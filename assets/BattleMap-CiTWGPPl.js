import{a as hn,s as tt,r as W,n as Y,m as nt,c as f,d as p,e as c,t as B,i as D,F as Q,p as le,x as ae,f as gs,h as De,v as Ye,D as He,I as bs,J as ys,o as mn,H as vn,K as Vt,g as M,q as Pe,L as Se,l as xs,M as ks,w as Me,N as yt,y as ws,k as Gt}from"./index-COA-MOPX.js";import{_ as Ts}from"./UserAvatar-BUMe_K1c.js";import{a as gn,b as at,f as Cs,F as be,C as we,e as bn,d as _s,u as Ss,H as Qt,M as Be,g as Ps,S as $s,T as Ke,L as Ue,h as ge,i as Ce,j as je,k as xt}from"./fillProfile-HTbvdPM0.js";const Es={class:"flex flex-col h-full bg-slate-950"},Ms={key:0,class:"h-full flex items-center justify-center"},As={class:"text-center max-w-md"},Is={class:"text-slate-600 text-sm"},Ds={class:"flex items-center justify-between text-xs text-slate-400 mb-1"},Rs={class:"font-semibold text-slate-200"},Ls={class:"text-base text-slate-100 whitespace-pre-line"},Fs={class:"border-t border-white/10 bg-slate-900/80 backdrop-blur px-6 py-4"},Ns={class:"flex gap-3 items-end max-w-4xl mx-auto"},Os=["disabled"],zs=["disabled"],Nr={__name:"ChatPanel",setup(e){const t=gn(),n=hn(),{messages:s,status:o,role:l,userProfiles:i}=tt(t),m=W(""),d=W(null),r=Y(()=>s.value.filter($=>$.type!=="system")),u=$=>{if($===n.userId)return{nickname:n.nickname||"Гость",avatar:n.avatar};const S=i.value.get($);return S?{nickname:S.nickname||"Гость",avatar:S.avatar}:{nickname:"Неизвестный",avatar:null}},g=Y(()=>l.value==="master"?["ready","in-room"].includes(o.value):o.value==="in-room");nt(()=>r.value.length,()=>{He(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})});const x=()=>{g.value&&(t.sendMessage(m.value),m.value="")},P=$=>{$.key==="Enter"&&!$.shiftKey&&($.preventDefault(),x())},y=$=>new Date($).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return($,S)=>(f(),p("div",Es,[c("div",{ref_key:"listRef",ref:d,class:"flex-1 overflow-y-auto px-6 py-6 space-y-4"},[r.value.length===0?(f(),p("div",Ms,[c("div",As,[S[1]||(S[1]=c("p",{class:"text-slate-500 text-lg mb-2"},"Чат пуст",-1)),c("p",Is,B(g.value?"Отправьте первое сообщение, чтобы начать переписку.":"Подключитесь к комнате, чтобы начать общение."),1)])])):D("",!0),(f(!0),p(Q,null,le(r.value,O=>(f(),p("article",{key:O.id,class:ae(["flex gap-3 items-start max-w-2xl",[O.senderRole==="master"?"ml-0 mr-auto":"",O.senderRole==="player"?"mr-0 ml-auto flex-row-reverse":""]])},[gs(Ts,{avatar:u(O.userId).avatar,name:u(O.userId).nickname,size:"md"},null,8,["avatar","name"]),c("div",{class:ae(["rounded-xl px-5 py-3 border flex-1",[O.senderRole==="master"?"bg-sky-500/10 border-sky-400/30":"",O.senderRole==="player"?"bg-emerald-500/10 border-emerald-400/20":""]])},[c("header",Ds,[c("span",Rs,B(u(O.userId).nickname),1),c("time",null,B(y(O.time)),1)]),c("p",Ls,B(O.text),1)],2)],2))),128))],512),c("footer",Fs,[c("div",Ns,[De(c("textarea",{"onUpdate:modelValue":S[0]||(S[0]=O=>m.value=O),class:"flex-1 min-h-[56px] max-h-[200px] rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-base text-slate-50 resize-none",placeholder:"Напишите сообщение...",disabled:!g.value,onKeydown:P,rows:"1"},null,40,Os),[[Ye,m.value]]),c("button",{type:"button",class:"h-[56px] px-6 rounded-xl bg-sky-500/20 border border-sky-400/60 font-semibold text-sky-100 hover:bg-sky-500/30 disabled:opacity-40 transition flex-shrink-0",disabled:!g.value||!m.value.trim(),onClick:x}," Отправить ",8,zs)])])]))}},Le=e=>{const t="/TriP/";return e.startsWith("/")?t.endsWith("/")?t+e.slice(1):t+e:t.endsWith("/")?t+e:t+"/"+e},Bs=e=>Le(`/images/presets/${e}.png`),Or=e=>Le(`/images/classes/${e}.png`),zr=e=>Le(`/images/items/${e}.png`),Br=(e,t,n="base")=>Le(`/images/races/${e}/${t}/${n}.png`),jr=e=>Le(`/images/gender/${e}.png`),yn=/^[a-z0-9]+(-[a-z0-9]+)*$/,ht=(e,t,n,s="")=>{const o=e.split(":");if(e.slice(0,1)==="@"){if(o.length<2||o.length>3)return null;s=o.shift().slice(1)}if(o.length>3||!o.length)return null;if(o.length>1){const m=o.pop(),d=o.pop(),r={provider:o.length>0?o[0]:s,prefix:d,name:m};return t&&!ct(r)?null:r}const l=o[0],i=l.split("-");if(i.length>1){const m={provider:s,prefix:i.shift(),name:i.join("-")};return t&&!ct(m)?null:m}if(n&&s===""){const m={provider:s,prefix:"",name:l};return t&&!ct(m,n)?null:m}return null},ct=(e,t)=>e?!!((t&&e.prefix===""||e.prefix)&&e.name):!1,xn=Object.freeze({left:0,top:0,width:16,height:16}),ft=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),mt=Object.freeze({...xn,...ft}),Pt=Object.freeze({...mt,body:"",hidden:!1});function js(e,t){const n={};!e.hFlip!=!t.hFlip&&(n.hFlip=!0),!e.vFlip!=!t.vFlip&&(n.vFlip=!0);const s=((e.rotate||0)+(t.rotate||0))%4;return s&&(n.rotate=s),n}function Kt(e,t){const n=js(e,t);for(const s in Pt)s in ft?s in e&&!(s in n)&&(n[s]=ft[s]):s in t?n[s]=t[s]:s in e&&(n[s]=e[s]);return n}function Hs(e,t){const n=e.icons,s=e.aliases||Object.create(null),o=Object.create(null);function l(i){if(n[i])return o[i]=[];if(!(i in o)){o[i]=null;const m=s[i]&&s[i].parent,d=m&&l(m);d&&(o[i]=[m].concat(d))}return o[i]}return Object.keys(n).concat(Object.keys(s)).forEach(l),o}function Ws(e,t,n){const s=e.icons,o=e.aliases||Object.create(null);let l={};function i(m){l=Kt(s[m]||o[m],l)}return i(t),n.forEach(i),Kt(e,l)}function kn(e,t){const n=[];if(typeof e!="object"||typeof e.icons!="object")return n;e.not_found instanceof Array&&e.not_found.forEach(o=>{t(o,null),n.push(o)});const s=Hs(e);for(const o in s){const l=s[o];l&&(t(o,Ws(e,o,l)),n.push(o))}return n}const Us={provider:"",aliases:{},not_found:{},...xn};function kt(e,t){for(const n in t)if(n in e&&typeof e[n]!=typeof t[n])return!1;return!0}function wn(e){if(typeof e!="object"||e===null)return null;const t=e;if(typeof t.prefix!="string"||!e.icons||typeof e.icons!="object"||!kt(e,Us))return null;const n=t.icons;for(const o in n){const l=n[o];if(!o||typeof l.body!="string"||!kt(l,Pt))return null}const s=t.aliases||Object.create(null);for(const o in s){const l=s[o],i=l.parent;if(!o||typeof i!="string"||!n[i]&&!s[i]||!kt(l,Pt))return null}return t}const Zt=Object.create(null);function qs(e,t){return{provider:e,prefix:t,icons:Object.create(null),missing:new Set}}function Xe(e,t){const n=Zt[e]||(Zt[e]=Object.create(null));return n[t]||(n[t]=qs(e,t))}function Tn(e,t){return wn(t)?kn(t,(n,s)=>{s?e.icons[n]=s:e.missing.add(n)}):[]}function Ys(e,t,n){try{if(typeof n.body=="string")return e.icons[t]={...n},!0}catch{}return!1}let ot=!1;function Cn(e){return typeof e=="boolean"&&(ot=e),ot}function Xs(e){const t=typeof e=="string"?ht(e,!0,ot):e;if(t){const n=Xe(t.provider,t.prefix),s=t.name;return n.icons[s]||(n.missing.has(s)?null:void 0)}}function Vs(e,t){const n=ht(e,!0,ot);if(!n)return!1;const s=Xe(n.provider,n.prefix);return t?Ys(s,n.name,t):(s.missing.add(n.name),!0)}function Gs(e,t){if(typeof e!="object")return!1;if(typeof t!="string"&&(t=e.provider||""),ot&&!t&&!e.prefix){let o=!1;return wn(e)&&(e.prefix="",kn(e,(l,i)=>{Vs(l,i)&&(o=!0)})),o}const n=e.prefix;if(!ct({prefix:n,name:"a"}))return!1;const s=Xe(t,n);return!!Tn(s,e)}const _n=Object.freeze({width:null,height:null}),Sn=Object.freeze({..._n,...ft}),Qs=/(-?[0-9.]*[0-9]+[0-9.]*)/g,Ks=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function Jt(e,t,n){if(t===1)return e;if(n=n||100,typeof e=="number")return Math.ceil(e*t*n)/n;if(typeof e!="string")return e;const s=e.split(Qs);if(s===null||!s.length)return e;const o=[];let l=s.shift(),i=Ks.test(l);for(;;){if(i){const m=parseFloat(l);isNaN(m)?o.push(l):o.push(Math.ceil(m*t*n)/n)}else o.push(l);if(l=s.shift(),l===void 0)return o.join("");i=!i}}function Zs(e,t="defs"){let n="";const s=e.indexOf("<"+t);for(;s>=0;){const o=e.indexOf(">",s),l=e.indexOf("</"+t);if(o===-1||l===-1)break;const i=e.indexOf(">",l);if(i===-1)break;n+=e.slice(o+1,l).trim(),e=e.slice(0,s).trim()+e.slice(i+1)}return{defs:n,content:e}}function Js(e,t){return e?"<defs>"+e+"</defs>"+t:t}function eo(e,t,n){const s=Zs(e);return Js(s.defs,t+s.content+n)}const to=e=>e==="unset"||e==="undefined"||e==="none";function no(e,t){const n={...mt,...e},s={...Sn,...t},o={left:n.left,top:n.top,width:n.width,height:n.height};let l=n.body;[n,s].forEach($=>{const S=[],O=$.hFlip,q=$.vFlip;let X=$.rotate;O?q?X+=2:(S.push("translate("+(o.width+o.left).toString()+" "+(0-o.top).toString()+")"),S.push("scale(-1 1)"),o.top=o.left=0):q&&(S.push("translate("+(0-o.left).toString()+" "+(o.height+o.top).toString()+")"),S.push("scale(1 -1)"),o.top=o.left=0);let w;switch(X<0&&(X-=Math.floor(X/4)*4),X=X%4,X){case 1:w=o.height/2+o.top,S.unshift("rotate(90 "+w.toString()+" "+w.toString()+")");break;case 2:S.unshift("rotate(180 "+(o.width/2+o.left).toString()+" "+(o.height/2+o.top).toString()+")");break;case 3:w=o.width/2+o.left,S.unshift("rotate(-90 "+w.toString()+" "+w.toString()+")");break}X%2===1&&(o.left!==o.top&&(w=o.left,o.left=o.top,o.top=w),o.width!==o.height&&(w=o.width,o.width=o.height,o.height=w)),S.length&&(l=eo(l,'<g transform="'+S.join(" ")+'">',"</g>"))});const i=s.width,m=s.height,d=o.width,r=o.height;let u,g;i===null?(g=m===null?"1em":m==="auto"?r:m,u=Jt(g,d/r)):(u=i==="auto"?d:i,g=m===null?Jt(u,r/d):m==="auto"?r:m);const x={},P=($,S)=>{to(S)||(x[$]=S.toString())};P("width",u),P("height",g);const y=[o.left,o.top,d,r];return x.viewBox=y.join(" "),{attributes:x,viewBox:y,body:l}}const so=/\sid="(\S+)"/g,oo="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let ao=0;function lo(e,t=oo){const n=[];let s;for(;s=so.exec(e);)n.push(s[1]);if(!n.length)return e;const o="suffix"+(Math.random()*16777216|Date.now()).toString(16);return n.forEach(l=>{const i=typeof t=="function"?t(l):t+(ao++).toString(),m=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp('([#;"])('+m+')([")]|\\.[a-z])',"g"),"$1"+i+o+"$3")}),e=e.replace(new RegExp(o,"g"),""),e}const $t=Object.create(null);function io(e,t){$t[e]=t}function Et(e){return $t[e]||$t[""]}function At(e){let t;if(typeof e.resources=="string")t=[e.resources];else if(t=e.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:e.path||"/",maxURL:e.maxURL||500,rotate:e.rotate||750,timeout:e.timeout||5e3,random:e.random===!0,index:e.index||0,dataAfterTimeout:e.dataAfterTimeout!==!1}}const It=Object.create(null),Ze=["https://api.simplesvg.com","https://api.unisvg.com"],ut=[];for(;Ze.length>0;)Ze.length===1||Math.random()>.5?ut.push(Ze.shift()):ut.push(Ze.pop());It[""]=At({resources:["https://api.iconify.design"].concat(ut)});function ro(e,t){const n=At(t);return n===null?!1:(It[e]=n,!0)}function Dt(e){return It[e]}const co=()=>{let e;try{if(e=fetch,typeof e=="function")return e}catch{}};let en=co();function uo(e,t){const n=Dt(e);if(!n)return 0;let s;if(!n.maxURL)s=0;else{let o=0;n.resources.forEach(i=>{o=Math.max(o,i.length)});const l=t+".json?icons=";s=n.maxURL-o-n.path.length-l.length}return s}function fo(e){return e===404}const po=(e,t,n)=>{const s=[],o=uo(e,t),l="icons";let i={type:l,provider:e,prefix:t,icons:[]},m=0;return n.forEach((d,r)=>{m+=d.length+1,m>=o&&r>0&&(s.push(i),i={type:l,provider:e,prefix:t,icons:[]},m=d.length),i.icons.push(d)}),s.push(i),s};function ho(e){if(typeof e=="string"){const t=Dt(e);if(t)return t.path}return"/"}const mo=(e,t,n)=>{if(!en){n("abort",424);return}let s=ho(t.provider);switch(t.type){case"icons":{const l=t.prefix,m=t.icons.join(","),d=new URLSearchParams({icons:m});s+=l+".json?"+d.toString();break}case"custom":{const l=t.uri;s+=l.slice(0,1)==="/"?l.slice(1):l;break}default:n("abort",400);return}let o=503;en(e+s).then(l=>{const i=l.status;if(i!==200){setTimeout(()=>{n(fo(i)?"abort":"next",i)});return}return o=501,l.json()}).then(l=>{if(typeof l!="object"||l===null){setTimeout(()=>{l===404?n("abort",l):n("next",o)});return}setTimeout(()=>{n("success",l)})}).catch(()=>{n("next",o)})},vo={prepare:po,send:mo};function go(e){const t={loaded:[],missing:[],pending:[]},n=Object.create(null);e.sort((o,l)=>o.provider!==l.provider?o.provider.localeCompare(l.provider):o.prefix!==l.prefix?o.prefix.localeCompare(l.prefix):o.name.localeCompare(l.name));let s={provider:"",prefix:"",name:""};return e.forEach(o=>{if(s.name===o.name&&s.prefix===o.prefix&&s.provider===o.provider)return;s=o;const l=o.provider,i=o.prefix,m=o.name,d=n[l]||(n[l]=Object.create(null)),r=d[i]||(d[i]=Xe(l,i));let u;m in r.icons?u=t.loaded:i===""||r.missing.has(m)?u=t.missing:u=t.pending;const g={provider:l,prefix:i,name:m};u.push(g)}),t}function Pn(e,t){e.forEach(n=>{const s=n.loaderCallbacks;s&&(n.loaderCallbacks=s.filter(o=>o.id!==t))})}function bo(e){e.pendingCallbacksFlag||(e.pendingCallbacksFlag=!0,setTimeout(()=>{e.pendingCallbacksFlag=!1;const t=e.loaderCallbacks?e.loaderCallbacks.slice(0):[];if(!t.length)return;let n=!1;const s=e.provider,o=e.prefix;t.forEach(l=>{const i=l.icons,m=i.pending.length;i.pending=i.pending.filter(d=>{if(d.prefix!==o)return!0;const r=d.name;if(e.icons[r])i.loaded.push({provider:s,prefix:o,name:r});else if(e.missing.has(r))i.missing.push({provider:s,prefix:o,name:r});else return n=!0,!0;return!1}),i.pending.length!==m&&(n||Pn([e],l.id),l.callback(i.loaded.slice(0),i.missing.slice(0),i.pending.slice(0),l.abort))})}))}let yo=0;function xo(e,t,n){const s=yo++,o=Pn.bind(null,n,s);if(!t.pending.length)return o;const l={id:s,icons:t,callback:e,abort:o};return n.forEach(i=>{(i.loaderCallbacks||(i.loaderCallbacks=[])).push(l)}),o}function ko(e,t=!0,n=!1){const s=[];return e.forEach(o=>{const l=typeof o=="string"?ht(o,t,n):o;l&&s.push(l)}),s}var wo={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function To(e,t,n,s){const o=e.resources.length,l=e.random?Math.floor(Math.random()*o):e.index;let i;if(e.random){let A=e.resources.slice(0);for(i=[];A.length>1;){const T=Math.floor(Math.random()*A.length);i.push(A[T]),A=A.slice(0,T).concat(A.slice(T+1))}i=i.concat(A)}else i=e.resources.slice(l).concat(e.resources.slice(0,l));const m=Date.now();let d="pending",r=0,u,g=null,x=[],P=[];typeof s=="function"&&P.push(s);function y(){g&&(clearTimeout(g),g=null)}function $(){d==="pending"&&(d="aborted"),y(),x.forEach(A=>{A.status==="pending"&&(A.status="aborted")}),x=[]}function S(A,T){T&&(P=[]),typeof A=="function"&&P.push(A)}function O(){return{startTime:m,payload:t,status:d,queriesSent:r,queriesPending:x.length,subscribe:S,abort:$}}function q(){d="failed",P.forEach(A=>{A(void 0,u)})}function X(){x.forEach(A=>{A.status==="pending"&&(A.status="aborted")}),x=[]}function w(A,T,I){const z=T!=="success";switch(x=x.filter(U=>U!==A),d){case"pending":break;case"failed":if(z||!e.dataAfterTimeout)return;break;default:return}if(T==="abort"){u=I,q();return}if(z){u=I,x.length||(i.length?N():q());return}if(y(),X(),!e.random){const U=e.resources.indexOf(A.resource);U!==-1&&U!==e.index&&(e.index=U)}d="completed",P.forEach(U=>{U(I)})}function N(){if(d!=="pending")return;y();const A=i.shift();if(A===void 0){if(x.length){g=setTimeout(()=>{y(),d==="pending"&&(X(),q())},e.timeout);return}q();return}const T={status:"pending",resource:A,callback:(I,z)=>{w(T,I,z)}};x.push(T),r++,g=setTimeout(N,e.rotate),n(A,t,T.callback)}return setTimeout(N),O}function $n(e){const t={...wo,...e};let n=[];function s(){n=n.filter(m=>m().status==="pending")}function o(m,d,r){const u=To(t,m,d,(g,x)=>{s(),r&&r(g,x)});return n.push(u),u}function l(m){return n.find(d=>m(d))||null}return{query:o,find:l,setIndex:m=>{t.index=m},getIndex:()=>t.index,cleanup:s}}function tn(){}const wt=Object.create(null);function Co(e){if(!wt[e]){const t=Dt(e);if(!t)return;const n=$n(t),s={config:t,redundancy:n};wt[e]=s}return wt[e]}function _o(e,t,n){let s,o;if(typeof e=="string"){const l=Et(e);if(!l)return n(void 0,424),tn;o=l.send;const i=Co(e);i&&(s=i.redundancy)}else{const l=At(e);if(l){s=$n(l);const i=e.resources?e.resources[0]:"",m=Et(i);m&&(o=m.send)}}return!s||!o?(n(void 0,424),tn):s.query(t,o,n)().abort}function nn(){}function So(e){e.iconsLoaderFlag||(e.iconsLoaderFlag=!0,setTimeout(()=>{e.iconsLoaderFlag=!1,bo(e)}))}function Po(e){const t=[],n=[];return e.forEach(s=>{(s.match(yn)?t:n).push(s)}),{valid:t,invalid:n}}function Je(e,t,n){function s(){const o=e.pendingIcons;t.forEach(l=>{o&&o.delete(l),e.icons[l]||e.missing.add(l)})}if(n&&typeof n=="object")try{if(!Tn(e,n).length){s();return}}catch(o){console.error(o)}s(),So(e)}function sn(e,t){e instanceof Promise?e.then(n=>{t(n)}).catch(()=>{t(null)}):t(e)}function $o(e,t){e.iconsToLoad?e.iconsToLoad=e.iconsToLoad.concat(t).sort():e.iconsToLoad=t,e.iconsQueueFlag||(e.iconsQueueFlag=!0,setTimeout(()=>{e.iconsQueueFlag=!1;const{provider:n,prefix:s}=e,o=e.iconsToLoad;if(delete e.iconsToLoad,!o||!o.length)return;const l=e.loadIcon;if(e.loadIcons&&(o.length>1||!l)){sn(e.loadIcons(o,s,n),u=>{Je(e,o,u)});return}if(l){o.forEach(u=>{const g=l(u,s,n);sn(g,x=>{const P=x?{prefix:s,icons:{[u]:x}}:null;Je(e,[u],P)})});return}const{valid:i,invalid:m}=Po(o);if(m.length&&Je(e,m,null),!i.length)return;const d=s.match(yn)?Et(n):null;if(!d){Je(e,i,null);return}d.prepare(n,s,i).forEach(u=>{_o(n,u,g=>{Je(e,u.icons,g)})})}))}const Eo=(e,t)=>{const n=ko(e,!0,Cn()),s=go(n);if(!s.pending.length){let d=!0;return t&&setTimeout(()=>{d&&t(s.loaded,s.missing,s.pending,nn)}),()=>{d=!1}}const o=Object.create(null),l=[];let i,m;return s.pending.forEach(d=>{const{provider:r,prefix:u}=d;if(u===m&&r===i)return;i=r,m=u,l.push(Xe(r,u));const g=o[r]||(o[r]=Object.create(null));g[u]||(g[u]=[])}),s.pending.forEach(d=>{const{provider:r,prefix:u,name:g}=d,x=Xe(r,u),P=x.pendingIcons||(x.pendingIcons=new Set);P.has(g)||(P.add(g),o[r][u].push(g))}),l.forEach(d=>{const r=o[d.provider][d.prefix];r.length&&$o(d,r)}),t?xo(t,s,l):nn};function Mo(e,t){const n={...e};for(const s in t){const o=t[s],l=typeof o;s in _n?(o===null||o&&(l==="string"||l==="number"))&&(n[s]=o):l===typeof n[s]&&(n[s]=s==="rotate"?o%4:o)}return n}const Ao=/[\s,]+/;function Io(e,t){t.split(Ao).forEach(n=>{switch(n.trim()){case"horizontal":e.hFlip=!0;break;case"vertical":e.vFlip=!0;break}})}function Do(e,t=0){const n=e.replace(/^-?[0-9.]*/,"");function s(o){for(;o<0;)o+=4;return o%4}if(n===""){const o=parseInt(e);return isNaN(o)?0:s(o)}else if(n!==e){let o=0;switch(n){case"%":o=25;break;case"deg":o=90}if(o){let l=parseFloat(e.slice(0,e.length-n.length));return isNaN(l)?0:(l=l/o,l%1===0?s(l):0)}}return t}function Ro(e,t){let n=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const s in t)n+=" "+s+'="'+t[s]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+n+">"+e+"</svg>"}function Lo(e){return e.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function Fo(e){return"data:image/svg+xml,"+Lo(e)}function No(e){return'url("'+Fo(e)+'")'}const on={...Sn,inline:!1},Oo={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},zo={display:"inline-block"},Mt={backgroundColor:"currentColor"},En={backgroundColor:"transparent"},an={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},ln={webkitMask:Mt,mask:Mt,background:En};for(const e in ln){const t=ln[e];for(const n in an)t[e+n]=an[n]}const dt={};["horizontal","vertical"].forEach(e=>{const t=e.slice(0,1)+"Flip";dt[e+"-flip"]=t,dt[e.slice(0,1)+"-flip"]=t,dt[e+"Flip"]=t});function rn(e){return e+(e.match(/^[-0-9.]+$/)?"px":"")}const cn=(e,t)=>{const n=Mo(on,t),s={...Oo},o=t.mode||"svg",l={},i=t.style,m=typeof i=="object"&&!(i instanceof Array)?i:{};for(let $ in t){const S=t[$];if(S!==void 0)switch($){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":n[$]=S===!0||S==="true"||S===1;break;case"flip":typeof S=="string"&&Io(n,S);break;case"color":l.color=S;break;case"rotate":typeof S=="string"?n[$]=Do(S):typeof S=="number"&&(n[$]=S);break;case"ariaHidden":case"aria-hidden":S!==!0&&S!=="true"&&delete s["aria-hidden"];break;default:{const O=dt[$];O?(S===!0||S==="true"||S===1)&&(n[O]=!0):on[$]===void 0&&(s[$]=S)}}}const d=no(e,n),r=d.attributes;if(n.inline&&(l.verticalAlign="-0.125em"),o==="svg"){s.style={...l,...m},Object.assign(s,r);let $=0,S=t.id;return typeof S=="string"&&(S=S.replace(/-/g,"_")),s.innerHTML=lo(d.body,S?()=>S+"ID"+$++:"iconifyVue"),Vt("svg",s)}const{body:u,width:g,height:x}=e,P=o==="mask"||(o==="bg"?!1:u.indexOf("currentColor")!==-1),y=Ro(u,{...r,width:g+"",height:x+""});return s.style={...l,"--svg":No(y),width:rn(r.width),height:rn(r.height),...zo,...P?Mt:En,...m},Vt("span",s)};Cn(!0);io("",vo);if(typeof document<"u"&&typeof window<"u"){const e=window;if(e.IconifyPreload!==void 0){const t=e.IconifyPreload,n="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(s=>{try{(typeof s!="object"||s===null||s instanceof Array||typeof s.icons!="object"||typeof s.prefix!="string"||!Gs(s))&&console.error(n)}catch{console.error(n)}})}if(e.IconifyProviders!==void 0){const t=e.IconifyProviders;if(typeof t=="object"&&t!==null)for(let n in t){const s="IconifyProviders["+n+"] is invalid.";try{const o=t[n];if(typeof o!="object"||!o||o.resources===void 0)continue;ro(n,o)||console.error(s)}catch{console.error(s)}}}}const Bo={...mt,body:""},Hr=bs((e,{emit:t})=>{const n=W(null);function s(){var r,u;n.value&&((u=(r=n.value).abort)==null||u.call(r),n.value=null)}const o=W(!!e.ssr),l=W(""),i=ys(null);function m(){const r=e.icon;if(typeof r=="object"&&r!==null&&typeof r.body=="string")return l.value="",{data:r};let u;if(typeof r!="string"||(u=ht(r,!1,!0))===null)return null;let g=Xs(u);if(!g){const y=n.value;return(!y||y.name!==r)&&(g===null?n.value={name:r}:n.value={name:r,abort:Eo([u],d)}),null}s(),l.value!==r&&(l.value=r,He(()=>{t("load",r)}));const x=e.customise;if(x){g=Object.assign({},g);const y=x(g.body,u.name,u.prefix,u.provider);typeof y=="string"&&(g.body=y)}const P=["iconify"];return u.prefix!==""&&P.push("iconify--"+u.prefix),u.provider!==""&&P.push("iconify--"+u.provider),{data:g,classes:P}}function d(){var u;const r=m();r?r.data!==((u=i.value)==null?void 0:u.data)&&(i.value=r):i.value=null}return o.value?d():mn(()=>{o.value=!0,d()}),nt(()=>e.icon,d),vn(s),()=>{const r=i.value;if(!r)return cn(Bo,e);let u=e;return r.classes&&(u={...e,class:r.classes.join(" ")}),cn({...mt,...r.data},u)}},{props:["icon","mode","ssr","width","height","style","color","inline","rotate","hFlip","horizontalFlip","vFlip","verticalFlip","flip","id","ariaHidden","customise","title"],emits:["load"]}),jo=[{id:"war",name:"Война",nameEn:"War",description:"Физическая сила, боевые навыки, агрессия и доминирование",characteristic:{name:"Мощь",nameEn:"Might",abbreviation:"MIG"},check:{name:"Конфликт",nameEn:"Conflict",description:"Проверки прямого противостояния, боя и физической силы"},mode:{name:"Напористо",nameEn:"Assertive",icon:"game-icons:fist",description:"Действуйте решительно и прямолинейно",bonuses:[]},color:"#dc2626",colorName:"red",icon:"game-icons:crossed-swords",characteristicIcon:"game-icons:embrassed-energy",checkIcon:"game-icons:arrow-scope",position:{angle:330,corner:"top-left",description:"Верхний левый угол шестиугольника"},neighbors:["nature","knowledge"],opposite:"shadow",axis:{id:"power",name:"Сила",nameEn:"Power",pole:"active"}},{id:"knowledge",name:"Знание",nameEn:"Knowledge",description:"Интеллект, логика, наука и аналитическое мышление",characteristic:{name:"Разум",nameEn:"Reason",abbreviation:"REA"},check:{name:"Порядок",nameEn:"Order",description:"Проверки знаний, логики и систематического подхода"},mode:{name:"Рассудительно",nameEn:"Deliberate",icon:"game-icons:brain",description:"Анализируйте и планируйте каждый шаг",bonuses:[]},color:"#3b82f7",colorName:"blue",icon:"game-icons:open-book",characteristicIcon:"game-icons:inspiration",checkIcon:"game-icons:materials-science",position:{angle:30,corner:"top-right",description:"Верхний правый угол шестиугольника"},neighbors:["war","community"],opposite:"mysticism",axis:{id:"progress",name:"Развитие",nameEn:"Progress",pole:"rational"}},{id:"community",name:"Общество",nameEn:"Community",description:"Социальные связи, лидерство, убеждение и дипломатия",characteristic:{name:"Харизма",nameEn:"Charisma",abbreviation:"CHA"},check:{name:"Влияние",nameEn:"Influence",description:"Проверки социального взаимодействия и убеждения"},mode:{name:"Выразительно",nameEn:"Expressive",icon:"game-icons:conversation",description:"Общайтесь открыто и убедительно",bonuses:[]},color:"#f59e0b",colorName:"amber",icon:"game-icons:human-pyramid",characteristicIcon:"game-icons:cheerful",checkIcon:"game-icons:caesar",position:{angle:90,corner:"right",description:"Правый угол шестиугольника"},neighbors:["knowledge","shadow"],opposite:"nature",axis:{id:"path",name:"Путь",nameEn:"Path",pole:"civilization"}},{id:"shadow",name:"Тень",nameEn:"Shadow",description:"Скрытность, обман, манипуляция и тайные действия",characteristic:{name:"Хитрость",nameEn:"Cunning",abbreviation:"CUN"},check:{name:"Коварство",nameEn:"Treachery",description:"Проверки скрытности, обмана и манипуляций"},mode:{name:"Скрытно",nameEn:"Stealthy",icon:"game-icons:ninja-mask",description:"Действуйте незаметно и осторожно",bonuses:[]},color:"#374151",colorName:"gray",icon:"game-icons:cowled",characteristicIcon:"game-icons:domino-mask",checkIcon:"game-icons:hooded-figure",position:{angle:150,corner:"bottom-right",description:"Нижний правый угол шестиугольника"},neighbors:["community","mysticism"],opposite:"war",axis:{id:"power",name:"Сила",nameEn:"Power",pole:"subtle"}},{id:"mysticism",name:"Мистика",nameEn:"Mysticism",description:"Магия, духовность, интуиция и связь с потусторонним",characteristic:{name:"Интуиция",nameEn:"Intuition",abbreviation:"INT"},check:{name:"Хаос",nameEn:"Chaos",description:"Проверки магии, интуиции и духовной связи"},mode:{name:"Чутко",nameEn:"Intuitive",icon:"game-icons:third-eye",description:"Доверьтесь интуиции и предчувствиям",bonuses:[]},color:"#9333ea",colorName:"purple",icon:"game-icons:pentacle",characteristicIcon:"game-icons:coiling-curl",checkIcon:"game-icons:small-fire",position:{angle:210,corner:"bottom-left",description:"Нижний левый угол шестиугольника"},neighbors:["shadow","nature"],opposite:"knowledge",axis:{id:"progress",name:"Развитие",nameEn:"Progress",pole:"intuitive"}},{id:"nature",name:"Природа",nameEn:"Nature",description:"Связь с природой, выживание, животные инстинкты и гармония",characteristic:{name:"Восприятие",nameEn:"Perception",abbreviation:"PER"},check:{name:"Поиск",nameEn:"Search",description:"Проверки наблюдательности, выживания и связи с природой"},mode:{name:"Внимательно",nameEn:"Watchful",icon:"game-icons:eagle-emblem",description:"Наблюдайте и замечайте детали",bonuses:[]},color:"#22c55e",colorName:"green",icon:"game-icons:curled-leaf",characteristicIcon:"game-icons:semi-closed-eye",checkIcon:"game-icons:spyglass",position:{angle:270,corner:"left",description:"Левый угол шестиугольника"},neighbors:["mysticism","war"],opposite:"community",axis:{id:"path",name:"Путь",nameEn:"Path",pole:"wilderness"}}],Ho=[{id:"power",name:"Сила",nameEn:"Power",description:"Ось силы: от прямой физической мощи до скрытого влияния",aspects:["war","shadow"],poles:{active:{aspect:"war",description:"Прямое действие, открытая сила, доминирование"},subtle:{aspect:"shadow",description:"Скрытое влияние, манипуляция, тайные действия"}}},{id:"progress",name:"Развитие",nameEn:"Progress",description:"Ось развития: от рационального познания до интуитивного понимания",aspects:["knowledge","mysticism"],poles:{rational:{aspect:"knowledge",description:"Логика, наука, аналитическое мышление"},intuitive:{aspect:"mysticism",description:"Интуиция, магия, духовное познание"}}},{id:"path",name:"Путь",nameEn:"Path",description:"Ось пути: от дикой природы до цивилизованного общества",aspects:["nature","community"],poles:{wilderness:{aspect:"nature",description:"Природа, инстинкты, гармония с окружением"},civilization:{aspect:"community",description:"Общество, культура, социальные структуры"}}}],Wo={systemName:"triP",systemFullName:"Triple P System",systemDescription:"Система трёх осей: Power (Сила), Progress (Развитие), Path (Путь)",version:"1.0",aspectCount:6,axisCount:3,circularOrder:["war","knowledge","community","shadow","mysticism","nature"]},Uo={aspects:jo,axes:Ho,metadata:Wo},qo=[{id:"clothes",category:"armor",subcat:"light",name:"Обычная одежда",desc:"Надевать такую в бой - довольно сомнительная затея. Однако на полях сражений нередко оказывались те, кто не смог себе позволить вовсе никакую броню. А иногда и серьёзных воинов нападение заставало не готовыми, погружёнными в обычные бытовые проблемы.",price:1,epoch:1,defence:0,resist:0,movement:0,bursts:0},{id:"makeshift_light_armor",category:"armor",subcat:"light",name:"Крепкая одежда",desc:"Некоторые виды одежды лучше других держат удар, что позволяет использовать их в качестве импровизированной брони. Это может быть куртка из толстой кожи, шкура зверя или вовсе обычные одеяния, на которые нашили твёрдые элементы.",price:3,epoch:2,defence:3,resist:0,movement:0,bursts:0},{id:"makeshift_heavy_armor",category:"armor",subcat:"heavy",name:"Кустарная тяжёлая броня",desc:"Хорошенько потрудившись, можно сделать из обычной одежды некое подобие брони. Обилие нашитых элементов здорово сковывает движение, зато такой доспех снижает входящий урон и (главное), очень дёшев в производстве.",price:3,epoch:2,defence:0,resist:1,movement:-1,bursts:-1},{id:"light_armor",category:"armor",subcat:"light",name:"Лёгкая броня",desc:"Лёгкая броня не сковывает движений и даёт кое-какую защиту - попасть в уязвимое место противнику становится значительно сложнее.",price:5,epoch:4,defence:6,resist:0,movement:0,bursts:0},{id:"heavy_armor",category:"armor",subcat:"heavy",name:"Тяжёлая броня",desc:"Хорошая тяжёлая броня лишь немного сковывает движения, но уворачиваться в ней уже гораздо сложнее. Зато, если по Вам всё же попали, урона Вы получите значительно меньше.",price:5,epoch:4,defence:0,resist:1,movement:-1,bursts:0},{id:"late_light_armor",category:"armor",subcat:"light",name:"Поздняя лёгкая броня",desc:"Позволить себе такой шедевр мастерства бронников могут не многие, зато живут на поле боя эти счастливчики гораздо дольше других. Защищённых областей на теле больше, а маневренность при этом никак не страдает.",price:7,epoch:6,defence:12,resist:0,movement:0,bursts:0},{id:"late_medium_armor",category:"armor",subcat:"middle",name:"Поздняя средняя броня",desc:"Хороший компромисс между подвижностью и защищённостью, но по совершенно бескомпромиссной цене.",price:7,epoch:6,defence:3,resist:1,movement:0,bursts:0},{id:"late_heavy_armor",category:"armor",subcat:"heavy",name:"Поздняя тяжёлая броня",desc:"Для тех, кто хочет почувствовать себя настоящим танком на поле боя - беспрецедентный уровень защищённости при минимальной подвижности. Несмотря на огромную цену этих доспехов, вряд ли найдётся идиот, который захочет сразиться с Вами ради такого трофея.",price:7,epoch:6,defence:0,resist:2,movement:-1,bursts:0},{id:"simple_spear",category:"weapon",subcat:"spears",name:"Простое копьё",desc:"",length:2,hands:1,price:2,epoch:2,attack:4,defence:3,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар"}},{id:"iron_spear",category:"weapon",subcat:"spears",name:"Железное копьё",desc:"",length:2,hands:1,price:4,epoch:4,attack:5,defence:3,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",4:"Точный удар",6:"Тяжёлый урон"}},{id:"steel_spear",category:"weapon",subcat:"spears",name:"Стальное копьё",desc:"",length:2,hands:1,price:6,epoch:6,attack:6,defence:4,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",4:"Точный удар",6:"Тяжёлый урон",9:"Огромный урон"}},{id:"iron_glaive",category:"weapon",subcat:"spears",name:"Глефа",desc:"",length:2,hands:2,price:5,epoch:5,attack:6,defence:2,damageType:"Рубящий",armorPen:0,damage:{0:"Лёгкий урон",3:"Тяжёлый урон",6:"Точный удар",9:"Огромный урон"}},{id:"steel_glaive",category:"weapon",subcat:"spears",name:"Стальная глефа",desc:"",length:2,hands:2,price:7,epoch:7,attack:8,defence:4,damageType:"Рубящий",armorPen:0,damage:{0:"Лёгкий урон",2:"Тяжёлый урон",4:"Точный удар",8:"Огромный урон"}},{id:"iron_halberd",category:"weapon",subcat:"spears",name:"Алебарда",desc:"",length:2,hands:2,price:5,epoch:5,attack:4,defence:3,damageType:"Рубящий",armorPen:0,damage:{0:"Лёгкий урон",2:"Тяжёлый урон",6:"Огромный урон"}},{id:"steel_halberd",category:"weapon",subcat:"spears",name:"Стальная алебарда",desc:"",length:2,hands:2,price:7,epoch:7,attack:5,defence:4,damageType:"Рубящий",armorPen:0,damage:{0:"Лёгкий урон",2:"Тяжёлый урон",6:"Огромный урон"}},{id:"simple_bow",category:"weapon",subcat:"bows",name:"Короткий лук",desc:"",spec:"Нельзя стрелять с порывом",length:2,hands:2,price:3,epoch:2,attack:6,defence:0,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар"}},{id:"strong_bow",category:"weapon",subcat:"bows",name:"Боевой лук",desc:"",spec:"",length:2,hands:2,price:4,epoch:4,attack:6,defence:0,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар",9:"Тяжёлый урон"}},{id:"longbow",category:"weapon",subcat:"bows",name:"Длинный лук",desc:"",spec:"Нельзя стрелять без порыва. Можно вкладывать в выстрел второй порыв, тогда игнорирует единицу брони.",length:2,hands:2,price:5,epoch:4,attack:6,defence:0,damageType:"Колющий",armorPen:0,damage:{0:"Лёгкий урон",3:"Точный удар",6:"Тяжёлый урон",12:"Огромный урон"}},{id:"stone_knife",category:"weapon",subcat:"daggers",name:"Простой нож",desc:"",length:1,hands:.5,price:1,epoch:1,attack:2,defence:0,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",5:"Точный удар"}},{id:"knife",category:"weapon",subcat:"daggers",name:"Добротный нож",desc:"",length:1,hands:.5,price:2,epoch:2,attack:2,defence:1,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",3:"Точный удар"}},{id:"steel_dagger",category:"weapon",subcat:"daggers",name:"Cтальной кинжал",desc:"",length:1,hands:.5,price:5,epoch:4,attack:3,defence:1,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",3:"Точный удар",4:"Тяжёлый урон"}},{id:"stiletto",category:"weapon",subcat:"daggers",name:"Стилет",desc:"Стилет не особенно то удобен в бою, зато замечательно пронзает многие виды доспехов.",length:1,hands:.5,price:6,epoch:5,attack:2,defence:0,damageType:"Колющий",armorPen:2,damage:{0:"Царапина",2:"Лёгкий урон",3:"Точный удар",6:"Тяжёлый урон"}},{id:"main_gauche",category:"weapon",subcat:"daggers",name:"Дага",desc:"Дага - преимущественно защитный кинжал во вторую руку, тем не менее может применяться и для нанесения серьёзных ударов. Особенно, если вражеская защита пробита. Атаки дагой во второй руке могут наносить ту же категорию ранения, что и атаки основным оружием, а не на категорию ниже, как обычно.",length:1,hands:1,price:6,epoch:5,attack:2,defence:4,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",3:"Точный удар",6:"Тяжёлый урон"}},{id:"wooden_flail",category:"weapon",subcat:"flails",name:"Цеп",desc:"",length:1,hands:1,price:1,epoch:2,attack:6,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",3:"Лёгкий урон"}},{id:"iron_flail",category:"weapon",subcat:"flails",name:"Железный цеп",desc:"",length:2,hands:1,price:5,epoch:4,attack:8,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",6:"Лёгкий урон",12:"Тяжёлый урон",15:"Точный удар"}},{id:"steel_flail",category:"weapon",subcat:"flails",name:"Стальной цеп",desc:"",length:2,hands:1,price:6,epoch:6,attack:9,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",6:"Лёгкий урон",9:"Тяжёлый урон",12:"Точный удар"}},{id:"wooden_club",category:"weapon",subcat:"maces",name:"Дубинка",desc:"",length:1,hands:1,price:1,epoch:1,attack:2,defence:2,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",6:"Лёгкий урон"}},{id:"simple_staff",category:"weapon",subcat:"maces",name:"Простой посох",desc:"",length:2,hands:2,price:1,epoch:1,attack:2,defence:2,damageType:"Дробящий",armorPen:0,damage:{0:"Царапина",6:"Лёгкий урон"}},{id:"battle_staff",category:"weapon",subcat:"maces",name:"Боевой посох",desc:"",length:2,hands:2,price:3,epoch:3,attack:4,defence:2,damageType:"Дробящий",armorPen:0,damage:{0:"Царапина",5:"Лёгкий урон",10:"Тяжёлый урон"}},{id:"steel_staff",category:"weapon",subcat:"maces",name:"Стальной посох",desc:"",length:2,hands:2,price:5,epoch:5,attack:4,defence:4,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",5:"Лёгкий урон",10:"Тяжёлый урон"}},{id:"iron_mace",category:"weapon",subcat:"maces",name:"Булава",desc:"",length:1,hands:1,price:5,epoch:4,attack:4,defence:2,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",6:"Тяжёлый урон",12:"Точный удар"}},{id:"steel_mace",category:"weapon",subcat:"maces",name:"Стальная булава",desc:"",length:1,hands:1,price:7,epoch:6,attack:5,defence:3,damageType:"Дробящий",armorPen:1,damage:{0:"Царапина",2:"Лёгкий урон",4:"Тяжёлый урон",6:"Точный удар"}},{id:"simple_axe",category:"weapon",subcat:"axes",name:"Плотницкий топор",desc:"",length:1,hands:1,price:2,epoch:1,attack:4,defence:2,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",8:"Тяжёлый урон",9:"Точный удар"}},{id:"battle_axe",category:"weapon",subcat:"axes",name:"Боевой топорик",desc:"",length:1,hands:1,price:5,epoch:4,attack:6,defence:3,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар",9:"Тяжёлый урон"}},{id:"steel_axe",category:"weapon",subcat:"axes",name:"Стальной топор",desc:"",length:1,hands:1,price:6,epoch:7,attack:8,defence:3,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",4:"Точный удар",6:"Тяжёлый урон"}},{id:"battle_greataxe",category:"weapon",subcat:"axes",name:"Двуручный топор",desc:"",length:2,hands:2,price:6,epoch:5,attack:6,defence:3,damageType:"Режущий",armorPen:0,damage:{0:"Лёгкий урон",3:"Тяжёлый урон",9:"Огромный урон",12:"Точный удар"}},{id:"steel_greataxe",category:"weapon",subcat:"axes",name:"Стальной двуручный топор",desc:"",length:2,hands:2,price:7,epoch:7,attack:8,defence:3,damageType:"Режущий",armorPen:0,damage:{0:"Лёгкий урон",2:"Тяжёлый урон",8:"Огромный урон",10:"Точный удар"}},{id:"stone_hammer",category:"weapon",subcat:"maces",name:"Каменный молоток",desc:"",length:1,hands:1,price:2,epoch:2,attack:2,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Лёгкий урон",6:"Тяжёлый урон",12:"Точный удар"}},{id:"stone_greathammer",category:"weapon",subcat:"maces",name:"Каменная кувалда",desc:"",length:2,hands:2,price:2,epoch:2,attack:0,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Тяжёлый урон",6:"Огромный урон"}},{id:"iron_hammer",category:"weapon",subcat:"maces",name:"Железный молот",desc:"",length:1,hands:1,price:3,epoch:3,attack:3,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Лёгкий урон",5:"Тяжёлый урон",10:"Точный удар"}},{id:"iron_greathammer",category:"weapon",subcat:"maces",name:"Железная кувалда",desc:"",length:2,hands:2,price:5,epoch:4,attack:0,defence:0,damageType:"Дробящий",armorPen:1,damage:{0:"Тяжёлый урон",5:"Огромный урон"}},{id:"iron_warhammer",category:"weapon",subcat:"maces",name:"Железный боевой молот",desc:"",length:1,hands:1,price:4,epoch:4,attack:4,defence:0,damageType:"Дробящий",armorPen:2,damage:{0:"Лёгкий урон",6:"Тяжёлый урон",12:"Точный удар"}},{id:"iron_greatwarhammer",category:"weapon",subcat:"maces",name:"Двуручный боевой молот",desc:"",length:2,hands:2,price:6,epoch:5,attack:2,defence:0,damageType:"Дробящий",armorPen:2,damage:{0:"Тяжёлый урон",6:"Огромный урон",12:"Точный удар"}},{id:"steel_warhammer",category:"weapon",subcat:"maces",name:"Стальной боевой молот",desc:"",length:1,hands:1,price:6,epoch:7,attack:5,defence:2,damageType:"Дробящий",armorPen:2,damage:{0:"Лёгкий урон",4:"Тяжёлый урон",8:"Точный удар"}},{id:"steel_greatwarhammer",category:"weapon",subcat:"maces",name:"Длинный стальной боевой молот",desc:"",length:2,hands:2,price:7,epoch:7,attack:3,defence:2,damageType:"Дробящий",armorPen:2,damage:{0:"Тяжёлый урон",4:"Огромный урон",8:"Точный удар"}},{id:"wooden_buckler",category:"shield",subcat:"shields",name:"Деревянный баклер",desc:"",spec:"Баклер может использоваться для атак, как второе оружие.",length:0,hands:.5,price:5,epoch:4,attack:1,defence:{front:{melee:3,ranged:3},side:{melee:3,ranged:0}}},{id:"wooden_shield",category:"shield",subcat:"shields",name:"Деревянный щит",desc:"",spec:"Небольшим щитом можно толкать противника, затратив один порыв.",length:0,hands:1,price:4,epoch:3,attack:1,defence:{front:{melee:6,ranged:6}}},{id:"large_wooden_shield",category:"shield",subcat:"shields",name:"Большой деревянный щит",desc:"",length:0,hands:1,price:5,epoch:3,defence:{front:{melee:6,ranged:9}}},{id:"wooden_tower_shield",category:"shield",subcat:"shields",name:"Деревянный башенный щит",desc:"",length:0,hands:1,price:5,epoch:3,movement:-1,attack:-3,defence:{front:{melee:9,ranged:12}}},{id:"metal_buckler",category:"shield",subcat:"shields",name:"Стальной баклер",desc:"",spec:"Баклер может использоваться для атак, как второе оружие.",length:0,hands:.5,price:6,epoch:6,attack:3,defence:{front:{melee:6,ranged:3},side:{melee:6,ranged:0}}},{id:"metal_shield",category:"shield",subcat:"shields",name:"Стальной щит",desc:"",spec:"Небольшим щитом можно толкать противника, затратив один порыв.",length:0,hands:1,price:7,epoch:6,attack:3,defence:{front:{melee:6,ranged:6}}},{id:"large_metal_shield",category:"shield",subcat:"shields",name:"Большой стальной щит",desc:"",length:0,hands:1,price:5,epoch:7,attack:1,defence:{front:{melee:9,ranged:9}}},{id:"metal_tower_shield",category:"shield",subcat:"shields",name:"Cтальной башенный щит",desc:"",length:0,hands:1,price:7,epoch:7,defence:{front:{melee:12,ranged:12}}},{id:"iron_shortsword",category:"weapon",subcat:"swords",name:"Короткий меч",desc:"",length:1,hands:1,price:4,epoch:3,attack:3,defence:5,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",4:"Лёгкий урон",8:"Точный удар",12:"Тяжёлый урон"}},{id:"iron_sword",category:"weapon",subcat:"swords",name:"Меч пехотинца",desc:"",length:2,hands:1,price:4,epoch:4,attack:5,defence:5,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар",10:"Тяжёлый урон"}},{id:"iron_falchion",category:"weapon",subcat:"swords",name:"Фальшион",desc:"",length:1,hands:1,price:4,epoch:4,attack:7,defence:4,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар",10:"Тяжёлый урон"}},{id:"iron_greatsword",category:"weapon",subcat:"swords",name:"Двуручный меч",desc:"",length:2,hands:2,price:5,epoch:4,attack:6,defence:3,damageType:"Режущий",armorPen:0,damage:{0:"Лёгкий урон",4:"Тяжёлый урон",8:"Огромный урон"}},{id:"steel_shortsword",category:"weapon",subcat:"swords",name:"Стальной короткий меч",desc:"",length:1,hands:1,price:6,epoch:6,attack:4,defence:5,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Точный удар",9:"Тяжёлый урон"}},{id:"steel_sword",category:"weapon",subcat:"swords",name:"Стальной меч",desc:"",length:2,hands:1,price:7,epoch:6,attack:6,defence:6,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",4:"Точный удар",8:"Тяжёлый урон"}},{id:"steel_saber",category:"weapon",subcat:"swords",name:"Сабля",desc:"",length:2,hands:1,price:7,epoch:7,attack:8,defence:3,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Тяжёлый урон",8:"Точный удар"}},{id:"steel_scimitar",category:"weapon",subcat:"swords",name:"Скимитар",desc:"",length:2,hands:1,price:7,epoch:7,attack:9,defence:2,damageType:"Режущий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",6:"Тяжёлый урон",9:"Точный удар"}},{id:"steel_greatsword",category:"weapon",subcat:"swords",name:"Качественный двуручный меч",desc:"",length:2,hands:2,price:7,epoch:6,attack:7,defence:4,damageType:"Режущий",armorPen:0,damage:{0:"Лёгкий урон",4:"Тяжёлый урон",6:"Огромный урон"}},{id:"rapier",category:"weapon",subcat:"swords",name:"Рапира",desc:"",length:2,hands:1.5,price:6,epoch:7,attack:7,defence:3,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",2:"Лёгкий урон",6:"Точный удар",8:"Тяжёлый урон"}},{id:"hand_crossbow",category:"weapon",subcat:"crossbows",name:"Ручной арбалет",desc:"Требует порыва на перезарядку",length:2,hands:1.5,price:5,epoch:5,attack:4,defence:0,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",5:"Лёгкий урон"}},{id:"crossbow",category:"weapon",subcat:"crossbows",name:"Арбалет",desc:"Требуется два порыва или полное основное действие на перезарядку",length:2,hands:2,price:6,epoch:5,attack:6,defence:0,damageType:"Колющий",armorPen:0,damage:{0:"Царапина",4:"Лёгкий урон",6:"Точный удар",8:"Тяжёлый урон"}},{id:"heavy_crossbow",category:"weapon",subcat:"crossbows",name:"Тяжёлый арбалет",desc:"Требуется полное действие и один порыв на перезарядку, в процессе нельзя передвигаться.",length:2,hands:2,price:6,epoch:5,attack:8,defence:0,damageType:"Колющий",armorPen:1,damage:{0:"Царапина",4:"Лёгкий урон",6:"Точный удар",8:"Тяжёлый урон"}},{id:"sling",category:"weapon",subcat:"slings",name:"Простая праща",desc:"",spec:"Нельзя стрелять с порывом",length:2,hands:2,price:2,epoch:2,attack:3,defence:0,damageType:"Дробящий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон"}},{id:"heavy_sling",category:"weapon",subcat:"slings",name:"Боевая праща",desc:"",spec:"Нельзя стрелять без порыва",length:2,hands:2,price:4,epoch:3,attack:4,defence:0,damageType:"Дробящий",armorPen:0,damage:{0:"Царапина",3:"Лёгкий урон",9:"Тяжёлый урон"}}],Yo={systemName:"triP Items",version:"1.0",totalItems:110},Tt={items:qo,metadata:Yo},Rt=(e,t)=>{const n=e.__vccOpts||e;for(const[s,o]of t)n[s]=o;return n},pt={3:{name:"Ниже простой",short:"НП",level:1,modifier:"below",color:"#00DDFF",lightText:!1,linetype:"dashed"},6:{name:"Простая",short:"П",level:1,modifier:"base",color:"#00DDFF",lightText:!1,linetype:"single"},9:{name:"Выше простой",short:"ВП",level:1,modifier:"above",color:"#00DDFF",lightText:!1,linetype:"double"},12:{name:"Ниже лёгкой",short:"НЛ",level:2,modifier:"below",color:"#00CC44",lightText:!1,linetype:"dashed"},15:{name:"Лёгкая",short:"Л",level:2,modifier:"base",color:"#00CC44",lightText:!1,linetype:"single"},18:{name:"Выше лёгкой",short:"ВЛ",level:2,modifier:"above",color:"#00CC44",lightText:!1,linetype:"double"},21:{name:"Ниже средней",short:"НС",level:3,modifier:"below",color:"#FFEE00",lightText:!1,linetype:"dashed"},24:{name:"Средняя",short:"С",level:3,modifier:"base",color:"#FFEE00",lightText:!1,linetype:"single"},27:{name:"Выше средней",short:"ВС",level:3,modifier:"above",color:"#FFEE00",lightText:!1,linetype:"double"},30:{name:"Ниже тяжёлой",short:"НТ",level:4,modifier:"below",color:"#FF8800",lightText:!1,linetype:"dashed"},33:{name:"Тяжёлая",short:"Т",level:4,modifier:"base",color:"#FF8800",lightText:!1,linetype:"single"},36:{name:"Выше тяжёлой",short:"ВТ",level:4,modifier:"above",color:"#FF8800",lightText:!1,linetype:"double"},39:{name:"Ниже жестокой",short:"НЖ",level:5,modifier:"below",color:"#CC0000",lightText:!0,linetype:"dashed"},42:{name:"Жестокая",short:"Ж",level:5,modifier:"base",color:"#CC0000",lightText:!0,linetype:"single"},45:{name:"Выше жестокой",short:"ВЖ",level:5,modifier:"above",color:"#CC0000",lightText:!0,linetype:"double"},48:{name:"Ниже кошмарной",short:"НК",level:6,modifier:"below",color:"#440066",lightText:!0,linetype:"dashed"},51:{name:"Кошмарная",short:"К",level:6,modifier:"base",color:"#440066",lightText:!0,linetype:"single"},54:{name:"Выше кошмарной",short:"ВК",level:6,modifier:"above",color:"#440066",lightText:!0,linetype:"double"},60:{name:"Невозможная",short:"Н",level:7,modifier:"base",color:"#000000",lightText:!0,linetype:"single"}},Xo={key:0,class:"hp-display"},Vo={key:0,class:"hp-compact"},Go={class:"hp-text"},Qo={key:0,class:"hp-penalty"},Ko={key:1,class:"hp-full"},Zo={class:"hp-header"},Jo={class:"hp-value"},ea={key:0,class:"hp-penalty-badge"},ta={class:"hp-groups"},na=["onClick"],sa={key:1,class:"wounds-display"},oa={key:0,class:"wounds-compact"},aa={key:0,class:"wound-healthy"},la={key:1,class:"wounds-full"},ia=["onClick","onContextmenu","onTouchstart","onTouchend"],ra={class:"wound-header"},ca={class:"wound-icon"},ua={class:"wound-label"},da={class:"wound-slots"},fa={class:"wound-count"},pa=500,ha={__name:"HealthDisplay",props:{combat:{type:Object,required:!0},stats:{type:Object,default:()=>({})},compact:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:hp","add-wound","remove-wound","toggle-health-type"],setup(e,{emit:t}){const n=e,s=t,o=Y(()=>{var w;return((w=n.combat)==null?void 0:w.healthType)||"simple"}),l=Y(()=>{var w;return((w=n.combat)==null?void 0:w.hp)||0}),i=Y(()=>{var w;return((w=n.combat)==null?void 0:w.maxHp)||8}),m=Y(()=>{const w=[],A=i.value,T=A%3;let I=0;if(T>0){const z=[];for(let U=0;U<T;U++)z.push({index:I,filled:I<l.value}),I++;w.push(z)}for(;I<A;){const z=[];for(let U=0;U<3&&I<A;U++)z.push({index:I,filled:I<l.value}),I++;w.push(z)}return w}),d=Y(()=>{const w=i.value-l.value;return Math.floor(w/3)}),r=Y(()=>{var w;return((w=n.combat)==null?void 0:w.wounds)||{scratch:0,light:0,heavy:0,deadly:0}}),u=Y(()=>{var w;return((w=n.combat)==null?void 0:w.bonusDeadlySlots)||0}),g=Y(()=>{const w=at(n.stats,u.value);return{scratch:{...w.scratch,total:w.scratch.base+w.scratch.bonus,filled:r.value.scratch,label:"Царапины",icon:"🩹",color:"amber"},light:{...w.light,total:w.light.base+w.light.bonus,filled:r.value.light,label:"Лёгкие",icon:"🩸",color:"orange"},heavy:{...w.heavy,total:w.heavy.base+w.heavy.bonus,filled:r.value.heavy,label:"Тяжёлые",icon:"💔",color:"rose"},deadly:{...w.deadly,total:w.deadly.base+w.deadly.bonus,filled:r.value.deadly,label:"Смертельные",icon:"💀",color:"red"}}}),x=["scratch","light","heavy","deadly"],P=w=>{const N=g.value[w],A=[];N.bonus+N.base;const T=N.filled;for(let I=0;I<N.bonus;I++)A.push({index:I,isBonus:!0,filled:I<T});for(let I=0;I<N.base;I++)A.push({index:N.bonus+I,isBonus:!1,filled:N.bonus+I<T});return A};let y=null;const $=w=>{n.readonly||(w<l.value?s("update:hp",l.value-1):s("update:hp",Math.min(i.value,l.value+1)))},S=(w,N)=>{n.readonly||(N.preventDefault(),s("add-wound",w))},O=(w,N)=>{n.readonly||(N.preventDefault(),s("remove-wound",w))},q=(w,N)=>{n.readonly||(y=setTimeout(()=>{s("remove-wound",w),y=null},pa))},X=(w,N)=>{n.readonly||y&&(clearTimeout(y),y=null,s("add-wound",w))};return(w,N)=>(f(),p("div",{class:ae(["health-display",{compact:e.compact}])},[o.value==="simple"?(f(),p("div",Xo,[e.compact?(f(),p("div",Vo,[N[0]||(N[0]=c("span",{class:"hp-icon"},"❤️",-1)),c("span",Go,B(l.value)+"/"+B(i.value),1),d.value>0?(f(),p("span",Qo,"-"+B(d.value),1)):D("",!0)])):(f(),p("div",Ko,[c("div",Zo,[N[1]||(N[1]=c("span",{class:"hp-label"},"HP",-1)),c("span",Jo,B(l.value)+"/"+B(i.value),1),d.value>0?(f(),p("span",ea,"штраф: -"+B(d.value),1)):D("",!0)]),c("div",ta,[(f(!0),p(Q,null,le(m.value,(A,T)=>(f(),p("div",{key:T,class:"hp-group"},[(f(!0),p(Q,null,le(A,I=>(f(),p("div",{key:I.index,class:ae(["hp-cell",{filled:I.filled,clickable:!e.readonly}]),onClick:z=>$(I.index)},null,10,na))),128))]))),128))])]))])):(f(),p("div",sa,[e.compact?(f(),p("div",oa,[(f(),p(Q,null,le(x,A=>(f(),p(Q,{key:A},[g.value[A].filled>0?(f(),p("span",{key:0,class:ae(["wound-badge",`wound-${g.value[A].color}`])},B(g.value[A].icon)+" "+B(g.value[A].filled),3)):D("",!0)],64))),64)),Object.values(r.value).every(A=>A===0)?(f(),p("span",aa," ✓ Здоров ")):D("",!0)])):(f(),p("div",la,[(f(),p(Q,null,le(x,A=>c("div",{key:A,class:ae(["wound-column",[`wound-column-${g.value[A].color}`,`wound-column-${A}`,{clickable:!e.readonly}]]),onClick:T=>S(A,T),onContextmenu:T=>O(A,T),onTouchstart:T=>q(A),onTouchend:T=>X(A)},[c("div",ra,[c("span",ca,B(g.value[A].icon),1),c("span",ua,B(g.value[A].label),1)]),c("div",da,[(f(!0),p(Q,null,le(P(A),T=>(f(),p("div",{key:T.index,class:ae(["wound-slot",{filled:T.filled,bonus:T.isBonus}])},null,2))),128))]),c("div",fa,B(g.value[A].filled)+"/"+B(g.value[A].total),1)],42,ia)),64))]))]))],2))}},Wr=Rt(ha,[["__scopeId","data-v-2d19fffd"]]),ma={class:"portrait-image"},va=["src","alt"],ga={key:1,class:"portrait-fallback"},ba={key:3,class:"death-overlay"},ya=["viewBox","width","height"],xa=["transform"],ka={key:0,class:"melee-defence"},wa=["d"],Ta=["d"],Ca=["d"],_a=["d"],Sa=["d"],Pa=["d"],$a={key:1,class:"ranged-defence"},Ea=["d"],Ma=["d"],Aa=["d"],Ia=["d"],Da=["d"],Ra=["d"],La=["viewBox","width","height"],Fa=["d","stroke"],Na=["cx","cy","r","fill"],qe=2,Oa={__name:"CharacterPortrait",props:{portrait:{type:[String,Number],default:null},name:{type:String,default:""},combat:{type:Object,default:()=>({})},stats:{type:Object,default:()=>({})},meleeDefence:{type:Object,default:null},rangedDefence:{type:Object,default:null},defenceMode:{type:String,default:"all",validator:e=>["all","melee","ranged","none"].includes(e)},defenceLayout:{type:String,default:"left",validator:e=>["left","both"].includes(e)},defenceRotation:{type:Number,default:0},highlightSegment:{type:Object,default:null},showDefence:{type:Boolean,default:!1},size:{type:String,default:"md",validator:e=>["sm","md","lg","xl"].includes(e)},showWounds:{type:Boolean,default:!0}},setup(e){const t=e,n={sm:48,md:80,lg:120,xl:160},s=Y(()=>n[t.size]),o=Y(()=>{var b;return((b=t.combat)==null?void 0:b.healthType)||"simple"}),l=Y(()=>{var b;return((b=t.combat)==null?void 0:b.wounds)||{scratch:0,light:0,heavy:0,deadly:0}}),i=Y(()=>{var b;return o.value!=="wounds"?null:at(t.stats,((b=t.combat)==null?void 0:b.bonusDeadlySlots)||0)}),m=Y(()=>{if(!i.value)return[];const b=i.value.scratch.base+i.value.scratch.bonus,C=i.value.scratch.bonus,_=l.value.scratch;if(_===0)return[];const R=10,re=(360-b*R)/b,te=180-(_*re+(_-1)*R)/2,ue=[];for(let oe=0;oe<_;oe++){const ie=te+oe*(re+R);ue.push({index:oe,startAngle:ie,endAngle:ie+re,filled:!0,isBonus:oe<C})}return ue}),d=(b,C,_,R)=>{const K=s.value,re=K/2,ce=K/2,te=_,ue=(b-90)*Math.PI/180,oe=(C-90)*Math.PI/180,ie=re+te*Math.cos(ue),me=ce+te*Math.sin(ue),Te=re+te*Math.cos(oe),xe=ce+te*Math.sin(oe),Fe=C-b>180?1:0;return`M ${ie} ${me} A ${te} ${te} 0 ${Fe} 1 ${Te} ${xe}`},r=Y(()=>{if(!i.value)return[];const b=i.value.light.bonus,C=l.value.light;if(C===0)return[];const _=[],R=s.value,K=R*.08,re=R/2,ce=R/2,te=R/2,ue=25,ie=90+(C-1)*ue/2;for(let me=0;me<C;me++){const xe=(ie-me*ue)*Math.PI/180;_.push({index:me,cx:ce+re*Math.cos(xe),cy:te+re*Math.sin(xe),r:K,filled:!0,isBonus:me<b})}return _}),u=Y(()=>{if(!i.value)return 0;const b=i.value.heavy.base+i.value.heavy.bonus,C=l.value.heavy;return b===0||C===0?0:C/b*70}),g=Y(()=>{if(!i.value)return 0;const b=i.value.deadly.base+i.value.deadly.bonus,C=l.value.deadly;return b===0?0:C/b}),x=Y(()=>g.value>0),P=Y(()=>g.value>=1),y=Y(()=>{var _,R;if(o.value!=="simple")return 100;const b=((_=t.combat)==null?void 0:_.hp)||0,C=((R=t.combat)==null?void 0:R.maxHp)||1;return b/C*100}),$=Y(()=>Math.max(0,100-y.value)*.7),S=Y(()=>{var b,C;return((C=(b=t.name)==null?void 0:b.charAt(0))==null?void 0:C.toUpperCase())||"?"}),O=b=>{const C=Object.entries(pt.default||pt).map(([R,K])=>({value:parseInt(R),...K})).filter(R=>R.value>=0).sort((R,K)=>R.value-K.value);let _=C[0];for(const R of C)if(R.value<=b)_=R;else break;return _},q=b=>{if(!t.meleeDefence)return null;const C=t.meleeDefence[b];return C==null?null:O(C)},X=b=>{if(!t.rangedDefence)return null;const C=t.rangedDefence[b];return C==null?null:O(C)},w=Y(()=>!t.showDefence||!t.meleeDefence||t.defenceMode==="none"||t.defenceMode==="ranged"?null:{front:q("front"),flank:q("flank"),back:q("back")}),N=Y(()=>!t.showDefence||!t.rangedDefence||t.defenceMode==="none"||t.defenceMode==="melee"?null:{front:X("front"),flank:X("flank"),back:X("back")}),A=(b,C)=>t.highlightSegment?t.highlightSegment.type===b&&t.highlightSegment.direction===C:!1,T=Y(()=>t.highlightSegment!==null),I=Y(()=>{if(t.defenceRotation===0)return"";const b=s.value,C=L.value,_=b/2+C,R=b/2+C;return`rotate(${t.defenceRotation} ${_} ${R})`}),z=(b,C=0)=>{const _=s.value,R=L.value,K=_/2+R,re=_/2+R,ce=_/2+14+C,te=Te=>{const xe=(Te-90)*Math.PI/180;return{x:K+ce*Math.cos(xe),y:re+ce*Math.sin(xe)}},ue=te(0),oe=te(180),ie=te(240),me=te(300);return b==="front"?`M ${ue.x} ${ue.y} L ${me.x} ${me.y}`:b==="flank"?`M ${me.x} ${me.y} L ${ie.x} ${ie.y}`:b==="back"?`M ${ie.x} ${ie.y} L ${oe.x} ${oe.y}`:""},U=(b,C=0,_="left")=>{const R=s.value,K=L.value,re=R/2+K,ce=R/2+K,ue=R/2+14+8+C;let oe,ie;if(_==="left")if(b==="front")oe=300,ie=360;else if(b==="flank")oe=240,ie=300;else if(b==="back")oe=180,ie=240;else return"";else if(b==="front")oe=0,ie=60;else if(b==="flank")oe=60,ie=120;else if(b==="back")oe=120,ie=180;else return"";const me=(oe-90)*Math.PI/180,Te=(ie-90)*Math.PI/180,xe=re+ue*Math.cos(me),Fe=ce+ue*Math.sin(me),$e=re+ue*Math.cos(Te),Oe=ce+ue*Math.sin(Te);return`M ${xe} ${Fe} A ${ue} ${ue} 0 0 1 ${$e} ${Oe}`},fe=b=>{if(!b)return{};const C=b.linetype||"single",R={stroke:b.color||"#FFFFFF","stroke-width":2,fill:"none","stroke-linecap":"butt"};return C==="dashed"?{...R,"stroke-dasharray":"4 3"}:R},G=b=>!b||b.linetype!=="double"?null:{stroke:b.color||"#FFFFFF","stroke-width":2,fill:"none","stroke-linecap":"butt","stroke-dasharray":"4 3"},L=Y(()=>t.showDefence?28:0),he=Y(()=>s.value+L.value*2);return(b,C)=>(f(),p("div",{class:ae(["character-portrait",[`size-${e.size}`,{dying:x.value,dead:P.value,"with-defence":e.showDefence}]]),style:Pe({width:`${he.value}px`,height:`${he.value}px`})},[c("div",{class:"portrait-container",style:Pe({width:`${s.value}px`,height:`${s.value}px`,position:"absolute",top:`${L.value}px`,left:`${L.value}px`})},[c("div",ma,[e.portrait?(f(),p("img",{key:0,src:M(Bs)(e.portrait),alt:e.name,class:"portrait-img",onError:C[0]||(C[0]=_=>_.target.style.display="none")},null,40,va)):(f(),p("div",ga,B(S.value),1))]),e.showWounds&&o.value==="wounds"&&u.value>0?(f(),p("div",{key:0,class:"heavy-overlay",style:Pe({height:`${u.value}%`})},null,4)):D("",!0),e.showWounds&&o.value==="simple"&&$.value>0?(f(),p("div",{key:1,class:"hp-damage-overlay",style:Pe({height:`${$.value}%`})},null,4)):D("",!0),e.showWounds&&x.value?(f(),p("div",{key:2,class:"deadly-overlay",style:Pe({opacity:g.value*.8})},null,4)):D("",!0),P.value?(f(),p("div",ba,[...C[1]||(C[1]=[c("span",{class:"death-icon"},"💀",-1)])])):D("",!0)],4),e.showDefence&&(w.value||N.value)?(f(),p("svg",{key:0,class:"defence-overlay",viewBox:`0 0 ${he.value} ${he.value}`,width:he.value,height:he.value,style:{position:"absolute",top:"0",left:"0"}},[c("g",{transform:I.value},[w.value?(f(),p("g",ka,[!T.value||A("melee","front")?(f(),p(Q,{key:0},[w.value.front?(f(),p("path",Se({key:0,d:z("front",0)},fe(w.value.front)),null,16,wa)):D("",!0),G(w.value.front)?(f(),p("path",Se({key:1,d:z("front",qe)},G(w.value.front)),null,16,Ta)):D("",!0)],64)):D("",!0),!T.value||A("melee","flank")?(f(),p(Q,{key:1},[w.value.flank?(f(),p("path",Se({key:0,d:z("flank",0)},fe(w.value.flank)),null,16,Ca)):D("",!0),G(w.value.flank)?(f(),p("path",Se({key:1,d:z("flank",qe)},G(w.value.flank)),null,16,_a)):D("",!0)],64)):D("",!0),!T.value||A("melee","back")?(f(),p(Q,{key:2},[w.value.back?(f(),p("path",Se({key:0,d:z("back",0)},fe(w.value.back)),null,16,Sa)):D("",!0),G(w.value.back)?(f(),p("path",Se({key:1,d:z("back",qe)},G(w.value.back)),null,16,Pa)):D("",!0)],64)):D("",!0)])):D("",!0),N.value?(f(),p("g",$a,[!T.value||A("ranged","front")?(f(),p(Q,{key:0},[N.value.front?(f(),p("path",Se({key:0,d:U("front",0,e.defenceLayout)},fe(N.value.front)),null,16,Ea)):D("",!0),G(N.value.front)?(f(),p("path",Se({key:1,d:U("front",qe,e.defenceLayout)},G(N.value.front)),null,16,Ma)):D("",!0)],64)):D("",!0),!T.value||A("ranged","flank")?(f(),p(Q,{key:1},[N.value.flank?(f(),p("path",Se({key:0,d:U("flank",0,e.defenceLayout)},fe(N.value.flank)),null,16,Aa)):D("",!0),G(N.value.flank)?(f(),p("path",Se({key:1,d:U("flank",qe,e.defenceLayout)},G(N.value.flank)),null,16,Ia)):D("",!0)],64)):D("",!0),!T.value||A("ranged","back")?(f(),p(Q,{key:2},[N.value.back?(f(),p("path",Se({key:0,d:U("back",0,e.defenceLayout)},fe(N.value.back)),null,16,Da)):D("",!0),G(N.value.back)?(f(),p("path",Se({key:1,d:U("back",qe,e.defenceLayout)},G(N.value.back)),null,16,Ra)):D("",!0)],64)):D("",!0)])):D("",!0)],8,xa)],8,ya)):D("",!0),e.showWounds?(f(),p("svg",{key:1,class:"wounds-overlay",viewBox:`0 0 ${s.value} ${s.value}`,width:s.value,height:s.value,style:Pe({position:"absolute",top:e.showDefence?`${L.value}px`:"0",left:e.showDefence?`${L.value}px`:"0",overflow:"visible"})},[(f(!0),p(Q,null,le(m.value,_=>(f(),p("path",{key:`scratch-${_.index}`,d:d(_.startAngle,_.endAngle,s.value/2-3),fill:"none",stroke:_.isBonus?"#a855f7":"#fbbf24","stroke-width":"3","stroke-linecap":"round",class:"scratch-arc filled"},null,8,Fa))),128)),(f(!0),p(Q,null,le(r.value,_=>(f(),p("circle",{key:`light-${_.index}`,cx:_.cx,cy:_.cy,r:_.r,fill:_.isBonus?"#a855f7":"#ef4444",stroke:"#1f2937","stroke-width":"1.5",class:"light-dot filled"},null,8,Na))),128))],12,La)):D("",!0)],6))}},Ur=Rt(Oa,[["__scopeId","data-v-8b721bd1"]]),Mn={};Uo.aspects.forEach(e=>{Mn[e.id]=e});const za=e=>Mn[e]||null,Ba=e=>{var i,m,d,r,u,g;const t=(e==null?void 0:e.stats)||{},n=((i=e==null?void 0:e.combat)==null?void 0:i.wounds)||(e==null?void 0:e.wounds)||{};if(!n.scratch&&!n.light&&!n.heavy&&!n.deadly)return 0;const s={scratch:{current:typeof n.scratch=="number"?n.scratch:((m=n.scratch)==null?void 0:m.current)||0},light:{current:typeof n.light=="number"?n.light:((d=n.light)==null?void 0:d.current)||0},heavy:{current:typeof n.heavy=="number"?n.heavy:((r=n.heavy)==null?void 0:r.current)||0},deadly:{current:typeof n.deadly=="number"?n.deadly:((u=n.deadly)==null?void 0:u.current)||0}},o=((g=e==null?void 0:e.combat)==null?void 0:g.bonusDeadlySlots)||0,l=at(t,o);return-Cs(s,l)},ja=e=>{let t=0;return t-=Ba(e),t},Ha=(e,t)=>{const n=za(t);if(!n)return 0;const s=(e==null?void 0:e.stats)||{},o=s[t]||0,l=n.neighbors||[],i=s[l[0]]||0,m=s[l[1]]||0,d=s[n.opposite]||0,r=Math.floor(o+i/2+m/2),u=Math.floor(d/2),g=Math.max(r,u),x=ja(e);return g+x},Lt={};Object.keys(Tt).forEach(e=>{Array.isArray(Tt[e])&&Tt[e].forEach(t=>{Lt[t.id]=t})});const Wa=e=>Ha(e,"shadow"),Ua=e=>{var n;const t=(n=e==null?void 0:e.equipment)==null?void 0:n.armor;return t&&Lt[t]||null},qa=(e,t,n)=>{var m,d;const s=((m=e==null?void 0:e.equipment)==null?void 0:m.activeSetIndex)??0,l=(((d=e==null?void 0:e.equipment)==null?void 0:d.weaponSets)||[])[s];if(!l||!l.weapons)return 0;let i=0;for(const r of l.weapons){const u=Lt[r];u&&(u.type==="shield"&&t==="front"&&(n==="melee"?i+=u.defenceMelee||0:n==="ranged"&&(i+=u.defenceRanged||0)),u.parry&&t==="front"&&n==="melee"&&(i+=u.parry||0))}return i},Ct=(e,t,n)=>{const s=Wa(e),o=Math.floor(s/2),l=Ua(e),i=(l==null?void 0:l.defence)||0,m=qa(e,t,n);let d=0,r=0;return t==="front"?(d=6,r=s):t==="flank"?(d=3,r=o):t==="back"&&(d=0,r=o),Math.max(0,d+r+i+m)},un=(e,t)=>({front:Ct(e,"front",t),flank:Ct(e,"flank",t),back:Ct(e,"back",t)}),Ya=[{id:"plains",name:"Равнина",color:"#8BC34A"},{id:"forest",name:"Лес",color:"#2E7D32"},{id:"desert",name:"Пустыня",color:"#FDD835"},{id:"swamp",name:"Болото",color:"#5D4037"},{id:"mountain",name:"Горы",color:"#78909C"},{id:"water",name:"Вода",color:"#1E88E5"},{id:"snow",name:"Снег",color:"#ECEFF1"},{id:"volcanic",name:"Вулкан",color:"#BF360C"},{id:"urban",name:"Город",color:"#616161"},{id:"underground",name:"Подземелье",color:"#37474F"}],Xa=[{id:"open",name:"Открытая",description:"Полностью просматривается",value:0},{id:"partial",name:"Частичная",description:"Маскирует (высокая трава, кусты)",value:1},{id:"blocking",name:"Блокирующая",description:"Блокирует обзор (стена, скала)",value:2}],Va=[{id:"grass",name:"Трава",description:"Обычный луг",biome:"plains",color:"#4CAF50",image:null,visibility:"open",movementCost:1,meleeAdvantage:0,tags:["природа","базовый"]},{id:"tall_grass",name:"Высокая трава",description:"Высокая трава, скрывающая присевших",biome:"plains",color:"#7CB342",image:null,visibility:"partial",movementCost:1,meleeAdvantage:0,tags:["природа","укрытие"]},{id:"forest_light",name:"Редколесье",description:"Редкие деревья и кустарники",biome:"forest",color:"#66BB6A",image:null,visibility:"partial",movementCost:2,meleeAdvantage:0,tags:["природа","лес","укрытие"]},{id:"forest_dense",name:"Густой лес",description:"Плотный лес с густым подлеском",biome:"forest",color:"#2E7D32",image:null,visibility:"blocking",movementCost:3,meleeAdvantage:-1,tags:["природа","лес","труднопроходимый"]},{id:"sand",name:"Песок",description:"Рыхлый песок",biome:"desert",color:"#FFD54F",image:null,visibility:"open",movementCost:2,meleeAdvantage:-1,tags:["природа","пустыня"]},{id:"dunes",name:"Дюны",description:"Песчаные холмы",biome:"desert",color:"#FFC107",image:null,visibility:"partial",movementCost:3,meleeAdvantage:1,tags:["природа","пустыня","возвышенность"]},{id:"shallow_water",name:"Мелководье",description:"Неглубокая вода по колено",biome:"water",color:"#4FC3F7",image:null,visibility:"open",movementCost:2,meleeAdvantage:-1,tags:["вода"]},{id:"deep_water",name:"Глубокая вода",description:"Глубокая вода, нужно плыть",biome:"water",color:"#1565C0",image:null,visibility:"open",movementCost:4,meleeAdvantage:-2,tags:["вода","опасность"]},{id:"swamp",name:"Болото",description:"Топкое болото",biome:"swamp",color:"#6D4C41",image:null,visibility:"partial",movementCost:3,meleeAdvantage:-1,tags:["природа","болото","опасность"]},{id:"rocks",name:"Камни",description:"Каменистая местность",biome:"mountain",color:"#90A4AE",image:null,visibility:"partial",movementCost:2,meleeAdvantage:0,tags:["природа","горы"]},{id:"cliff",name:"Утёс",description:"Крутой обрыв или возвышенность",biome:"mountain",color:"#607D8B",image:null,visibility:"blocking",movementCost:5,meleeAdvantage:2,tags:["природа","горы","возвышенность"]},{id:"snow",name:"Снег",description:"Заснеженная местность",biome:"snow",color:"#ECEFF1",image:null,visibility:"open",movementCost:2,meleeAdvantage:-1,tags:["природа","холод"]},{id:"ice",name:"Лёд",description:"Скользкий лёд",biome:"snow",color:"#B3E5FC",image:null,visibility:"open",movementCost:1,meleeAdvantage:-2,tags:["природа","холод","опасность"]},{id:"lava",name:"Лава",description:"Раскалённая лава",biome:"volcanic",color:"#FF5722",image:null,visibility:"open",movementCost:5,meleeAdvantage:-2,tags:["опасность","огонь"]},{id:"volcanic_rock",name:"Вулканический камень",description:"Застывшая лава",biome:"volcanic",color:"#3E2723",image:null,visibility:"open",movementCost:2,meleeAdvantage:0,tags:["природа","горы"]},{id:"road_dirt",name:"Грунтовая дорога",description:"Утоптанная тропа",biome:"plains",color:"#A1887F",image:null,visibility:"open",movementCost:1,meleeAdvantage:0,tags:["дорога"]},{id:"road_stone",name:"Каменная дорога",description:"Мощёная дорога",biome:"urban",color:"#9E9E9E",image:null,visibility:"open",movementCost:1,meleeAdvantage:0,tags:["дорога","город"]},{id:"floor_wood",name:"Деревянный пол",description:"Деревянный настил",biome:"urban",color:"#8D6E63",image:null,visibility:"open",movementCost:1,meleeAdvantage:0,tags:["город","здание"]},{id:"floor_stone",name:"Каменный пол",description:"Каменные плиты",biome:"urban",color:"#757575",image:null,visibility:"open",movementCost:1,meleeAdvantage:0,tags:["город","здание"]},{id:"wall",name:"Стена",description:"Непроходимая стена",biome:"urban",color:"#424242",image:null,visibility:"blocking",movementCost:5,meleeAdvantage:0,tags:["город","здание","преграда"]},{id:"dungeon_floor",name:"Пол подземелья",description:"Холодный каменный пол",biome:"underground",color:"#455A64",image:null,visibility:"open",movementCost:1,meleeAdvantage:0,tags:["подземелье"]},{id:"dungeon_wall",name:"Стена подземелья",description:"Массивная каменная стена",biome:"underground",color:"#263238",image:null,visibility:"blocking",movementCost:5,meleeAdvantage:0,tags:["подземелье","преграда"]},{id:"void",name:"Пустота",description:"Пустое пространство",biome:"underground",color:"#0D1117",image:null,visibility:"blocking",movementCost:5,meleeAdvantage:0,tags:["специальный"]}],_t={biomes:Ya,visibility:Xa,terrains:Va},An=xs("terrain",()=>{const e=W(_t.terrains),t=W([]),n=W(_t.biomes),s=W(_t.visibility),o=W(new Map),l=W({search:"",biome:null,visibility:null,movementCostMin:1,movementCostMax:5,meleeAdvantageMin:-2,meleeAdvantageMax:2,tags:[]}),i=Y(()=>[...e.value,...t.value]),m=Y(()=>{const T=new Set;return i.value.forEach(I=>{var z;(z=I.tags)==null||z.forEach(U=>T.add(U))}),Array.from(T).sort()}),d=Y(()=>i.value.filter(T=>{var I;if(l.value.search){const z=l.value.search.toLowerCase(),U=T.name.toLowerCase().includes(z),fe=(I=T.description)==null?void 0:I.toLowerCase().includes(z);if(!U&&!fe)return!1}if(l.value.biome&&T.biome!==l.value.biome||l.value.visibility&&T.visibility!==l.value.visibility||T.movementCost<l.value.movementCostMin||T.movementCost>l.value.movementCostMax||T.meleeAdvantage<l.value.meleeAdvantageMin||T.meleeAdvantage>l.value.meleeAdvantageMax)return!1;if(l.value.tags.length>0){const z=new Set(T.tags||[]);if(!l.value.tags.every(fe=>z.has(fe)))return!1}return!0})),r=Y(()=>{const T={};return n.value.forEach(I=>{T[I.id]={biome:I,terrains:d.value.filter(z=>z.biome===I.id)}}),T});function u(T){return i.value.find(I=>I.id===T)||null}function g(T={}){const{biome:I=null,visibility:z=null,passabilityMin:U=0,passabilityMax:fe=5,meleeAdvantageMin:G=-2,meleeAdvantageMax:L=2,search:he="",tags:b=[]}=T;return i.value.filter(C=>{var K;if(he){const re=he.toLowerCase(),ce=C.name.toLowerCase().includes(re),te=(K=C.description)==null?void 0:K.toLowerCase().includes(re);if(!ce&&!te)return!1}if(I&&C.biome!==I||z&&C.visibility!==z)return!1;const _=C.movementCost??1;if(_<U||_>fe)return!1;const R=C.meleeAdvantage??0;if(R<G||R>L)return!1;if(b.length>0){const re=new Set(C.tags||[]);if(!b.every(ce=>re.has(ce)))return!1}return!0})}function x(T){return n.value.find(I=>I.id===T)||null}function P(T){const I=u(T);if(!I)return"#888888";if(I.color)return I.color;const z=x(I.biome);return(z==null?void 0:z.color)||"#888888"}function y(T){const I=u(T);return(I==null?void 0:I.image)||null}async function $(T){return o.value.has(T)?o.value.get(T):new Promise((I,z)=>{const U=new Image;U.onload=()=>{o.value.set(T,U),I(U)},U.onerror=z,U.src=T})}function S(T){const z={id:`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:T.name||"Новый террейн",description:T.description||"",biome:T.biome||"plains",color:T.color||"#888888",image:T.image||null,visibility:T.visibility||"open",movementCost:Math.max(1,Math.min(5,T.movementCost||1)),meleeAdvantage:Math.max(-2,Math.min(2,T.meleeAdvantage||0)),tags:T.tags||[],isCustom:!0,createdAt:Date.now()};return t.value.push(z),z}function O(T,I){const z=t.value.findIndex(U=>U.id===T);return z===-1?!1:(t.value[z]={...t.value[z],...I,updatedAt:Date.now()},!0)}function q(T){const I=t.value.findIndex(z=>z.id===T);return I===-1?!1:(t.value.splice(I,1),!0)}function X(T){l.value={...l.value,...T}}function w(){l.value={search:"",biome:null,visibility:null,movementCostMin:1,movementCostMax:5,meleeAdvantageMin:-2,meleeAdvantageMax:2,tags:[]}}function N(){return JSON.stringify(t.value,null,2)}function A(T){try{const I=JSON.parse(T);if(!Array.isArray(I))throw new Error("Invalid format");return I.forEach(z=>{S(z)}),!0}catch(I){return console.error("Failed to import terrains:",I),!1}}return{baseTerrains:e,customTerrains:t,biomes:n,visibilityTypes:s,imageCache:o,filters:l,allTerrains:i,allTags:m,filteredTerrains:d,terrainsByBiome:r,getTerrainById:u,getFilteredTerrains:g,getBiomeById:x,getTerrainColor:P,getTerrainImage:y,loadImage:$,addCustomTerrain:S,updateCustomTerrain:O,removeCustomTerrain:q,setFilters:X,resetFilters:w,exportCustomTerrains:N,importCustomTerrains:A}},{persist:{key:"trip-terrains",paths:["customTerrains"]}});class Ga{constructor(t=null){this.seed=t??Date.now(),this.current=this.seed}next(){return this.current=this.current*1103515245+12345&2147483647,this.current/2147483647}nextInt(t,n){return Math.floor(this.next()*(n-t+1))+t}shuffle(t){const n=[...t];for(let s=n.length-1;s>0;s--){const o=this.nextInt(0,s);[n[s],n[o]]=[n[o],n[s]]}return n}}function Qa(e,t){return[{q:e+1,r:t},{q:e+1,r:t-1},{q:e,r:t-1},{q:e-1,r:t},{q:e-1,r:t+1},{q:e,r:t+1}]}function Ka(e){const[t,n]=e.split(",").map(Number);return{q:t,r:n}}function Za(e,t){return`${e},${t}`}function Ja(e,t,n){if(!e||e.type===be.NONE)return!0;const{type:s,operator:o,value:l,minValue:i,maxValue:m}=e;let d;switch(s){case be.TERRAIN_ID:d=t==null?void 0:t.id;break;case be.TERRAIN_BIOME:d=t==null?void 0:t.biome;break;case be.VISIBILITY:d=t==null?void 0:t.visibility;break;case be.MOVEMENT_COST:d=(t==null?void 0:t.movementCost)??1;break;case be.MELEE_ADVANTAGE:d=(t==null?void 0:t.meleeAdvantage)??0;break;case be.TAG:d=(t==null?void 0:t.tags)||[];break;case be.RANDOM:return!0;default:return!0}switch(o){case we.EQUALS:return d===l;case we.NOT_EQUALS:return d!==l;case we.GREATER:return d>l;case we.GREATER_EQUALS:return d>=l;case we.LESS:return d<l;case we.LESS_EQUALS:return d<=l;case we.CONTAINS:return Array.isArray(d)?d.includes(l):String(d).includes(String(l));default:return!0}}function el(e,t,n){return!e.conditions||e.conditions.length===0?!0:e.conditions.every(s=>Ja(s,t))}function tl(e,t,n,s){if(e.length===0)return new Set;const o=Math.round(e.length*(t/100));if(o===0)return new Set;const l=new Set,i=new Set(e),m=n/100,d=Math.max(1,Math.round(o*(1-m*.8))),r=s.shuffle([...i]);for(r.slice(0,Math.min(d,r.length)).forEach(g=>{l.add(g),i.delete(g)});l.size<o&&i.size>0;)if(s.next()<m){const x=[...l],P=s.shuffle(x);let y=!1;for(const $ of P){const{q:S,r:O}=Ka($),q=Qa(S,O),X=s.shuffle(q);for(const w of X){const N=Za(w.q,w.r);if(i.has(N)){l.add(N),i.delete(N),y=!0;break}}if(y)break}if(!y&&i.size>0){const $=s.shuffle([...i])[0];l.add($),i.delete($)}}else{const x=s.shuffle([...i])[0];l.add(x),i.delete(x)}return l}function In(e,t,n,s={}){const{previewOnly:o=!1,customSeed:l=null}=s;if(!e||!t||t.length===0)return new Map;const i=l??e.seed??Date.now(),m=new Ga(i),d=new Map;for(const u of t)d.set(u,e.baseTerrain);const r=[...e.layers].filter(u=>u.enabled&&u.terrainId).sort((u,g)=>u.priority-g.priority);for(const u of r){const g=[];for(const P of t){const y=d.get(P),$=n.getTerrainById(y);el(u,$)&&g.push(P)}const x=tl(g,u.density,u.clustering,m);for(const P of x)d.set(P,u.terrainId)}return d}function nl(e,t){const n={total:e.size,byTerrain:{}};return e.forEach((s,o)=>{if(!n.byTerrain[s]){const l=t.getTerrainById(s);n.byTerrain[s]={id:s,name:(l==null?void 0:l.name)||s,count:0,percent:0}}n.byTerrain[s].count++}),Object.values(n.byTerrain).forEach(s=>{s.percent=Math.round(s.count/n.total*100)}),n}function sl(e,t,n,s=null){return In(e,t,n,{previewOnly:!0,customSeed:s??Date.now()})}const st=new Map,Dn=e=>e==null?null:typeof e=="number"?Le(`/images/presets/${e}.png`):typeof e!="string"?Le(`/images/presets/${String(e)}.png`):e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")||e.startsWith("blob:")?e:e.startsWith("/")?Le(e):Le(`/images/presets/${e}.png`),ol=e=>e?st.has(e)?Promise.resolve(st.get(e)):new Promise((t,n)=>{const s=new Image;!e.startsWith("data:")&&!e.startsWith("blob:")&&(s.crossOrigin="anonymous"),s.onload=()=>{st.set(e,s),t(s)},s.onerror=o=>{console.warn("Failed to load image:",e,o),t(null)},s.src=e}):Promise.resolve(null),al=async e=>{const t=e.filter(n=>{var s;return(s=n.character)==null?void 0:s.portrait}).map(n=>{const s=Dn(n.character.portrait);return ol(s).catch(()=>null)});await Promise.all(t)},dn=e=>{const t=Object.entries(pt.default||pt).map(([s,o])=>({value:parseInt(s),...o})).filter(s=>s.value>=0).sort((s,o)=>s.value-o.value);let n=t[0];for(const s of t)if(s.value<=e)n=s;else break;return n},Re=(e,t,n,s)=>{const o=(s-90)*Math.PI/180;return{x:e+n*Math.cos(o),y:t+n*Math.sin(o)}},Rn=(e,t,n,s,o,l,i,m)=>{var r;e.save();const d=Dn(o);if(e.beginPath(),e.arc(t,n,s,0,Math.PI*2),e.clip(),e.fillStyle="#1e293b",e.fill(),d&&st.has(d)){const u=st.get(d),g=u.width/u.height;let x,P,y,$;g>1?(P=s*2,x=P*g,y=t-x/2,$=n-s):(x=s*2,P=x/g,y=t-s,$=n-P/2),e.drawImage(u,y,$,x,P)}else e.fillStyle="#64748b",e.font=`bold ${s}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(((r=l==null?void 0:l.charAt(0))==null?void 0:r.toUpperCase())||"?",t,n);if(i&&m&&i.heavy>0){const u=m.heavy.base+m.heavy.bonus,g=i.heavy/u*.7,x=e.createLinearGradient(t,n+s,t,n-s);x.addColorStop(0,"rgba(220, 38, 38, 0.8)"),x.addColorStop(g,"rgba(220, 38, 38, 0.4)"),x.addColorStop(g+.01,"transparent"),e.fillStyle=x,e.fillRect(t-s,n-s,s*2,s*2)}if(i&&m&&i.deadly>0){const u=m.deadly.base+m.deadly.bonus,g=i.deadly/u;if(g>=1)e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(t-s,n-s,s*2,s*2);else{const x=e.createRadialGradient(t,n,0,t,n,s);x.addColorStop(0,"transparent"),x.addColorStop(.7,"transparent"),x.addColorStop(1,`rgba(220, 38, 38, ${.3+g*.5})`),e.fillStyle=x,e.fillRect(t-s,n-s,s*2,s*2)}}e.restore(),e.beginPath(),e.arc(t,n,s,0,Math.PI*2),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=2,e.stroke()},Ln=(e,t,n,s,o,l)=>{if(!o||!l||o.scratch===0)return;const i=l.scratch.base+l.scratch.bonus,m=o.scratch,d=10,r=(360-i*d)/i,g=180-(m*r+(m-1)*d)/2,x=s+4;e.strokeStyle="#fbbf24",e.lineWidth=2,e.lineCap="round";for(let P=0;P<m;P++){const y=g+P*(r+d),$=(y-90)*Math.PI/180,S=(y+r-90)*Math.PI/180;e.beginPath(),e.arc(t,n,x,$,S),e.stroke()}},Fn=(e,t,n,s,o,l)=>{if(!o||!l||o.light===0)return;const i=o.light,m=25,d=s*.1,u=90+(i-1)*m/2;e.fillStyle="#dc2626";for(let g=0;g<i;g++){const P=(u-g*m)*Math.PI/180;e.beginPath(),e.arc(t+s*Math.cos(P),n+s*Math.sin(P),d,0,Math.PI*2),e.fill()}},fn=(e,t,n,s,o,l,i=0,m="left")=>{if(!l)return;const d=l.color||"#FFFFFF",r=l.linetype||"single";let u;m==="left"?u={top:0,upper:300,lower:240,bottom:180}:u={top:0,upper:60,lower:120,bottom:180};const g=Re(t,n,s,u.top+i),x=Re(t,n,s,u.upper+i),P=Re(t,n,s,u.lower+i),y=Re(t,n,s,u.bottom+i);let $,S;if(o==="front")$=g,S=x;else if(o==="flank")$=x,S=P;else if(o==="back")$=P,S=y;else return;if(e.lineCap="butt",e.strokeStyle=d,r==="dashed")e.setLineDash([4,5]),e.lineWidth=1.5,e.beginPath(),e.moveTo($.x,$.y),e.lineTo(S.x,S.y),e.stroke(),e.setLineDash([]);else if(r==="double"){e.lineWidth=1.5,e.beginPath(),e.moveTo($.x,$.y),e.lineTo(S.x,S.y),e.stroke();const O=s+1.5,q=Re(t,n,O,(o==="front"?u.top:o==="flank"?u.upper:u.lower)+i),X=Re(t,n,O,(o==="front"?u.upper:o==="flank"?u.lower:u.bottom)+i);e.setLineDash([4,5]),e.lineWidth=1.5,e.beginPath(),e.moveTo(q.x,q.y),e.lineTo(X.x,X.y),e.stroke(),e.setLineDash([])}else e.lineWidth=1.5,e.beginPath(),e.moveTo($.x,$.y),e.lineTo(S.x,S.y),e.stroke()},pn=(e,t,n,s,o,l,i=0,m="left")=>{if(!l)return;const d=l.color||"#FFFFFF",r=l.linetype||"single";let u,g;if(m==="left")if(o==="front")u=300,g=360;else if(o==="flank")u=240,g=300;else if(o==="back")u=180,g=240;else return;else if(o==="front")u=0,g=60;else if(o==="flank")u=60,g=120;else if(o==="back")u=120,g=180;else return;u+=i,g+=i;const x=(u-90)*Math.PI/180,P=(g-90)*Math.PI/180;e.lineCap="butt",e.strokeStyle=d,r==="dashed"?(e.setLineDash([4,5]),e.lineWidth=1.5,e.beginPath(),e.arc(t,n,s,x,P),e.stroke(),e.setLineDash([])):r==="double"?(e.lineWidth=1.5,e.beginPath(),e.arc(t,n,s,x,P),e.stroke(),e.setLineDash([4,5]),e.lineWidth=1.5,e.beginPath(),e.arc(t,n,s+1.5,x,P),e.stroke(),e.setLineDash([])):(e.lineWidth=1.5,e.beginPath(),e.arc(t,n,s,x,P),e.stroke())},Nn=(e,t,n,s,o,l,i=0,m={})=>{const{bothSides:d=!1}=m,r=s+14,u=r+6;if(o)for(const g of["front","flank","back"]){const x=o[g];if(x!=null){const P=dn(x);fn(e,t,n,r,g,P,i,"left"),d&&fn(e,t,n,r,g,P,i,"right")}}if(l)for(const g of["front","flank","back"]){const x=l[g];if(x!=null){const P=dn(x);pn(e,t,n,u,g,P,i,"left"),d&&pn(e,t,n,u,g,P,i,"right")}}},On=(e,t,n,s,o=0)=>{const l=Re(t,n,s+8,o),i=Re(t,n,s,o-15),m=Re(t,n,s,o+15);e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(i.x,i.y),e.lineTo(m.x,m.y),e.closePath(),e.fillStyle="rgba(250, 204, 21, 0.9)",e.fill(),e.strokeStyle="rgba(0, 0, 0, 0.5)",e.lineWidth=1,e.stroke()},ll=(e,t,n={})=>{var q,X;const{tokenSize:s=48,isHovered:o=!1,isSelected:l=!1,canSeeDefence:i=!1}=n,{character:m,pixelX:d,pixelY:r,facing:u=0,meleeDefence:g,rangedDefence:x}=t;if(!m)return;const P=d,y=r,$=s/2,S=u*60;if((o||l)&&i&&(g||x)){const w=(q=m.combat)==null?void 0:q.wounds,N=m.woundSlots||(m.stats?at(m.stats,((X=m.combat)==null?void 0:X.bonusDeadlySlots)||0):null);zn(e,P,y,$,S,l,o),Nn(e,P,y,$,g,x,S,{bothSides:!0}),Rn(e,P,y,$,m.portrait,m.name,w,N),w&&N&&(Ln(e,P,y,$,w,N),Fn(e,P,y,$,w,N));const A=$+28;On(e,P,y,A,S)}},il=(e,t,n={})=>{var A,T;const{tokenSize:s=48,showDefence:o=!1,showFacing:l=!0,isHovered:i=!1,isSelected:m=!1,canSeeDefence:d=!1}=n,{character:r,pixelX:u,pixelY:g,facing:x=0,meleeDefence:P,rangedDefence:y}=t;if(!r)return;const $=u,S=g,O=s/2,q=x*60,X=(A=r.combat)==null?void 0:A.wounds,w=r.woundSlots||(r.stats?at(r.stats,((T=r.combat)==null?void 0:T.bonusDeadlySlots)||0):null),N=(i||m)&&d&&(P||y);if(N&&zn(e,$,S,O,q,m,i),Rn(e,$,S,O,r.portrait,r.name,X,w),X&&w&&(Ln(e,$,S,O,X,w),Fn(e,$,S,O,X,w)),N&&Nn(e,$,S,O,P,y,q,{bothSides:!0}),l){const I=O+(N?28:8);On(e,$,S,I,q)}},zn=(e,t,n,s,o=0,l=!1,i=!1)=>{e.save();const m=s+35,d=e.createRadialGradient(t,n,s-5,t,n,m);l?(d.addColorStop(0,"rgba(45, 35, 15, 0.95)"),d.addColorStop(.6,"rgba(35, 28, 12, 0.85)"),d.addColorStop(1,"rgba(25, 20, 8, 0)")):i?(d.addColorStop(0,"rgba(15, 30, 45, 0.95)"),d.addColorStop(.6,"rgba(12, 25, 38, 0.85)"),d.addColorStop(1,"rgba(8, 18, 28, 0)")):(d.addColorStop(0,"rgba(15, 23, 42, 0.95)"),d.addColorStop(.6,"rgba(15, 23, 42, 0.85)"),d.addColorStop(1,"rgba(15, 23, 42, 0)")),e.beginPath(),e.arc(t,n,m,0,Math.PI*2),e.fillStyle=d,e.fill(),e.beginPath(),e.arc(t,n,m-2,0,Math.PI*2),l?e.strokeStyle="rgba(250, 204, 21, 0.4)":i?e.strokeStyle="rgba(56, 189, 248, 0.4)":e.strokeStyle="rgba(148, 163, 184, 0.3)",e.lineWidth=1,e.stroke(),e.restore()},rl=(e,t,n={})=>{const{hoveredTokenId:s=null,selectedTokenId:o=null,currentUserId:l=null,isMaster:i=!1,draggingTokenId:m=null}=n,d=t.map(u=>{var O,q,X;const g=u.id===s||u.characterId===s,x=u.id===o||u.characterId===o,P=u.id===m||u.characterId===m,y=((O=u.character)==null?void 0:O.ownerId)===l,$=((X=(q=u.character)==null?void 0:q.combat)==null?void 0:X.showDefenceToOthers)||!1;return{token:u,isHovered:g,isSelected:x,isDragging:P,canSeeDefence:i||y||$}});for(const{token:u,isHovered:g,isSelected:x,isDragging:P,canSeeDefence:y}of d)P&&(e.save(),e.globalAlpha=.7),il(e,u,{...n,isHovered:!1,isSelected:!1,canSeeDefence:y}),P&&e.restore();const r=d.filter(u=>u.isHovered||u.isSelected);r.sort((u,g)=>u.isHovered&&!g.isHovered?1:!u.isHovered&&g.isHovered?-1:0);for(const{token:u,isHovered:g,isSelected:x,canSeeDefence:P}of r)ll(e,u,{...n,isHovered:g,isSelected:x,canSeeDefence:P})},cl=(e,t,n,s)=>{const o=e-n.pixelX,l=t-n.pixelY,i=s/2;return o*o+l*l<=i*i},St=(e,t,n,s)=>{for(let o=n.length-1;o>=0;o--){const l=n[o];if(cl(e,t,l,s))return l}return null},et=(e,t,n)=>({x:(e-n.x)/n.zoom,y:(t-n.y)/n.zoom}),ul={class:"fill-profile-panel flex flex-col h-full bg-slate-800 text-white"},dl={class:"flex items-center justify-between px-3 py-2 border-b border-white/10"},fl={class:"flex border-b border-white/10"},pl=["onClick"],hl={class:"flex-1 overflow-y-auto p-3"},ml={class:"space-y-2"},vl={class:"flex items-center justify-between mb-2"},gl={class:"flex gap-1"},bl={key:0,class:"p-2 bg-slate-700/50 rounded-lg mb-2"},yl={class:"flex gap-1"},xl=["onClick"],kl={class:"flex items-center justify-between"},wl={class:"text-sm font-medium"},Tl={class:"text-xs text-slate-400"},Cl=["onClick"],_l={key:1,class:"text-center text-slate-500 text-xs py-4"},Sl={key:0,class:"mt-4 pt-4 border-t border-white/10"},Pl={class:"grid grid-cols-5 gap-1 max-h-32 overflow-y-auto"},$l=["title","onClick"],El={key:1,class:"space-y-2"},Ml={class:"flex items-center justify-between mb-2"},Al={class:"text-xs text-slate-400"},Il=["onClick"],Dl={class:"flex items-center gap-2"},Rl=["checked","onChange"],Ll={class:"text-sm"},Fl={class:"flex items-center gap-1"},Nl={class:"text-xs text-slate-400"},Ol=["onClick"],zl={key:0,class:"mt-3 pt-3 border-t border-white/10 space-y-3"},Bl=["value","onInput"],jl={class:"grid grid-cols-6 gap-1 mt-1 max-h-24 overflow-y-auto"},Hl=["title","onClick"],Wl={class:"flex items-center justify-between"},Ul={class:"text-xs text-sky-400"},ql=["value","onInput"],Yl={class:"flex items-center justify-between"},Xl={class:"text-xs text-sky-400"},Vl={class:"flex items-center gap-2 text-[10px] text-slate-500"},Gl=["value","onInput"],Ql={class:"flex items-center justify-between mb-1"},Kl=["onClick"],Zl={key:0,class:"text-xs text-slate-500 italic"},Jl=["value","onChange"],ei=["value"],ti=["value","onChange"],ni=["value"],si=["value","onInput"],oi=["onClick"],ai={key:0,class:"text-center text-slate-500 text-xs py-4"},li={key:2,class:"text-center py-8"},ii={key:3,class:"text-center text-slate-500 text-xs py-8"},ri={key:0,class:"p-3 border-t border-white/10"},ci={__name:"FillProfilePanel",emits:["apply","preview","close"],setup(e,{emit:t}){const n=t,s=bn(),o=An(),{profiles:l,currentProfile:i,sortedProfiles:m}=tt(s),d=W("profile"),r=W(null),u=W(!1),g=W(""),x=Y(()=>[...o.baseTerrains,...o.customTerrains]),P=G=>x.value.find(L=>L.id===G)||{name:G,color:"#888"},y=()=>{g.value.trim()&&(s.createProfile({name:g.value.trim()}),g.value="",u.value=!1)},$=G=>{s.selectProfile(G),r.value=null},S=G=>{confirm("Удалить профиль?")&&s.deleteProfile(G)},O=()=>{var L;if(!i.value)return;const G=s.addLayer(i.value.id,{name:`Слой ${(((L=i.value.layers)==null?void 0:L.length)||0)+1}`});G&&(r.value=G.id,d.value="layers")},q=G=>{i.value&&(s.removeLayer(i.value.id,G),r.value===G&&(r.value=null))},X=(G,L,he)=>{i.value&&s.updateLayer(i.value.id,G,{[L]:he})},w=G=>{i.value&&s.updateProfile(i.value.id,{baseTerrain:G})},N=G=>{i.value&&s.addCondition(i.value.id,G,{type:be.NONE})},A=(G,L)=>{i.value&&s.removeCondition(i.value.id,G,L)},T=()=>{i.value&&n("apply",i.value)},I=()=>{i.value&&n("preview",i.value)},z=()=>{s.createDefaultProfile()},U={[be.NONE]:"Без условия",[be.TERRAIN_ID]:"Террейн",[be.TERRAIN_BIOME]:"Биом",[be.VISIBILITY]:"Видимость",[be.MOVEMENT_COST]:"Проходимость",[be.MELEE_ADVANTAGE]:"Бонус ближ. боя",[be.TAG]:"Тег"},fe={[we.EQUALS]:"=",[we.NOT_EQUALS]:"≠",[we.GREATER]:">",[we.GREATER_EQUALS]:"≥",[we.LESS]:"<",[we.LESS_EQUALS]:"≤",[we.CONTAINS]:"содержит"};return(G,L)=>{var he;return f(),p("div",ul,[c("header",dl,[L[5]||(L[5]=c("h3",{class:"text-sm font-medium"},"Профили заливки",-1)),c("button",{type:"button",class:"text-slate-400 hover:text-white transition",onClick:L[0]||(L[0]=b=>n("close"))}," ✕ ")]),c("div",fl,[(f(),p(Q,null,le([{id:"profile",label:"📋 Профиль"},{id:"layers",label:"📚 Слои"},{id:"preview",label:"👁 Превью"}],b=>c("button",{key:b.id,type:"button",class:ae(["flex-1 px-3 py-2 text-xs transition",d.value===b.id?"bg-sky-500/20 text-sky-400 border-b-2 border-sky-400":"text-slate-400 hover:text-white hover:bg-white/5"]),onClick:C=>d.value=b.id},B(b.label),11,pl)),64))]),c("div",hl,[d.value==="profile"?(f(),p(Q,{key:0},[c("div",ml,[c("div",vl,[L[6]||(L[6]=c("span",{class:"text-xs text-slate-400"},"Сохранённые профили",-1)),c("div",gl,[c("button",{type:"button",class:"px-2 py-1 text-xs bg-sky-500/20 text-sky-400 rounded hover:bg-sky-500/30 transition",onClick:L[1]||(L[1]=b=>u.value=!0)}," + Новый "),M(l).length===0?(f(),p("button",{key:0,type:"button",class:"px-2 py-1 text-xs bg-emerald-500/20 text-emerald-400 rounded hover:bg-emerald-500/30 transition",onClick:z}," Пример ")):D("",!0)])]),u.value?(f(),p("div",bl,[De(c("input",{"onUpdate:modelValue":L[2]||(L[2]=b=>g.value=b),type:"text",placeholder:"Название профиля...",class:"w-full px-2 py-1 text-xs bg-slate-900/50 border border-white/10 rounded mb-2 focus:outline-none focus:border-sky-400/50",onKeyup:ks(y,["enter"])},null,544),[[Ye,g.value]]),c("div",yl,[c("button",{type:"button",class:"flex-1 px-2 py-1 text-xs bg-sky-500 text-white rounded hover:bg-sky-600 transition",onClick:y}," Создать "),c("button",{type:"button",class:"px-2 py-1 text-xs text-slate-400 hover:text-white transition",onClick:L[3]||(L[3]=b=>{u.value=!1,g.value=""})}," Отмена ")])])):D("",!0),(f(!0),p(Q,null,le(M(m),b=>{var C,_;return f(),p("div",{key:b.id,class:ae(["p-2 rounded-lg border transition cursor-pointer",((C=M(i))==null?void 0:C.id)===b.id?"bg-sky-500/20 border-sky-400/60":"bg-slate-700/30 border-white/10 hover:border-white/20"]),onClick:R=>$(b.id)},[c("div",kl,[c("div",null,[c("div",wl,B(b.name),1),c("div",Tl,B(((_=b.layers)==null?void 0:_.length)||0)+" слоёв • База: "+B(P(b.baseTerrain).name),1)]),c("button",{type:"button",class:"p-1 text-slate-400 hover:text-red-400 transition",onClick:Me(R=>S(b.id),["stop"])}," 🗑 ",8,Cl)])],10,xl)}),128)),M(l).length===0?(f(),p("div",_l," Нет сохранённых профилей ")):D("",!0)]),M(i)?(f(),p("div",Sl,[L[7]||(L[7]=c("div",{class:"text-xs text-slate-400 mb-2"},"Базовый террейн",-1)),c("div",Pl,[(f(!0),p(Q,null,le(x.value,b=>(f(),p("button",{key:b.id,type:"button",class:ae(["w-10 h-10 rounded border transition",M(i).baseTerrain===b.id?"border-sky-400 ring-2 ring-sky-400/50":"border-white/10 hover:border-white/30"]),style:Pe({backgroundColor:b.color||"#888"}),title:b.name,onClick:C=>w(b.id)},null,14,$l))),128))])])):D("",!0)],64)):D("",!0),d.value==="layers"&&M(i)?(f(),p("div",El,[c("div",Ml,[c("span",Al,'Слои профиля "'+B(M(i).name)+'"',1),c("button",{type:"button",class:"px-2 py-1 text-xs bg-sky-500/20 text-sky-400 rounded hover:bg-sky-500/30 transition",onClick:O}," + Слой ")]),(f(!0),p(Q,null,le(M(i).layers,b=>{var C;return f(),p("div",{key:b.id,class:ae(["p-2 rounded-lg border transition",r.value===b.id?"bg-sky-500/10 border-sky-400/60":"bg-slate-700/30 border-white/10"])},[c("div",{class:"flex items-center justify-between cursor-pointer",onClick:_=>r.value=r.value===b.id?null:b.id},[c("div",Dl,[c("input",{type:"checkbox",checked:b.enabled,class:"rounded",onClick:L[4]||(L[4]=Me(()=>{},["stop"])),onChange:_=>X(b.id,"enabled",_.target.checked)},null,40,Rl),c("span",{class:"w-4 h-4 rounded",style:Pe({backgroundColor:P(b.terrainId).color||"#888"})},null,4),c("span",Ll,B(b.name),1)]),c("div",Fl,[c("span",Nl,B(b.density)+"%",1),c("button",{type:"button",class:"p-1 text-slate-400 hover:text-red-400 transition",onClick:Me(_=>q(b.id),["stop"])}," ✕ ",8,Ol)])],8,Il),r.value===b.id?(f(),p("div",zl,[c("div",null,[L[8]||(L[8]=c("label",{class:"text-xs text-slate-400"},"Название",-1)),c("input",{value:b.name,type:"text",class:"w-full px-2 py-1 text-xs bg-slate-900/50 border border-white/10 rounded mt-1 focus:outline-none focus:border-sky-400/50",onInput:_=>X(b.id,"name",_.target.value)},null,40,Bl)]),c("div",null,[L[9]||(L[9]=c("label",{class:"text-xs text-slate-400"},"Террейн",-1)),c("div",jl,[(f(!0),p(Q,null,le(x.value,_=>(f(),p("button",{key:_.id,type:"button",class:ae(["w-8 h-8 rounded border transition",b.terrainId===_.id?"border-sky-400 ring-2 ring-sky-400/50":"border-white/10 hover:border-white/30"]),style:Pe({backgroundColor:_.color||"#888"}),title:_.name,onClick:R=>X(b.id,"terrainId",_.id)},null,14,Hl))),128))])]),c("div",null,[c("div",Wl,[L[10]||(L[10]=c("label",{class:"text-xs text-slate-400"},"Плотность",-1)),c("span",Ul,B(b.density)+"%",1)]),c("input",{value:b.density,type:"range",min:"0",max:"100",class:"w-full mt-1",onInput:_=>X(b.id,"density",Number(_.target.value))},null,40,ql)]),c("div",null,[c("div",Yl,[L[11]||(L[11]=c("label",{class:"text-xs text-slate-400"},"Группировка",-1)),c("span",Xl,B(b.clustering)+"%",1)]),c("div",Vl,[L[12]||(L[12]=c("span",null,"Разброс",-1)),c("input",{value:b.clustering,type:"range",min:"0",max:"100",class:"flex-1",onInput:_=>X(b.id,"clustering",Number(_.target.value))},null,40,Gl),L[13]||(L[13]=c("span",null,"Кластеры",-1))])]),c("div",null,[c("div",Ql,[L[14]||(L[14]=c("label",{class:"text-xs text-slate-400"},"Условия",-1)),c("button",{type:"button",class:"text-xs text-sky-400 hover:text-sky-300",onClick:_=>N(b.id)}," + Условие ",8,Kl)]),((C=b.conditions)==null?void 0:C.length)===0?(f(),p("div",Zl," Нет условий (применяется везде) ")):D("",!0),(f(!0),p(Q,null,le(b.conditions,_=>(f(),p("div",{key:_.id,class:"flex items-center gap-1 mt-1 p-1 bg-slate-900/30 rounded text-xs"},[c("select",{value:_.type,class:"flex-1 px-1 py-0.5 bg-slate-800 border border-white/10 rounded text-xs",onChange:R=>M(s).updateLayer(M(i).id,b.id,{conditions:b.conditions.map(K=>K.id===_.id?{...K,type:R.target.value}:K)})},[(f(),p(Q,null,le(U,(R,K)=>c("option",{key:K,value:K},B(R),9,ei)),64))],40,Jl),_.type!==M(be).NONE?(f(),p("select",{key:0,value:_.operator,class:"px-1 py-0.5 bg-slate-800 border border-white/10 rounded text-xs",onChange:R=>M(s).updateLayer(M(i).id,b.id,{conditions:b.conditions.map(K=>K.id===_.id?{...K,operator:R.target.value}:K)})},[(f(),p(Q,null,le(fe,(R,K)=>c("option",{key:K,value:K},B(R),9,ni)),64))],40,ti)):D("",!0),_.type!==M(be).NONE?(f(),p("input",{key:1,value:_.value,type:"text",placeholder:"значение",class:"w-16 px-1 py-0.5 bg-slate-800 border border-white/10 rounded text-xs",onInput:R=>M(s).updateLayer(M(i).id,b.id,{conditions:b.conditions.map(K=>K.id===_.id?{...K,value:R.target.value}:K)})},null,40,si)):D("",!0),c("button",{type:"button",class:"text-slate-400 hover:text-red-400",onClick:R=>A(b.id,_.id)}," ✕ ",8,oi)]))),128))])])):D("",!0)],2)}),128)),(he=M(i).layers)!=null&&he.length?D("",!0):(f(),p("div",ai," Добавьте слои для настройки заливки "))])):D("",!0),d.value==="preview"&&M(i)?(f(),p("div",li,[L[15]||(L[15]=c("div",{class:"text-slate-400 text-sm mb-4"},' Выделите область на карте и нажмите "Превью" чтобы увидеть результат ',-1)),c("button",{type:"button",class:"px-4 py-2 bg-amber-500/20 text-amber-400 rounded-lg hover:bg-amber-500/30 transition",onClick:I}," 👁 Показать превью ")])):D("",!0),!M(i)&&d.value!=="profile"?(f(),p("div",ii," Выберите или создайте профиль ")):D("",!0)]),M(i)?(f(),p("footer",ri,[c("button",{type:"button",class:"w-full py-2 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600 transition",onClick:T}," 🎲 Применить к выделению ")])):D("",!0)])}}},ui=Rt(ci,[["__scopeId","data-v-f9b9add9"]]),di={class:"h-full bg-slate-950 text-slate-50 flex flex-col overflow-hidden relative"},fi={key:0,class:"bg-slate-900/90 backdrop-blur border-b border-white/10 px-4 py-2 flex items-center justify-between flex-shrink-0 gap-2 relative z-20"},pi={class:"flex items-center gap-2"},hi={key:0,class:"relative"},mi={class:"font-medium truncate max-w-32"},vi=["onClick"],gi={class:"text-sm font-medium"},bi={class:"text-xs text-slate-400"},yi={key:0,class:"text-xs text-emerald-400"},xi={key:0,class:"border-t border-white/10 mt-1 pt-1"},ki={key:1,class:"flex items-center gap-2"},wi={key:0,class:"px-3 py-1.5 rounded-lg bg-slate-800 border border-white/10 text-sm font-medium"},Ti={key:1,class:"px-3 py-1.5 rounded-lg bg-slate-800/50 border border-white/10 text-sm text-slate-400"},Ci={key:0,class:"text-xs px-2 py-1 rounded bg-slate-800 border border-white/10"},_i={key:1,class:"text-xs px-2 py-1 rounded bg-slate-700 text-slate-400"},Si={key:0,class:"flex items-center gap-1"},Pi=["title","onClick"],$i={class:"flex items-center gap-1"},Ei=["title","onClick"],Mi={key:0,class:"text-xs text-slate-500 italic"},Ai={class:"relative"},Ii={class:"mb-3"},Di={class:"flex gap-1"},Ri=["title","onClick"],Li={class:"mb-3"},Fi={class:"flex gap-1"},Ni=["title","onClick"],Oi={class:"mb-3"},zi={class:"flex gap-1"},Bi=["title","onClick"],ji={class:"text-[10px] text-slate-500 mt-1"},Hi={key:0},Wi={class:"text-xs text-slate-400 mb-1"},Ui=["value"],qi={class:"text-xs text-slate-400 px-1"},Yi={class:"relative"},Xi={class:"text-xs"},Vi={class:"p-2 border-b border-white/10"},Gi={class:"flex items-center gap-2"},Qi={key:0,class:"mt-2 space-y-2"},Ki={class:"flex items-center gap-2"},Zi=["value"],Ji={class:"flex items-center gap-2"},er=["value"],tr={class:"flex items-center gap-2"},nr={class:"text-xs text-slate-300 w-8"},sr={class:"p-2 max-h-64 overflow-y-auto"},or={key:0,class:"grid grid-cols-5 gap-1"},ar=["title","onClick"],lr={class:"absolute bottom-0 left-0 right-0 flex justify-center gap-0.5 p-0.5 bg-black/50 opacity-0 group-hover:opacity-100 transition"},ir={key:0,class:"text-[8px]"},rr={key:1,class:"text-[8px]"},cr={key:2,class:"text-[8px]"},ur={key:3,class:"text-[8px]"},dr={key:4,class:"text-[8px] text-green-400"},fr={key:5,class:"text-[8px] text-red-400"},pr={key:1,class:"text-center text-xs text-slate-400 py-4"},hr={key:2,class:"mt-2 pt-2 border-t border-white/10"},mr={class:"grid grid-cols-5 gap-1"},vr=["title","onClick"],gr={class:"flex items-center gap-2"},br=["title"],yr={class:"flex-1 flex overflow-hidden"},xr=["width","height"],kr=["width","height"],wr=["width","height"],Tr={key:0,class:"absolute bottom-4 left-4 px-3 py-1.5 rounded-lg bg-slate-900/90 border border-white/10 text-xs font-mono pointer-events-none"},Cr={key:1,class:"absolute bottom-4 right-4 px-3 py-1.5 rounded-lg bg-slate-900/90 border border-white/10 text-xs pointer-events-none"},_r={key:1,class:"bg-slate-900/80 backdrop-blur border-t border-white/10 px-4 py-2 flex-shrink-0 relative z-10"},Sr={class:"flex items-center justify-between text-sm"},Pr={class:"text-slate-400 text-xs"},$r={class:"flex items-center gap-2"},Er={class:"bg-slate-800 border border-white/10 rounded-xl p-6 w-full max-w-md shadow-2xl"},Mr={class:"space-y-4"},Ar={class:"flex gap-2"},Ir=["value"],Dr={class:"flex justify-end gap-2 mt-6"},qr={__name:"BattleMap",props:{readonly:{type:Boolean,default:!1},mobileMode:{type:Boolean,default:!1},pendingAction:{type:Object,default:null}},emits:["action-target-selected","token-selected","hex-selected","hex-double-tap"],setup(e,{emit:t}){const n=e,s=t,o=_s(),l=An();bn();const i=gn(),m=Ss(),d=hn(),{activeMap:r,editingMap:u,editorMode:g,selectedTerrain:x,activeLayerId:P,camera:y,maps:$,publishedMaps:S,selection:O}=tt(o),{isMaster:q}=tt(i),{characters:X}=tt(m),w=Y(()=>n.readonly||!q.value),N=Y(()=>!w.value),A=W(null),T=W(null),I=W(null),z=W(null),U=W({width:800,height:600}),fe=W(!1),G=W(!1),L=W(!1),he=W(!1),b=W(!1),C=W(null),_=W(null),R=W(null),K=W(!1),re=W(!1),ce=W(!1),te=W(null),ue=W({x:0,y:0}),oe=W(null),ie=W(""),me=W(null),Te=W(null),xe=W({min:1,max:5}),Fe=W(!1),$e=W(!1),Oe=W(null),_e=W(null),Ae=W([]),pe=W(new Set),vt=W(null),lt=W({x:0,y:0}),ke=W({name:"",orientation:Qt.FLAT,scale:Be.BATTLE,hexSize:32}),de=Y(()=>{const v=r.value;return v?new Ps({orientation:v.orientation,hexSize:v.hexSize,origin:{x:0,y:0}}):null}),Ve=Y(()=>{if(!r.value||!de.value)return[];const v=o.getAllTokens(r.value.id),a=de.value;return v.map(k=>{const E=m.getCharacterById(k.characterId);if(!E)return null;const j=a.hexToPixel(k.q,k.r);return{...k,character:E,pixelX:j.x,pixelY:j.y,meleeDefence:un(E,"melee"),rangedDefence:un(E,"ranged")}}).filter(Boolean)}),it=Y(()=>r.value?Math.floor(r.value.hexSize*1.6):48),We=Y(()=>de.value?new $s(de.value):null),Ft=Y(()=>l.getFilteredTerrains({biome:me.value,visibility:Te.value,passabilityMin:xe.value.min,passabilityMax:xe.value.max,search:ie.value})),Bn=Y(()=>[...l.baseTerrains,...l.customTerrains]),gt=Y(()=>{const v=Bn.value.find(a=>a.id===x.value);if(v)return v;if(Ke[x.value]){const a=Ke[x.value];return{id:x.value,name:a.name,fallbackColor:a.color,passability:a.passable?1:0}}return{id:"void",name:"Пустота",fallbackColor:"#0d1117",passability:0}}),Ge=v=>{if(!v||!r.value)return v;const a=o.getHexTerrain(r.value.id,v.q,v.r),k=l.getTerrainById(a);return{q:v.q,r:v.r,terrain:k||null}};mn(()=>{Nt(),N.value&&($.value.length===0?Wt():r.value||o.setActiveMap($.value[0].id)),rt(),He(()=>{Ee()}),window.addEventListener("resize",Ot)}),vn(()=>{window.removeEventListener("resize",Ot)}),nt([r,y],()=>{He(()=>{Ee()})},{deep:!0}),nt(Ve,async v=>{v.length>0&&(await al(v),ve())},{immediate:!0});let bt=null;nt(()=>{var v;return(v=r.value)==null?void 0:v.updatedAt},(v,a)=>{!q.value||!v||(bt&&clearTimeout(bt),bt=setTimeout(()=>{i.broadcastMap()},500))},{flush:"post"});const Nt=()=>{if(A.value){const v=A.value.getBoundingClientRect();U.value={width:Math.floor(v.width)||800,height:Math.floor(v.height)||600}}},rt=()=>{o.$patch({camera:{x:U.value.width/2,y:U.value.height/2,zoom:1}})},Ee=()=>{ze(),Qe(),ve()},ze=()=>{const v=T.value;if(!v||!r.value||!de.value)return;const a=v.getContext("2d"),k=r.value,E=de.value;a.clearRect(0,0,v.width,v.height),a.save(),a.translate(y.value.x,y.value.y),a.scale(y.value.zoom,y.value.zoom);const j=k.layers.find(J=>J.type===Ue.TERRAIN);if(!j){a.restore();return}j.data.forEach((J,h)=>{const[F,H]=h.split(",").map(Number),V=E.hexToPixel(F,H),ee=E.getHexCorners(V.x,V.y);let ne=(J==null?void 0:J.terrain)||"void",se=!1;oe.value&&oe.value.has(h)&&(ne=oe.value.get(h),se=!0);let ye="#0d1117";const Ne=l.getTerrainById(ne);Ne?ye=Ne.fallbackColor||Ne.color||ye:Ke[ne]&&(ye=Ke[ne].color),a.beginPath(),a.moveTo(ee[0].x,ee[0].y);for(let Ie=1;Ie<6;Ie++)a.lineTo(ee[Ie].x,ee[Ie].y);a.closePath(),a.fillStyle=ye,a.fill(),se&&(a.strokeStyle="rgba(255, 255, 0, 0.6)",a.lineWidth=2/y.value.zoom,a.stroke())}),a.restore()},Qe=()=>{const v=I.value;if(!v||!r.value||!de.value)return;const a=v.getContext("2d"),k=r.value,E=de.value;if(a.clearRect(0,0,v.width,v.height),!k.visibility.showGrid)return;a.save(),a.translate(y.value.x,y.value.y),a.scale(y.value.zoom,y.value.zoom);const j=k.layers.find(h=>h.type===Ue.TERRAIN);if(!j){a.restore();return}a.strokeStyle="rgba(255, 255, 255, 0.2)",a.lineWidth=1/y.value.zoom,j.data.forEach((h,F)=>{const[H,V]=F.split(",").map(Number),ee=E.hexToPixel(H,V),ne=E.getHexCorners(ee.x,ee.y);a.beginPath(),a.moveTo(ne[0].x,ne[0].y);for(let se=1;se<6;se++)a.lineTo(ne[se].x,ne[se].y);a.closePath(),a.stroke()});const J=E.hexToPixel(0,0);a.beginPath(),a.arc(J.x,J.y,4/y.value.zoom,0,Math.PI*2),a.fillStyle="rgba(250, 204, 21, 0.8)",a.fill(),a.restore()},ve=()=>{var j,J,h;const v=z.value;if(!v||!r.value||!de.value)return;const a=v.getContext("2d"),k=de.value;if(a.clearRect(0,0,v.width,v.height),a.save(),a.translate(y.value.x,y.value.y),a.scale(y.value.zoom,y.value.zoom),pe.value.size>0&&pe.value.forEach(F=>{const[H,V]=F.split(",").map(Number),ee=k.hexToPixel(H,V),ne=k.getHexCorners(ee.x,ee.y);a.beginPath(),a.moveTo(ne[0].x,ne[0].y);for(let se=1;se<6;se++)a.lineTo(ne[se].x,ne[se].y);a.closePath(),a.fillStyle="rgba(250, 204, 21, 0.25)",a.fill(),a.strokeStyle="rgba(250, 204, 21, 0.8)",a.lineWidth=2/y.value.zoom,a.stroke()}),Ae.value.length>0&&$e.value){const F=O.value.mode;let H,V;if(F===Ce.ADD?(H="rgba(34, 197, 94, 0.3)",V="rgba(34, 197, 94, 0.9)"):F===Ce.SUBTRACT?(H="rgba(239, 68, 68, 0.3)",V="rgba(239, 68, 68, 0.9)"):(H="rgba(56, 189, 248, 0.3)",V="rgba(56, 189, 248, 0.9)"),Ae.value.forEach(ee=>{const ne=k.hexToPixel(ee.q,ee.r),se=k.getHexCorners(ne.x,ne.y);a.beginPath(),a.moveTo(se[0].x,se[0].y);for(let ye=1;ye<6;ye++)a.lineTo(se[ye].x,se[ye].y);a.closePath(),a.fillStyle=H,a.fill(),a.strokeStyle=V,a.lineWidth=1.5/y.value.zoom,a.stroke()}),_e.value&&C.value){const ee=O.value.shape,ne=_e.value,se=k.hexToPixel(C.value.q,C.value.r);if(a.setLineDash([5/y.value.zoom,5/y.value.zoom]),a.strokeStyle=V,a.lineWidth=2/y.value.zoom,ee===ge.RECTANGLE){const ye=Math.min(ne.x,se.x),Ne=Math.max(ne.x,se.x),Ie=Math.min(ne.y,se.y),vs=Math.max(ne.y,se.y);a.strokeRect(ye,Ie,Ne-ye,vs-Ie)}else if(ee===ge.CIRCLE||ee===ge.HEXAGON){const ye=se.x-ne.x,Ne=se.y-ne.y,Ie=Math.sqrt(ye*ye+Ne*Ne);a.beginPath(),a.arc(ne.x,ne.y,Ie,0,Math.PI*2),a.stroke()}else ee===ge.LINE&&(a.beginPath(),a.moveTo(ne.x,ne.y),a.lineTo(se.x,se.y),a.stroke());a.setLineDash([])}}if(_e.value&&$e.value){const F=_e.value;a.beginPath(),a.arc(F.x,F.y,6/y.value.zoom,0,Math.PI*2),a.fillStyle="rgba(250, 204, 21, 0.9)",a.fill(),a.strokeStyle="rgba(0, 0, 0, 0.5)",a.lineWidth=1/y.value.zoom,a.stroke()}if(C.value&&!$e.value){const F=k.hexToPixel(C.value.q,C.value.r),H=k.getHexCorners(F.x,F.y);a.beginPath(),a.moveTo(H[0].x,H[0].y);for(let V=1;V<6;V++)a.lineTo(H[V].x,H[V].y);a.closePath(),a.fillStyle="rgba(56, 189, 248, 0.3)",a.fill(),a.strokeStyle="rgba(56, 189, 248, 0.8)",a.lineWidth=2,a.stroke()}const E=Ve.value;if(E.length>0&&rl(a,E,{tokenSize:it.value,showFacing:!0,hoveredTokenId:((j=_.value)==null?void 0:j.characterId)||null,selectedTokenId:((J=R.value)==null?void 0:J.characterId)||null,currentUserId:d.userId,isMaster:q.value,draggingTokenId:ce.value?(h=te.value)==null?void 0:h.characterId:null}),ce.value&&te.value&&de.value){const F=de.value.pixelToHex(te.value.pixelX,te.value.pixelY),H=de.value.hexToPixel(F.q,F.r);a.beginPath();const V=de.value.getHexCorners(H.x,H.y);a.moveTo(V[0].x,V[0].y);for(let ee=1;ee<V.length;ee++)a.lineTo(V[ee].x,V[ee].y);a.closePath(),a.fillStyle="rgba(250, 204, 21, 0.3)",a.fill(),a.strokeStyle="rgba(250, 204, 21, 0.8)",a.lineWidth=2,a.stroke()}a.restore()},Ot=()=>{Nt(),He(()=>{Ee()})},jn=v=>{if(!de.value||!z.value)return null;const a=z.value.getBoundingClientRect(),k=(v.clientX-a.left-y.value.x)/y.value.zoom,E=(v.clientY-a.top-y.value.y)/y.value.zoom;return de.value.pixelToHex(k,E)},zt=v=>{if(!z.value)return null;const a=z.value.getBoundingClientRect(),k=(v.clientX-a.left-y.value.x)/y.value.zoom,E=(v.clientY-a.top-y.value.y)/y.value.zoom;return{x:k,y:E}},Bt=v=>{if(!de.value||!C.value)return null;const a=zt(v);if(!a)return null;const k=de.value,E=C.value,j=k.hexToPixel(E.q,E.r),J=k.getHexCorners(j.x,j.y),h=[{x:j.x,y:j.y,type:"center"},...J.map((V,ee)=>({x:V.x,y:V.y,type:`corner${ee}`}))];let F=1/0,H=h[0];for(const V of h){const ee=V.x-a.x,ne=V.y-a.y,se=ee*ee+ne*ne;se<F&&(F=se,H=V)}return{x:H.x,y:H.y}},Hn=v=>{if(K.value){const F=v.clientX-lt.value.x,H=v.clientY-lt.value.y;o.panCamera(F,H),lt.value={x:v.clientX,y:v.clientY},Ee();return}if(ce.value&&te.value){const F=v.target.getBoundingClientRect(),H=v.clientX-F.left,V=v.clientY-F.top,ee=et(H,V,y.value);te.value.pixelX=ee.x-ue.value.x,te.value.pixelY=ee.y-ue.value.y,ve();return}const a=jn(v);a?(C.value=a,$e.value&&Oe.value&&We.value&&Xn(a,v),re.value&&u.value&&g.value!=="select"&&jt(a)):C.value=null;const k=v.target.getBoundingClientRect(),E=v.clientX-k.left,j=v.clientY-k.top,J=et(E,j,y.value),h=St(J.x,J.y,Ve.value,it.value);h!==_.value&&(_.value=h),ve()},Wn=v=>{var a;if(fe.value=!1,L.value=!1,he.value=!1,v.button===1||v.button===0&&v.shiftKey){K.value=!0,lt.value={x:v.clientX,y:v.clientY},v.preventDefault();return}if(v.button===0&&_.value&&q.value){ce.value=!0,te.value=_.value,R.value=_.value,s("token-selected",_.value);const k=v.target.getBoundingClientRect(),E=v.clientX-k.left,j=v.clientY-k.top,J=et(E,j,y.value);ue.value={x:J.x-_.value.pixelX,y:J.y-_.value.pixelY},v.preventDefault();return}if(v.button===0&&_.value){if(n.mobileMode&&n.pendingAction&&(n.pendingAction.id==="attack"||n.pendingAction.id==="skill")){s("action-target-selected",_.value);return}((a=R.value)==null?void 0:a.characterId)===_.value.characterId?(R.value=null,s("token-selected",null)):(R.value=_.value,s("token-selected",_.value)),ve();return}if(v.button===0&&!_.value){if(n.mobileMode&&n.pendingAction&&n.pendingAction.id==="move"&&C.value){s("action-target-selected",{type:"hex",hex:Ge(C.value)});return}C.value&&s("hex-selected",Ge(C.value)),R.value&&(R.value=null,s("token-selected",null),ve())}if(!w.value&&v.button===0&&C.value&&u.value)if(g.value==="select"){$e.value=!0,Oe.value={...C.value};const k=Bt(v);_e.value=k,Ae.value=[{...C.value}]}else g.value==="token"?(pe.value.clear(),pe.value.add(`${C.value.q},${C.value.r}`),ve()):(re.value=!0,jt(C.value))},Un=v=>{if(ce.value&&te.value&&de.value&&r.value){const a=de.value.pixelToHex(te.value.pixelX,te.value.pixelY),k=te.value.q,E=te.value.r;(k!==a.q||E!==a.r)&&(o.moveToken(r.value.id,k,E,a.q,a.r)?i.broadcastMapTokenMove(r.value.id,te.value.characterId,a.q,a.r):console.warn("Failed to move token - target hex may be occupied")),ce.value=!1,te.value=null,ue.value={x:0,y:0},ve();return}$e.value&&Oe.value&&C.value&&Vn(),K.value=!1,re.value=!1,$e.value=!1,Oe.value=null,_e.value=null,Ae.value=[],ve()},qn=()=>{C.value=null,_.value=null,K.value=!1,re.value=!1,ce.value&&(ce.value=!1,te.value=null,ue.value={x:0,y:0}),$e.value&&($e.value=!1,Oe.value=null,_e.value=null,Ae.value=[]),ve()},Yn=v=>{v.preventDefault();const a=z.value.getBoundingClientRect(),k=v.clientX-a.left,E=v.clientY-a.top,j=y.value.zoom,J=v.deltaY>0?.9:1.1,h=Math.max(.25,Math.min(4,j*J)),F=(k-y.value.x)/j,H=(E-y.value.y)/j;o.$patch({camera:{x:k-F*h,y:E-H*h,zoom:h}}),Ee()},jt=v=>{if(u.value){if(g.value==="paint")o.setHexTerrain(u.value.id,v.q,v.r,x.value),ze(),Qe();else if(g.value==="erase"){const a=r.value,k=a==null?void 0:a.layers.find(E=>E.type===Ue.TERRAIN);if(k){const E=xt(v.q,v.r);k.data.delete(E),a.updatedAt=Date.now(),ze(),Qe()}}}},Xn=(v,a=null)=>{if(!We.value||!_e.value)return;const k=O.value.shape,E=O.value.behavior,j=O.value.lineWidth,J=r.value,h=J==null?void 0:J.layers.find(ee=>ee.type===Ue.TERRAIN),F=h?h.data:new Map,H=a?Bt(a)||zt(a):null;if(!H)return;let V=[];switch(k){case ge.RECTANGLE:V=We.value.calculateRectanglePreviewPixel(_e.value,H,F,E);break;case ge.CIRCLE:V=We.value.calculateCirclePreviewPixel(_e.value,H,F,E);break;case ge.HEXAGON:V=We.value.calculateHexagonPreviewPixel(_e.value,H,F,E);break;case ge.LINE:V=We.value.calculateLinePreviewPixel(_e.value,H,j,F,E);break}Ae.value=V},Vn=()=>{if(Ae.value.length===0)return;const v=O.value.mode,a=new Set(pe.value);Ae.value.forEach(k=>{const E=xt(k.q,k.r);switch(v){case Ce.REPLACE:a.size===pe.value.size&&a.clear(),a.add(E);break;case Ce.ADD:a.add(E);break;case Ce.SUBTRACT:a.delete(E);break}}),v===Ce.REPLACE?pe.value=new Set(Ae.value.map(k=>xt(k.q,k.r))):pe.value=a},Ht=()=>{pe.value=new Set,ve()},Gn=()=>{pe.value.size===0||!u.value||(pe.value.forEach(v=>{const[a,k]=v.split(",").map(Number);o.setHexTerrain(u.value.id,a,k,x.value)}),ze(),Qe())},Qn=()=>{if(pe.value.size===0||!r.value)return;const v=r.value.layers.find(a=>a.type===Ue.TERRAIN);v&&(pe.value.forEach(a=>{v.data.delete(a)}),r.value.updatedAt=Date.now(),Ht(),ze(),Qe())},Z=W({touches:[],lastTap:null,isMultiTouch:!1,isPanning:!1,wasZooming:!1,initialDistance:0,initialZoom:1}),Kn=v=>{v.preventDefault();const a=Array.from(v.touches);if(Z.value.touches=a,Z.value.isMultiTouch=a.length>1,a.length===1){const k=a[0];Z.value.lastTap={x:k.clientX,y:k.clientY,time:Date.now()},Z.value.isPanning=!1}else if(a.length===2){const k=a[0],E=a[1],j=Math.hypot(E.clientX-k.clientX,E.clientY-k.clientY);Z.value.initialDistance=j,Z.value.initialZoom=y.value.zoom,Z.value.isPanning=!1,Z.value.wasZooming=!0}},Zn=v=>{v.preventDefault();const a=Array.from(v.touches);if(Z.value.touches=a,a.length===1&&!Z.value.isMultiTouch&&!Z.value.wasZooming){const k=a[0];if(Z.value.lastTap&&!Z.value.isPanning){const E=k.clientX-Z.value.lastTap.x,j=k.clientY-Z.value.lastTap.y;Math.hypot(E,j)>10&&(Z.value.isPanning=!0)}if(Z.value.isPanning&&Z.value.lastTap){const E=k.clientX-Z.value.lastTap.x,j=k.clientY-Z.value.lastTap.y;o.$patch({camera:{x:y.value.x+E,y:y.value.y+j,zoom:y.value.zoom}}),Z.value.lastTap={x:k.clientX,y:k.clientY,time:Date.now()},Ee()}}else if(a.length===2){const k=a[0],E=a[1],j=Math.hypot(E.clientX-k.clientX,E.clientY-k.clientY);if(Z.value.initialDistance>0){const J=j/Z.value.initialDistance,h=Math.max(.25,Math.min(4,Z.value.initialZoom*J)),F=(k.clientX+E.clientX)/2,H=(k.clientY+E.clientY)/2,V=z.value.getBoundingClientRect(),ee=F-V.left,ne=H-V.top,se=(ee-y.value.x)/y.value.zoom,ye=(ne-y.value.y)/y.value.zoom;o.$patch({camera:{x:ee-se*h,y:ne-ye*h,zoom:h}}),Ee()}}if(a.length===1&&!Z.value.isPanning){const k=a[0],E=v.target.getBoundingClientRect(),j=k.clientX-E.left,J=k.clientY-E.top,h=et(j,J,y.value);if(de.value){const H=de.value.pixelToHex(h.x,h.y);C.value=H}const F=St(h.x,h.y,Ve.value,it.value);F!==_.value&&(_.value=F),ve()}},Jn=v=>{v.preventDefault();const a=Array.from(v.touches);if(Z.value.touches=a,a.length>0){Z.value.isMultiTouch=a.length>1;return}if(!Z.value.isPanning&&Z.value.lastTap&&Date.now()-Z.value.lastTap.time<300){const E=v.target.getBoundingClientRect(),j=Z.value.lastTap.x-E.left,J=Z.value.lastTap.y-E.top,h=et(j,J,y.value);let F=null;de.value&&(F=de.value.pixelToHex(h.x,h.y),C.value=F);const H=St(h.x,h.y,Ve.value,it.value);_.value=H,es(H,F)}Z.value.touches=[],Z.value.lastTap=null,Z.value.isMultiTouch=!1,Z.value.isPanning=!1,Z.value.wasZooming=!1,Z.value.initialDistance=0,Z.value.initialZoom=1,ve()},es=(v,a)=>{var k;if(v){if(n.mobileMode&&n.pendingAction&&(n.pendingAction.id==="attack"||n.pendingAction.id==="skill")){s("action-target-selected",v);return}((k=R.value)==null?void 0:k.characterId)===v.characterId?(R.value=null,s("token-selected",null)):(R.value=v,s("token-selected",v)),ve();return}if(!v){if(n.mobileMode&&n.pendingAction&&n.pendingAction.id==="move"&&a){s("action-target-selected",{type:"hex",hex:Ge(a)});return}if(a&&n.mobileMode){const E=Date.now(),j=vt.value;if(j&&j.q===a.q&&j.r===a.r&&E-j.time<500){s("hex-double-tap",Ge(a)),vt.value=null;return}vt.value={q:a.q,r:a.r,time:E}}a&&s("hex-selected",Ge(a)),R.value&&(R.value=null,s("token-selected",null),ve())}},Wt=()=>{const v=o.createMap({name:ke.value.name||"Новая карта",orientation:ke.value.orientation,scale:ke.value.scale,hexSize:ke.value.hexSize}),a=5;for(let k=-a;k<=a;k++)for(let E=-a;E<=a;E++)(Math.abs(k)+Math.abs(k+E)+Math.abs(E))/2<=a&&o.setHexTerrain(v.id,k,E,"grass");o.startEditing(v.id),G.value=!1,ke.value.name="",He(()=>{rt(),Ee()})},ts=v=>{o.setActiveMap(v),fe.value=!1,He(()=>{rt(),Ee()})},ns=()=>{u.value?o.stopEditing():r.value&&o.startEditing(r.value.id)},Ut=v=>{o.selectTerrain(v),g.value!=="select"&&o.setEditorMode("paint"),L.value=!1},ss=()=>{r.value&&o.toggleMapPublished(r.value.id)},os=()=>{r.value&&confirm(`Удалить карту "${r.value.name}"?`)&&o.deleteMap(r.value.id)},as=v=>{if(!v||pe.value.size===0){alert("Сначала выделите область на карте");return}const a=[...pe.value],k=sl(v,a,l);oe.value=k,ze(),ve()},ls=v=>{if(!v||pe.value.size===0){alert("Сначала выделите область на карте");return}const a=[...pe.value],k=In(v,a,l);k.forEach((j,J)=>{const[h,F]=J.split(",").map(Number);o.setHexTerrain(r.value.id,h,F,j)});const E=nl(k,l);console.log("Заливка применена:",E),oe.value=null,pe.value=new Set,b.value=!1,Ee()},is=()=>{oe.value=null,ze(),ve()},rs=(v,a,k)=>{if(!r.value)return!1;const E=o.placeToken(r.value.id,v,a,k,0);return E&&(ve(),q.value&&i.broadcastMap()),E},cs=v=>{let a=null;if(pe.value.size>0){const k=pe.value.values().next().value,[E,j]=k.split(",").map(Number);a={q:E,r:j}}else C.value&&(a=C.value);return a?rs(v,a.q,a.r):(console.warn("No hex selected for token placement"),!1)},us=Y(()=>{const v=r.value;if(!v)return 0;const a=v.layers.find(k=>k.type===Ue.TERRAIN);return(a==null?void 0:a.data.size)||0}),ds=Y(()=>r.value?r.value.orientation===Qt.FLAT?"Flat-top ⬡":"Pointy-top ⬢":""),qt={[Be.BATTLE]:"Бой",[Be.LOCATION]:"Локация",[Be.DISTRICT]:"Район",[Be.CITY]:"Город",[Be.REGION]:"Регион",[Be.WORLD]:"Мир"},Yt={[ge.RECTANGLE]:"▭",[ge.CIRCLE]:"○",[ge.HEXAGON]:"⬡",[ge.LINE]:"╱"},fs={[ge.RECTANGLE]:"Прямоугольник",[ge.CIRCLE]:"Круг",[ge.HEXAGON]:"Шестиугольник",[ge.LINE]:"Линия"},ps={[Ce.REPLACE]:"⬚",[Ce.ADD]:"+",[Ce.SUBTRACT]:"−"},hs={[Ce.REPLACE]:"Заменить",[Ce.ADD]:"Добавить",[Ce.SUBTRACT]:"Вычесть"},ms={[je.AGGRESSIVE]:"Все",[je.STANDARD]:"Станд.",[je.PASSIVE]:"Связн."},Xt={[je.AGGRESSIVE]:"Все гексы в геометрической области",[je.STANDARD]:"Все гексы в геометрической области",[je.PASSIVE]:"Только связные существующие гексы (flood-fill)"};return(v,a)=>{var k,E,j,J;return f(),p("div",di,[!e.mobileMode||M(q)?(f(),p("header",fi,[c("div",pi,[N.value?(f(),p("div",hi,[c("button",{type:"button",class:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800 border border-white/10 hover:bg-slate-700 transition text-sm",onClick:a[0]||(a[0]=Me(h=>{fe.value=!fe.value,L.value=!1},["stop"]))},[c("span",mi,B(((k=M(r))==null?void 0:k.name)||"Выбрать карту"),1),a[25]||(a[25]=c("span",{class:"text-slate-400"},"▼",-1))]),fe.value?(f(),p("div",{key:0,class:"absolute top-full left-0 mt-1 w-64 bg-slate-800 border border-white/10 rounded-lg shadow-xl z-50 py-1 max-h-80 overflow-y-auto",onClick:a[2]||(a[2]=Me(()=>{},["stop"]))},[(f(!0),p(Q,null,le(M($),h=>{var F,H;return f(),p("div",{key:h.id,class:ae(["px-3 py-2 hover:bg-slate-700 cursor-pointer flex items-center justify-between",h.id===((F=M(r))==null?void 0:F.id)?"bg-sky-500/20":""]),onClick:V=>ts(h.id)},[c("div",null,[c("p",gi,B(h.name),1),c("p",bi,B(qt[h.scale]),1)]),(H=h.visibility)!=null&&H.published?(f(),p("span",yi,"●")):D("",!0)],10,vi)}),128)),N.value?(f(),p("div",xi,[c("button",{type:"button",class:"w-full px-3 py-2 text-left text-sm text-sky-400 hover:bg-slate-700",onClick:a[1]||(a[1]=h=>{G.value=!0,fe.value=!1})}," + Создать карту ")])):D("",!0)])):D("",!0)])):(f(),p("div",ki,[M(r)?(f(),p("span",wi," 🗺️ "+B(M(r).name),1)):(f(),p("span",Ti," ⏳ Ожидание карты... "))])),M(q)?(f(),p(Q,{key:2},[M(r)?(f(),p("span",Ci,B(us.value)+" гексов • "+B(ds.value),1)):D("",!0),w.value&&M(r)?(f(),p("span",_i," 👁️ Просмотр ")):D("",!0)],64)):D("",!0)]),M(u)&&N.value?(f(),p("div",Si,[(f(),p(Q,null,le(["select","paint","erase","token"],h=>c("button",{key:h,type:"button",class:ae(["w-9 h-9 rounded-lg border flex items-center justify-center text-sm transition",M(g)===h?"bg-sky-500/30 border-sky-400/60 text-sky-100":"border-white/10 hover:bg-white/5 text-slate-300"]),title:h==="select"?"Выбор":h==="paint"?"Рисовать":h==="erase"?"Стереть":"Токены",onClick:F=>M(o).setEditorMode(h)},B(h==="select"?"👆":h==="paint"?"🖌️":h==="erase"?"🧹":"👤"),11,Pi)),64)),M(g)==="token"?(f(),p(Q,{key:0},[a[27]||(a[27]=c("div",{class:"w-px h-6 bg-white/10 mx-1"},null,-1)),c("div",$i,[a[26]||(a[26]=c("span",{class:"text-xs text-slate-400 mr-1"},"Персонажи:",-1)),(f(!0),p(Q,null,le(M(X),h=>{var F,H;return f(),p("button",{key:h.id,type:"button",class:ae(["px-2 py-1 rounded text-xs border border-white/10 hover:bg-white/10 transition truncate max-w-24",M(o).findTokenPosition((F=M(r))==null?void 0:F.id,h.id)?"bg-emerald-500/20 border-emerald-400/40":""]),title:h.name+(M(o).findTokenPosition((H=M(r))==null?void 0:H.id,h.id)?" (на карте)":" - клик для размещения"),onClick:V=>cs(h.id)},B(h.name),11,Ei)}),128)),M(X).length?D("",!0):(f(),p("span",Mi,"Нет персонажей"))])],64)):D("",!0),M(g)==="select"?(f(),p(Q,{key:1},[a[32]||(a[32]=c("div",{class:"w-px h-6 bg-white/10 mx-1"},null,-1)),c("div",Ai,[c("button",{type:"button",class:"flex items-center gap-1 px-2 py-1.5 rounded-lg border border-white/10 hover:bg-white/5 transition text-xs",onClick:a[3]||(a[3]=Me(h=>{he.value=!he.value,L.value=!1,fe.value=!1},["stop"]))},[c("span",null,B(Yt[M(O).shape]),1),a[28]||(a[28]=c("span",{class:"text-slate-400"},"▼",-1))]),he.value?(f(),p("div",{key:0,class:"absolute top-full left-0 mt-1 w-56 bg-slate-800 border border-white/10 rounded-lg shadow-xl z-50 p-3",onClick:a[5]||(a[5]=Me(()=>{},["stop"]))},[c("div",Ii,[a[29]||(a[29]=c("p",{class:"text-xs text-slate-400 mb-1.5"},"Форма",-1)),c("div",Di,[(f(!0),p(Q,null,le(Object.values(M(ge)),h=>(f(),p("button",{key:h,type:"button",class:ae(["flex-1 py-1.5 rounded border text-sm transition",M(O).shape===h?"bg-sky-500/20 border-sky-400/60":"border-white/10 hover:bg-white/5"]),title:fs[h],onClick:F=>M(o).setSelectionShape(h)},B(Yt[h]),11,Ri))),128))])]),c("div",Li,[a[30]||(a[30]=c("p",{class:"text-xs text-slate-400 mb-1.5"},"Режим",-1)),c("div",Fi,[(f(!0),p(Q,null,le(Object.values(M(Ce)),h=>(f(),p("button",{key:h,type:"button",class:ae(["flex-1 py-1.5 rounded border text-xs transition",M(O).mode===h?"bg-sky-500/20 border-sky-400/60":"border-white/10 hover:bg-white/5"]),title:hs[h],onClick:F=>M(o).setSelectionMode(h)},B(ps[h]),11,Ni))),128))])]),c("div",Oi,[a[31]||(a[31]=c("p",{class:"text-xs text-slate-400 mb-1.5"},"Поведение",-1)),c("div",zi,[(f(!0),p(Q,null,le(Object.values(M(je)),h=>(f(),p("button",{key:h,type:"button",class:ae(["flex-1 py-1 rounded border text-[10px] transition",M(O).behavior===h?"bg-sky-500/20 border-sky-400/60":"border-white/10 hover:bg-white/5"]),title:Xt[h],onClick:F=>M(o).setSelectionBehavior(h)},B(ms[h]),11,Bi))),128))]),c("p",ji,B(Xt[M(O).behavior]),1)]),M(O).shape===M(ge).LINE?(f(),p("div",Hi,[c("p",Wi,"Ширина линии: "+B(M(O).lineWidth),1),c("input",{type:"range",min:"1",max:"5",value:M(O).lineWidth,class:"w-full",onInput:a[4]||(a[4]=h=>M(o).setSelectionLineWidth(Number(h.target.value)))},null,40,Ui)])):D("",!0)])):D("",!0)]),pe.value.size>0?(f(),p(Q,{key:0},[c("span",qi,B(pe.value.size)+" выбрано",1),c("button",{type:"button",class:"px-2 py-1.5 rounded-lg border border-emerald-400/60 bg-emerald-500/20 text-emerald-100 text-xs hover:bg-emerald-500/30 transition",title:"Заполнить выбранным террейном",onClick:Gn}," 🎨 Залить "),c("button",{type:"button",class:"px-2 py-1.5 rounded-lg border border-amber-400/60 bg-amber-500/20 text-amber-100 text-xs hover:bg-amber-500/30 transition",title:"Рандомная заливка по профилю",onClick:a[6]||(a[6]=h=>{b.value=!b.value,L.value=!1,he.value=!1})}," 🎲 Рандом "),c("button",{type:"button",class:"px-2 py-1.5 rounded-lg border border-rose-400/60 bg-rose-500/20 text-rose-100 text-xs hover:bg-rose-500/30 transition",title:"Удалить выбранные гексы",onClick:Qn}," 🗑️ "),c("button",{type:"button",class:"px-2 py-1.5 rounded-lg border border-white/10 text-slate-300 text-xs hover:bg-white/5 transition",title:"Снять выделение",onClick:Ht}," ✕ ")],64)):D("",!0)],64)):D("",!0),a[39]||(a[39]=c("div",{class:"w-px h-6 bg-white/10 mx-1"},null,-1)),c("div",Yi,[c("button",{type:"button",class:"flex items-center gap-2 px-2 py-1.5 rounded-lg border border-white/10 hover:bg-white/5 transition text-sm",onClick:a[7]||(a[7]=Me(h=>{L.value=!L.value,fe.value=!1,he.value=!1},["stop"]))},[c("span",{class:"w-5 h-5 rounded",style:Pe({backgroundColor:gt.value.fallbackColor||gt.value.color||"#888"})},null,4),c("span",Xi,B(gt.value.name||M(x)),1)]),L.value?(f(),p("div",{key:0,class:"absolute top-full left-0 mt-1 w-80 bg-slate-800 border border-white/10 rounded-lg shadow-xl z-50 overflow-hidden",onClick:a[14]||(a[14]=Me(()=>{},["stop"]))},[c("div",Vi,[c("div",Gi,[De(c("input",{"onUpdate:modelValue":a[8]||(a[8]=h=>ie.value=h),type:"text",placeholder:"Поиск террейна...",class:"flex-1 px-2 py-1 text-xs bg-slate-900/50 border border-white/10 rounded focus:outline-none focus:border-sky-400/50"},null,512),[[Ye,ie.value]]),c("button",{type:"button",class:ae(["p-1 rounded hover:bg-white/10 transition text-xs",Fe.value?"bg-sky-500/20 text-sky-400":"text-slate-400"]),onClick:a[9]||(a[9]=h=>Fe.value=!Fe.value),title:"Показать фильтры"}," ⚙ ",2)]),Fe.value?(f(),p("div",Qi,[c("div",Ki,[a[34]||(a[34]=c("span",{class:"text-xs text-slate-400 w-16"},"Биом:",-1)),De(c("select",{"onUpdate:modelValue":a[10]||(a[10]=h=>me.value=h),class:"flex-1 px-2 py-1 text-xs bg-slate-900/50 border border-white/10 rounded focus:outline-none"},[a[33]||(a[33]=c("option",{value:null},"Все биомы",-1)),(f(!0),p(Q,null,le(M(l).biomes,h=>(f(),p("option",{key:h.id,value:h.id},B(h.name),9,Zi))),128))],512),[[yt,me.value]])]),c("div",Ji,[a[36]||(a[36]=c("span",{class:"text-xs text-slate-400 w-16"},"Обзор:",-1)),De(c("select",{"onUpdate:modelValue":a[11]||(a[11]=h=>Te.value=h),class:"flex-1 px-2 py-1 text-xs bg-slate-900/50 border border-white/10 rounded focus:outline-none"},[a[35]||(a[35]=c("option",{value:null},"Любой",-1)),(f(!0),p(Q,null,le(M(l).visibilityTypes,h=>(f(),p("option",{key:h.id,value:h.id},B(h.name),9,er))),128))],512),[[yt,Te.value]])]),c("div",tr,[a[37]||(a[37]=c("span",{class:"text-xs text-slate-400 w-16"},"Проход:",-1)),De(c("input",{"onUpdate:modelValue":a[12]||(a[12]=h=>xe.value.max=h),type:"range",min:"1",max:"5",step:"1",class:"flex-1"},null,512),[[Ye,xe.value.max,void 0,{number:!0}]]),c("span",nr,"≤"+B(xe.value.max),1)]),c("button",{type:"button",class:"w-full px-2 py-1 text-xs bg-slate-700/50 hover:bg-slate-700 rounded transition",onClick:a[13]||(a[13]=h=>{me.value=null,Te.value=null,xe.value={min:1,max:5},ie.value=""})}," Сбросить фильтры ")])):D("",!0)]),c("div",sr,[Ft.value.length>0?(f(),p("div",or,[(f(!0),p(Q,null,le(Ft.value,h=>(f(),p("button",{key:h.id,type:"button",class:ae(["w-12 h-12 rounded border border-white/10 hover:border-white/30 transition relative group",M(x)===h.id?"ring-2 ring-sky-400":""]),style:Pe({backgroundColor:h.color||h.fallbackColor||"#888"}),title:`${h.name}
Проход: ${h.movementCost??1}
Ближ. бой: ${(h.meleeAdvantage??0)>0?"+":""}${h.meleeAdvantage??0}`,onClick:F=>Ut(h.id)},[c("div",lr,[h.movementCost>=5?(f(),p("span",ir,"🚫")):h.movementCost>2?(f(),p("span",rr,"⚠")):D("",!0),h.visibility==="blocking"?(f(),p("span",cr,"🔲")):h.visibility==="partial"?(f(),p("span",ur,"🌿")):D("",!0),(h.meleeAdvantage??0)>0?(f(),p("span",dr,"+"+B(h.meleeAdvantage),1)):(h.meleeAdvantage??0)<0?(f(),p("span",fr,B(h.meleeAdvantage),1)):D("",!0)])],14,ar))),128))])):(f(),p("div",pr," Террейны не найдены ")),!ie.value&&!me.value&&!Te.value?(f(),p("div",hr,[a[38]||(a[38]=c("div",{class:"text-xs text-slate-500 mb-1"},"Базовые (совместимость):",-1)),c("div",mr,[(f(!0),p(Q,null,le(M(Ke),(h,F)=>(f(),p("button",{key:F,type:"button",class:ae(["w-12 h-12 rounded border border-white/10 hover:border-white/30 transition",M(x)===F?"ring-2 ring-sky-400":""]),style:Pe({backgroundColor:h.color}),title:h.name,onClick:H=>Ut(F)},null,14,vr))),128))])])):D("",!0)])])):D("",!0)])])):D("",!0),c("div",gr,[M(q)?(f(),p(Q,{key:0},[c("button",{type:"button",class:ae(["px-3 py-1.5 rounded-lg border text-xs transition",M(u)?"bg-emerald-500/20 border-emerald-400/60 text-emerald-100":"border-white/10 hover:bg-white/5 text-slate-300"]),onClick:ns},B(M(u)?"✓ Готово":"✏️ Редактировать"),3),M(r)?(f(),p("button",{key:0,type:"button",class:ae(["px-3 py-1.5 rounded-lg border text-xs transition",(E=M(r).visibility)!=null&&E.published?"bg-emerald-500/20 border-emerald-400/60 text-emerald-100":"border-white/10 hover:bg-white/5 text-slate-300"]),title:(j=M(r).visibility)!=null&&j.published?"Карта видна игрокам":"Карта скрыта",onClick:ss},B((J=M(r).visibility)!=null&&J.published?"👁 Видима":"🙈 Скрыта"),11,br)):D("",!0)],64)):D("",!0),c("button",{type:"button",class:"w-9 h-9 rounded-lg border border-white/10 hover:bg-white/5 flex items-center justify-center text-sm",title:"Центрировать (0,0)",onClick:a[15]||(a[15]=h=>{rt(),Ee()})}," 🎯 ")])])):D("",!0),c("div",yr,[c("div",{ref_key:"canvasContainer",ref:A,class:"flex-1 overflow-hidden relative bg-slate-900/40 z-0"},[c("canvas",{ref_key:"terrainCanvas",ref:T,class:"absolute top-0 left-0",width:U.value.width,height:U.value.height},null,8,xr),c("canvas",{ref_key:"gridCanvas",ref:I,class:"absolute top-0 left-0",width:U.value.width,height:U.value.height},null,8,kr),c("canvas",{ref_key:"uiCanvas",ref:z,class:ae(["absolute top-0 left-0",K.value?"cursor-grabbing":M(u)?"cursor-crosshair":"cursor-grab"]),width:U.value.width,height:U.value.height,onMousemove:Hn,onMousedown:Wn,onMouseup:Un,onMouseleave:qn,onWheel:Yn,onTouchstart:Kn,onTouchmove:Zn,onTouchend:Jn,onContextmenu:a[16]||(a[16]=Me(()=>{},["prevent"]))},null,42,wr),C.value&&(!e.mobileMode||M(q))?(f(),p("div",Tr," q: "+B(C.value.q)+", r: "+B(C.value.r),1)):D("",!0),!e.mobileMode||M(q)?(f(),p("div",Cr,B(Math.round(M(y).zoom*100))+"% ",1)):D("",!0)],512),b.value?(f(),ws(ui,{key:0,class:"flex-shrink-0 border-l border-white/10",onClose:a[17]||(a[17]=h=>{b.value=!1,is()}),onPreview:as,onApply:ls})):D("",!0)]),!e.mobileMode||M(q)?(f(),p("footer",_r,[c("div",Sr,[c("p",Pr,[M(u)?(f(),p(Q,{key:0},[Gt(" Рисуйте кликом/перетаскиванием • Shift+drag для навигации • Колёсико для зума • 🎯 центр (0,0) ")],64)):(f(),p(Q,{key:1},[Gt(B(M(q)?'Нажмите "Редактировать" для изменения карты':"Shift+перетаскивание для навигации"),1)],64))]),c("div",$r,[M(q)&&M(r)?(f(),p("button",{key:0,type:"button",class:"px-2 py-1 rounded text-xs text-rose-400 hover:bg-rose-500/10 transition",onClick:os}," 🗑️ Удалить ")):D("",!0)])])])):D("",!0),G.value?(f(),p("div",{key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:a[24]||(a[24]=Me(h=>G.value=!1,["self"]))},[c("div",Er,[a[45]||(a[45]=c("h3",{class:"text-lg font-semibold mb-4"},"Создать карту",-1)),c("div",Mr,[c("div",null,[a[40]||(a[40]=c("label",{class:"block text-sm text-slate-400 mb-1"},"Название",-1)),De(c("input",{"onUpdate:modelValue":a[18]||(a[18]=h=>ke.value.name=h),type:"text",class:"w-full px-3 py-2 rounded-lg bg-slate-900 border border-white/10 text-sm",placeholder:"Новая карта"},null,512),[[Ye,ke.value.name]])]),c("div",null,[a[41]||(a[41]=c("label",{class:"block text-sm text-slate-400 mb-1"},"Ориентация гексов",-1)),c("div",Ar,[c("button",{type:"button",class:ae(["flex-1 py-2 rounded-lg border text-sm transition",ke.value.orientation==="flat"?"bg-sky-500/20 border-sky-400/60":"border-white/10 hover:bg-white/5"]),onClick:a[19]||(a[19]=h=>ke.value.orientation="flat")}," Flat-top ⬡ ",2),c("button",{type:"button",class:ae(["flex-1 py-2 rounded-lg border text-sm transition",ke.value.orientation==="pointy"?"bg-sky-500/20 border-sky-400/60":"border-white/10 hover:bg-white/5"]),onClick:a[20]||(a[20]=h=>ke.value.orientation="pointy")}," Pointy-top ⬢ ",2)])]),c("div",null,[a[42]||(a[42]=c("label",{class:"block text-sm text-slate-400 mb-1"},"Масштаб",-1)),De(c("select",{"onUpdate:modelValue":a[21]||(a[21]=h=>ke.value.scale=h),class:"w-full px-3 py-2 rounded-lg bg-slate-900 border border-white/10 text-sm"},[(f(),p(Q,null,le(qt,(h,F)=>c("option",{key:F,value:F},B(h),9,Ir)),64))],512),[[yt,ke.value.scale]])]),c("div",null,[a[43]||(a[43]=c("label",{class:"block text-sm text-slate-400 mb-1"},"Размер гекса (пиксели)",-1)),De(c("input",{"onUpdate:modelValue":a[22]||(a[22]=h=>ke.value.hexSize=h),type:"number",min:"16",max:"64",class:"w-full px-3 py-2 rounded-lg bg-slate-900 border border-white/10 text-sm"},null,512),[[Ye,ke.value.hexSize,void 0,{number:!0}]])]),a[44]||(a[44]=c("p",{class:"text-xs text-slate-500"}," Карта не имеет фиксированных границ — она расширяется по мере рисования. Центр карты находится в координатах (0, 0). ",-1))]),c("div",Dr,[c("button",{type:"button",class:"px-4 py-2 rounded-lg border border-white/10 hover:bg-white/5 text-sm",onClick:a[23]||(a[23]=h=>G.value=!1)}," Отмена "),c("button",{type:"button",class:"px-4 py-2 rounded-lg bg-sky-500 hover:bg-sky-600 text-sm font-medium",onClick:Wt}," Создать ")])])])):D("",!0)])}}};export{Ur as C,Wr as H,Hr as I,Rt as _,Uo as a,zr as b,Or as c,Ha as d,un as e,pt as f,jr as g,Ct as h,Tt as i,Dn as j,Rn as k,ol as l,Ln as m,Fn as n,qr as o,Bs as p,Nr as q,Br as r};
