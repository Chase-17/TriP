import{l as cs,r as J,m as Xe,n as j,c as t,d as s,e,f as k,g as c,i as g,F as N,p as K,q as ue,t as n,k as oe,x as G,y as Me,z as rs,w as ye,T as Ge,h as je,v as Je,o as ht,A as Wt,a as nt,B as ds,s as He,j as Vt,C as Xt,D as Mt,E as ze,G as us,u as fs,H as Dt}from"./index-COA-MOPX.js";import{u as Ke,a as ot,c as vs,b as ps,d as Rt}from"./fillProfile-HTbvdPM0.js";import{I as q,a as Pe,_ as Oe,i as Re,b as rt,p as vt,g as At,c as Et,r as ut,d as pt,e as Ze,f as Fe,C as It,H as Ht,h as ms,j as qt,l as hs,k as xs,m as bs,n as gs,o as Yt,q as zt}from"./BattleMap-CiTWGPPl.js";import{_ as ys}from"./UserAvatar-BUMe_K1c.js";const _s=cs("characterCreation",{state:()=>({step:1,formData:{name:"",portrait:null,gender:null,race:null,subrace:null,class:null,stats:{war:0,knowledge:0,community:0,shadow:0,mysticism:0,nature:0},skills:{fromClass:null,fromAspect1:null,fromAspect2:null},equipment:{armor:"clothes",weapons:[],wealth:5,epoch:10}}}),persist:{key:"trip-character-creation-v2",paths:["step","formData"]},getters:{isComplete:m=>m.step===7&&m.formData.gender&&m.formData.race&&m.formData.class},actions:{setStep(m){this.step=m},setName(m){this.formData.name=m},setPortrait(m){this.formData.portrait=m},setGender(m){this.formData.gender=m},setRace(m){this.formData.race=m},setSubrace(m){this.formData.subrace=m},setClass(m){this.formData.class=m},setStats(m){this.formData.stats={...this.formData.stats,...m}},setSkills(m){this.formData.skills=m},setEquipment(m){this.formData.equipment=m},reset(){this.step=1,this.formData={name:"",portrait:null,gender:null,race:null,subrace:null,class:null,stats:{war:0,knowledge:0,community:0,shadow:0,mysticism:0,nature:0},skills:{fromClass:null,fromAspect1:null,fromAspect2:null},equipment:{armor:"clothes",weapons:[],wealth:5,epoch:10}}}}}),ks=[{id:"scholar",name:{m:"Учёный",f:"Учёная"},nameEn:"Scholar",professions:[],aspects:["knowledge","nature"],traits:[{id:"knowNature",name:"Знание природы",levels:[{text:`:check:nature 1:easier
 Все проверки Поиска для Вас на одну категорию проще.`,effect:{}},{text:`2:check:nature в :turn
Вы можете выполнить две проверки Поиска вместо одной за каждый ход.`,effect:{}},{text:`2:check в :turn, :check:nature 2:easier
Вы можете выполнить любые две проверки одного типа вместо одной за каждый ход. Проверки Поиска проще на две категории`,effect:{}}]},{id:"knowEnemy",name:"Знание врага",levels:[{text:`:attack 1:easier если Вы ранили
Любые атаки по противникам, которых Вам уже удалось ранить - на одну категорию проще.`,effect:{}},{text:`:defence 1:easier если уже отражали
Если Вы успешно отбили удар противника, Ваша защита против него повышается на одну категорию, пока вы дееспособны`,effect:{}},{text:`:attack :defence 1:easier, если видели как ранят или защищаются от атак противника
Вам достаточно видеть как другие ранят противника или успешно отражают его удары, чтобы адаптироваться к ним и получить преимущества.`,effect:{}}]},{id:"constructor",name:"Конструктор",levels:[{text:"Вы получаете преимущество в две категории на создание предметов с помощью немагических ремёсел. В этот список входят самодельное оружие и доспехи, эликсиры и яды, особые боеприпасы, но не ловушки. Для создания Вам всё ещё нужен рецепт достаточного качества.",effect:{}},{text:"Вы можете подбирать рецепты самостоятельно, ориентируясь на найденные слухи и общеизвестную информацию. Для этого Вам нужно провести проверку Поиска или Влияния, если это уместно в данной ситуации",effect:{}},{text:"Вы можете сами создавать рецепты, изучая природные материалы. Проведя успешную проверку Поиска Вы можете узнать о свойствах того или иного материала и придумать ему применение. Проверка на первое создание предмета тем проще, чем более реалистичный у вас план. На усмотрение мастера",effect:{}}]}],edges:[{type:"aspect",id:"knowledge",cost:3},{type:"aspect",id:"nature",cost:3}]},{id:"mastermind",name:{m:"Комбинатор",f:"Комбинаторша"},nameEn:"Mastermind",professions:[],aspects:["shadow","community"],traits:[{id:"ambushMaster",name:"Засадный мастер",levels:[{text:"Вы можете подготовить хорошее место для засады, если потратите на это некоторое время. Противнику будет сложнее Вас обнаружить на две категории, а в случае успеха в первый ход все Ваши герои атакуют и защищаются на две категории эффективнее.",effect:{}},{text:"Если вы отражаете атаку, Вы можете пройти проверку Влияния (против разумных) или  Поиска (против зверей и монстров), чтобы симулировать тяжёлое ранение или даже смерть. Если Ваш обман не раскрыт, Вы можете получить преимущество в две категории на атаку, если наносите неожиданный удар в полную мощь.",effect:{}},{text:"Вы можете провести проверку Влияния (против разумных) или Поиска (против зверей и монстров), чтобы инициировать ложное отступление. Сложность её будет тем больше, чем меньше у Вас понятных врагу причин для отступления, на усмотрение мастера. В случае успеха Вы должны отходить назад один ход, увлекая противника за собой, а затем обрушиться на него снова, получая преимущества как от засады.",effect:{}}]},{id:"criminalSchemes",name:"Преступные схемы",levels:[{text:"Потратив не менее месяца на подготовку, Вы можете организовать серьёзное преступление в поселении. Это может быть кража, похищение или убийство влиятельного лица. Сложность проверки определяет мастер исходя из степени реалистичности Вашего плана. Вы можете отказаться от реализации плана, когда мастер объявил сложность. Выполнить задуманное нелегко, ещё сложнее - не попасться после.  Вероятность того, что кто-то выйдет на Ваш след, зависит от превышения проверки.",effect:{}},{text:"Потратив не менее месяца на подготовку, Вы можете инициировать войну между разными фракциями в пределах одного поселения. Потратив не менее трёх месяцев - глобальную вражду между глобальными фракциями, не менее шести - войну. Формат войны или вражды может быть разным, в зависимости от сути фракций, например, купеческие гильдии будут враждовать совсем не так, как гильдии воров. Ваши преступные планы на две категории эффективнее, если затрагивают интересы воюющих.",effect:{}},{text:"Проведя полгода в поселении, вы можете подчинить себе все его преступные организации, при этом оставаясь в тени. Они не знают Вас в лицо и не будут подчиняться напрямую, но дёргая за правильные ниточки Вы можете заставлять их делать то, что нужно Вам. Все проверки Влияния удаются Вам проще на три категории, а уровень Вашего влияния на эти организации не может опускаться ниже Крепкой Дружбы",effect:{}}]},{id:"noDistinctiveFeatures",name:"Без особых примет",levels:[{text:"Вы умеете затеряться в толпе, знаете толк в маскировке в поселениях разумных. Искать Вас сложнее на две категории, если Вы только не хотите быть найденным. Иначе - на две категории проще.",effect:{}},{text:"Ваше умение скрываться с глаз оказывается полезным и на поле боя. Вы умеете быть неприметным и не угрожающим. Если противник собирается атаковать Вас, когда имеет возможность бить по Вашему союзнику, Вы можете пройти проверку Влияния, чтобы переключить его внимание. На это не требуется никаких действий, Вы можете сделать это сколько угодно раз за ход, но каждая следующая проверка будет сложнее.",effect:{}},{text:"Если Вам удаётся переключить внимание противника на своего союзника - вы можете нанести неожиданную атаку по нему в самый неподходящий момент. Такая атака стоит один порыв, и может быть усилена, но выполняется только один раз за ход.",effect:{}}]}],edges:[{type:"aspect",id:"shadow",cost:2},{type:"aspect",id:"community",cost:4}]},{id:"weaponmaster",name:{m:"Оружейник",f:"Оружейница"},nameEn:"Weaponmaster",professions:[],aspects:["war","knowledge"],traits:[{id:"steelShines",name:"И сталь блестит",levels:[{text:"Вы знаете толк в боевом снаряжении и со всей скурпулёзностью подходите к его выбору. Ваша броня или один из наборов вооружения качественнее на целую категорию.",effect:{}},{text:"Прежде чем стать популярным, более эффективное оружие появляется на рынке в малом количестве. Используя свои связи (не менее 4 уровня) и деньги (не менее 7 уровня), Вы можете найти такие редкие образцы и пополнить свою коллекцию. Теперь более высоким качеством могут отличаться два набора вооружения, или один набор и броня.",effect:{}},{text:"Если вы привыкаете к оружию не менее месяца, необходимое превышение защиты за каждый вид травмы сокращается на единицу (мин 1). Кроме того, Вы можете использовать особые удары экзотического оружия без штрафов. Одновременно вы можете таким образом привыкнуть только к трём наборам снаряжения. ",effect:{}}]},{id:"mySword",name:"Таких мечей много, но этот - мой",levels:[{text:"Если Вы организуете что-то, связанное с оружием или вооружёнными людьми, Ваши проверки Порядка легче на две категории (6). Нанимать и вооружать отряд наёмников для Вас дешевле на одну категорию.",effect:{}},{text:"Вооружённые с Вашей помощью отряды защищаются и атакуют эффективнее на одну категорию.",effect:{}},{text:"Если Ваши товарищи по команде прислушиваются к Вашим советам, каждый может сделать один набор оружия или свою броню более эффективными (на одну категорию). На этом уровне Вы также получаете такое преимущество.",effect:{}}]},{id:"worthMoreThanGold",name:"Дороже золота",levels:[{text:"Оружие даёт силу, а сила - власть. Попадая в новые сообщества Вы сразу получаете как минимум Небольшое Влияние на воинское и дворянское сословие, если готовы демонстрировать своё превосходное снаряжение.",effect:{}},{text:"Внешний вид Вашего снаряжения заставляет нанимателей задуматься о цене за Ваши услуги. Если Вашему заказчику это по карману, он предложит на одну категорию более высокую оплату. Если нет - он и вовсе не станет предлагать Вам работу.",effect:{}},{text:"Раз в три месяца Вы можете купить действительно очень редкое оружие, совершив покупку не менее чем 7 уровня богатства. Такую редкость с удовольствием купят любые коллекционеры, вполне вероятно - даже короли и императоры.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:2},{type:"aspect",id:"knowledge",cost:4}]},{id:"tactician",name:{m:"Тактик",f:"Тактичка"},nameEn:"Tactician",professions:[],aspects:["war","knowledge"],traits:[{id:"holdOn",name:"Держись!",levels:[{text:"За один ход Вы можете помочь союзнику советом два раза, а не один. Кроме того, Ваши советы могут увеличить не только защиту, но и нападение. Ваши советы должны быть реалистичны, иначе мастер может решить, что они не принесут пользу.",effect:{}},{text:"Стоящие плечом к плечу с Вами товарищи атакуют и защищаются на одну категорию эффективнее, но это преимущество не складывается с эффектом от вербальной помощи.",effect:{}},{text:"Вы можете помочь союзнику трижды за один ход, эффект суммируется с преимуществом от второго уровня этого умения.",effect:{}}]},{id:"officerCourses",name:"Офицерские курсы",levels:[{text:"Вы можете невзначай демонстрировать свои познания в тактике в разговоре, если хотите этого. Все Ваши проверки Влияния на невраждебных разумных-воинов эффективнее на две категории.",effect:{}},{text:"Вам проще находить грамотных командиров, все нанятые Вами воины атакуют и защищаются эффективнее на одну категорию.",effect:{}},{text:"Ваша слава идёт впереди Вас, больше хороших бойцов хотят служить под Вашим началом, меньше дураков готовы на Вас напасть. Проверки Влияния на поиск бойцов легче на две категории, проверки организации диверсий и нападений на Вас на две категории сложнее",effect:{}}]},{id:"artOfWar",name:"Искусство войны",levels:[{text:"Война требует денег, денег и ещё раз денег. А ещё, бизнес здорово похож на войну. Ваши проверки Порядка и Диверсии на одну категории проще, если они касаются организации прибыльной компании или борьбы с конкурентами.",effect:{}},{text:"Какой бы важной не была тактика, она не может обойтись без стратегии. Проверки Поиска и Влияния на одну категорию проще, если касаются исследования рынков или стратегических позиций противника.",effect:{}},{text:"Проверки Порядка, Диверсии, Поиска и Влияния первых двух уровней умения становятся проще не на одну, а на три категории.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:4},{type:"aspect",id:"knowledge",cost:2}]},{id:"monk",name:{m:"Монах",f:"Монахиня"},nameEn:"Monk",professions:[],aspects:["war","mysticism"],traits:[{id:"martialArts",name:"Боевые искусства",levels:[{text:"Ваша скорость передвижения увеличивается на 2, а рукопашные атаки без оружия становятся эффективнее на одну категорию. Кроме того, Ваша защита в ближнем бою повышается на одну категорию, а в дальнем - на две. Эти бонусы работают только в том случае, если Вы носите броню не тяжелее лёгкой. ",effect:{}},{text:"Вы больше не получаете штрафов к защите сбоку. Ваши сокрушительные удары без оружия - всегда точные. ",effect:{}},{text:"Бой для вас - особая форма транса, вы умудряетесь замечать всё происходящее вокруг. Вы больше не получаете штрафов к защите сзади, а также можете реагировать на происходящее за своей спиной. Ваши безоружные атаки становятся эффективнее ещё на одну категорию, а ваши тяжёлые удары оружием ближнего боя становятся всегда точными.",effect:{}}]},{id:"bastionOfSpirit",name:"Бастион духа",levels:[{text:"Боевые искусства - не просто способ убрать врага со своей дороги. Для Вас - это способ обратиться к себе, познать мир через себя, а себя - через мир вокруг. Вы должны проводить не менее 10 часов в неделю в изнуряющих тренировках, но в результате Вы чувствуете происходящее вокруг невероятно тонко. Любые проверки Диверсии на две категории проще, если Вы участвуете в них лично.",effect:{}},{text:"Вы должны тратить на тренировки не менее 20 часов в неделю, но Ваша потребность в сне значительно сократилась. Теперь Вы высыпаетесь всего за 6 часов в сутки. Проверки Порядка проще на одну категорию, если Вы участвуете в них лично.",effect:{}},{text:"Ваше тело - всего лишь продолжение Вашей несгибаемой воли. Вам больше не нужно спать, но Вы должны проводить не меньше 4х часов в сутки в медитациях, поддерживающих Ваш дух. Пока Вам удаётся выполнять это условие, Вам нужно вдвое меньше припасов для выживания, Ваши раны кровоточат вдвое меньше, а ранить Ваше тело значительно сложнее. Ваш класс брони увеличивается на 1.",effect:{}}]},{id:"innerCalm",name:"Внутреннее спокойствие",levels:[{text:"Вам одинаково просто выживать в дикой природе, в суетливом городе или горном додзё. Однако внешний мир Вам не особенно интересен. Ваш уровень знания немагической местности не может быть ниже 4х, но выше этого значения растёт вдвое медленнее обычного.",effect:{}},{text:"Ваш путь боевых искусств провёл Вас через множество стран и регионов - Ваши проверки Влияния на впервые встреченных незнакомцев на две категории легче.",effect:{}},{text:"Ваше паранормальное предчувствие опасности позволяет точно знать, когда Вас держат на прицеле, а иногда и заранее знать, что кто-то замыслил недоброе. Это предчувствие иногда может давать ложноположительный результат.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:3},{type:"aspect",id:"mysticism",cost:3}]},{id:"commander",name:{m:"Командир",f:"Командирша"},nameEn:"Commander",professions:[],aspects:["war","community"],traits:[{id:"followMe",name:"За мной!",levels:[{text:"Перед боем командир может повысить мораль союзных бойцов ниже или равных по рангу на 3 единицы, если успешно пройдёт проверку Влияния или на 1, если провалит её.",effect:{}},{text:"Вербальная команда командира во время боя поднимает мораль бойца на единицу, а так же позволяет один ход игнорировать негативные последствия тяжёлой травмы.",effect:{}},{text:"Потратив основное действие во время боя, командир может повысить мораль всех способных его слышать бойцов на 2 единицы, снизить мораль всех разумных бойцов противника на 2 единицы. ",effect:{}}]},{id:"allInOrder",name:"Всё по порядку",levels:[{text:"Составить хороший план - половина успеха. Ваши проверки Порядка на одну категорию легче.",effect:{}},{text:"Мало составить план - нужно ещё и ему следовать. Ваши проверки Порядка на две категории проще, если Вы выполняете работу самостоятельно или с проверенными исполнителями, с которыми Вам уже доводилось работать раньше.",effect:{}},{text:"Вы умеете составлять чёткие исчерпывающие инструкции, такие, чтобы по ним выполнить работу смогла и обезьяна. Ваши проверки Порядка легче на две категории, если исполнителями на месте руководит выбранный Вами смышлёный человек. Этот бонус работает и если вы руководите лично.",effect:{}}]},{id:"togetherStronger",name:"Вместе сильнее",levels:[{text:"Если несколько персонажей думают над решением одной проблемы и готовы доверить Вам руководство, Вы можете сделать так, чтобы проверку проходил персонаж с самой высокой характеристикой, а бонусы учитывались от персонажа с самыми высокими бонусами.",effect:{}},{text:"Если это проверка Войны, Порядка или Влияния, Вы так же можете облегчить её ещё на одну категорию.",effect:{}},{text:"Для любых проверок Вы можете сложить все бонусы всех участников, однако полученное преимущество не должно быть больше чем в два раза большим, чем самый большой бонус.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:3},{type:"aspect",id:"community",cost:3}]},{id:"ranger",name:{m:"Следопыт",f:"Следопытка"},nameEn:"Ranger",professions:[],aspects:["war","nature"],traits:[{id:"bloodyTrail",name:"По кровавому следу",levels:[{text:"Вы не уличный задира, Вы - профессиональный убийца. Вы выслеживаете свою цель и наносите удар издалека. Проверки Поиска на категорию легче, если вы ищете живое существо. Первый удар по не подозревающей о Вас цели эффективнее дополнительно на две категории, но это не должен быть удар с соседней клетки.",effect:{}},{text:"Ваши атаки по не подозревающему о Вашем присутствии противнику - всегда считаются точными, если Вы успели изучить его по следам или наблюдая в течении хотя бы одной минуты.",effect:{}},{text:"Ваши дальние атаки (даже через одну клетку) эффективнее на одну категорию даже по обнаружившим Вас противникам, если Вы успели изучить их по следам. Ваша защита в ближнем и дальнем бою против них так же выше на категорию.",effect:{}}]},{id:"likeHome",name:"Как у себя дома",levels:[{text:"Если Ваше знание местности хотя бы 5, обнаружить Вас сложнее на одну категорию.",effect:{}},{text:"Если Ваше знание местности хотя бы 5, обнаружить весь Ваш отряд сложнее на одну категорию. Это касается как попыток спрятаться в засаде, так и передвижения по глобальной карте.",effect:{}},{text:"Ваше мастерство скрытности достигло своего апогея. Если Вы знаете местность хотя бы до уровня 3, Вы можете скрыть себя с дополнительной сложностью в три категории, или весь отряд - со сложностью в две. Кроме того, Ваш первый удар по не подозревающему о Вашем присутствии врагу получает дополнительный бонус в одну категорию",effect:{}}]},{id:"secretPaths",name:"Тайные тропы",levels:[{text:"Вы знаете, как выбирать дорогу, чтобы меньше уставать и больше успевать. Ваша скорость передвижения по глобальной карте увеличена на два. Вы значительно эффективнее обнаруживаете другие отряды неподалёку, на две категории. ",effect:{}},{text:"С Вашей помощью весь отряд может двигаться по глобальной карте быстрее на единицу. Если Вы прокладываете маршрут движения какого-нибудь отряда, он оказывается на одну категорию безопаснее.",effect:{}},{text:"Ваши проверки Диверсии против отрядов, движущихся по дикой местности, эффективнее на две категории. Маршруты, проложенные Вами на две категории безопаснее.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:2},{type:"aspect",id:"nature",cost:4}]},{id:"hunter",name:{m:"Охотник",f:"Охотница"},nameEn:"Hunter",professions:[],aspects:["war","nature"],traits:[{id:"catchTheHunter",name:"На ловца",levels:[{text:"Вопреки расхожему мифу, рыцарь в латах и на коне не сумеет одолеть дракона. А вот хорошо подготовленный охотник - сможет. Вы очень хороши в бою против зверей и монстров из крови и плоти - атака и защита эффективнее на одну категорию.",effect:{}},{text:"Кое-что из Ваших навыков прекрасно работает и на разумных. Ваши ловушки на одну категорию эффективнее, а кровотечение спровоцированное Вашими атаками, вдвое тяжелее.",effect:{}},{text:"В бою против зверей и монстров, с которыми Вы уже сталкивались раньше, Ваша атака и защита эффективнее на две категории.",effect:{}}]},{id:"battleTrophies",name:"Боевые трофеи",levels:[{text:"Если Ваш уровень знания местности хотя бы 4, Вы можете собирать одну меру немагических полезных ингредиентов из тел живущих в ней животных в месяц. Для этого Вам нужно найти подходящее место и остановиться в нём. Вы также можете извлекать обычные ингредиенты из поверженных в бою монстров",effect:{}},{text:"Вы можете собирать редкие ингредиенты, тратя на это всё своё время или обычные - прямо на ходу. Из побеждённых в бою Вы можете извлекать обычные или редкие ингредиенты",effect:{}},{text:"Вы можете собирать даже магические материалы из монстров, которых победили в бою или на которых охотились.",effect:{}}]},{id:"startYearAgo",name:"Начинаем год назад",levels:[{text:"Хорошая подготовка - ключ к успешной охоте. Имея большой опыт в вещах такого рода, Вы можете неплохо организовывать и другие дела. Проверки Порядка проще на одну категорию, если они хоть как-то связаны с пребыванием в дикой местности.",effect:{}},{text:"Что будет, если Ваши конкуретны забудут палатку? Проверки Диверсии так же проще на одну категорию, если связаны с пребыванием Вашей цели в дикой местности.",effect:{}},{text:"Ваше снаряжениие подобрано так хорошо, что Вы можете использовать его исключительно быстро. Полным действием в бою Вы можете подготовить ловушку, это может быть заранее подготовленный капкан на медведя или некая импровизация на месте. В случае импровизации, вы будете проходить проверку Порядка, сложность которой зависит от реалистичности Вашей задумки.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:4},{type:"aspect",id:"nature",cost:2}]},{id:"druid",name:{m:"Друид",f:"Друидка"},nameEn:"Druid",professions:[],aspects:["nature","mysticism"],traits:[{id:"oneAmongBeasts",name:"Свой среди зверей",levels:[{text:"Вы умеете вести себя так, чтобы не провоцировать диких животных. Они нападут на Вас только по исключительной причине, например, умирая от голода или защищая своё потомство. Проверки Поиска связанные со зверьми для вас на одну категорию проще.",effect:{}},{text:"Звери рассматривают Вас как доброго приятеля. Драться на Вашей стороне они, конечно, не станут, но могут предупредить о приближающейся опасности. Ваш отряд на одну категорию сложнее обнаружить, а Вы обнаруживаете другие на одну проще",effect:{}},{text:"Вы учитесь гораздо лучше понимать, что пытаются Вам сказать наши братья меньшие. Ваши проверки Поиска в местности, где есть звери на две категории эффективнее. Сообщения от зверей мастер теперь передаёт Вам как короткие предложения из двух-трёх простых слов.",effect:{}}]},{id:"forestSpirits",name:"Духи леса",levels:[{text:"Ежедневно жертвуя духам местности, в которой Вы находитесь, нечто ценное (обычно подходят съестные припасы) за одну неделю Вы можете наладить с ними контакт. Если духи благоволят Вам, один раз за боевую сцену (или один раз в месяц вне боя), Вы можете пройти проверку автоматически, если это возможно хотя бы при каком-то значении на кубике.",effect:{}},{text:"Регулярно жертвуя духам местности нечто ценное (отлично подойдут ценные материалы) Вы можете расположить их к себе ещё больше. Проверка, которую Вы видите, может получить максимум или минимум на кубиках по Вашему желанию. Это умение можно применить один раз за бой или раз в месяц в небоевых сценах.",effect:{}},{text:"Регулярно жертвуя духам местности магические ингредиенты или артефакты (не менее месяца), Вы достигаете максимального расположения с их стороны. Они могут самостоятельно помогать Вам как посчитают нужным, будь это подсказки или помощь в бою.",effect:{}}]},{id:"likeAFish",name:"Как рыба в воде",levels:[{text:"Вы чувствуете присутствие крупных зверей на расстоянии в сотню метров. Ваши проверки Поиска в отношении зверей проще на три категории.",effect:{}},{text:"Монстры - совершенно чуждые природе существа. Земля стонет и плачет там, где они ходят по ней. Вы слышите этот плач издалека, за несколько километров определяя направление до ближайшего монстра. Проверки Поиска в отношении монстров на две категории проще.",effect:{}},{text:"Магия вплетена в природу, но всё же выделяется на фоне всего остального ярким пятном. Вы чувствуете магические артефакты и ингредиенты, находящиеся в дикой природе за несколько километров. Поиск таких предметов проще на три категории, но имейте ввиду - духи местности могут разозлиться на Вас, если Вы заберёте что-то ценное.",effect:{}}]}],edges:[{type:"aspect",id:"nature",cost:2},{type:"aspect",id:"mysticism",cost:4}]},{id:"outlaw",name:{m:"Беглец",f:"Беглянка"},nameEn:"Outlaw",professions:[],aspects:["shadow","nature"],traits:[{id:"shepherdOfBlackSheep",name:"Пастух паршивых овец",levels:[{text:"В любом обществе есть те, кто промышляет тёмными делишками. Вы легко определяете таких, сложность проверки ниже на две категории.",effect:{}},{text:"Вы можете не только успешно определять криминальные элементы, но ещё и ловить их на горячем. Чтобы затем шантажировать. Ваши проверки Влияния на них на две категории эффективнее.",effect:{}},{text:"Вы безошибочно определяете тёмных дельцов, воров, взяточников в любом обществе, проведя с ними в разговоре хотя бы несколько минут. Размеры взяток для Вас снижены на две категории. Пройдя дополнительную проверку, Вы можете разгадать схему, в которой кто-то замешан.",effect:{}}]},{id:"constantlyLookingBack",name:"Постоянно оглядываясь",levels:[{text:"Вы так долго скрывались от властей, что теперь чувствуете себя гораздо лучше вне поселений. Скорость изучения местности удвоена вплоть до уровня 4, если это не магическая местность.",effect:{}},{text:"Уходить от погони - сильнейший из Ваших талантов. Если Вас преследуют, (в бою или на стратегической карте) Ваша скорость передвижения увеличивается на два.",effect:{}},{text:"Проведя в поселении хотя бы месяц, Вы узнаёте обо всех тайных ходах, не закрытых от простых людей или криминальных элементов. Если это поселение около границы другого государства, Вы также узнаёте как проникнуть туда незамеченным.",effect:{}}]},{id:"withoutStopping",name:"Не останавливаясь",levels:[{text:"Вы учитесь атаковать на бегу, не разворачиваясь. Для Вас возможны атаки вбок с штрафом эффективности в одну категорию.",effect:{}},{text:"От привычки не так легко избавиться. Если Ваши атаки наносят хотя бы лёгкую травму, они снижают скорость передвижения противника на одну клетку длительностью на два хода. Если только Вы явно не захотите обратного.",effect:{}},{text:"Вы можете атаковать назад не разворачиваясь со штрафом в одну категорию, или вбок - без штрафа. Кроме того, Ваша защита с тыла становится сильнее на одну категорию.",effect:{}}]}],edges:[{type:"aspect",id:"shadow",cost:3},{type:"aspect",id:"nature",cost:3}]},{id:"warlock",name:{m:"Колдун",f:"Колдунья"},nameEn:"Warlock",professions:[],aspects:["mysticism","shadow"],traits:[{id:"bloodMagic",name:"Магия крови",levels:[{text:"Вы получаете связь первого уровня с Концептом Жизнь, если ещё не имели её. Ваше особое умение - направлять магическую энергию по крови, которую Вы сумели получить от цели. Касты, направленные таким образом, слабее на два уровня, но не слабее Быстрого. Кровь, изьятая из организма, имеет связь с телом несколько часов.",effect:{}},{text:"Вы можете жертвовать собственную кровь для усиления магического эффекта - это наносит царапину при результате на кубике 10-12, лёгкую травму в иных случаях. Сила каста вырастает на один уровень.",effect:{}},{text:"Вы учитесь лучше чувствовать связь Крови, теперь магические эффекты, передаваемые через неё, слабее всего на один уровень, а если Вы прикладываете небольшие усилия, образец крови может оставаться связанным с целью сколь угодно долго. Одновременно Вы можете держать у себя не больше трёх таких образцов, но если не сумеете укрепить связь в какой-нибудь день, она будет разрушена.",effect:{}}]},{id:"myOtherHalf",name:"Половинка меня",levels:[{text:"Вам удаётся сделать невероятное - оторвать от своей души небольшой кусок, да ещё так, чтобы он не развалился при этом. Получилось нечто живое, отдельное от Вас и в то же время являющееся Вами. Вы вселили это в животное, получив, таким образом, фамильяра. Небольшой зверёк на Ваш выбор подчиняется Вашей воле, но главное - Вы можете направлять любые касты из той точки, где находится он. Помните, что любые энергии Порядка изгоняют духа, а чтобы вселить его в новое тело, Вам нужно потратить как минимум один день. В случае полного разрушения духовной сущности, Вы получаете травму уровня смертельного ранения и должны потратить не менее недели, чтобы повторить свой опыт.",effect:{}},{text:"Ваш дух-фамильяр становится значительно сильнее. Животное-носитель больше не является живым - скорее немёртвым. Остановить его физическим оружием можно, но убить - нельзя. Теперь Вы можете проводить энергии Порядка через фамильяра, но эффекты будут на один уровень слабее. Кроме того, теперь духа нельзя изгнать энергией порядка ниже уровнем, чем Средний каст. Вы можете общаться телепатически с фамильяром, когда он меньше чем в 1000 метров от Вас.",effect:{}},{text:"Дух становится всё сильнее, как и Ваша с ним связь. Вы можете общаться с ним телепатически на любом расстоянии (в пределах одного мира), а в пределах 1000 метров - ещё и ощущать мир его органами чувств. Вселение духа в животное больше не занимает у Вас много времени - достаточно нескольких минут. Любые энергии каста теперь передаются без потерь. В случае полного разрушения духовной сущности фамильяра, вы больше не получите урона.",effect:{}}]},{id:"deadWater",name:"Мёртвая вода",levels:[{text:"Вы учитесь заключать некоторые магические эффекты в специальных отварах. Потратив час времени и немного как минимум редких ингредиентов, Вы можете выполнить каст и при успехе, заключить его действие в магическом отваре. Энергия сохранится в нём ещё одни сутки, а затем развеется. Ваш отвар - всегда яд, производить что-то кроме яда Вы ещё не научились. Чтобы он подействовал в полной мере, цель должна его проглотить - а внесённый в кровь вместе с ударом оружия яд подействует на уровень слабее. Сила эффектов, которые может вместить Ваш отвар ограничена уровнем Малого каста.",effect:{}},{text:'Вы можете заключать более мощные магические эффекты в отварах, теперь они ограничены уровнем до Среднего каста. Кроме того, теперь Вы можете добавлять дополнительные эффекты, кроме урона, но они должны быть слабее основного, а сделать зелье с "умным" эффектом любого рода не получится - оно не привязано к разуму применяющего, потому всегда имеет нулевой контроль и нулевую самостоятельность.',effect:{}},{text:"Ваши зелья теперь могут вмещать эффект вплоть до уровня Большого каста, гораздо более долговечны - могут прожить до недели, а периодически подновляя магию в них, Вы можете держать их рабочими сколь угодно долго (до 9 зелий, 3 шт каждого из 3х типов).Теперь дополнительные эффекты могут оказываться сильнее вредоносного, но как минимум царапину Ваш яд всегда должен наносить.",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:2},{type:"aspect",id:"shadow",cost:4}]},{id:"specialist",name:{m:"Мастер",f:"Мастерица"},nameEn:"Specialist",professions:[],aspects:["community","knowledge"],traits:[{id:"fasterAndHigher",name:"Быстрее и выше",levels:[{text:"Вы копаете глубоко и не останавливаетесь на достигнутом. И это даёт свои плоды - в любом ремесле, распространённом в обществе, Вы преуспеваете больше других. Работая по любой профессии, не связанной с Мистикой, Вы можете заработать на один уровень богатства больше. Кроме того, все проверки Порядка для Вас на одну категорию проще.",effect:{}},{text:"Хороших профессионалов ценят. Ваши проверки Влияния на категорию проще, а искать специалистов в какой-то области - проще на две.",effect:{}},{text:"Занимаясь своим ремеслом, Вы можете заработать на две категории больше богатства больше, чем другие. Ваши проверки Влияния на две категории эффективнее, если Вы проработали по профессии в этом поселении хотя бы месяц.",effect:{}}]},{id:"allOnShelves",name:"Всё по полочкам",levels:[{text:"Вы бы не смогли достичь таких высот в своих ремёслах, если бы не анализировали и не систематизировали всё. Все проверки Порядка на одну категорию проще, если они связаны с освоенным Вами ремеслом - на две.",effect:{}},{text:"Вы можете осваивать новые профессии и ремёсла гораздо быстрее остальных - всего за месяц обучения Вы достигаете уровня среднего специалиста. Ремесло в таком случае считается усвоенным. Вам всё ещё не доступны профессии, связанные с мистикой.",effect:{}},{text:"Даже мистические профессии теперь доступны Вам, однако Вы должны потратить втрое больше времени, чтобы разобраться в них. Освоив совершенно новую для себя профессию, Вы получите одно очко развития.",effect:{}}]},{id:"almostChess",name:"Почти шахматы",levels:[{text:"Потратив основное действие в бою, Вы можете попробовать разгадать тактический замысел противника, если он есть. Это проверка Порядка или Диверсии, на Ваш выбор. Если проверка пройдена успешно, мастер раскрывает Вам суть задумки, а Вы и Ваши товарищи получают преимущество в атаке и защите в одну категорию на следующий раунд боя.",effect:{}},{text:"Проанализировав как минимум три взаимодействия с враждебными силами, Вы можете попробовать разгадать стратегический замысел противника. Это проверка Порядка или Диверсии на Ваш выбор, сложность тем больше, чем меньше Ваш персонаж узнал предварительно. В случае успеха Вы получаете преимущество в две категории на все проверки (кроме боя) в отношении этой фракции на месяц",effect:{}},{text:"Преимущество, которое Вы получаете от первых двух уровней этого умения, длится вдвое дольше. Кроме того, если Вы прошли изначальную проверку (Порядка или Диверсии), Вы можете предложить план, как помешать врагу и пройти другую (Диверсии для Порядка или наоборот), чтобы удвоить и силу Вашего преимущества. Сложность проверки выставляет мастер ориентируясь на реалистичность Вашего плана.",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:2},{type:"aspect",id:"knowledge",cost:4}]},{id:"skald",name:{m:"Скальд",f:"Скальдесса"},nameEn:"Skald",professions:[],aspects:["community","knowledge"],traits:[{id:"knowATale",name:"Знаю сказ, который начинался...",levels:[{text:"Ничто не ново в этом мире, и Вы, как хранитель легенд ушедших эпох, знаете это лучше других. В любой ситуации Вы можете попробовать пройти проверку Порядка, чтобы вспомнить, не было ли уже на свете подобной ситуации. Проверка тем сложнее, чем более необычный пример Вы пытаетесь вспомнить, но если она пройдена, Вы можете поделиться поучительной историей из прошлого с другими, облегчая следующую проверку (свою или чужую) на две категории. Вы можете упрощать подобным образом только проверки Конфликта, Порядка или Влияния.",effect:{}},{text:"Многие баллады сложены о героизме или о любви, но не стоит забывать и тёмные сказки, которые народ тоже исправно хранит в своей памяти. Теперь Вы можете усиливать этим умением и проверки Диверсии, Защиты и Поиска. Кроме того, раз в месяц Вы можете усилить свою проверку, не затрачивая хода.",effect:{}},{text:"Вам не составляет труда вывернуть любую историю так, чтобы она выставляла Вас в выгодном свете. Ваши собственные проверки Влияния всегда проще на две категории, а Репутация Вашей группы с любыми невраждебными фракциями всегда как минимум 2 (Небольшое Влияние)",effect:{}}]},{id:"ourLastAndDecisive",name:"Наш последний и решительный",levels:[{text:"Жизнь жестока и вопрос не в том, выживешь ли ты. Только в том, каким тебя запомнят. Те, кто дерётся с Вами плечом к плечу понимают, что каждый бой - их шанс занять своё место в героической легенде. Боевой дух всех бойцов ниже рангом чем Вы выше на единицу.",effect:{}},{text:"Когда Вы успешно побеждаете противника в бою, Вы можете сопровождать свои действия вдохновляющими союзников репликами. Все увидевшие и услышавшие это в бою бойцы ниже Вас рангом получат преимущество в одну категорию при атаке на один раунд.",effect:{}},{text:"Преимущества двух предыдущих уровней теперь действуют даже на бойцов Вашего ранга, включая товарищей по команде и даже Вас.",effect:{}}]},{id:"goldenPages",name:"Золотые страницы",levels:[{text:"Не только простые бойцы хотят остаться в легендах, выдающимся людям своей эпохи тоже не чужда жажда славы. Вам на две категории проще находить выход на тех, кто не стремится общаться с простым людом, а Ваши проверки Влияния против них на одну категорию проще.",effect:{}},{text:"Вам на две категории проще убеждать нейтральные стороны оказать Вам какую-то помощь - подкрепления, припасы, деньги или снаряжение. Это работает только в том случае, если по мнению люда Вам противостоит серьёный враг.",effect:{}},{text:"Здорово казаться всем храбрым... но и сойти богатым и щедрым - тоже неплохо. Вы можете рассчитывать на награду на одну категорию выше, если заказчик способен её себе позволить.",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:4},{type:"aspect",id:"knowledge",cost:2}]},{id:"cutthroat",name:{m:"Головорез",f:"Головорезка"},nameEn:"Cutthroat",professions:[],aspects:["war","shadow"],traits:[{id:"terrorToAll",name:"Гроза всему живому",levels:[{text:"Вы славитесь своей безпринципностью и безжалостностью. Проверки Влияния на одну категорию эффективнее, если Вы предпочитаете действовать через угрозы. Однако, вероятность того, что Ваша деятельность привлечёт внимание властей ничуть не меньше.",effect:{}},{text:"Враждебные фракции подумают дважды, прежде чем чинить Вам какие-то неудобства. Но уж если они решатся - бросят в бой всё, что имеют. Враждебные фракции решаются на активные действия только при репутации Ненависть (-4) или Лютая Ненависть (-5)",effect:{}},{text:"Ваши проверки Влияния эффективнее на одну категорию при попытках договориться или на две, если Вы используете угрозы. Любые предприятия и организации связанные с Вашим именем на одну категорию больше защищены от нападок разумных.",effect:{}}]},{id:"mindBlowingCruelty",name:"Умопомрачительная жестокость",levels:[{text:"Пришедшие за Вашей головой морально готовы умереть, но никто не готов умереть ТАК. Если противник уже не может эффективно сопротивляться, Вы можете устроить показательную жестокую казнь, подрывая мораль всех, кто это увидел и услышал. Противники получают -2 морали, союзники и нейтральные бойцы -1. На это нужно затратить основное действие, но в следующий ход противники будут защищаться и нападать на одну категорию хуже. Этот эффект не проймёт бойцов более высокого ранга, чем убитый.",effect:{}},{text:"Захватив в бою пленного, Вы можете жестоко казнить его позже прилюдно. Такое действие снизит вероятность нападок на Вас со стороны враждебных фракций на две категории на следующий месяц.",effect:{}},{text:"Вы можете проводить казнь в бою, затрачивая всего один порыв. Это действие больше не подрывает мораль Ваших союзников, а кроме того может пронять бойцов даже более опытных, чем убитый.",effect:{}}]},{id:"honorForFools",name:"Честь - для идиотов и мертвецов",levels:[{text:"Ваши атаки во фланг и тыл получают преимущество в одну категорию.",effect:{}},{text:"Ваши атаки во фланг и тыл - всегда точные.",effect:{}},{text:"Ваши атаки во фланг и тыл не вызывают срабатывания реакции, а кроме того забирают у цели один порыв даже в случае промаха.",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:3},{type:"aspect",id:"shadow",cost:3}]},{id:"heretic",name:{m:"Еретик",f:"Еретичка"},nameEn:"Heretic",professions:[],aspects:["mysticism","knowledge"],traits:[{id:"comprehendingIncomprehensible",name:"Постигая непостижимое",levels:[{text:"Парадокс - Ваше второе имя. Проходя любую проверку, Вы можете выбрать противоположную ей и преуспеть необъяснимым образом. Такая проверка, правда, будет на одну категорию сложнее заявленной. Вы должны объяснить, каким образом применяете свои навыки для того, чтобы пройти проверку.",effect:{}},{text:"Странно для других, естественно - для Вас. Вы можете выбрать соседнюю проверку вместо противоположной, но она будет на две категории сложнее.",effect:{}},{text:"Гениальность или безумие? Главное, чтобы это работало. Противоположные проверки больше не получают штрафа, а штраф при использовании соседних проверок снижен до одной категории.",effect:{}}]},{id:"verbalMagic",name:"Вербальная магия",levels:[{text:"Посвятив месяц изучению и анализу необъяснимых мистических сущностей, вы всё же находите кое-какие закономерности. Вы способны создавать заклинания - нелепые высказывания, которые нужно громко пропевать странно пританцовывая, чтобы они сработали. Каждое использование заклинания - парная проверка Порядка и Диверсии, требующая основного действия в бою или полного хода в небоевой сцене. Сложность определяется мастером по степени реалистичности задумки. Эти проверки нельзя заменить на другие, к ним не применяются никакие бонусы. Если обе пройдены - заклинание срабатывает как и планировалось, если провалена одна - не происходит ничего, если провалены обе - срабатывает наоборот. Одновременно Вы можете помнить только три заклинания.",effect:{}},{text:"Вы учитесь записывать свои заклинания и лучше запоминать, как именно их следует выполнять. Проверки сложности теперь проще на одну категорию, а если Вам нужно выбросить на кубике 6 или меньше, Вы проходите проверку автоматически. Теперь Вы можете хранить в своей памяти три заклинания и ещё три - в своих записях. Заклинания из памяти используются основным действием, заклинания из записей - основным действием и двумя порывами.",effect:{}},{text:"Вы научились так хорошо записывать свои заклинания, что даже другие могут их повторять. Потратив не менее двух недель и одного очка развития на изучение, Ваш товарищ может научиться использовать заклинание. В вашей собственной памяти теперь может храниться до шести заклинаний, ещё три - в записях.",effect:{}}]},{id:"completePicture",name:"Дорисовать картину",levels:[{text:"Высокие аналитические способности и хорошая интуиция - невероятно редкое сочетание, но благодаря этой связке Вы можете понимать то, что для других - недоступно. Например, разгадывать самые запутанные истории по обрывкам информации. Раз в месяц Вы можете сделать невероятную догадку - точно узнать причину какого-то события, которое Вы подробно изучали.",effect:{}},{text:"Будущее не может быть секретом для того, кто так хорошо понимает прошлое. Раз в месяц Вы можете сделать невероятную догадку - точно узнать последствия какого-то события, которое Вы подробно изучали или действия, которое собираетесь совершить.",effect:{}},{text:"Остальные видят только разрозренные кусочки, а Вы - полную картину. Жаль, что такие озарения посещают Вас лишь иногда. Раз в месяц Вы можете точно узнать самый лучший, простой и надёжный способ добиться каких-то результатов.",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:3},{type:"aspect",id:"knowledge",cost:3}]},{id:"seeker",name:{m:"Искатель",f:"Искательница"},nameEn:"Seeker",professions:[],aspects:["nature","community"],traits:[{id:"wolfToWolf",name:"Волк волку человек",levels:[{text:"Дух первооткрывателя толкает Вас почти всё время проводить в экспедициях по неизведанным землям. Вы здорово научились находить общий язык с местными дикими сообществами, Ваша Репутация с ними начинается с Небольшого Влияния (2), а все проверки Поиска и Влияния с их помощью на две категории проще.",effect:{}},{text:"Вы легко можете затеряться в дикой местности, поселившись в диком сообществе. За месяц проживания с ними, Вы можете хорошо выучить их язык, подняв попутно уровень Репутации до Дружбы (5). Ваши проверки Поиска в этой местности с помощью дружественных аборигенов проще на три категории.",effect:{}},{text:"Затратив достаточно времени, Вы способны, кажется, подружиться с кем угодно. Теперь Вы можете вжиться в сообщество любых животных или монстров, если им свойственна хотя бы какая-то стайность или социальность. На это придётся потратить не менее трёх месяцев, но в результате вы получите полное знание местности Как Свои Пять Пальцев (10), и одно очко развития.",effect:{}}]},{id:"artifactorFlair",name:"Чутьё артефактора",levels:[{text:"Пока другие покупают безделушки по цене магических артефактов, Вы делаете обратное. Паранормальное чутьё позволяет Вам находить действительно магические предметы даже в куче хлама, если они там есть. Проверки Поиска и Влияния проще на две категории при попытке найти артефакты.",effect:{}},{text:"Продажа магических материалов, ингредиентов и артефактов позволяет Вам выручить на одну категорию больше богатства.",effect:{}},{text:"Собирая вместе все знания о местной природе, слухи и легенды местного населения и своё таинственное чутьё, Вы гораздо легче находите древние руины, гробницы, затерянные города, магические места силы и прочее подобное. Проверки такого рода легче на три категории.",effect:{}}]},{id:"untilVictorious",name:"До победного",levels:[{text:"Простая неудача не может остановить Вашу несгибаемую волю Искателя. Раз в месяц Вы можете попробовать пройти проверку ещё два раза, если провалили первую попытку. Если вы пройдёте хотя бы одну из трёх - это зачитывается как успех. Мастер может наложить на Вас какой-нибудь штраф за приложение чрезмерных усилий.",effect:{}},{text:"Если Вы преуспели со второй попытки, третью можете использовать на другой проверке в этом же месяце.",effect:{}},{text:"Если Вы проваливаете проверку все три раза, при следующей попытке Ваша проверка будет на одну категорию проще.",effect:{}}]}],edges:[{type:"aspect",id:"nature",cost:3},{type:"aspect",id:"community",cost:3}]},{id:"dervish",name:{m:"Дервиш",f:"Дервишка"},nameEn:"Dervish",professions:[],aspects:["community","mysticism"],traits:[{id:"danceOfBliss",name:"Танец блаженства",levels:[{text:"Потратив действие в свой ход, Вы можете войти в особый боевой танец, в процессе которого не можете использовать атаки дальнего боя, но получаете преимущество в атаке в одну категорию.",effect:{}},{text:"Ваши движения иррациональны и непредсказуемы. Если Ваше передвижение или атака вызывает реакцию, пройдите проверку Влияния против Поиска противника. В случае успеха ему не удаётся отреагировать на Ваше действие, но затраченный порыв всё равно тратится.",effect:{}},{text:"Во время танца вы не получаете штрафов из-за ранений и морали (кроме смертельных), в к Вашей проверке Влияния на реакцию противника прибавляется две категории сложности.",effect:{}}]},{id:"ignitingHearts",name:"Зажигающий сердца",levels:[{text:"Свет вашей безграничной веры зажигает сердца и увлекает за собой. Ваши проверки Влияния вне боя легче на две категории, если цель не настроена враждебно по отношению к Вам.",effect:{}},{text:"Вы учитесь входить в особый транс в танце, который позволяет Вам лучше настроиться на следующую проверку. Проведя особый ритуал, Вы можете снизить сложность следующей проверки на категорию.",effect:{}},{text:"Ваш фанатизм сияет настолько ярко, что способен заворожить даже врага в бою. Теперь Ваши проверки Влияния легче на две категории даже в бою, даже в отношении врагов.",effect:{}}]},{id:"asIfNoOneSees",name:"Как будто никто не видит",levels:[{text:"Дервиш - это юродивый, которого никто не замечает, если он только сам того не хочет. Найти Вас в поселении с помощью Влияния на категорию сложнее.",effect:{}},{text:"Паранормальное чувство опасности ведёт Вас, позволяя избегать недоброжелателей. Найти Вас с помощью Влияния или Поиска становится сложнее на две категории. Этот бонус работает как в поселениях, так и в дикой природе.",effect:{}},{text:"Если Вас никто не видит, Вы можете делать что захотите. Проверки Диверсии становятся проще на две категории, если Вы лично участвуете в деле.",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:3},{type:"aspect",id:"mysticism",cost:3}]},{id:"bard",name:{m:"Бард",f:"Бардесса"},nameEn:"Bard",professions:[],aspects:["community","shadow"],traits:[{id:"withoutMusic",name:"А без музыки…",levels:[{text:"Хотя бардам и не часто приходится участвовать в сражениях, в кабацких драках они бывают чаще прочих. Те, кто не научился защищать себя - попросту не выжили. Потратив два порыва Вы можете провести проверку Влияния против Влияния противника, чтобы отвлечь его и заставить потерять оставшиеся действия и порывы.",effect:{}},{text:"Пока Ваша собственная мораль высока и у Вас нет тяжёлых ранений, Вы можете петь в бою, не затрачивая никаких ресурсов. Это укрепляет мораль окружающих, добавляя единицу.",effect:{}},{text:"Ваше пение теперь повышает мораль на две единицы, а затратив в свой ход полное действие Вы можете подключить к нему игру на инструменте, попробовав, таким образом, отвлечь внимание сразу всей противников, которые способны Вас видеть и слышать. С высокой долей вероятности они вскоре захотят атаковать Вас.",effect:{}}]},{id:"welcomeGuest",name:"Желанный гость",levels:[{text:"Любое застолье проходит приятнее под хорошую музыку. Мало кто откажется от присутствия барда на светском рауте. Вы в курсе всех слухов поселения, в котором провели хотя бы один месяц, это упрощает Ваши проверки Влияния в поселении на три категории. ",effect:{}},{text:"Если Вы проводите в поселении хотя бы месяц, все фракции кроме враждебных, начинают относиться к Вам как минимум с Симпатией (1).",effect:{}},{text:"Если Вы проводите в поселении хотя бы месяц, все фракции кроме враждебных начинают относиться к Вам как к доброму приятелю (Сопереживание, 4), а жители окрестных селений - с Симпатией (1)",effect:{}}]},{id:"lightWedge",name:"Свет клином",levels:[{text:"Любое тёмное дело гораздо проще провернуть, если в нём участвует яркий фанфарон, привлекающий всё внимание. Вы не можете действовать в одиночку, но облегчаете проверки Диверсии для своих друзей на одну категорию. Этот бонус складывается с другими, которыми они обладают.",effect:{}},{text:"Как же не помочь хорошим ребятам! Вы облегчаете проверки Влияния на одну категорию для своих друзей, этот бонус складывается с другими. Размер бонуса к Диверсии увеличивается до двух категорий.",effect:{}},{text:" Как складно говорит! Проверки Порядка для Ваших друзей становятся легче на одну, Влияния - на две, Порядка - на три категории. Все эти бонусы складываются с другими, которые есть у этих персонажей.",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:2},{type:"aspect",id:"shadow",cost:4}]},{id:"assassin",name:{m:"Убийца",f:"Убийца"},nameEn:"Assassin",professions:[],aspects:["mysticism","shadow"],traits:[{id:"slidingInShadows",name:"Скользящий в тени",levels:[{text:"Договариваться и подкупать стражу - не для Вас. Вам больше по душе верёвка с крюком и немного акробатики. А ещё Вы тонко чувствуете опасности, потому знаете, куда и когда лучше не соваться. Проверки Диверсии на проникновение на защищаемые объекты легче на две категории. Вы гарантированно успешно проникаете на объект, если его охраняют только Бойцы или ниже.",effect:{}},{text:"Затратив полный ход (включая порывы и передвижения) Вы можете попробовать настроиться на своё сверхъестественное чувство и узнать, какие опасности есть поблизости. Этот талант работает нестабильно, но всё же много раз спасал Вам жизнь.",effect:{}},{text:"Тени вокруг Вас неестественно темны, а под Вашими шагами не хрустят ветки и не скрипят половицы. Вне боя противник может заметить Вас, только если вы попадёте в его фронтальное поле зрения без укрытия. Противник не может протрубить тревогу в тот же ход, когда обнаружил Вас, если Вы нанесли ему хотя бы лёгкую травму. Проверки Диверсии теперь легче на три категории, если Вы можете обосновать, как будете использовать своё мастерство проникновения. ",effect:{}}]},{id:"flyingDeath",name:"Летящая смерть",levels:[{text:'Вопреки расхожим мифам, убийца - вовсе не лучший воин на свете. Ваше лучшее оружие - неожиданность и удары в спину. Затрачивая порыв на передвижение, Вы можете сделать один шаг и метнуть небольшой металлический шип через одну клетку. При попадании, он нанесёт травму категории "царапина".',effect:{}},{text:'Вы можете метать своё оружие через две клетки, а при попадании вы можете выбрать "точный удар" категории царапина или "лёгкая травма".',effect:{}},{text:'Ваши метательные ножи отравлены. Если Вы наносите хотя бы "лёгкую травму" своим метательным шипом, противник подвергается воздействию сильного яда, который удвоит этот урон на следующий ход. Теперь Вы можете метать ножи порывом, не затормаживая своего движения, в Вашем распоряжении остаются все два очка передвижения.',effect:{}}]},{id:"rememberDeath",name:"Помни о смерти",levels:[{text:"Хотя вы не афишируете свои умения, многие знают, что Ваши недоброжелатели долго не живут. Кто-то захлебнулся чаем, кто-то накормил в лесу стаю волков, а кто-то упал на собственный кухонный нож 18 раз. Проверки Влияния на две категории (6) проще, если Вы пытаетесь запугать кого-то.",effect:{}},{text:"Доказательств нет, но слухи… Преступные сообщества поселения, в котором Вы живёте не менее месяца, относятся к Вам с опаской. Быть безразличными им не удаётся - либо ненависть, либо уважение. Уровни влияния с -2 до +2 недоступны, все сообщества должны выбрать свою сторону. Те, кому Вы не чинили явного зла, будут склонны выбрать дружбу. Переходить из -3 до +3 для Вас вдвое проще, чем в обратную сторону..",effect:{}},{text:"Кроме тех, кто Вас боится, есть ещё и те, кто Вам должен. Все проверки Влияния на категорию проще, если Вы провели в этом поселении не менее месяца. Этот бонус складывается с бонусом при угрозах.",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:4},{type:"aspect",id:"shadow",cost:2}]},{id:"shaman",name:{m:"Шаман",f:"Шаманка"},nameEn:"Shaman",professions:[],aspects:["mysticism","nature"],traits:[{id:"bearSkin",name:"Медвежья шкура",levels:[{text:"В бою Вы способны впадать в кровавую ярость - за каждую степень этого эффекта Ваши защита и атака повышаются на одну категорию, но Вы не можете сопротивляться соблазну рвать на части зубами и когтями тело поверженного врага, если оказываетесь вплотную к нему. Активация ярости происходит мгновенно, сразу на второй степени. Вы можете потратить действие, чтобы снизить уровень эффекта на единицу, проведя проверку категории Простая + степень эффекта. В случае провала, Вы не можете контролировать своего персонажа следующий ход. Расправа над поверженным занимает целое действие.",effect:{}},{text:"За каждого разодранного противника Вы получаете дополнительную степень эффекта, вплоть до пяти. Начиная с третьей, расправа над противником требует только один порыв.",effect:{}},{text:"Максимальная степень эффекта теперь шестая. Начиная с третьей Вы мгновенно раздираете противника на части, если добиваете своей атакой. Если же он уже был повержен к тому моменту, Вам требуется один порыв.",effect:{}}]},{id:"iSee",name:"Я вижу",levels:[{text:"Духи говорят с Вами, позволяют видеть своими глазами. Вы получаете дополнительную информацию о том, что происходит в пределах километра от Вас. Проверки Поиска легче на одну категорию.",effect:{}},{text:"Духи видят прошлое и будущее. Вы можете узнать прошлое и будущее места, которое посетили, если свяжетесь с духами, которые здесь живут. Доступна особая проверка Интуиции, сложность на усмотрение мастера.",effect:{}},{text:"Духи помнят, помнят всё. Вы можете ограниченно получать информацию от мёртвых. Доступна особая проверка интуиции, сложность на усмотрение мастера.",effect:{}}]},{id:"visions",name:"Видения",levels:[{text:"Знать - недостаточно, нужно ещё суметь применить эти знания на пользу делу. Вы учитесь использовать полученную информацию для шпионажа и диверсий, таким образом можете облегчить любую проверку Диверсии на одну категорию.",effect:{}},{text:"Предупреждён - значит вооружён. Позволяет усложнить вражеские проверки Диверсии против какого-то предприятия на одну категорию.",effect:{}},{text:"Удваивает бонусы двух предыдущих уровней этого умения.",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:2},{type:"aspect",id:"nature",cost:4}]},{id:"fixer",name:{m:"Решала",f:"Решала"},nameEn:"Fixer",professions:[],aspects:["knowledge","shadow"],traits:[{id:"sneakyStrike",name:"Подлый удар",levels:[{text:"Вы не рыцарь в сверкающих доспехах, а всего лишь деловой человек, который не хочет проблем. Но иногда проблемы приходят сами… Потратив один порыв Вы можете нанести точный лёгкий удар рукой по противнику. Если Вы держите в руках оружие, считается что Вы ударили рукоятью, гардой, древком. Этот удар гарантировано сработает против противника, который ещё не знает что Вы так умеете. Но только один раз, и всех увидевших Вы уже не сможете удивить повторно.",effect:{}},{text:"Ваша точная неожиданная атага теперь наносит лёгкую травму, а не царапину. После такой атаки защита противника снижена на две категории.",effect:{}},{text:"Разнообразие. Вы знаете столько приёмов, что можете удивить каждого. Если Вы используете подлый удар, в течении этого хода Вы можете применить его несколько раз до полного исчерпания порывов.",effect:{}}]},{id:"whileNoOneSees",name:"Пока никто не видит",levels:[{text:"Ваша специализация - тёмные дела, чаще всего торговые. Вы проводите теневые сделки проще, зарабатываете с них больше. Проверки проще на одну категорию, прибыль также больше на одну.",effect:{}},{text:"Ваши шансы найти что-то действительно ценное значительно повышаются, если Вы занимаетесь торговлей. Поиск через Влияние работает на две категории проще, если Вы знаете, что именно ищете.",effect:{}},{text:"Торговля удаётся Вам всё лучше - теперь проверки и прибыль лучше сразу на две категории. Раз в месяц Вы можете провести особенно крупную сделку, с повышенными шансами на провал и на то, что Вас поймают.",effect:{}}]},{id:"boundByBlood",name:"Повязанные кровью",levels:[{text:"У Вас обширная сеть контактов в криминальном мире, преимущественно - среди гильдий воров. Ваши отношения с ними изначально на уровне 4, Сопереживание, но могут и меняться со временем.",effect:{}},{text:"В любом поселении цивилизованного мира Вы легко можете найти своих. За звонкую монету они готовы выполнить любой заказ. Доступен особый тип наёмников - разъярённые бедняки. Они способны устроить беспорядки в своём селении, но не покинут его пределов.",effect:{}},{text:"Вам доступен особый тип наёмников - городские бандиты. Могут наниматься только в крупных городах, их дисциплина хромает, как и мораль. Зато они обходятся крайне дёшево и с такими потерями можно не считаться.",effect:{}}]}],edges:[{type:"aspect",id:"knowledge",cost:3},{type:"aspect",id:"shadow",cost:3}]},{id:"champion",name:{m:"Чемпион",f:"Чемпион"},nameEn:"Champion",professions:[],aspects:["war"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:2}]},{id:"strategist",name:{m:"Стратег",f:"Стратег"},nameEn:"Strategist",professions:[],aspects:["war"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:2},{type:"class",id:"surgeon",cost:4}]},{id:"sniper",name:{m:"Снайпер",f:"Снайпер"},nameEn:"Sniper",professions:[],aspects:["war"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"war",cost:2},{type:"class",id:"warden",cost:4}]},{id:"surgeon",name:{m:"Хирург",f:"Хирург"},nameEn:"Surgeon",professions:[],aspects:["knowledge"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"knowledge",cost:2},{type:"class",id:"strategist",cost:4}]},{id:"magister",name:{m:"Магистр",f:"Магистр"},nameEn:"Magister",professions:[],aspects:["knowledge"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"knowledge",cost:2}]},{id:"advisor",name:{m:"Советник",f:"Советница"},nameEn:"Advisor",professions:[],aspects:["knowledge"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"knowledge",cost:2},{type:"class",id:"politician",cost:4}]},{id:"politician",name:{m:"Политик",f:"Политик"},nameEn:"Politician",professions:[],aspects:["community"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:2},{type:"class",id:"advisor",cost:4}]},{id:"leader",name:{m:"Лидер",f:"Лидер"},nameEn:"Leader",professions:[],aspects:["community"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:2}]},{id:"instigator",name:{m:"Провокатор",f:"Провокатор"},nameEn:"Instigator",professions:[],aspects:["community"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"community",cost:2},{type:"class",id:"spy",cost:4}]},{id:"spy",name:{m:"Шпион",f:"Шпион"},nameEn:"Spy",professions:[],aspects:["shadow"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"shadow",cost:2},{type:"class",id:"instigator",cost:4}]},{id:"thief",name:{m:"Вор",f:"Вор"},nameEn:"Thief",professions:[],aspects:["shadow"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"shadow",cost:2}]},{id:"trickster",name:{m:"Шулер",f:"Шулер"},nameEn:"Trickster",professions:[],aspects:["shadow"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"shadow",cost:2},{type:"class",id:"mentalist",cost:4}]},{id:"mentalist",name:{m:"Менталист",f:"Менталист"},nameEn:"Mentalist",professions:[],aspects:["mysticism"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:2},{type:"class",id:"trickster",cost:4}]},{id:"occultist",name:{m:"Оккультист",f:"Оккультист"},nameEn:"Occultist",professions:[],aspects:["mysticism"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:2}]},{id:"seer",name:{m:"Провидец",f:"Провидица"},nameEn:"Seer",professions:[],aspects:["mysticism"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"mysticism",cost:2},{type:"class",id:"stalker",cost:4}]},{id:"stalker",name:{m:"Сталкер",f:"Сталкер"},nameEn:"Stalker",professions:[],aspects:["nature"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"nature",cost:2},{type:"class",id:"seer",cost:4}]},{id:"archon",name:{m:"Архонт",f:"Архонт"},nameEn:"Archon",professions:[],aspects:["nature"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"nature",cost:2}]},{id:"warden",name:{m:"Страж",f:"Страж"},nameEn:"Warden",professions:[],aspects:["nature"],traits:[{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]},{id:"placeholder",name:"Временный",levels:[{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}},{text:"Этот класс ещё не прописан, как и его способности",effect:{}}]}],edges:[{type:"aspect",id:"nature",cost:2},{type:"class",id:"sniper",cost:4}]}],$s={systemName:"triP Classes",version:"1.0"},at={classes:ks,metadata:$s},ws={class:"space-y-6"},Cs={key:0},Ss={class:"flex items-center justify-between mb-3"},Ts={class:"space-y-2"},Ms={class:"flex items-center gap-3 flex-1"},Ds={class:"flex-1"},As={class:"text-sm font-medium text-slate-200"},Es={class:"text-xs text-slate-400"},qs={class:"flex items-center gap-3"},js={class:"text-right"},Ps={class:"flex items-center gap-3 flex-1"},Os={class:"flex-1"},Bs={class:"text-sm font-medium text-slate-300"},Ws={class:"text-xs text-slate-500"},Vs={class:"flex items-center gap-3"},Xs={class:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg border border-slate-700/40 bg-slate-800/40"},Rs={class:"text-right"},Is={class:"text-[10px] uppercase font-medium tracking-wide text-slate-500"},Hs={class:"text-sm font-bold text-slate-400"},Ys={class:"text-xl font-semibold text-slate-400 px-3 py-1"},zs={class:"flex items-center gap-3 flex-1"},Fs={class:"flex-1"},Ls={class:"text-sm font-medium text-slate-500"},Ns={class:"text-xs text-slate-600"},Us={class:"flex items-center gap-3"},Gs={class:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg border border-slate-800/50 bg-slate-900/40"},Js={class:"text-right"},Zs={class:"text-[10px] uppercase font-medium tracking-wide text-slate-600"},Ks={class:"text-sm font-bold text-slate-600"},Qs={key:1},el={class:"space-y-3"},tl={class:"text-xs font-medium text-slate-400 mb-2 flex items-center gap-2"},sl={class:"grid grid-cols-1 gap-2"},ll=["onClick"],nl={class:"flex items-start justify-between gap-2"},ol={class:"flex-1 min-w-0"},al={class:"text-sm font-medium text-slate-200 mb-1"},il={class:"text-xs text-slate-500 leading-relaxed"},cl={key:0,class:"border-t border-slate-700/30"},rl=["onClick"],dl={key:0,class:"px-3 pb-3 space-y-2 bg-slate-900/30"},ul={class:"text-xs font-medium text-slate-300 mb-1"},fl={class:"text-xs text-slate-400"},vl={class:"grid grid-cols-1 gap-2"},pl=["onClick"],ml={class:"flex items-start justify-between gap-2"},hl={class:"flex-1 min-w-0"},xl={class:"text-sm font-medium text-slate-200 mb-1"},bl={class:"text-xs text-slate-500 leading-relaxed"},gl={key:0,class:"border-t border-slate-700/30"},yl=["onClick"],_l={key:0,class:"px-3 pb-3 space-y-2 bg-slate-900/30"},kl={class:"text-xs font-medium text-slate-300 mb-1"},$l={class:"text-xs text-slate-400"},wl={class:"grid grid-cols-1 gap-2"},Cl=["onClick"],Sl={class:"flex items-start justify-between gap-2"},Tl={class:"flex-1 min-w-0"},Ml={class:"text-sm font-medium text-slate-200 mb-1"},Dl={class:"text-xs text-slate-500 leading-relaxed"},Al={key:0,class:"border-t border-slate-700/30"},El=["onClick"],ql={key:0,class:"px-3 pb-3 space-y-2 bg-slate-900/30"},jl={class:"text-xs font-medium text-slate-300 mb-1"},Pl={class:"text-xs text-slate-400"},Ol={__name:"ClassStatsAndSkills",props:{classId:{type:String,required:!0},modelValue:{type:Object,required:!0},showStats:{type:Boolean,default:!0},showSkills:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(m,{expose:L,emit:u}){const S=m,y=u,p=Pe.aspects,_=at.classes,E=J({...S.modelValue.stats}),v=J({...S.modelValue.skills}),A=J(!1),Y=J(new Set);Xe(()=>S.modelValue,r=>{if(!A.value){const f=JSON.stringify(E.value)!==JSON.stringify(r.stats),x=JSON.stringify(v.value)!==JSON.stringify(r.skills);f&&(E.value={...r.stats}),x&&(v.value={...r.skills})}},{deep:!0,flush:"post"}),Xe([E,v],()=>{A.value||y("update:modelValue",{stats:{...E.value},skills:{...v.value}})},{deep:!0,flush:"post"});const se=j(()=>_.find(r=>r.id===S.classId)),V=j(()=>se.value?se.value.aspects:[]),W=j(()=>{if(V.value.length!==2)return!1;const r=D(V.value[0]);return D(V.value[1]),(r==null?void 0:r.opposite)===V.value[1]}),O=j(()=>{var x,z;if(!se.value)return[];const r=p.map(U=>U.id),f=V.value;if(W.value)return r.filter(U=>!f.includes(U));{const U=(x=D(f[0]))==null?void 0:x.opposite,le=(z=D(f[1]))==null?void 0:z.opposite,me=[U,le].filter(Boolean);return r.filter(ie=>!f.includes(ie)&&!me.includes(ie))}}),ae=j(()=>{var z,U;if(W.value)return[];if(!se.value)return[];const r=V.value,f=(z=D(r[0]))==null?void 0:z.opposite,x=(U=D(r[1]))==null?void 0:U.opposite;return[f,x].filter(Boolean)}),B=j(()=>{var r;return((r=se.value)==null?void 0:r.traits)||[]}),R=j(()=>{if(!se.value)return[[],[]];const r=[],f=[];return p.find(x=>x.id===V.value[0]),p.find(x=>x.id===V.value[1]),_.forEach(x=>{x.aspects.includes(V.value[0])&&x.id!==S.classId&&r.push(...x.traits),x.aspects.includes(V.value[1])&&x.id!==S.classId&&f.push(...x.traits)}),[r.slice(0,3),f.slice(0,3)]});function D(r){return p.find(f=>f.id===r)}function X(r){var f;return((f=D(r))==null?void 0:f.color)||"#64748b"}const d=j(()=>{const r={};return p.forEach(x=>{var ne;const z=E.value[x.id]||0,U=x.neighbors||[],le=x.opposite,me=E.value[U[0]]||0,ie=E.value[U[1]]||0,o=Math.floor(z+me/2+ie/2+0),h=E.value[le]||0,I=Math.floor(h/2),H=Math.max(o,I);r[x.id]={bonus:H,checkName:((ne=x.check)==null?void 0:ne.name)||"",checkIcon:x.checkIcon}}),r});Xe(()=>S.classId,r=>{if(!r)return;A.value=!0;const f={war:0,knowledge:0,community:0,shadow:0,mysticism:0,nature:0},x=V.value,z=O.value,U=ae.value;x.length===2&&(W.value?(f[x[0]]=6,f[x[1]]=4,z.forEach(le=>{f[le]=1})):(f[x[0]]=6,f[x[1]]=4,z.forEach(le=>{f[le]=2}),U.forEach(le=>{f[le]=0}))),E.value=f,setTimeout(()=>{A.value=!1,y("update:modelValue",{stats:{...E.value},skills:{...v.value}})},0)},{immediate:!0});function b(){const r=E.value[V.value[0]];E.value[V.value[0]]=E.value[V.value[1]],E.value[V.value[1]]=r}function T(r,f){v.value[r]=f}function l(r){Y.value.has(r)?Y.value.delete(r):Y.value.add(r)}const i=j(()=>v.value.fromClass&&v.value.fromAspect1&&v.value.fromAspect2);return L({allSkillsSelected:i,swapStats:b}),(r,f)=>{var x,z,U,le,me,ie;return t(),s("div",ws,[m.showStats?(t(),s("div",Cs,[e("div",Ss,[f[1]||(f[1]=e("h4",{class:"text-xs font-semibold text-slate-400 uppercase tracking-wider"},"Характеристики",-1)),V.value.length===2?(t(),s("button",{key:0,onClick:b,class:"flex items-center gap-1.5 px-3 py-1.5 text-xs rounded bg-slate-700/50 hover:bg-slate-700 border border-slate-600/50 text-slate-300 transition"},[k(c(q),{icon:"mdi:swap-horizontal",class:"w-4 h-4"}),f[0]||(f[0]=e("span",null,"Поменять местами",-1))])):g("",!0)]),e("div",Ts,[(t(!0),s(N,null,K(V.value,(o,h)=>{var I,H,ne,ce,de,$e;return t(),s("div",{key:o,class:"flex items-center justify-between p-3 rounded-lg border transition-colors",style:ue({backgroundColor:X(o)+"15",borderColor:X(o)+"40"})},[e("div",Ms,[k(c(q),{icon:((I=D(o))==null?void 0:I.characteristicIcon)||"mdi:star",class:"w-6 h-6",style:ue({color:X(o)})},null,8,["icon","style"]),e("div",Ds,[e("div",As,n((H=D(o))==null?void 0:H.characteristic.name),1),e("div",Es,n((ne=D(o))==null?void 0:ne.name),1)])]),e("div",qs,[e("div",{class:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg border",style:ue({backgroundColor:X(o)+"15",borderColor:X(o)+"30"})},[k(c(q),{icon:(ce=d.value[o])==null?void 0:ce.checkIcon,class:"w-4 h-4",style:ue({color:X(o)+"aa"})},null,8,["icon","style"]),e("div",js,[e("div",{class:"text-[10px] uppercase font-medium tracking-wide",style:ue({color:X(o)+"cc"})},n((de=d.value[o])==null?void 0:de.checkName),5),e("div",{class:"text-sm font-bold",style:ue({color:X(o)})}," +"+n(($e=d.value[o])==null?void 0:$e.bonus),5)])],4),e("div",{class:"text-2xl font-bold px-3 py-1 rounded",style:ue({color:X(o),backgroundColor:X(o)+"20"})},n(E.value[o]),5)])],4)}),128)),(t(!0),s(N,null,K(O.value,o=>{var h,I,H,ne,ce,de;return t(),s("div",{key:o,class:"flex items-center justify-between p-3 rounded-lg bg-slate-800/30 border border-slate-700/30"},[e("div",Ps,[k(c(q),{icon:((h=D(o))==null?void 0:h.characteristicIcon)||"mdi:star",class:"w-6 h-6 text-slate-400"},null,8,["icon"]),e("div",Os,[e("div",Bs,n((I=D(o))==null?void 0:I.characteristic.name),1),e("div",Ws,n((H=D(o))==null?void 0:H.name),1)])]),e("div",Vs,[e("div",Xs,[k(c(q),{icon:(ne=d.value[o])==null?void 0:ne.checkIcon,class:"w-4 h-4 text-slate-500"},null,8,["icon"]),e("div",Rs,[e("div",Is,n((ce=d.value[o])==null?void 0:ce.checkName),1),e("div",Hs," +"+n((de=d.value[o])==null?void 0:de.bonus),1)])]),e("div",Ys,n(E.value[o]),1)])])}),128)),(t(!0),s(N,null,K(ae.value,o=>{var h,I,H,ne,ce,de;return t(),s("div",{key:o,class:"flex items-center justify-between p-3 rounded-lg bg-slate-900/50 border border-slate-800/50 opacity-60"},[e("div",zs,[k(c(q),{icon:((h=D(o))==null?void 0:h.characteristicIcon)||"mdi:star",class:"w-6 h-6 text-slate-600"},null,8,["icon"]),e("div",Fs,[e("div",Ls,n((I=D(o))==null?void 0:I.characteristic.name),1),e("div",Ns,n((H=D(o))==null?void 0:H.name),1)])]),e("div",Us,[e("div",Gs,[k(c(q),{icon:(ne=d.value[o])==null?void 0:ne.checkIcon,class:"w-4 h-4 text-slate-600"},null,8,["icon"]),e("div",Js,[e("div",Zs,n((ce=d.value[o])==null?void 0:ce.checkName),1),e("div",Ks," +"+n((de=d.value[o])==null?void 0:de.bonus),1)])]),f[2]||(f[2]=e("div",{class:"text-xl font-semibold text-slate-600 px-3 py-1"}," 0 ",-1))])])}),128))])])):g("",!0),m.showSkills?(t(),s("div",Qs,[f[3]||(f[3]=e("h4",{class:"text-sm font-semibold text-slate-300 mb-3"},"Выбор навыков (3 из 9)",-1)),e("div",el,[e("div",null,[e("div",tl,[k(c(q),{icon:"game-icons:skills",class:"w-4 h-4"}),oe(" Навык класса (1 из "+n(B.value.length)+") ",1)]),e("div",sl,[(t(!0),s(N,null,K(B.value,o=>(t(),s("div",{key:o.id,class:G(["rounded-lg border transition-all overflow-hidden",v.value.fromClass===o.id?"bg-slate-700/40 border-slate-500/60 ring-2 ring-slate-500/30":"bg-slate-800/30 border-slate-700/30 hover:bg-slate-800/40 hover:border-slate-700/40"])},[e("button",{onClick:h=>T("fromClass",o.id),class:"w-full text-left p-3 transition"},[e("div",nl,[e("div",ol,[e("div",al,n(o.name),1),e("div",il,n(o.levels[0].text),1)]),v.value.fromClass===o.id?(t(),Me(c(q),{key:0,icon:"mdi:check-circle",class:"w-5 h-5 text-slate-300 flex-shrink-0"})):g("",!0)])],8,ll),o.levels.length>1?(t(),s("div",cl,[e("button",{onClick:h=>l(o.id),class:"w-full px-3 py-2 text-xs text-slate-400 hover:text-slate-300 hover:bg-white/5 transition flex items-center gap-1.5"},[k(c(q),{icon:Y.value.has(o.id)?"mdi:chevron-up":"mdi:chevron-down",class:"w-4 h-4"},null,8,["icon"]),e("span",null,n(Y.value.has(o.id)?"Скрыть":"Показать")+" уровни 2-3",1)],8,rl),Y.value.has(o.id)?(t(),s("div",dl,[(t(!0),s(N,null,K(o.levels.slice(1),(h,I)=>(t(),s("div",{key:I,class:"p-2 rounded bg-slate-800/50 border border-slate-700/50"},[e("div",ul,"Уровень "+n(I+2),1),e("div",fl,n(h.text),1)]))),128))])):g("",!0)])):g("",!0)],2))),128))])]),e("div",null,[e("div",{class:"text-xs font-medium mb-2 flex items-center gap-2",style:ue({color:X(V.value[0])})},[k(c(q),{icon:(x=D(V.value[0]))==null?void 0:x.icon,class:"w-4 h-4"},null,8,["icon"]),oe(" Навык аспекта "+n((z=D(V.value[0]))==null?void 0:z.name)+" (1 из "+n(((U=R.value[0])==null?void 0:U.length)||0)+") ",1)],4),e("div",vl,[(t(!0),s(N,null,K(R.value[0],o=>(t(),s("div",{key:o.id,class:G(["rounded-lg border transition-all overflow-hidden",v.value.fromAspect1===o.id?"bg-slate-700/40 border-slate-500/60 ring-2 ring-slate-500/30":"bg-slate-800/30 border-slate-700/30 hover:bg-slate-800/40 hover:border-slate-700/40"])},[e("button",{onClick:h=>T("fromAspect1",o.id),class:"w-full text-left p-3 transition"},[e("div",ml,[e("div",hl,[e("div",xl,n(o.name),1),e("div",bl,n(o.levels[0].text),1)]),v.value.fromAspect1===o.id?(t(),Me(c(q),{key:0,icon:"mdi:check-circle",class:"w-5 h-5 text-slate-300 flex-shrink-0"})):g("",!0)])],8,pl),o.levels.length>1?(t(),s("div",gl,[e("button",{onClick:h=>l(o.id),class:"w-full px-3 py-2 text-xs text-slate-400 hover:text-slate-300 hover:bg-white/5 transition flex items-center gap-1.5"},[k(c(q),{icon:Y.value.has(o.id)?"mdi:chevron-up":"mdi:chevron-down",class:"w-4 h-4"},null,8,["icon"]),e("span",null,n(Y.value.has(o.id)?"Скрыть":"Показать")+" уровни 2-3",1)],8,yl),Y.value.has(o.id)?(t(),s("div",_l,[(t(!0),s(N,null,K(o.levels.slice(1),(h,I)=>(t(),s("div",{key:I,class:"p-2 rounded border bg-slate-800/50 border-slate-700/50"},[e("div",kl,"Уровень "+n(I+2),1),e("div",$l,n(h.text),1)]))),128))])):g("",!0)])):g("",!0)],2))),128))])]),e("div",null,[e("div",{class:"text-xs font-medium mb-2 flex items-center gap-2",style:ue({color:X(V.value[1])})},[k(c(q),{icon:(le=D(V.value[1]))==null?void 0:le.icon,class:"w-4 h-4"},null,8,["icon"]),oe(" Навык аспекта "+n((me=D(V.value[1]))==null?void 0:me.name)+" (1 из "+n(((ie=R.value[1])==null?void 0:ie.length)||0)+") ",1)],4),e("div",wl,[(t(!0),s(N,null,K(R.value[1],o=>(t(),s("div",{key:o.id,class:G(["rounded-lg border transition-all overflow-hidden",v.value.fromAspect2===o.id?"bg-slate-700/40 border-slate-500/60 ring-2 ring-slate-500/30":"bg-slate-800/30 border-slate-700/30 hover:bg-slate-800/40 hover:border-slate-700/40"])},[e("button",{onClick:h=>T("fromAspect2",o.id),class:"w-full text-left p-3 transition"},[e("div",Sl,[e("div",Tl,[e("div",Ml,n(o.name),1),e("div",Dl,n(o.levels[0].text),1)]),v.value.fromAspect2===o.id?(t(),Me(c(q),{key:0,icon:"mdi:check-circle",class:"w-5 h-5 text-slate-300 flex-shrink-0"})):g("",!0)])],8,Cl),o.levels.length>1?(t(),s("div",Al,[e("button",{onClick:h=>l(o.id),class:"w-full px-3 py-2 text-xs text-slate-400 hover:text-slate-300 hover:bg-white/5 transition flex items-center gap-1.5"},[k(c(q),{icon:Y.value.has(o.id)?"mdi:chevron-up":"mdi:chevron-down",class:"w-4 h-4"},null,8,["icon"]),e("span",null,n(Y.value.has(o.id)?"Скрыть":"Показать")+" уровни 2-3",1)],8,El),Y.value.has(o.id)?(t(),s("div",ql,[(t(!0),s(N,null,K(o.levels.slice(1),(h,I)=>(t(),s("div",{key:I,class:"p-2 rounded border bg-slate-800/50 border-slate-700/50"},[e("div",jl,"Уровень "+n(I+2),1),e("div",Pl,n(h.text),1)]))),128))])):g("",!0)])):g("",!0)],2))),128))])])])])):g("",!0)])}}},Bl={class:"flex flex-col items-center gap-4"},Wl={class:"flex items-center gap-2 bg-slate-800/50 rounded-lg p-1 border border-slate-700/50"},Vl=["width","height","viewBox"],Xl={key:0},Rl=["points","stroke","stroke-width"],Il={key:1},Hl=["cx","cy","r","stroke","stroke-width"],Yl=["x1","y1","x2","y2"],zl=["points"],Fl=["points"],Ll=["cx","cy","fill","stroke"],Nl=["cx","cy","fill","stroke"],Ul=["x","y"],Gl={class:"w-full h-full flex items-center justify-center",xmlns:"http://www.w3.org/1999/xhtml"},Jl=["title"],Zl=["x","y"],Kl={class:"flex items-center justify-center",xmlns:"http://www.w3.org/1999/xhtml"},Ql=["x","y"],en={class:"flex items-center justify-center",xmlns:"http://www.w3.org/1999/xhtml"},tn={__name:"AspectChart",props:{stats:{type:Object,required:!0},size:{type:Number,default:340}},emits:["swap-stats"],setup(m,{emit:L}){const u=m,{stats:S}=rs(u),y=Pe.aspects,p=J("stats"),_=j(()=>u.size/2),E=j(()=>u.size/2*.6),v=j(()=>{const D={};return y.forEach(X=>{D[X.id]=X.color}),D}),A=j(()=>{const D={};return y.forEach(d=>{var le;const b=S.value[d.id]||0,T=d.neighbors||[],l=d.opposite,i=S.value[T[0]]||0,r=S.value[T[1]]||0,f=Math.floor(b+i/2+r/2+0),x=S.value[l]||0,z=Math.floor(x/2),U=Math.max(f,z);D[d.id]={bonus:U,checkName:((le=d.check)==null?void 0:le.name)||"",checkIcon:d.checkIcon}}),D});function Y(D,X){const b=(D*60-120)*(Math.PI/180),T=E.value*X/10;return{x:_.value+T*Math.cos(b),y:_.value+T*Math.sin(b)}}function se(D,X){const d=(D*60-120)*(Math.PI/180),b=V(X);return{x:_.value+b*Math.cos(d),y:_.value+b*Math.sin(d)}}function V(D){return E.value*D/12}function W(D){const X=(D*60-120)*(Math.PI/180),d=E.value;return{x:_.value+d*Math.cos(X),y:_.value+d*Math.sin(X)}}function O(D){const X=[];for(let d=0;d<6;d++){const b=Y(d,D);X.push(`${b.x},${b.y}`)}return X.join(" ")}function ae(){const D=[];return y.forEach((X,d)=>{const b=S.value[X.id]||0,T=Y(d,b);D.push(`${T.x},${T.y}`)}),D.join(" ")}function B(){const D=[];return y.forEach((X,d)=>{var l;const b=((l=A.value[X.id])==null?void 0:l.bonus)||0,T=se(d,b);D.push(`${T.x},${T.y}`)}),D.join(" ")}function R(D){const X=(D*60-120)*(Math.PI/180),d=E.value*1.25;return{x:_.value+d*Math.cos(X),y:_.value+d*Math.sin(X)}}return(D,X)=>(t(),s("div",Bl,[e("div",Wl,[e("button",{onClick:X[0]||(X[0]=d=>p.value="stats"),class:G(["px-4 py-2 rounded-md text-sm font-medium transition-all",p.value==="stats"?"bg-sky-500/20 text-sky-200 border border-sky-400/40":"text-slate-400 hover:text-slate-300"])},[k(c(q),{icon:"game-icons:embrassed-energy",class:"w-4 h-4 inline mr-1.5"}),X[2]||(X[2]=oe(" Характеристики ",-1))],2),e("button",{onClick:X[1]||(X[1]=d=>p.value="checks"),class:G(["px-4 py-2 rounded-md text-sm font-medium transition-all",p.value==="checks"?"bg-purple-500/20 text-purple-200 border border-purple-400/40":"text-slate-400 hover:text-slate-300"])},[k(c(q),{icon:"mdi:dice-d20",class:"w-4 h-4 inline mr-1.5"}),X[3]||(X[3]=oe(" Бонусы проверок ",-1))],2)]),e("div",{class:"relative",style:ue({width:m.size+"px",height:m.size+"px"})},[(t(),s("svg",{width:m.size,height:m.size,viewBox:`0 0 ${m.size} ${m.size}`},[p.value==="stats"?(t(),s("g",Xl,[(t(),s(N,null,K([0,2,4,6,8,10],d=>e("g",{key:d},[e("polygon",{points:O(d),fill:"none",stroke:d===10?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.1)","stroke-width":d===10?1.5:1},null,8,Rl)])),64))])):(t(),s("g",Il,[(t(),s(N,null,K([0,2,4,6,8,10,12],d=>e("g",{key:d},[e("circle",{cx:_.value,cy:_.value,r:V(d),fill:"none",stroke:d===12?"rgba(148, 163, 184, 0.3)":"rgba(148, 163, 184, 0.1)","stroke-width":d===12?1.5:1},null,8,Hl)])),64))])),(t(!0),s(N,null,K(c(y),(d,b)=>(t(),s("g",{key:d.id},[e("line",{x1:_.value,y1:_.value,x2:W(b).x,y2:W(b).y,stroke:"rgba(148, 163, 184, 0.2)","stroke-width":"1"},null,8,Yl)]))),128)),p.value==="stats"?(t(),s("polygon",{key:2,points:ae(),fill:"rgba(56, 189, 248, 0.3)",stroke:"rgba(56, 189, 248, 0.7)","stroke-width":"2",class:"transition-all duration-300"},null,8,zl)):(t(),s("polygon",{key:3,points:B(),fill:"rgba(139, 92, 246, 0.2)",stroke:"rgba(139, 92, 246, 0.6)","stroke-width":"2",class:"transition-all duration-300"},null,8,Fl)),(t(!0),s(N,null,K(c(y),(d,b)=>{var T,l;return t(),s("g",{key:"point-"+d.id},[p.value==="stats"&&c(S)[d.id]>0?(t(),s("circle",{key:0,cx:Y(b,c(S)[d.id]).x,cy:Y(b,c(S)[d.id]).y,r:4,fill:v.value[d.id],stroke:v.value[d.id],"stroke-width":"2",class:"transition-all duration-300"},null,8,Ll)):p.value==="checks"?(t(),s("circle",{key:1,cx:se(b,((T=A.value[d.id])==null?void 0:T.bonus)||0).x,cy:se(b,((l=A.value[d.id])==null?void 0:l.bonus)||0).y,r:5,fill:v.value[d.id],stroke:v.value[d.id],"stroke-width":"2",class:"transition-all duration-300"},null,8,Nl)):g("",!0)])}),128)),(t(!0),s(N,null,K(c(y),(d,b)=>{var T,l,i;return t(),s("g",{key:"label-"+d.id},[e("g",null,[e("title",null,n(p.value==="stats"?d.characteristic.name:(T=d.check)==null?void 0:T.name),1),(t(),s("foreignObject",{x:W(b).x-20,y:W(b).y-20,width:"40",height:"40"},[e("div",Gl,[e("div",{class:"w-10 h-10 rounded-full flex items-center justify-center shadow-lg",style:ue({backgroundColor:v.value[d.id]+"25",borderColor:v.value[d.id]+"70",borderWidth:"2px"}),title:p.value==="stats"?d.characteristic.name:(l=d.check)==null?void 0:l.name},[k(c(q),{icon:p.value==="stats"?d.characteristicIcon:d.checkIcon,class:"w-6 h-6",style:ue({color:v.value[d.id]})},null,8,["icon","style"])],12,Jl)])],8,Ul))]),p.value==="stats"?(t(),s("foreignObject",{key:0,x:R(b).x-20,y:R(b).y-16,width:"40",height:"32"},[e("div",Kl,[e("div",{class:"text-lg font-bold text-center min-w-[36px]",style:ue({color:v.value[d.id]})},n(c(S)[d.id]),5)])],8,Zl)):g("",!0),p.value==="checks"?(t(),s("foreignObject",{key:1,x:R(b).x-22,y:R(b).y-16,width:"44",height:"32"},[e("div",en,[e("div",{class:"text-lg font-bold text-center min-w-[40px]",style:ue({color:v.value[d.id]})},n(((i=A.value[d.id])==null?void 0:i.bonus)||0),5)])],8,Ql)):g("",!0)])}),128))],8,Vl))],4)]))}},xt={1:{name:"Каменный век"},2:{name:"Железный век"},3:{name:"Тёмные века"},4:{name:"Античность"},5:{name:"Раннее средневековье"},6:{name:"Средние века"},7:{name:"Ренессанс"},8:{name:"Век пара"},9:{name:"Век дизеля"},10:{name:"Современность"},11:{name:"Кибер век"}},sn={class:"armor-carousel"},ln=["disabled"],nn={class:"armor-display"},on={class:"armor-header"},an={class:"text-2xl font-bold text-slate-100"},cn={class:"armor-image-container"},rn=["src","alt"],dn={class:"stats-grid"},un={class:"stat-item"},fn={class:"stat-label"},vn={class:"stat-value"},pn={class:"stat-item"},mn={class:"stat-label"},hn={class:"stat-value"},xn={class:"stat-item"},bn={class:"stat-label"},gn={class:"stat-item"},yn={class:"stat-label"},_n={class:"price-epoch-row"},kn={class:"price-box"},$n={class:"value"},wn={class:"epoch-box"},Cn={class:"value"},Sn={class:"armor-description"},Tn={key:0,class:"availability-warning"},Mn=["disabled"],Dn={__name:"ArmorCarousel",props:{modelValue:{type:String,default:"clothes"},wealth:{type:Number,default:5},epoch:{type:Number,default:10}},emits:["update:modelValue"],setup(m,{emit:L}){const u=m,S=L,y=xt,p=Re.items.filter(W=>W.category==="armor"),_=J(p.findIndex(W=>W.id===u.modelValue));Xe(()=>u.modelValue,W=>{const O=p.findIndex(ae=>ae.id===W);O!==-1&&(_.value=O)});const E=j(()=>p[_.value]),v=()=>{_.value>0&&(_.value--,S("update:modelValue",E.value.id))},A=()=>{_.value<p.length-1&&(_.value++,S("update:modelValue",E.value.id))},Y=W=>W.price<=u.wealth,se=W=>{const O=W.price-u.wealth;return O<0?"availability-green":O===0?"availability-yellow":O===1?"availability-orange":"availability-red"},V=W=>{const O=W.price-u.wealth;return O<0?"Незначительная":O===0?"Значительная":O===1?"Огромная":"Запредельная"};return(W,O)=>{var ae;return t(),s("div",sn,[e("button",{onClick:v,class:"nav-button left",disabled:_.value===0},[k(c(q),{icon:"mdi:chevron-left",class:"w-6 h-6"})],8,ln),e("div",nn,[e("div",on,[e("h3",an,n(E.value.name),1),e("div",{class:G(["availability-badge",se(E.value)])},n(V(E.value)),3)]),e("div",cn,[e("img",{src:c(rt)(E.value.id),alt:E.value.name,class:"armor-image",onError:O[0]||(O[0]=B=>B.target.style.display="none")},null,40,rn)]),e("div",dn,[e("div",un,[e("div",fn,[k(c(q),{icon:"mdi:shield",class:"w-5 h-5"}),O[1]||(O[1]=oe(" Защита ",-1))]),e("div",vn,n(E.value.defence),1)]),e("div",pn,[e("div",mn,[k(c(q),{icon:"mdi:shield-check",class:"w-5 h-5"}),O[2]||(O[2]=oe(" Снижение ",-1))]),e("div",hn,n(E.value.resist),1)]),e("div",xn,[e("div",bn,[k(c(q),{icon:"mdi:run-fast",class:"w-5 h-5"}),O[3]||(O[3]=oe(" Скорость ",-1))]),e("div",{class:G(["stat-value",E.value.movement<0?"text-red-400":"text-slate-300"])},n(E.value.movement),3)]),e("div",gn,[e("div",yn,[k(c(q),{icon:"mdi:lightning-bolt",class:"w-5 h-5"}),O[4]||(O[4]=oe(" Порывы ",-1))]),e("div",{class:G(["stat-value",E.value.bursts<0?"text-red-400":"text-slate-300"])},n(E.value.bursts),3)])]),e("div",_n,[e("div",kn,[k(c(q),{icon:"mdi:gold",class:"w-5 h-5"}),O[5]||(O[5]=e("span",{class:"label"},"Цена",-1)),e("span",$n,n(E.value.price),1)]),e("div",wn,[k(c(q),{icon:"mdi:clock-outline",class:"w-5 h-5"}),O[6]||(O[6]=e("span",{class:"label"},"Эпоха",-1)),e("span",Cn,n((ae=c(y)[E.value.epoch])==null?void 0:ae.name),1)])]),e("div",Sn,n(E.value.desc),1),Y(E.value)?g("",!0):(t(),s("div",Tn,[k(c(q),{icon:"mdi:alert",class:"w-5 h-5"}),e("span",null,[O[7]||(O[7]=oe("Цена для Вас: ",-1)),e("strong",null,n(V(E.value)),1)]),k(c(q),{icon:"mdi:content-copy",class:"w-4 h-4 ml-auto"})]))]),e("button",{onClick:A,class:"nav-button right",disabled:_.value===c(p).length-1},[k(c(q),{icon:"mdi:chevron-right",class:"w-6 h-6"})],8,Mn)])}}},An=Oe(Dn,[["__scopeId","data-v-ed08f348"]]),En={class:"weapons-grid"},qn=["onClick"],jn={class:"weapon-image-container"},Pn=["src","alt"],On={class:"weapon-info"},Bn={class:"weapon-name"},Wn={class:"weapon-quick-stats"},Vn={class:"epoch"},Xn={key:0,class:"selected-indicator"},Rn={key:1,class:"locked-overlay"},In={class:"modal-header"},Hn={class:"text-2xl font-bold text-slate-100"},Yn={class:"modal-body"},zn={class:"modal-weapon-image"},Fn=["src","alt"],Ln={class:"stats-grid"},Nn={key:0,class:"stat-box"},Un={class:"stat-label"},Gn={class:"stat-value"},Jn={key:1,class:"stat-box"},Zn={class:"stat-label"},Kn={class:"stat-value"},Qn={key:2,class:"stat-box"},eo={class:"stat-label"},to={class:"stat-value"},so={key:3,class:"stat-box"},lo={class:"stat-label"},no={class:"stat-value"},oo={key:0,class:"damage-section"},ao={class:"section-title"},io={class:"overflow-x-auto"},co={class:"w-full text-sm bg-slate-950/30 rounded-lg overflow-hidden"},ro={key:0,class:"border-t border-slate-800"},uo={class:"text-center p-3"},fo={class:"text-emerald-400 font-bold text-lg"},vo={class:"text-center p-3"},po={class:"text-sky-400 font-bold text-lg"},mo={key:1,class:"border-t border-slate-800"},ho={class:"text-center p-3"},xo={class:"text-emerald-400 font-bold text-lg"},bo={class:"text-center p-3"},go={class:"text-sky-400 font-bold text-lg"},yo={key:2,class:"border-t border-slate-800"},_o={class:"text-center p-3"},ko={class:"text-emerald-400 font-bold text-lg"},$o={class:"text-center p-3"},wo={class:"text-sky-400 font-bold text-lg"},Co={class:"price-epoch-row"},So={class:"info-box"},To={class:"value"},Mo={class:"info-box"},Do={class:"value"},Ao={class:"damage-section"},Eo={class:"section-title"},qo={class:"damage-table"},jo={class:"threshold"},Po={class:"effect"},Oo={key:1,class:"description-box"},Bo={class:"modal-footer"},Wo=["disabled"],Vo={__name:"WeaponSelector",props:{modelValue:{type:Array,default:()=>[]},wealth:{type:Number,default:5},epoch:{type:Number,default:10},categoryFilter:{type:String,default:null}},emits:["update:modelValue"],setup(m,{emit:L}){const u=m,S=L,y=xt,p=Re.items.filter(B=>B.category==="weapon"||B.category==="shield"),_=J(null),E=j(()=>u.categoryFilter?p.filter(B=>B.subcat===u.categoryFilter):p),v=B=>{_.value=B},A=()=>{_.value=null},Y=B=>u.modelValue.includes(B),se=B=>{const R=B.price-u.wealth,D=B.epoch<=u.epoch;return R<=1&&D},V=B=>{const R=B.price-u.wealth;return R<0?"price-green":R===0?"price-yellow":R===1?"price-orange":"price-red"},W=B=>{const R=Y(B.id),D=se(B);return R?"card-selected":D?"card-available":"card-locked"},O=()=>{_.value&&se(_.value)&&(S("update:modelValue",[...u.modelValue,_.value.id]),A())},ae=()=>{if(_.value){const B=u.modelValue.filter(R=>R!==_.value.id);S("update:modelValue",B),A()}};return(B,R)=>{var D;return t(),s("div",null,[e("div",En,[(t(!0),s(N,null,K(E.value,X=>{var d;return t(),s("div",{key:X.id,onClick:b=>v(X),class:G(["weapon-card",W(X)])},[e("div",jn,[e("img",{src:c(rt)(X.id),alt:X.name,class:"weapon-image",onError:R[0]||(R[0]=b=>b.target.style.display="none")},null,40,Pn)]),e("div",On,[e("h4",Bn,n(X.name),1),e("div",Wn,[e("span",{class:G(["price",V(X)])},[k(c(q),{icon:"mdi:gold",class:"w-3.5 h-3.5"}),oe(" "+n(X.price),1)],2),e("span",Vn,n((d=c(y)[X.epoch])==null?void 0:d.name.substring(0,10)),1)])]),Y(X.id)?(t(),s("div",Xn,[k(c(q),{icon:"mdi:check",class:"w-5 h-5"})])):g("",!0),se(X)?g("",!0):(t(),s("div",Rn,[k(c(q),{icon:"mdi:lock",class:"w-8 h-8"})]))],10,qn)}),128))]),(t(),Me(Ge,{to:"body"},[_.value?(t(),s("div",{key:0,class:"modal-overlay",onClick:A},[e("div",{class:"modal-content",onClick:R[2]||(R[2]=ye(()=>{},["stop"]))},[e("div",In,[e("h2",Hn,n(_.value.name),1),e("button",{onClick:A,class:"close-button"},[k(c(q),{icon:"mdi:close",class:"w-6 h-6"})])]),e("div",Yn,[e("div",zn,[e("img",{src:c(rt)(_.value.id),alt:_.value.name,class:"w-full h-full object-contain",onError:R[1]||(R[1]=X=>X.target.style.display="none")},null,40,Fn)]),e("div",Ln,[_.value.attack!==void 0&&typeof _.value.defence!="object"?(t(),s("div",Nn,[e("div",Un,[k(c(q),{icon:"mdi:sword",class:"w-5 h-5"}),R[3]||(R[3]=oe(" Атака ",-1))]),e("div",Gn,n(_.value.attack),1)])):g("",!0),_.value.defence!==void 0&&typeof _.value.defence!="object"?(t(),s("div",Jn,[e("div",Zn,[k(c(q),{icon:"mdi:shield",class:"w-5 h-5"}),R[4]||(R[4]=oe(" Защита ",-1))]),e("div",Kn,n(_.value.defence),1)])):g("",!0),_.value.length!==void 0?(t(),s("div",Qn,[e("div",eo,[k(c(q),{icon:"mdi:arrow-expand-horizontal",class:"w-5 h-5"}),R[5]||(R[5]=oe(" Дальность ",-1))]),e("div",to,n(_.value.length),1)])):g("",!0),_.value.hands!==void 0?(t(),s("div",so,[e("div",lo,[k(c(q),{icon:"mdi:hand-back-left",class:"w-5 h-5"}),R[6]||(R[6]=oe(" Руки ",-1))]),e("div",no,n(_.value.hands),1)])):g("",!0)]),typeof _.value.defence=="object"?(t(),s("div",oo,[e("h3",ao,[k(c(q),{icon:"mdi:shield",class:"w-5 h-5"}),R[7]||(R[7]=oe(" Защита щита ",-1))]),e("div",io,[e("table",co,[R[11]||(R[11]=e("thead",null,[e("tr",{class:"bg-slate-900/50"},[e("th",{class:"text-left text-slate-400 p-3"},"Направление"),e("th",{class:"text-center text-slate-400 p-3"},"Ближний бой"),e("th",{class:"text-center text-slate-400 p-3"},"Дальний бой")])],-1)),e("tbody",null,[_.value.defence.front?(t(),s("tr",ro,[R[8]||(R[8]=e("td",{class:"p-3 text-slate-300 font-medium"},"Спереди",-1)),e("td",uo,[e("span",fo,n(_.value.defence.front.melee||0),1)]),e("td",vo,[e("span",po,n(_.value.defence.front.ranged||0),1)])])):g("",!0),_.value.defence.side?(t(),s("tr",mo,[R[9]||(R[9]=e("td",{class:"p-3 text-slate-300 font-medium"},"С фланга",-1)),e("td",ho,[e("span",xo,n(_.value.defence.side.melee||0),1)]),e("td",bo,[e("span",go,n(_.value.defence.side.ranged||0),1)])])):g("",!0),_.value.defence.back?(t(),s("tr",yo,[R[10]||(R[10]=e("td",{class:"p-3 text-slate-300 font-medium"},"Сзади",-1)),e("td",_o,[e("span",ko,n(_.value.defence.back.melee||0),1)]),e("td",$o,[e("span",wo,n(_.value.defence.back.ranged||0),1)])])):g("",!0)])])])])):g("",!0),e("div",Co,[e("div",So,[k(c(q),{icon:"mdi:gold",class:"w-5 h-5"}),R[12]||(R[12]=e("span",{class:"label"},"Цена",-1)),e("span",To,n(_.value.price),1)]),e("div",Mo,[k(c(q),{icon:"mdi:clock-outline",class:"w-5 h-5"}),R[13]||(R[13]=e("span",{class:"label"},"Эпоха",-1)),e("span",Do,n((D=c(y)[_.value.epoch])==null?void 0:D.name),1)])]),e("div",Ao,[e("h3",Eo,[k(c(q),{icon:"mdi:sword-cross",class:"w-5 h-5"}),R[14]||(R[14]=oe(" Превышение защиты ",-1))]),e("div",qo,[(t(!0),s(N,null,K(_.value.damage,(X,d)=>(t(),s("div",{key:d,class:"damage-row"},[e("div",jo,n(d),1),e("div",Po,n(X),1)]))),128))])]),_.value.desc?(t(),s("div",Oo,n(_.value.desc),1)):g("",!0)]),e("div",Bo,[Y(_.value.id)?(t(),s("button",{key:1,onClick:ae,class:"action-button remove"},[k(c(q),{icon:"mdi:close-circle",class:"w-5 h-5"}),R[16]||(R[16]=oe(" Убрать ",-1))])):(t(),s("button",{key:0,onClick:O,class:"action-button take",disabled:!se(_.value)},[k(c(q),{icon:"mdi:plus-circle",class:"w-5 h-5"}),R[15]||(R[15]=oe(" Взять ",-1))],8,Wo)),e("button",{onClick:A,class:"action-button close"}," Закрыть ")])])])):g("",!0)]))])}}},Xo=Oe(Vo,[["__scopeId","data-v-5a343b7c"]]),Ro={spears:{name:"Копья",nameEn:"Spears",icon:"game-icons:broadhead-arrow"},swords:{name:"Мечи",nameEn:"Swords",icon:"game-icons:croc-sword"},daggers:{name:"Кинжалы",nameEn:"Daggers",icon:"game-icons:plain-dagger"},bows:{name:"Луки",nameEn:"Bows",icon:"game-icons:bow-arrow"},crossbows:{name:"Арбалеты",nameEn:"Crossbows",icon:"game-icons:crossbow"},slings:{name:"Пращи",nameEn:"Slings",icon:"game-icons:sling"},axes:{name:"Топоры",nameEn:"Axes",icon:"game-icons:battered-axe"},maces:{name:"Булавы",nameEn:"Maces",icon:"game-icons:flanged-mace"},flails:{name:"Цепы",nameEn:"Flails",icon:"game-icons:flail"},shields:{name:"Щиты",nameEn:"Shields",icon:"game-icons:round-shield"}},Io={light:{name:"Лёгкая",nameEn:"Light"},middle:{name:"Средняя",nameEn:"Medium"},heavy:{name:"Тяжёлая",nameEn:"Heavy"}},Ho={piercing:{name:"Колющий",nameEn:"Piercing"},slashing:{name:"Режущий",nameEn:"Slashing"},bludgeoning:{name:"Дробящий",nameEn:"Bludgeoning"}},Yo={weaponTypes:Ro,armorTypes:Io,damageTypes:Ho},zo={1:{name:"Крайняя бедность"},2:{name:"Бедность"},3:{name:"Умеренная бедность"},4:{name:"Ниже среднего"},5:{name:"Среднее благополучие"},6:{name:"Выше среднего"},7:{name:"Небольшое богатство"},8:{name:"Богатство"},9:{name:"Огромное богатство"},10:{name:"Умопомрачительное богатство"}},Fo={class:"equipment-selector"},Lo={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},No={class:"selector-card"},Uo={class:"card-title"},Go={class:"space-y-4"},Jo={class:"value-display"},Zo={class:"value-number"},Ko={class:"value-name"},Qo={class:"hint-text"},ea={class:"highlight"},ta={class:"selector-card"},sa={class:"card-title"},la={class:"space-y-4"},na={class:"value-display"},oa={class:"value-number"},aa={class:"value-name"},ia={class:"selector-card mb-6"},ca={class:"card-title"},ra={class:"selector-card"},da={class:"card-title"},ua={class:"filter-buttons"},fa=["onClick"],va={class:"selection-summary"},pa={class:"summary-item"},ma={class:"summary-value"},ha={class:"summary-item"},xa={class:"summary-value green"},ba={class:"summary-item"},ga={class:"summary-value yellow"},ya={class:"summary-item"},_a={class:"summary-value orange"},ka={key:0,class:"validation-warnings"},$a={key:1,class:"no-weapon-warning"},wa={__name:"EquipmentSelector",props:{modelValue:{type:Object,default:()=>({armor:"clothes",weapons:[],wealth:5,epoch:10})}},emits:["update:modelValue","validation-change"],setup(m,{emit:L}){var d,b,T,l;const u=m,S=L,y=J(((d=u.modelValue)==null?void 0:d.wealth)??5),p=J(((b=u.modelValue)==null?void 0:b.epoch)??10),_=J(((T=u.modelValue)==null?void 0:T.armor)??"clothes"),E=J(((l=u.modelValue)==null?void 0:l.weapons)??[]),v=J(null),A=Yo.weaponTypes,Y=xt,se=zo,V=Re.items,W=j(()=>{var i;return((i=se[y.value])==null?void 0:i.name)||""}),O=j(()=>{var i;return((i=Y[p.value])==null?void 0:i.name)||""});Xe(()=>u.modelValue,i=>{i&&(i.wealth!==void 0&&(y.value=i.wealth),i.epoch!==void 0&&(p.value=i.epoch),i.armor!==void 0&&(_.value=i.armor),i.weapons!==void 0&&(E.value=i.weapons))},{deep:!0});const ae=j(()=>E.value.filter(i=>{const r=V.find(f=>f.id===i);return r&&r.price<y.value}).length),B=j(()=>E.value.filter(i=>{const r=V.find(f=>f.id===i);return r&&r.price===y.value}).length),R=j(()=>E.value.filter(i=>{const r=V.find(f=>f.id===i);return r&&r.price===y.value+1}).length),D=j(()=>{const i=[];return B.value>2&&i.push(`Предметов "жёлтой" доступности не может быть больше двух (у вас: ${B.value})`),R.value>0&&B.value>0&&i.push('Если взят предмет "оранжевой" доступности, нельзя брать "жёлтые" предметы'),R.value>1&&i.push(`Предмет "оранжевой" доступности может быть только один (у вас: ${R.value})`),i}),X=j(()=>D.value.length===0);return Xe([y,p,_,E],()=>{S("update:modelValue",{armor:_.value,weapons:E.value,wealth:y.value,epoch:p.value})},{deep:!0}),Xe(X,i=>{S("validation-change",i)}),S("validation-change",X.value),(i,r)=>(t(),s("div",Fo,[e("div",Lo,[e("div",No,[e("h3",Uo,[k(c(q),{icon:"mdi:gold",class:"w-6 h-6 text-amber-400"}),r[5]||(r[5]=oe(" Уровень благосостояния ",-1))]),e("div",Go,[je(e("input",{type:"range",min:"1",max:"10","onUpdate:modelValue":r[0]||(r[0]=f=>y.value=f),class:"wealth-slider"},null,512),[[Je,y.value,void 0,{number:!0}]]),e("div",Jo,[e("span",Zo,n(y.value),1),r[6]||(r[6]=e("span",{class:"value-separator"},"-",-1)),e("span",Ko,n(W.value),1)]),e("p",Qo,[r[7]||(r[7]=oe(" Максимальная цена: ",-1)),e("span",ea,n(y.value),1)])])]),e("div",ta,[e("h3",sa,[k(c(q),{icon:"mdi:clock-outline",class:"w-6 h-6 text-sky-400"}),r[8]||(r[8]=oe(" Максимальная эпоха ",-1))]),e("div",la,[je(e("input",{type:"range",min:"1",max:"10","onUpdate:modelValue":r[1]||(r[1]=f=>p.value=f),class:"epoch-slider"},null,512),[[Je,p.value,void 0,{number:!0}]]),e("div",na,[e("span",oa,n(p.value),1),r[9]||(r[9]=e("span",{class:"value-separator"},"-",-1)),e("span",aa,n(O.value),1)])])])]),e("div",ia,[e("h3",ca,[k(c(q),{icon:"mdi:shield",class:"w-6 h-6 text-emerald-400"}),r[10]||(r[10]=oe(" Выбор доспеха ",-1))]),r[11]||(r[11]=e("p",{class:"card-description"}," В бой Вы сможете брать только два набора снаряжения и один доспех. Например, лук со стрелами для дальнего боя и меч с щитом для ближнего. ",-1)),k(An,{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=f=>_.value=f),wealth:y.value,epoch:p.value},null,8,["modelValue","wealth","epoch"])]),e("div",ra,[e("h3",da,[k(c(q),{icon:"mdi:sword-cross",class:"w-6 h-6 text-red-400"}),r[12]||(r[12]=oe(" Выбор оружия ",-1))]),e("div",ua,[e("button",{onClick:r[3]||(r[3]=f=>v.value=null),class:G(["filter-btn",{active:v.value===null}])}," Всё ",2),(t(!0),s(N,null,K(c(A),(f,x)=>(t(),s("button",{key:x,onClick:z=>v.value=x,class:G(["filter-btn",{active:v.value===x}])},[k(c(q),{icon:f.icon,class:"w-4 h-4"},null,8,["icon"]),oe(" "+n(f.name),1)],10,fa))),128))]),k(Xo,{modelValue:E.value,"onUpdate:modelValue":r[4]||(r[4]=f=>E.value=f),wealth:y.value,epoch:p.value,"category-filter":v.value},null,8,["modelValue","wealth","epoch","category-filter"]),e("div",va,[e("div",pa,[r[13]||(r[13]=e("span",{class:"summary-label"},"Выбрано предметов:",-1)),e("span",ma,n(E.value.length),1)]),e("div",ha,[r[14]||(r[14]=e("span",{class:"summary-label"},"Зелёных:",-1)),e("span",xa,n(ae.value),1)]),e("div",ba,[r[15]||(r[15]=e("span",{class:"summary-label"},"Жёлтых:",-1)),e("span",ga,n(B.value),1)]),e("div",ya,[r[16]||(r[16]=e("span",{class:"summary-label"},"Оранжевых:",-1)),e("span",_a,n(R.value),1)])]),D.value.length>0?(t(),s("div",ka,[(t(!0),s(N,null,K(D.value,(f,x)=>(t(),s("div",{key:x,class:"warning-message"},[k(c(q),{icon:"mdi:alert",class:"w-5 h-5"}),oe(" "+n(f),1)]))),128))])):g("",!0),E.value.length===0?(t(),s("div",$a,[k(c(q),{icon:"mdi:alert-outline",class:"w-5 h-5"}),r[17]||(r[17]=oe(" Вы не взяли с собой никакого оружия. Уверены, что хотите продолжить? ",-1))])):g("",!0)])]))}},Ca=Oe(wa,[["__scopeId","data-v-fde3c527"]]),Sa={class:"finalization-step"},Ta={class:"content-wrapper"},Ma={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Da={class:"space-y-6"},Aa={class:"input-card"},Ea={class:"input-label"},qa={class:"char-counter"},ja={class:"preview-card"},Pa={class:"preview-title"},Oa={class:"selected-portrait-container"},Ba=["src","alt"],Wa={key:1,class:"no-portrait-placeholder"},Va={key:0,class:"portrait-number"},Xa={class:"portraits-section"},Ra={class:"portraits-header"},Ia={class:"portraits-title"},Ha={class:"portraits-grid-container"},Ya={class:"portraits-grid"},za=["onClick"],Fa=["src","alt"],La={key:0,class:"portrait-check"},Na={class:"portrait-overlay"},Ua={class:"portrait-num"},Ga={key:0,class:"summary-card"},Ja={class:"summary-text"},Za={class:"text-slate-100"},jt=96,Ka={__name:"CharacterFinalization",props:{name:{type:String,default:""},portrait:{type:Number,default:null}},emits:["update:name","update:portrait"],setup(m,{emit:L}){const u=m,S=L,y=J(u.name||""),p=J(u.portrait||null);Xe(()=>u.name,E=>{y.value=E}),Xe(()=>u.portrait,E=>{p.value=E});const _=E=>{p.value=E,S("update:portrait",E)};return(E,v)=>(t(),s("div",Sa,[e("div",Ta,[v[8]||(v[8]=e("div",{class:"text-center mb-8"},[e("h2",{class:"text-3xl font-bold text-slate-100 mb-2"},"Последние штрихи"),e("p",{class:"text-slate-400"},"Выберите имя и портрет для вашего персонажа")],-1)),e("div",Ma,[e("div",Da,[e("div",Aa,[e("label",Ea,[k(c(q),{icon:"mdi:account",class:"w-5 h-5"}),v[2]||(v[2]=oe(" Имя персонажа ",-1))]),je(e("input",{"onUpdate:modelValue":v[0]||(v[0]=A=>y.value=A),type:"text",placeholder:"Введите имя...",maxlength:"50",class:"name-input",onInput:v[1]||(v[1]=A=>S("update:name",y.value))},null,544),[[Je,y.value]]),e("div",qa,n(y.value.length)+" / 50 ",1)]),e("div",ja,[e("h3",Pa,[k(c(q),{icon:"mdi:image",class:"w-5 h-5"}),v[3]||(v[3]=oe(" Выбранный портрет ",-1))]),e("div",Oa,[p.value?(t(),s("img",{key:0,src:c(vt)(p.value),alt:`Портрет ${p.value}`,class:"selected-portrait-image"},null,8,Ba)):(t(),s("div",Wa,[k(c(q),{icon:"mdi:account-circle",class:"w-24 h-24 text-slate-600"}),v[4]||(v[4]=e("p",{class:"text-slate-500 text-sm mt-2"},"Выберите портрет",-1))]))]),p.value?(t(),s("div",Va," #"+n(p.value),1)):g("",!0)])]),e("div",Xa,[e("div",Ra,[e("h3",Ia,[k(c(q),{icon:"mdi:view-grid",class:"w-5 h-5"}),v[5]||(v[5]=oe(" Галерея портретов ",-1))]),e("div",{class:"portraits-count"},n(jt)+" доступно ")]),e("div",Ha,[e("div",Ya,[(t(),s(N,null,K(jt,A=>e("div",{key:A,onClick:Y=>_(A),class:G(["portrait-card",{selected:p.value===A}])},[e("img",{src:c(vt)(A),alt:`Портрет ${A}`,class:"portrait-image",loading:"lazy"},null,8,Fa),p.value===A?(t(),s("div",La,[k(c(q),{icon:"mdi:check-circle",class:"w-6 h-6"})])):g("",!0),e("div",Na,[e("span",Ua,"#"+n(A),1)])],10,za)),64))])])])]),y.value&&p.value?(t(),s("div",Ga,[k(c(q),{icon:"mdi:check-circle",class:"w-6 h-6 text-emerald-400"}),e("div",Ja,[v[6]||(v[6]=e("span",{class:"text-slate-300"},"Персонаж",-1)),e("strong",Za,n(y.value),1),v[7]||(v[7]=e("span",{class:"text-slate-300"},"готов к созданию!",-1))])])):g("",!0)])]))}},Qa=Oe(Ka,[["__scopeId","data-v-d510e8c7"]]),ei=[{id:"dwarf",name:"Дворфы",nameEn:"Dwarf",description:"Крепкие и стойкие мастера камня и металла, живущие в горных твердынях",icon:"🧔",position:{aspects:["war","knowledge"],description:"Между Войной и Знанием"},color:"amber",subraceAliases:{}},{id:"human",name:"Люди",nameEn:"Human",description:"Универсальные и адаптивные существа, способные проявить себя в любой сфере",icon:"👤",position:{aspects:["knowledge","community"],description:"Между Знанием и Обществом"},color:"slate",subraceAliases:{}},{id:"tiefling",name:"Тифлинги",nameEn:"Tiefling",description:"Существа с демоническим наследием, обладающие врождённой магией и харизмой",icon:"😈",position:{aspects:["community","shadow"],description:"Между Обществом и Тенью"},color:"purple",subraceAliases:{}},{id:"drow",name:"Дроу",nameEn:"Drow",description:"Тёмные эльфы подземий, мастера скрытности и магии теней",icon:"🕷️",position:{aspects:["shadow","mysticism"],description:"Между Тенью и Мистикой"},color:"gray",subraceAliases:{}},{id:"goblin",name:"Гоблины",nameEn:"Goblin",description:"Хитрые и изобретательные существа, выжившие благодаря смекалке",icon:"👺",position:{aspects:["mysticism","nature"],description:"Между Мистикой и Природой"},color:"green",subraceAliases:{}},{id:"orc",name:"Орки",nameEn:"Orc",description:"Могучие воины с первобытной силой и связью с природой",icon:"💪",position:{aspects:["nature","war"],description:"Между Природой и Войной"},color:"green",subraceAliases:{}},{id:"hobgoblin",name:"Хобгоблины",nameEn:"Hobgoblin",description:"Дисциплинированные и организованные военные стратеги",icon:"🎖️",position:{aspects:["war","community"],description:"Между Войной и Обществом"},color:"red",subraceAliases:{}},{id:"kobold",name:"Кобольды",nameEn:"Kobold",description:"Маленькие драконоподобные существа, изобретательные и хитрые",icon:"🦎",position:{aspects:["knowledge","shadow"],description:"Между Знанием и Тенью"},color:"orange",subraceAliases:{}},{id:"liminar",name:"Лиминары",nameEn:"Liminar",description:"Загадочные существа пограничных миров, обладающие глубокой связью с мистикой и обществом",icon:"✨",position:{aspects:["community","mysticism"],description:"Между Обществом и Мистикой"},color:"pink",subraceAliases:{}},{id:"shifter",name:"Шифтеры",nameEn:"Shifter",description:"Существа с ликантропическим наследием, способные менять облик",icon:"🐺",position:{aspects:["shadow","nature"],description:"Между Тенью и Природой"},color:"brown",subraceAliases:{}},{id:"ferrat",name:"Фераты",nameEn:"Ferrat",description:"Дикие гуманоиды с первобытной магией и боевыми инстинктами",icon:"🐉",position:{aspects:["mysticism","war"],description:"Между Мистикой и Войной"},color:"purple",subraceAliases:{}},{id:"elf",name:"Эльфы",nameEn:"Elf",description:"Грациозные и долгоживущие существа с глубокой связью с природой и знаниями",icon:"🧝",position:{aspects:["nature","knowledge"],description:"Между Природой и Знанием"},color:"emerald",subraceAliases:{}}],bt={races:ei},ti=[{id:"storm",name:"Грозные",nameEn:"Storm",aspect:"war",description:"Те, кто связан с аспектом Войны"},{id:"light",name:"Светлые",nameEn:"Light",aspect:"knowledge",description:"Те, кто связан с аспектом Знания"},{id:"high",name:"Высшие",nameEn:"High",aspect:"community",description:"Те, кто связан с аспектом Общества"},{id:"dusk",name:"Сумеречные",nameEn:"Dusk",aspect:"shadow",description:"Те, кто связан с аспектом Тени"},{id:"moon",name:"Лунные",nameEn:"Moon",aspect:"mysticism",description:"Те, кто связан с аспектом Мистики"},{id:"wild",name:"Вольные",nameEn:"Wild",aspect:"nature",description:"Те, кто связан с аспектом Природы"}],si={subraces:ti},li={class:"fixed inset-0 z-50 flex flex-col lg:flex-row bg-slate-950 select-none"},ni=["viewBox"],oi=["id"],ai=["points"],ii={id:"clip-center-race"},ci=["points"],ri=["transform"],di={key:0,class:"gender-selection"},ui=["x","y","href"],fi=["x","y","href"],vi={key:1,class:"aspects"},pi=["cx","cy","fill","fill-opacity","onClick"],mi=["cx","cy","stroke"],hi=["x","y"],xi=["x","y"],bi={key:2,class:"race-aspect-connections"},gi=["x1","y1","x2","y2","stroke","stroke-opacity"],yi=["x1","y1","x2","y2","stroke","stroke-opacity"],_i={key:3,class:"races"},ki=["onClick","onMouseenter"],$i=["transform"],wi=["clip-path"],Ci=["href","onError"],Si=["points","stroke","stroke-width","opacity"],Ti={key:4,class:"subrace-selection"},Mi=["x1","y1","x2","y2","stroke"],Di=["cx","cy","fill","fill-opacity","stroke","stroke-opacity"],Ai=["x","y"],Ei={class:"flex items-center justify-center w-full h-full opacity-70"},qi=["x","y"],ji=["transform"],Pi={"clip-path":"url(#clip-center-race)"},Oi=["href"],Bi=["points","stroke","stroke-width","opacity"],Wi=["cx","cy","onClick","onMouseenter"],Vi=["cx","cy","fill"],Xi=["cx","cy","stroke"],Ri={key:5,class:"class-selection"},Ii=["cx","cy","r"],Hi=["cx","cy","fill","fill-opacity"],Yi=["x","y"],zi=["d","stroke"],Fi=["d","stroke","stroke-opacity","stroke-width"],Li=["id","gradientTransform"],Ni=["stop-color"],Ui=["stop-color"],Gi=["stop-color"],Ji=["stop-color"],Zi=["id"],Ki=["points"],Qi=["transform","onClick","onMouseenter"],ec=["fill","fill-opacity","clip-path"],tc=["points","stroke-opacity"],sc=["x","y","width","height"],lc=["src"],nc={key:1,class:"pointer-events-none"},oc=["cx","cy","stroke"],ac={class:"flex-1 bg-slate-900 border-t lg:border-t-0 lg:border-l border-white/10 flex flex-col relative overflow-hidden"},ic={class:"sticky top-0 z-20 bg-slate-900/95 backdrop-blur-sm px-6 py-4 border-b border-slate-700/50"},cc={class:"flex items-center justify-between"},rc={key:1},dc={class:"flex-1 overflow-y-auto p-6 pb-0"},uc={key:0,class:"mb-4"},fc={class:"text-2xl font-bold text-slate-100"},vc={class:"text-sm text-slate-400 mt-1"},pc={class:"pb-6"},mc={key:0,class:"space-y-4"},hc={class:"text-lg font-semibold text-slate-100 mb-2"},xc={class:"text-sm text-slate-300"},bc={class:"flex flex-wrap gap-2"},gc={key:1,class:"space-y-4"},yc={class:"text-lg font-semibold text-slate-100 mb-2"},_c={class:"text-sm text-slate-300"},kc={key:2,class:"space-y-6"},$c={key:0,class:"step-4-container"},wc={class:"step-4-grid gap-8 mb-6"},Cc={class:"step-4-left-column space-y-4"},Sc={class:"text-2xl font-bold text-slate-100 mb-1"},Tc={class:"text-sm text-slate-400"},Mc=["src","alt"],Dc={class:"flex items-center justify-center"},Ac={class:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-5 mb-6"},Ec={class:"flex items-start justify-between gap-6 flex-wrap"},qc={key:0,class:"bg-slate-800/20 border border-slate-700/30 rounded-lg p-5 mb-6"},jc={class:"text-sm text-slate-400 leading-relaxed italic"},Pc={key:3},Oc={key:4},Bc={class:"p-6 pt-4 border-t border-white/5 bg-slate-900 flex gap-3 flex-shrink-0"},Wc=["disabled"],Vc=["disabled"],Pt=6,fe=800,Ve=1600,ct=5,Xc=300,Rc={__name:"CharacterCreationCanvas",emits:["close","created"],setup(m,{emit:L}){const u=L,S=_s(),y=j({get:()=>S.step,set:C=>S.setStep(C)}),p=j(()=>S.formData),_=J(1.9),E=J({x:0,y:0}),v=J(!1),A=J({x:0,y:0}),Y=J(!1);ht(()=>{console.log("Восстановлено состояние:",S.step,S.formData)});const se=J(0),V=J(1),W=J({x:0,y:0}),O=J(null),ae=J(null),B=J(null),R=J(null),D=J(!1),X=J("forward"),d=J(!1),b=J(0),T=J(null),l=J(null),i=J({stats:{...S.formData.stats},skills:{...S.formData.skills}}),r=J(!0),f=bt.races,x=Pe.aspects,z=Pe.metadata.circularOrder,U=at.classes,le=j(()=>f.find(C=>C.id===p.value.race)),me=j(()=>{var te;if(!le.value||!p.value.subrace)return null;const C=p.value.subrace.split("-");if(C.length!==2)return null;const[M,Z]=C,re=si.subraces.find(pe=>pe.aspect===Z);if(!re)return null;const a=(te=le.value.subraceAliases)==null?void 0:te[Z];return{...re,id:p.value.subrace,name:(a==null?void 0:a.name)||`${re.name} ${le.value.name.toLowerCase()}`,description:(a==null?void 0:a.description)||re.description}}),ie=j(()=>{if(!p.value.subrace)return null;const C=p.value.subrace.split("-");return C.length===2?C[1]:null}),o=j(()=>{if(y.value!==2||!p.value.race||D.value)return[];const C=f.find(M=>M.id===p.value.race);return(C==null?void 0:C.position.aspects)||[]}),h=j(()=>y.value!==2||!B.value||D.value?[]:f.filter(C=>C.position.aspects.includes(B.value)).map(C=>C.id)),I=j(()=>{switch(y.value){case 1:return p.value.gender!==null;case 2:return p.value.race!==null;case 3:return p.value.subrace!==null;case 4:{if(!p.value.class)return!1;const C=i.value.skills;return C.fromClass&&C.fromAspect1&&C.fromAspect2}case 5:return r.value&&p.value.equipment.armor!==null;case 6:return p.value.name.trim().length>0&&p.value.portrait!==null;default:return!1}}),H=C=>{const M=x.find(xe=>xe.id===C);if(!M)return{x:0,y:0};const Z=M.position.angle,re=fe*.32,a=(Z-90)*(Math.PI/180),te=fe/2+re*Math.cos(a),pe=fe/2+re*Math.sin(a);return{x:te,y:pe}},ne=C=>{const[M,Z]=C.position.aspects,re=H(M),a=H(Z);return{x:(re.x+a.x)/2,y:(re.y+a.y)/2}},ce=C=>{const M=x.find(Z=>Z.id===C);return(M==null?void 0:M.color)||"#666"},de=C=>({war:"w",knowledge:"k",community:"c",shadow:"s",mysticism:"m",nature:"n"})[C]||C,$e=(C,M,Z=null)=>{if(Z){const re=de(Z);return ut(C,M,re)}return ut(C,M,"base")},he=(C,M,Z,re=null)=>{const a=C.target;if(!a)return;const te=a.src||"",pe=re?de(re):null;if(re&&pe&&te.includes(`/${M}/${Z}/${pe}.png`)){console.log(`Subrace portrait not found: ${M}/${Z}/${pe}.png (aspect: ${re}), falling back to base`),a.src=ut(M,Z,"base");return}if(te.includes(`/${M}/${Z}/base.png`)){console.error(`Base portrait not found for ${M} (${Z}), hiding image`),a.style.display="none";return}console.error(`Unexpected image load error for ${M} (${Z})`,te),a.style.display="none"},ge=(C,M,Z)=>{const re=[];for(let a=0;a<6;a++){const te=Math.PI/3*a,pe=C+Z*Math.cos(te),xe=M+Z*Math.sin(te);re.push(`${pe},${xe}`)}return re.join(" ")},ve=C=>C.edges.filter(Z=>Z.type==="aspect").length===1,F=C=>{if(ve(C)){const we=C.aspects[0],ke=H(we),Ce=fe/2,Te=fe/2,De=ke.x-Ce,We=ke.y-Te;let Ae=Math.atan2(We,De)*(180/Math.PI);return Ae<0&&(Ae+=360),Ae}const M=C.aspects[0],Z=C.aspects[1],re=H(M),a=H(Z),te=a.x-re.x,pe=a.y-re.y;let xe=Math.atan2(pe,te)*(180/Math.PI);return xe<0&&(xe+=360),xe},P=C=>{const M=fe/2,Z=fe/2;if(ve(C)){const Ie=C.aspects[0],Le=H(Ie),Ne=Le.x-M,Ue=Le.y-Z,_t=Math.sqrt(Ne*Ne+Ue*Ue),ns=Ne/_t,os=Ue/_t,it=fe*.43;let kt=M+ns*it,$t=Z+os*it;if(C.edges.some(et=>et.type==="class")){const et=C.edges.find(tt=>tt.type==="class"),as=et==null?void 0:et.id,wt=U.find(tt=>tt.id===as);if(wt){const tt=wt.aspects[0],Ct=x.find(st=>st.id===Ie),St=x.find(st=>st.id===tt);if(Ct&&St){const st=Ct.position.angle;let lt=St.position.angle-st;for(;lt>180;)lt-=360;for(;lt<-180;)lt+=360;const is=(lt>0?14:-14)*(Math.PI/180),Tt=Math.atan2(Ue,Ne)+is;kt=M+Math.cos(Tt)*it,$t=Z+Math.sin(Tt)*it}}}return{x:kt,y:$t}}const re=C.aspects[0],a=C.aspects[1],te=H(re),pe=H(a),xe=C.edges.find(Ie=>Ie.id===re),we=C.edges.find(Ie=>Ie.id===a),ke=(xe==null?void 0:xe.cost)||3,Ce=(we==null?void 0:we.cost)||3,Te=ke+Ce,De=ke/Te;let We=te.x+(pe.x-te.x)*De,Ae=te.y+(pe.y-te.y)*De;if(ke===2&&Ce===4||ke===4&&Ce===2){const Ie=We-M,Le=Ae-Z;We=M+Ie*.875,Ae=Z+Le*.875}const Ye=60;return C.id==="seeker"?Ae-=Ye:C.id==="heretic"?(We+=Ye*Math.cos(-Math.PI/6),Ae+=Ye*Math.sin(Math.PI/6)):C.id==="cutthroat"&&(We+=Ye*Math.cos(5*Math.PI/6),Ae+=Ye*Math.sin(Math.PI/6)),{x:We,y:Ae}},Q=(C,M,Z=.15)=>{const re=M.x-C.x,a=M.y-C.y,te=Math.sqrt(re*re+a*a),pe=re/te,xe=a/te,we=30,ke=18,Ce=C.x+pe*we,Te=C.y+xe*we,De=M.x-pe*ke,We=M.y-xe*ke,Ae=-xe,Ye=pe,Ie=(Ce+De)/2,Le=(Te+We)/2,Ne=Ie+Ae*te*Z,Ue=Le+Ye*te*Z;return`M ${Ce},${Te} Q ${Ne},${Ue} ${De},${We}`},$=C=>{const M=ne(C),Z=p.value.race===C.id,re=h.value.includes(C.id);if(D.value&&Z){const a=fe/2,te=fe/2;return`translate(${a}, ${te}) scale(2.5)`}return Be.value&&Z&&!D.value?`translate(${M.x}, ${M.y}) scale(1.2)`:Be.value&&re&&!D.value?`translate(${M.x}, ${M.y}) scale(1.1)`:`translate(${M.x}, ${M.y})`},w=C=>{C.preventDefault();const Z=C.currentTarget.getBoundingClientRect(),re=C.clientX-Z.left,a=C.clientY-Z.top,te=-C.deltaY*.001,pe=Math.max(1,Math.min(4,_.value+te));if(pe!==_.value){const xe=re/Z.width*Ve,we=a/Z.height*Ve,ke=Ve/2,Ce=fe/2,Te=(xe-ke-E.value.x)/_.value+Ce,De=(we-ke-E.value.y)/_.value+Ce;E.value={x:xe-ke-(Te-Ce)*pe,y:we-ke-(De-Ce)*pe},_.value=pe}},ee=C=>{if(C.button===0){Y.value=!1;const M={x:C.clientX,y:C.clientY};v.value=!0,A.value={x:C.clientX-E.value.x,y:C.clientY-E.value.y,initialX:M.x,initialY:M.y}}else(C.button===1||C.button===2)&&(C.preventDefault(),Y.value=!1,v.value=!0,A.value={x:C.clientX-E.value.x,y:C.clientY-E.value.y,initialX:C.clientX,initialY:C.clientY})},be=C=>{if(v.value){const M=C.clientX-A.value.initialX,Z=C.clientY-A.value.initialY;!Y.value&&(Math.abs(M)>ct||Math.abs(Z)>ct)&&(Y.value=!0),Y.value&&(E.value={x:C.clientX-A.value.x,y:C.clientY-A.value.y})}},_e=()=>{v.value=!1,setTimeout(()=>{Y.value=!1},10)},Se=C=>{if(C.touches.length===1){const M=C.touches[0];v.value=!0,Y.value=!1,A.value={x:M.clientX-E.value.x,y:M.clientY-E.value.y,initialX:M.clientX,initialY:M.clientY}}else if(C.touches.length===2){const M=C.touches[0],Z=C.touches[1],re=Math.hypot(Z.clientX-M.clientX,Z.clientY-M.clientY);se.value=re,V.value=_.value,W.value={...E.value},Y.value=!1}},Ee=C=>{if(C.preventDefault(),C.touches.length===1&&v.value){const M=C.touches[0],Z=M.clientX-A.value.initialX,re=M.clientY-A.value.initialY;!Y.value&&(Math.abs(Z)>ct||Math.abs(re)>ct)&&(Y.value=!0),Y.value&&(E.value={x:M.clientX-A.value.x,y:M.clientY-A.value.y})}else if(C.touches.length===2){const M=C.touches[0],Z=C.touches[1],re=Math.hypot(Z.clientX-M.clientX,Z.clientY-M.clientY),a=C.currentTarget.closest("svg");if(!a)return;const te=a.getBoundingClientRect(),pe=(M.clientX+Z.clientX)/2,xe=(M.clientY+Z.clientY)/2,we=(pe-te.left)/te.width*Ve,ke=(xe-te.top)/te.height*Ve,Ce=Math.max(1,Math.min(4,V.value*(re/se.value))),Te=Ve/2,De=fe/2,We=(we-Te-W.value.x)/V.value+De,Ae=(ke-Te-W.value.y)/V.value+De;E.value={x:we-Te-(We-De)*Ce,y:ke-Te-(Ae-De)*Ce},_.value=Ce,Y.value=!0}},qe=()=>{v.value=!1,setTimeout(()=>{Y.value=!1},10)},Qe=j(()=>{const C=Ve/2,M=fe/2;return`translate(${C+E.value.x}, ${C+E.value.y}) scale(${_.value}) translate(${-M}, ${-M})`}),Nt=()=>{S.reset(),u("close")},Ut=()=>{u("created",p.value),S.reset()},gt=C=>{Y.value||(S.setGender(C),d.value=!0,setTimeout(()=>{dt(),setTimeout(()=>{d.value=!1},100)},400))},Gt=C=>{if(Y.value)return;const M=Date.now(),Z=T.value===C&&M-b.value<Xc;b.value=M,T.value=C,Z&&y.value===2?(S.setRace(C),B.value=null,yt()):(S.setRace(C),B.value=null)},Jt=C=>{Y.value||(y.value===2?B.value===C?B.value=null:(B.value=C,S.setRace(null)):y.value===3&&S.setSubrace(`${p.value.race}-${C}`))},Zt=C=>{Y.value||S.setSubrace(`${p.value.race}-${C}`)},Kt=C=>{Y.value||S.setClass(C)},Qt=C=>{Y.value||y.value===2&&(S.setRace(null),B.value=null)},es=C=>{if(Y.value)return;const M=C.currentTarget.closest("svg");if(!M)return;const Z=M.getBoundingClientRect(),re=C.clientX-Z.left,a=C.clientY-Z.top,te=re/Z.width*Ve,pe=a/Z.height*Ve,xe=Ve/2,we=fe/2,ke=(te-xe-E.value.x)/_.value+we,Ce=(pe-xe-E.value.y)/_.value+we,Te=_.value<2.5?3.2:1.9;E.value={x:te-xe-(ke-we)*Te,y:pe-xe-(Ce-we)*Te},_.value=Te},dt=()=>{I.value&&y.value<Pt&&y.value++},ts=()=>{y.value>1&&(y.value===3&&p.value.race?(D.value=!0,X.value="backward",setTimeout(()=>{D.value=!1,y.value--},600)):y.value--)},yt=()=>{I.value&&(y.value===4&&(S.setStats(i.value.stats),S.setSkills(i.value.skills)),y.value===2&&p.value.race||y.value===3&&p.value.subrace||y.value===4&&p.value.class?(D.value=!0,X.value="forward",setTimeout(()=>{dt(),setTimeout(()=>{D.value=!1},100)},600)):dt())};j(()=>{if(y.value<3||!le.value)return null;const C=ne(le.value),M=fe/2,Z=fe/2;return{translateX:M-C.x,translateY:Z-C.y,scale:2.5}});const ss=j(()=>y.value===1),Be=j(()=>y.value===2),ls=j(()=>y.value===3);return j(()=>y.value===4),(C,M)=>{var Z,re;return t(),s("div",li,[e("div",{class:"canvas-container relative overflow-hidden touch-none bg-slate-950 flex-shrink-0",onWheel:w,onMousedown:ee,onMousemove:be,onMouseup:_e,onMouseleave:_e,onTouchstart:Se,onTouchmove:Ee,onTouchend:qe,onContextmenu:M[7]||(M[7]=ye(()=>{},["prevent"]))},[(t(),s("svg",{viewBox:`0 0 ${Ve} ${Ve}`,class:"w-full h-full",preserveAspectRatio:"xMidYMid meet"},[e("defs",null,[(t(!0),s(N,null,K(c(f),a=>(t(),s("clipPath",{key:`clip-${a.id}`,id:`clip-${a.id}`},[e("polygon",{points:ge(0,0,48)},null,8,ai)],8,oi))),128)),e("clipPath",ii,[e("polygon",{points:ge(0,0,120)},null,8,ci)])]),e("g",{transform:Qe.value,class:G(["canvas-group",{panning:v.value}])},[e("rect",{x:"0",y:"0",width:fe,height:fe,fill:"#0f172a",class:"cursor-default",onClick:Qt,onDblclick:es},null,32),ss.value||d.value?(t(),s("g",di,[e("g",{class:G(["gender-option",{"gender-sliding-left":d.value}])},[e("image",{x:fe/4-280,y:fe/2-350,width:"560",height:"700",href:c(At)("male"),class:G(["cursor-pointer opacity-90 hover:opacity-100 transition-opacity",{"brightness-110":p.value.gender==="m"}]),onClick:M[0]||(M[0]=a=>gt("m"))},null,10,ui)],2),e("g",{class:G(["gender-option",{"gender-sliding-right":d.value}])},[e("image",{x:fe*3/4-280,y:fe/2-350,width:"560",height:"700",href:c(At)("female"),class:G(["cursor-pointer opacity-90 hover:opacity-100 transition-opacity",{"brightness-110":p.value.gender==="f"}]),onClick:M[1]||(M[1]=a=>gt("f"))},null,10,fi)],2)])):g("",!0),y.value>=2&&y.value!==3&&y.value!==4?(t(),s("g",vi,[(t(!0),s(N,null,K(c(x),a=>(t(),s("g",{key:a.id},[e("circle",{cx:H(a.id).x,cy:H(a.id).y,r:"32",fill:a.color,"fill-opacity":B.value===a.id?.8:o.value.includes(a.id)?.7:.4,class:"transition-all duration-300 cursor-pointer",onClick:ye(te=>Jt(a.id),["stop"])},null,8,pi),B.value===a.id?(t(),s("circle",{key:0,cx:H(a.id).x,cy:H(a.id).y,r:"36",fill:"none",stroke:a.color,"stroke-width":"2",opacity:"0.9",class:"pointer-events-none animate-pulse"},null,8,mi)):g("",!0),(t(),s("foreignObject",{x:H(a.id).x-16,y:H(a.id).y-16,width:"32",height:"32",class:"pointer-events-none"},[e("div",{class:G(["flex items-center justify-center w-full h-full transition-opacity duration-300",B.value===a.id?"opacity-90":o.value.includes(a.id)?"opacity-80":"opacity-50"])},[k(c(q),{icon:a.icon,class:"text-2xl"},null,8,["icon"])],2)],8,hi)),e("text",{x:H(a.id).x,y:H(a.id).y+fe*.055,"text-anchor":"middle",class:G(["text-xs font-medium select-none transition-all duration-300 pointer-events-none",B.value===a.id?"fill-white font-semibold":o.value.includes(a.id)?"fill-slate-100":"fill-slate-300"])},n(a.name),11,xi)]))),128))])):g("",!0),Be.value&&!D.value?(t(),s("g",bi,[(t(!0),s(N,null,K(c(f),a=>(t(),s("line",{key:`line1-${a.id}`,x1:ne(a).x,y1:ne(a).y,x2:H(a.position.aspects[0]).x,y2:H(a.position.aspects[0]).y,stroke:ce(a.position.aspects[0]),"stroke-opacity":p.value.race===a.id?.5:.15,"stroke-width":"2",class:"transition-all duration-300"},null,8,gi))),128)),(t(!0),s(N,null,K(c(f),a=>(t(),s("line",{key:`line2-${a.id}`,x1:ne(a).x,y1:ne(a).y,x2:H(a.position.aspects[1]).x,y2:H(a.position.aspects[1]).y,stroke:ce(a.position.aspects[1]),"stroke-opacity":p.value.race===a.id?.5:.15,"stroke-width":"2",class:"transition-all duration-300"},null,8,yi))),128))])):g("",!0),Be.value||D.value?(t(),s("g",_i,[(t(!0),s(N,null,K(c(f),a=>(t(),s("g",{key:a.id,class:G(["cursor-pointer",D.value?"":"transition-all duration-300"]),style:ue(D.value&&p.value.race!==a.id&&X.value==="forward"?"opacity: 0; transition: opacity 600ms ease-out;":D.value&&X.value==="backward"&&p.value.race!==a.id?"opacity: 0; transition: opacity 600ms ease-in;":D.value&&X.value==="backward"&&p.value.race===a.id?"opacity: 1;":""),onClick:te=>Gt(a.id),onMouseenter:te=>O.value=a.id,onMouseleave:M[2]||(M[2]=te=>O.value=null)},[e("g",{transform:$(a),style:ue(D.value&&p.value.race===a.id?"transition: transform 600ms cubic-bezier(0.4, 0, 0.2, 1);":!D.value&&(p.value.race===a.id||h.value.includes(a.id))?"transition: transform 200ms ease-out;":"")},[e("g",{"clip-path":`url(#clip-${a.id})`},[e("image",{href:$e(a.id,p.value.gender),x:"-48",y:"-48",width:"96",height:"96",preserveAspectRatio:"xMidYMid slice",onError:te=>he(te,a.id,p.value.gender)},null,40,Ci)],8,wi),e("polygon",{points:ge(0,0,48),fill:"none",stroke:p.value.race===a.id&&Be.value?"white":h.value.includes(a.id)&&Be.value?"#fbbf24":O.value===a.id&&Be.value?"#64748b":"#1e293b","stroke-width":p.value.race===a.id&&Be.value||h.value.includes(a.id)&&Be.value?2.5:2,opacity:p.value.race===a.id&&Be.value?.9:h.value.includes(a.id)&&Be.value?.85:O.value===a.id&&Be.value?.8:.6,class:"transition-all duration-200"},null,8,Si)],12,$i)],46,ki))),128))])):g("",!0),ls.value&&le.value?(t(),s("g",Ti,[ie.value?(t(),s("line",{key:0,x1:fe/2,y1:fe/2,x2:H(ie.value).x,y2:H(ie.value).y,stroke:ce(ie.value),"stroke-width":"3",opacity:"0.5",class:"transition-all duration-300"},null,8,Mi)):g("",!0),(t(!0),s(N,null,K(c(z),a=>(t(),s("g",{key:`aspect-bg-${a}`,class:"pointer-events-none"},[e("circle",{cx:H(a).x,cy:H(a).y,r:"36",fill:ce(a),"fill-opacity":ie.value===a?.6:.3,stroke:ce(a),"stroke-opacity":ie.value===a?.4:.2,"stroke-width":"1",class:"transition-all duration-300"},null,8,Di)]))),128)),(t(!0),s(N,null,K(c(x),a=>(t(),s("g",{key:`aspect-full-${a.id}`,class:"pointer-events-none"},[(t(),s("foreignObject",{x:H(a.id).x-16,y:H(a.id).y-16,width:"32",height:"32"},[e("div",Ei,[k(c(q),{icon:a.icon,class:"text-2xl"},null,8,["icon"])])],8,Ai)),e("text",{x:H(a.id).x,y:H(a.id).y+fe*.055,"text-anchor":"middle",class:"text-xs font-medium fill-slate-200 select-none"},n(a.name),9,qi)]))),128)),e("g",{transform:`translate(${fe/2}, ${fe/2})`},[e("g",Pi,[e("image",{href:$e(le.value.id,p.value.gender,ie.value),x:"-120",y:"-120",width:"240",height:"240",preserveAspectRatio:"xMidYMid slice",onError:M[3]||(M[3]=a=>he(a,le.value.id,p.value.gender,ie.value)),class:"transition-opacity duration-300"},null,40,Oi)]),e("polygon",{points:ge(0,0,120),fill:"none",stroke:ie.value?ce(ie.value):"white","stroke-width":ie.value?5:3,opacity:ie.value?.95:.7,class:"transition-all duration-300"},null,8,Bi)],8,ji),(t(!0),s(N,null,K(c(z),a=>(t(),s("g",{key:`subrace-${a}`},[e("circle",{cx:H(a).x,cy:H(a).y,r:"40",fill:"transparent",class:"cursor-pointer",onClick:te=>Zt(a),onMouseenter:te=>ae.value=a,onMouseleave:M[4]||(M[4]=te=>ae.value=null)},null,40,Wi),ae.value===a&&ie.value!==a?(t(),s("circle",{key:0,cx:H(a).x,cy:H(a).y,r:"36",fill:ce(a),opacity:"0.5",class:"pointer-events-none"},null,8,Vi)):g("",!0),ie.value===a?(t(),s("circle",{key:1,cx:H(a).x,cy:H(a).y,r:"38",fill:"none",stroke:ce(a),"stroke-width":"3",opacity:"0.8",class:"pointer-events-none"},null,8,Xi)):g("",!0)]))),128))])):g("",!0),y.value===4?(t(),s("g",Ri,[e("rect",{x:"0",y:"0",width:fe,height:fe,fill:"transparent",class:"cursor-default",onClick:M[5]||(M[5]=()=>{p.value.class&&c(S).setClass(null)})}),e("circle",{cx:fe/2,cy:fe/2,r:fe*.32,fill:"none",stroke:"#ffffff","stroke-width":"8",opacity:"0.075",class:"pointer-events-none"},null,8,Ii),(t(!0),s(N,null,K(c(x),a=>{var te,pe;return t(),s("g",{key:`aspect-bg-${a.id}`},[e("circle",{cx:H(a.id).x,cy:H(a.id).y,r:"18",fill:ce(a.id),"fill-opacity":p.value.class?(te=c(U).find(xe=>xe.id===p.value.class))!=null&&te.aspects.includes(a.id)?.35:.15:.4,class:"pointer-events-none transition-all duration-300"},null,8,Hi),(t(),s("foreignObject",{x:H(a.id).x-16,y:H(a.id).y-16,width:"32",height:"32",class:"pointer-events-none"},[e("div",{class:G(["flex items-center justify-center w-full h-full transition-opacity duration-300",p.value.class?(pe=c(U).find(xe=>xe.id===p.value.class))!=null&&pe.aspects.includes(a.id)?"opacity-60":"opacity-30":"opacity-70"])},[k(c(q),{icon:a.icon,class:"text-2xl"},null,8,["icon"])],2)],8,Yi))])}),128)),(t(!0),s(N,null,K(c(U),a=>(t(),s("g",{key:`class-lines-${a.id}`,class:"pointer-events-none"},[(t(!0),s(N,null,K(a.edges.filter(te=>te.type==="aspect"),te=>(t(),s(N,{key:`edge-${a.id}-${te.id}`},[p.value.class===a.id?(t(),s("path",{key:0,d:Q(P(a),H(te.id)),stroke:ce(te.id),"stroke-opacity":"0.6","stroke-width":"8",fill:"none",class:"transition-all duration-300",style:{filter:"blur(4px)"}},null,8,zi)):g("",!0),e("path",{d:Q(P(a),H(te.id)),stroke:p.value.class===a.id?ce(te.id):R.value===a.id?"#64748b":"#475569","stroke-opacity":p.value.class===a.id?.9:R.value===a.id?.5:.2,"stroke-width":p.value.class===a.id?3:R.value===a.id?2:1.5,fill:"none",class:"transition-all duration-300"},null,8,Fi)],64))),128))]))),128)),p.value.class?(t(),s("rect",{key:0,x:"0",y:"0",width:fe,height:fe,fill:"#0a0f1a",opacity:"0.85",class:"transition-opacity duration-300 pointer-events-none"})):g("",!0),(t(!0),s(N,null,K(c(U),a=>(t(),s("g",{key:`class-${a.id}`},[e("defs",null,[e("linearGradient",{id:`class-gradient-${a.id}`,gradientTransform:`rotate(${F(a)}, 0.5, 0.5)`},[e("stop",{offset:"0%","stop-color":ce(a.aspects[0])},null,8,Ni),e("stop",{offset:"15%","stop-color":ce(a.aspects[0])},null,8,Ui),e("stop",{offset:"85%","stop-color":ce(a.aspects[a.aspects.length>1?1:0])},null,8,Gi),e("stop",{offset:"100%","stop-color":ce(a.aspects[a.aspects.length>1?1:0])},null,8,Ji)],8,Li),e("clipPath",{id:`hexclip-${a.id}`},[e("polygon",{points:ge(0,0,30)},null,8,Ki)],8,Zi)]),e("g",{transform:`translate(${P(a).x}, ${P(a).y}) scale(${p.value.class===a.id?1.5:1})`,class:G(["cursor-pointer transition-all duration-300",{"opacity-100":!p.value.class||p.value.class===a.id,"opacity-40":p.value.class&&p.value.class!==a.id}]),onClick:te=>Kt(a.id),onMouseenter:te=>R.value=a.id,onMouseleave:M[6]||(M[6]=te=>R.value=null)},[e("circle",{cx:"0",cy:"0",r:"30",fill:`url(#class-gradient-${a.id})`,"fill-opacity":p.value.class===a.id?.4:.25,"clip-path":`url(#hexclip-${a.id})`,class:"transition-all duration-300"},null,8,ec),e("polygon",{points:ge(0,0,30),fill:"none",stroke:"#ffffff","stroke-opacity":p.value.class===a.id?.3:.15,"stroke-width":"1",class:"transition-all duration-300"},null,8,tc),(t(),s("foreignObject",{x:p.value.class===a.id?-38:-30,y:p.value.class===a.id?-38:-30,width:p.value.class===a.id?76:60,height:p.value.class===a.id?76:60,class:"pointer-events-none transition-all duration-300"},[e("img",{src:c(Et)(a.id),style:{width:"100%",height:"100%",opacity:1,transition:"all 0.3s"}},null,8,lc)],8,sc))],42,Qi)]))),128)),p.value.class?(t(),s("g",nc,[(t(!0),s(N,null,K(((Z=c(U).find(a=>a.id===p.value.class))==null?void 0:Z.aspects)||[],a=>(t(),s("g",{key:`highlight-${a}`},[e("circle",{cx:H(a).x,cy:H(a).y,r:"22",fill:"none",stroke:ce(a),"stroke-width":"2.5",opacity:"0.9",class:"transition-all duration-300"},null,8,oc)]))),128))])):g("",!0)])):g("",!0)],10,ri)],8,ni))],32),e("div",ac,[e("div",ic,[e("div",cc,[y.value>1?(t(),s("button",{key:0,onClick:ts,class:"flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700 border border-slate-700/50 text-slate-300 transition"},[k(c(q),{icon:"mdi:arrow-left",class:"w-5 h-5"}),M[15]||(M[15]=e("span",{class:"text-sm font-medium"},"Назад",-1))])):(t(),s("div",rc)),e("button",{onClick:Nt,class:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-900/20 hover:bg-red-900/30 border border-red-700/50 text-red-300 transition"},[k(c(q),{icon:"mdi:close",class:"w-5 h-5"}),M[16]||(M[16]=e("span",{class:"text-sm font-medium"},"Закрыть",-1))])])]),e("div",dc,[y.value!==4&&y.value!==5?(t(),s("div",uc,[e("h2",fc,n(y.value===1?"Выберите пол":y.value===2?"Выберите расу":y.value===3?"Выберите подрасу":"Выберите навыки"),1),e("p",vc,n(y.value===1?"Выберите пол персонажа для начала":y.value===2?"Выберите расу, расположенную между двумя аспектами":y.value===3?"Подраса добавляет связь с одним из аспектов":"Выберите навыки персонажа"),1)])):g("",!0),e("div",pc,[y.value===2&&le.value?(t(),s("div",mc,[e("div",null,[e("h3",hc,n(le.value.name),1),e("p",xc,n(le.value.description),1)]),e("div",null,[M[17]||(M[17]=e("h4",{class:"text-sm font-semibold text-slate-400 mb-2"},"Особенности:",-1)),e("div",bc,[(t(!0),s(N,null,K(le.value.traits,a=>(t(),s("span",{key:a,class:"px-2 py-1 rounded text-xs bg-sky-500/20 text-sky-300"},n(a),1))),128))])])])):g("",!0),y.value===3&&me.value?(t(),s("div",gc,[e("div",null,[e("h3",yc,n(me.value.name),1),e("p",_c,n(me.value.description),1)])])):g("",!0),y.value===4&&p.value.class?(t(),s("div",kc,[c(U).find(a=>a.id===p.value.class)?(t(),s("div",$c,[e("div",wc,[e("div",Cc,[e("div",null,[e("h3",Sc,n(c(U).find(a=>a.id===p.value.class).name[p.value.gender]),1),e("p",Tc,n(c(U).find(a=>a.id===p.value.class).nameEn),1)]),e("img",{src:c(Et)(p.value.class),alt:c(U).find(a=>a.id===p.value.class).name[p.value.gender],class:"w-full aspect-square object-cover rounded-lg border-2 border-slate-700"},null,8,Mc)]),e("div",Dc,[k(tn,{stats:i.value.stats,size:360,onSwapStats:M[8]||(M[8]=a=>{var te;return(te=l.value)==null?void 0:te.swapStats()})},null,8,["stats"])])]),e("div",Ac,[e("div",Ec,[M[19]||(M[19]=Wt('<div class="flex-1 text-sm text-slate-400 leading-relaxed min-w-[280px]" data-v-510fce57><p class="font-semibold text-slate-300 mb-2" data-v-510fce57>Как рассчитываются бонусы проверок:</p><p class="mb-2" data-v-510fce57> Каждая проверка связана с аспектом и имеет соседние аспекты. Бонус проверки равен максимуму из двух формул: </p><ul class="list-disc list-inside space-y-1 ml-2" data-v-510fce57><li data-v-510fce57><span class="font-mono text-sky-300" data-v-510fce57>Основной</span>: полное значение аспекта + половина (округлённая вниз) каждого соседнего</li><li data-v-510fce57><span class="font-mono text-purple-300" data-v-510fce57>Альтернативный</span>: половина (округлённая вниз) противоположного аспекта</li></ul></div>',1)),e("button",{onClick:M[9]||(M[9]=a=>{var te;return(te=l.value)==null?void 0:te.swapStats()}),class:"flex-shrink-0 flex items-center gap-2 px-4 py-2.5 rounded-lg bg-slate-700/50 hover:bg-slate-700 border border-slate-600/50 text-slate-300 transition"},[k(c(q),{icon:"mdi:swap-horizontal",class:"w-5 h-5"}),M[18]||(M[18]=e("span",{class:"text-sm font-medium"},"Поменять 6 ↔ 4",-1))])])]),(re=c(U).find(a=>a.id===p.value.class))!=null&&re.description?(t(),s("div",qc,[e("p",jc,n(c(U).find(a=>a.id===p.value.class).description),1)])):g("",!0),k(Ol,{"class-id":p.value.class,modelValue:i.value,"onUpdate:modelValue":M[10]||(M[10]=a=>i.value=a),ref_key:"statsAndSkillsRef",ref:l,"show-stats":!1,"show-skills":!0},null,8,["class-id","modelValue"])])):g("",!0)])):g("",!0),y.value===5?(t(),s("div",Pc,[k(Ca,{modelValue:p.value.equipment,"onUpdate:modelValue":M[11]||(M[11]=a=>p.value.equipment=a),onValidationChange:M[12]||(M[12]=a=>r.value=a)},null,8,["modelValue"])])):g("",!0),y.value===6?(t(),s("div",Oc,[k(Qa,{name:p.value.name,portrait:p.value.portrait,"onUpdate:name":M[13]||(M[13]=a=>c(S).setName(a)),"onUpdate:portrait":M[14]||(M[14]=a=>c(S).setPortrait(a))},null,8,["name","portrait"])])):g("",!0)])]),e("div",Bc,[y.value<Pt?(t(),s("button",{key:0,type:"button",class:G(["flex-1 px-4 py-2 rounded-lg font-semibold transition",I.value?"bg-sky-500/20 border border-sky-400/60 text-sky-100 hover:bg-sky-500/30":"bg-slate-800 border border-slate-700 text-slate-500 cursor-not-allowed"]),disabled:!I.value,onClick:yt},n(y.value===2?"Подтвердить расу":y.value===3?"Подтвердить подрасу":y.value===4?"Подтвердить класс":y.value===5?"Подтвердить снаряжение":y.value===6?"Завершить":"Далее"),11,Wc)):(t(),s("button",{key:1,type:"button",class:"flex-1 px-4 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/60 text-emerald-100 font-semibold hover:bg-emerald-500/30 transition",disabled:!I.value,onClick:Ut}," Создать персонажа ",8,Vc))])])])}}},Ic=Oe(Rc,[["__scopeId","data-v-510fce57"]]),Hc={__name:"CharacterWizard",emits:["close","created"],setup(m,{emit:L}){const u=L,S=nt(),y=Ke(),p=ot(),_=v=>{const A=v.portrait?vt(v.portrait):ds(v.name||"Unknown"),Y=v.equipment||{},se=Y.weapons||[];se.slice(0,2),se.slice(2).map(O=>({id:O,category:"weapon",equipped:!1}));const V=vs(v.stats||{}),W=y.createFromWizard(S.userId,S.nickname,{name:v.name||"Безымянный",portrait:v.portrait,gender:v.gender,race:v.race,subrace:v.subrace,class:v.class,avatar:A,stats:v.stats,skills:v.skills,equipment:{armor:Y.armor||"clothes",weapons:se,items:[],wealth:Y.wealth||5},combat:{hp:V,maxHp:V,mp:0,maxMp:0}});setTimeout(()=>{p.sendCharactersToMaster()},100),u("created",W),u("close")},E=()=>{S.closeCharacterWizard(),u("close")};return(v,A)=>(t(),Me(Ic,{onClose:E,onCreated:_}))}},Yc={class:"equipment-manager"},zc={class:"weapon-sets-selector bg-slate-900/60 border border-white/10 rounded-2xl p-4 mb-4"},Fc={class:"flex gap-2 flex-wrap"},Lc=["onClick"],Nc={class:"armor-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 mb-4"},Uc={class:"flex items-center justify-between mb-3"},Gc={key:0,class:"p-3 bg-slate-950/40 rounded-lg border border-slate-700"},Jc={class:"font-bold text-white mb-1"},Zc={class:"grid grid-cols-2 gap-2 text-xs"},Kc={class:"flex items-center justify-between p-2 bg-slate-900/60 rounded"},Qc={class:"text-emerald-400 font-bold"},er={class:"flex items-center justify-between p-2 bg-slate-900/60 rounded"},tr={class:"text-blue-400 font-bold"},sr={class:"weapons-section bg-slate-900/60 border border-white/10 rounded-2xl p-4"},lr={class:"flex items-center justify-between mb-3"},nr={class:"text-sm font-bold text-slate-400 uppercase flex items-center gap-2"},or={class:"flex items-center justify-between text-xs mb-1"},ar={class:"flex items-center justify-between text-xs"},ir={key:0,class:"mb-3 p-2 rounded-lg bg-red-900/20 border border-red-700"},cr={key:1,class:"space-y-2"},rr={class:"flex-1"},dr={class:"font-bold text-white text-sm"},ur={class:"text-xs text-slate-400"},fr={key:0},vr={key:1},pr={key:2},mr={key:3,class:"mt-1 text-[10px]"},hr={key:0},xr={key:1},br={key:2},gr=["onClick"],yr={key:2,class:"text-slate-500 text-sm text-center py-4"},_r={class:"bg-slate-900 rounded-2xl border border-white/10 max-w-2xl w-full max-h-[80vh] overflow-y-auto"},kr={class:"sticky top-0 bg-slate-900 border-b border-white/10 p-4 flex items-center justify-between"},$r={class:"p-4 space-y-2"},wr=["onClick"],Cr={class:"font-bold text-white mb-1"},Sr={class:"text-xs text-slate-400 mb-2"},Tr={class:"grid grid-cols-4 gap-2 text-xs"},Mr={class:"text-center"},Dr={class:"text-emerald-400 font-bold"},Ar={class:"text-center"},Er={class:"text-blue-400 font-bold"},qr={class:"text-center"},jr={class:"text-center"},Pr={class:"bg-slate-900 rounded-2xl border border-white/10 max-w-4xl w-full max-h-[80vh] overflow-y-auto"},Or={class:"sticky top-0 bg-slate-900 border-b border-white/10 p-4 flex items-center justify-between"},Br={class:"text-xl font-bold"},Wr={class:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-3"},Vr=["onClick","disabled"],Xr={class:"flex items-start justify-between mb-1"},Rr={class:"font-bold text-white"},Ir={key:0,class:"text-red-400 text-xs"},Hr={class:"text-xs text-slate-400 mb-2 line-clamp-2"},Yr={class:"grid grid-cols-4 gap-2 text-xs"},zr={key:0,class:"text-center"},Fr={class:"text-red-400 font-bold"},Lr={key:1,class:"text-center"},Nr={class:"text-emerald-400 font-bold"},Ur={key:2,class:"col-span-4 p-2 bg-slate-900/60 rounded"},Gr={class:"space-y-1 text-[9px]"},Jr={key:0,class:"flex justify-between"},Zr={class:"text-emerald-400 font-bold"},Kr={class:"text-sky-400 font-bold"},Qr={key:1,class:"flex justify-between"},ed={class:"text-emerald-400 font-bold"},td={class:"text-sky-400 font-bold"},sd={key:2,class:"flex justify-between"},ld={class:"text-emerald-400 font-bold"},nd={class:"text-sky-400 font-bold"},od={key:3,class:"text-center"},ad={class:"text-cyan-400 font-bold"},id={key:4,class:"text-center"},cd={class:"text-purple-400 font-bold"},rd={__name:"EquipmentManager",props:{character:{type:Object,required:!0}},emits:["update:character"],setup(m,{emit:L}){const u=m,S=L,y=j(()=>Re.items.filter(d=>d.category==="armor")),p=j(()=>Re.items.filter(d=>d.category==="weapon"||d.category==="shield")),_=j({get:()=>{var d;return((d=u.character.equipment)==null?void 0:d.activeSetIndex)||0},set:d=>{W({activeSetIndex:d})}}),E=j(()=>{var d,b;return((b=(d=u.character.equipment)==null?void 0:d.weaponSets)==null?void 0:b[_.value])||{name:"Набор 1",weapons:[]}}),v=j(()=>{var b;const d=((b=u.character.equipment)==null?void 0:b.armor)||"clothes";return y.value.find(T=>T.id===d)}),A=j(()=>E.value.weapons.map(d=>p.value.find(b=>b.id===d)).filter(Boolean)),Y=j(()=>{const d=A.value,b=d.reduce((i,r)=>i+(r.hands||0),0),T=d.filter(i=>i.length===2).length,l=[];return b>2&&l.push(`Сумма рук превышает 2 (текущая: ${b})`),T>1&&l.push(`Нельзя держать больше одного длинного оружия (текущее: ${T})`),{valid:l.length===0,errors:l,totalHands:b,longWeaponsCount:T}}),se=d=>{const b=p.value.find(r=>r.id===d);if(!b)return!1;const T=[...A.value,b],l=T.reduce((r,f)=>r+(f.hands||0),0),i=T.filter(r=>r.length===2).length;return l<=2&&i<=1},V=j(()=>{var x,z,U,le,me;const d=((x=u.character.equipment)==null?void 0:x.wealth)||0,b=((z=u.character.equipment)==null?void 0:z.epoch)||0,T=((U=u.character.inventory)==null?void 0:U.map(ie=>typeof ie=="string"?ie:ie.id))||[],l=((me=(le=u.character.equipment)==null?void 0:le.weaponSets)==null?void 0:me.flatMap(ie=>ie.weapons))||[],i=[...new Set([...l,...T])],r=p.value.filter(ie=>i.includes(ie.id)),f=p.value.filter(ie=>{if(i.includes(ie.id))return!1;const o=(ie.wealth||ie.price||0)<=d,h=(ie.epoch||0)<=b;return o&&h});return[...r,...f]}),W=d=>{const b={...u.character,equipment:{...u.character.equipment,...d}};S("update:character",b)},O=d=>{W({armor:d})},ae=d=>{var l;if(!se(d))return;const b=[...((l=u.character.equipment)==null?void 0:l.weaponSets)||[]],T={...b[_.value]};T.weapons.includes(d)||(T.weapons=[...T.weapons,d],b[_.value]=T,W({weaponSets:b}))},B=d=>{var l;const b=[...((l=u.character.equipment)==null?void 0:l.weaponSets)||[]],T={...b[_.value]};T.weapons=T.weapons.filter(i=>i!==d),b[_.value]=T,W({weaponSets:b})},R=()=>{var T;const d=[...((T=u.character.equipment)==null?void 0:T.weaponSets)||[]],b=d.length+1;d.push({name:`Набор ${b}`,weapons:[]}),W({weaponSets:d})},D=J(!1),X=J(!1);return(d,b)=>{var T;return t(),s("div",Yc,[e("div",zc,[b[6]||(b[6]=e("h3",{class:"text-sm font-bold text-slate-400 uppercase mb-3"},"Активный набор",-1)),e("div",Fc,[(t(!0),s(N,null,K(((T=m.character.equipment)==null?void 0:T.weaponSets)||[],(l,i)=>(t(),s("button",{key:i,onClick:r=>_.value=i,class:G(["flex-1 min-w-[120px] px-4 py-2 rounded-lg font-semibold transition-all",_.value===i?"bg-amber-500/20 border-2 border-amber-400 text-amber-100":"bg-slate-800/40 border border-slate-700 text-slate-400 hover:bg-slate-800/60"])},n(l.name),11,Lc))),128)),e("button",{onClick:R,class:"px-4 py-2 rounded-lg border border-dashed border-slate-600 text-slate-500 hover:border-amber-500 hover:text-amber-400 transition-all",title:"Добавить набор (требуется особая способность)"}," + Новый набор ")])]),e("div",Nc,[e("div",Uc,[b[7]||(b[7]=e("h3",{class:"text-sm font-bold text-slate-400 uppercase flex items-center gap-2"},[e("span",null,"🛡️"),oe(" Броня ")],-1)),e("button",{onClick:b[0]||(b[0]=l=>D.value=!0),class:"px-3 py-1 text-xs rounded-lg bg-sky-500/20 border border-sky-400/60 text-sky-100 hover:bg-sky-500/30 transition"}," Сменить ")]),v.value?(t(),s("div",Gc,[e("h4",Jc,n(v.value.name),1),e("div",Zc,[e("div",Kc,[b[8]||(b[8]=e("span",{class:"text-slate-400"},"Защита",-1)),e("span",Qc,n(v.value.defence),1)]),e("div",er,[b[9]||(b[9]=e("span",{class:"text-slate-400"},"Резист",-1)),e("span",tr,n(v.value.resist),1)])])])):g("",!0)]),e("div",sr,[e("div",lr,[e("h3",nr,[b[10]||(b[10]=e("span",null,"⚔️",-1)),oe(" Оружие ("+n(E.value.name)+") ",1)]),e("button",{onClick:b[1]||(b[1]=l=>X.value=!0),class:"px-3 py-1 text-xs rounded-lg bg-amber-500/20 border border-amber-400/60 text-amber-100 hover:bg-amber-500/30 transition"}," Выбрать ")]),e("div",{class:G(["mb-3 p-2 rounded-lg",Y.value.valid?"bg-slate-950/40 border border-slate-700":"bg-red-900/20 border border-red-700"])},[e("div",or,[b[11]||(b[11]=e("span",{class:"text-slate-400"},"Занято рук:",-1)),e("span",{class:G(Y.value.totalHands>2?"text-red-400 font-bold":"text-emerald-400 font-bold")},n(Y.value.totalHands)+" / 2 ",3)]),e("div",ar,[b[12]||(b[12]=e("span",{class:"text-slate-400"},"Длинное оружие:",-1)),e("span",{class:G(Y.value.longWeaponsCount>1?"text-red-400 font-bold":"text-emerald-400 font-bold")},n(Y.value.longWeaponsCount)+" / 1 ",3)])],2),Y.value.valid?g("",!0):(t(),s("div",ir,[(t(!0),s(N,null,K(Y.value.errors,(l,i)=>(t(),s("p",{key:i,class:"text-xs text-red-300"}," ⚠️ "+n(l),1))),128))])),A.value.length?(t(),s("div",cr,[(t(!0),s(N,null,K(A.value,l=>(t(),s("div",{key:l.id,class:"p-3 bg-slate-950/40 rounded-lg border border-slate-700 flex items-center justify-between"},[e("div",rr,[e("h4",dr,n(l.name),1),e("div",ur,[l.attack!==void 0?(t(),s("span",fr,"Атака: "+n(l.attack),1)):g("",!0),l.attack!==void 0&&typeof l.defence!="object"?(t(),s("span",vr," • ")):g("",!0),typeof l.defence!="object"?(t(),s("span",pr,"Защита: "+n(l.defence||0),1)):g("",!0),typeof l.defence=="object"?(t(),s("div",mr,[b[13]||(b[13]=oe(" 🛡️ Защита (удар/снаряд): ",-1)),l.defence.front?(t(),s("span",hr," спереди "+n(l.defence.front.melee)+"/"+n(l.defence.front.ranged),1)):g("",!0),l.defence.side?(t(),s("span",xr,", фланг "+n(l.defence.side.melee)+"/"+n(l.defence.side.ranged),1)):g("",!0),l.defence.back?(t(),s("span",br,", сзади "+n(l.defence.back.melee)+"/"+n(l.defence.back.ranged),1)):g("",!0)])):g("",!0)])]),e("button",{onClick:i=>B(l.id),class:"ml-2 px-2 py-1 text-xs rounded bg-red-500/20 border border-red-400/40 text-red-300 hover:bg-red-500/30"}," Убрать ",8,gr)]))),128))])):(t(),s("p",yr," Оружие не выбрано "))]),(t(),Me(Ge,{to:"body"},[D.value?(t(),s("div",{key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:b[3]||(b[3]=ye(l=>D.value=!1,["self"]))},[e("div",_r,[e("div",kr,[b[14]||(b[14]=e("h2",{class:"text-xl font-bold"},"Выбрать броню",-1)),e("button",{onClick:b[2]||(b[2]=l=>D.value=!1),class:"w-8 h-8 rounded-lg hover:bg-white/10 transition"}," ✕ ")]),e("div",$r,[(t(!0),s(N,null,K(y.value,l=>{var i;return t(),s("button",{key:l.id,onClick:r=>{O(l.id),D.value=!1},class:G(["w-full p-4 rounded-lg border transition text-left",((i=v.value)==null?void 0:i.id)===l.id?"bg-sky-500/20 border-sky-400":"bg-slate-950/40 border-slate-700 hover:bg-slate-800/40"])},[e("h3",Cr,n(l.name),1),e("p",Sr,n(l.desc),1),e("div",Tr,[e("div",Mr,[b[15]||(b[15]=e("div",{class:"text-slate-500"},"Защита",-1)),e("div",Dr,n(l.defence),1)]),e("div",Ar,[b[16]||(b[16]=e("div",{class:"text-slate-500"},"Резист",-1)),e("div",Er,n(l.resist),1)]),e("div",qr,[b[17]||(b[17]=e("div",{class:"text-slate-500"},"Движение",-1)),e("div",{class:G([l.movement>=0?"text-green-400":"text-red-400","font-bold"])},n(l.movement>=0?"+":"")+n(l.movement),3)]),e("div",jr,[b[18]||(b[18]=e("div",{class:"text-slate-500"},"Порывы",-1)),e("div",{class:G([l.bursts>=0?"text-green-400":"text-red-400","font-bold"])},n(l.bursts>=0?"+":"")+n(l.bursts),3)])])],10,wr)}),128))])])])):g("",!0)])),(t(),Me(Ge,{to:"body"},[X.value?(t(),s("div",{key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:b[5]||(b[5]=ye(l=>X.value=!1,["self"]))},[e("div",Pr,[e("div",Or,[e("h2",Br,"Выбрать оружие ("+n(E.value.name)+")",1),e("button",{onClick:b[4]||(b[4]=l=>X.value=!1),class:"w-8 h-8 rounded-lg hover:bg-white/10 transition"}," ✕ ")]),e("div",Wr,[(t(!0),s(N,null,K(V.value,l=>(t(),s("button",{key:l.id,onClick:i=>E.value.weapons.includes(l.id)?B(l.id):ae(l.id),disabled:!E.value.weapons.includes(l.id)&&!se(l.id),class:G(["p-4 rounded-lg border transition text-left",E.value.weapons.includes(l.id)?"bg-amber-500/20 border-amber-400":se(l.id)?"bg-slate-950/40 border-slate-700 hover:bg-slate-800/40":"bg-slate-950/20 border-slate-800 opacity-50 cursor-not-allowed"])},[e("div",Xr,[e("h3",Rr,n(l.name),1),!E.value.weapons.includes(l.id)&&!se(l.id)?(t(),s("div",Ir," ⚠️ ")):g("",!0)]),e("p",Hr,n(l.desc),1),e("div",Yr,[l.attack!==void 0?(t(),s("div",zr,[b[19]||(b[19]=e("div",{class:"text-slate-500"},"Атака",-1)),e("div",Fr,n(l.attack),1)])):g("",!0),typeof l.defence!="object"?(t(),s("div",Lr,[b[20]||(b[20]=e("div",{class:"text-slate-500"},"Защита",-1)),e("div",Nr,n(l.defence||0),1)])):g("",!0),typeof l.defence=="object"?(t(),s("div",Ur,[b[27]||(b[27]=e("div",{class:"text-emerald-400 font-semibold text-center mb-1 text-[10px]"},"🛡️ Защита (удар/снаряд)",-1)),e("div",Gr,[l.defence.front?(t(),s("div",Jr,[b[22]||(b[22]=e("span",{class:"text-slate-500"},"Спереди:",-1)),e("span",null,[e("span",Zr,n(l.defence.front.melee||0),1),b[21]||(b[21]=oe(" / ",-1)),e("span",Kr,n(l.defence.front.ranged||0),1)])])):g("",!0),l.defence.side?(t(),s("div",Qr,[b[24]||(b[24]=e("span",{class:"text-slate-500"},"С фланга:",-1)),e("span",null,[e("span",ed,n(l.defence.side.melee||0),1),b[23]||(b[23]=oe(" / ",-1)),e("span",td,n(l.defence.side.ranged||0),1)])])):g("",!0),l.defence.back?(t(),s("div",sd,[b[26]||(b[26]=e("span",{class:"text-slate-500"},"Сзади:",-1)),e("span",null,[e("span",ld,n(l.defence.back.melee||0),1),b[25]||(b[25]=oe(" / ",-1)),e("span",nd,n(l.defence.back.ranged||0),1)])])):g("",!0)])])):g("",!0),l.length!==void 0?(t(),s("div",od,[b[28]||(b[28]=e("div",{class:"text-slate-500"},"Длина",-1)),e("div",ad,n(l.length),1)])):g("",!0),l.hands!==void 0?(t(),s("div",id,[b[29]||(b[29]=e("div",{class:"text-slate-500"},"Руки",-1)),e("div",cd,n(l.hands),1)])):g("",!0)])],10,Vr))),128))])])])):g("",!0)]))])}}},Ft=Oe(rd,[["__scopeId","data-v-e08ec306"]]),dd={class:"inventory-panel"},ud={class:"flex items-center justify-between mb-4"},fd={class:"mb-4 space-y-3"},vd={class:"flex gap-2 flex-wrap"},pd=["onClick"],md={class:"mr-1"},hd={class:"mb-4 p-3 rounded-lg bg-slate-900/40 border border-slate-700 text-sm"},xd={class:"flex items-center justify-between"},bd={class:"text-white font-bold"},gd={class:"flex items-center justify-between mt-1"},yd={class:"text-emerald-400 font-bold"},_d={class:"flex items-center justify-between mt-1"},kd={class:"text-amber-400 font-bold"},$d={key:0,class:"space-y-2"},wd=["onClick"],Cd={class:"flex items-start justify-between mb-2"},Sd={class:"flex-1"},Td={class:"flex items-center gap-2 mb-1"},Md={class:"font-bold text-white"},Dd={key:0,class:"px-2 py-0.5 text-xs rounded bg-emerald-500/20 text-emerald-300 border border-emerald-500/40"},Ad={class:"text-xs text-slate-400 leading-relaxed"},Ed={class:"flex items-center gap-2 ml-4"},qd=["onClick"],jd=["onClick"],Pd={class:"grid grid-cols-4 gap-2 text-xs mt-3"},Od={key:0,class:"text-center p-2 bg-slate-900/60 rounded"},Bd={class:"text-red-400 font-bold"},Wd={key:1,class:"text-center p-2 bg-slate-900/60 rounded"},Vd={class:"text-emerald-400 font-bold"},Xd={key:2,class:"col-span-4 p-2 bg-slate-900/60 rounded"},Rd={class:"grid grid-cols-3 gap-1 text-[10px]"},Id={class:"text-emerald-400 font-bold"},Hd={class:"text-sky-400 font-bold"},Yd={class:"text-emerald-400 font-bold"},zd={class:"text-sky-400 font-bold"},Fd={class:"text-emerald-400 font-bold"},Ld={class:"text-sky-400 font-bold"},Nd={key:3,class:"text-center p-2 bg-slate-900/60 rounded"},Ud={class:"text-red-400 font-bold"},Gd={key:4,class:"text-center p-2 bg-slate-900/60 rounded"},Jd={class:"text-blue-400 font-bold"},Zd={key:5,class:"text-center p-2 bg-slate-900/60 rounded"},Kd={class:"text-cyan-400 font-bold"},Qd={key:6,class:"text-center p-2 bg-slate-900/60 rounded"},eu={class:"text-purple-400 font-bold"},tu={key:7,class:"text-center p-2 bg-slate-900/60 rounded"},su={key:8,class:"text-center p-2 bg-slate-900/60 rounded"},lu={key:1,class:"text-center py-12 text-slate-500"},nu={class:"bg-slate-900 rounded-2xl border border-white/10 max-w-4xl w-full max-h-[85vh] overflow-y-auto"},ou={class:"sticky top-0 bg-slate-900 border-b border-white/10 p-4 flex items-center justify-between z-10"},au={class:"p-4 space-y-3 border-b border-white/10"},iu={class:"flex gap-2 flex-wrap"},cu=["onClick"],ru={class:"mr-1"},du={class:"p-4"},uu={class:"text-sm text-slate-400 mb-3"},fu={class:"text-white font-bold"},vu={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},pu=["onClick"],mu={class:"font-bold text-white mb-1"},hu={class:"text-xs text-slate-400 mb-2 line-clamp-2"},xu={class:"grid grid-cols-4 gap-1 text-xs"},bu={key:0,class:"text-center p-1 bg-slate-900/60 rounded"},gu={class:"text-red-400 font-bold"},yu={key:1,class:"text-center p-1 bg-slate-900/60 rounded"},_u={class:"text-emerald-400 font-bold"},ku={key:2,class:"col-span-4 p-1 bg-slate-900/60 rounded text-[9px]"},$u={key:0,class:"flex justify-between"},wu={class:"text-emerald-400"},Cu={class:"text-sky-400"},Su={key:1,class:"flex justify-between"},Tu={class:"text-emerald-400"},Mu={class:"text-sky-400"},Du={key:3,class:"text-center p-1 bg-slate-900/60 rounded"},Au={class:"text-blue-400 font-bold"},Eu={key:4,class:"text-center p-1 bg-slate-900/60 rounded"},qu={class:"text-purple-400 font-bold"},ju={key:1,class:"text-center py-8 text-slate-500"},Pu={class:"flex items-center justify-between p-6 border-b border-slate-700"},Ou={class:"text-2xl font-bold text-slate-100"},Bu={class:"flex-1 overflow-y-auto p-6 space-y-6"},Wu={class:"w-48 h-48 mx-auto bg-slate-950/50 rounded-xl p-4 flex items-center justify-center"},Vu=["src","alt"],Xu={key:0,class:"p-4 bg-slate-950/30 border-l-4 border-slate-600 rounded-r-lg"},Ru={class:"text-slate-300 text-sm leading-relaxed italic"},Iu={class:"grid grid-cols-2 gap-3"},Hu={key:0,class:"stat-box"},Yu={class:"stat-value text-red-400"},zu={key:1,class:"stat-box"},Fu={class:"stat-value text-emerald-400"},Lu={key:2,class:"stat-box"},Nu={class:"stat-value text-blue-400"},Uu={key:3,class:"stat-box"},Gu={class:"stat-value text-cyan-400"},Ju={key:4,class:"stat-box"},Zu={class:"stat-value text-purple-400"},Ku={key:5,class:"stat-box"},Qu={key:6,class:"stat-box"},ef={key:7,class:"stat-box"},tf={class:"stat-value text-amber-400"},sf={key:1,class:"bg-slate-950/50 rounded-xl p-4 border border-slate-700"},lf={class:"overflow-x-auto"},nf={class:"w-full text-sm"},of={key:0,class:"border-b border-slate-800"},af={class:"text-center py-3 px-3"},cf={class:"text-emerald-400 font-bold text-lg"},rf={class:"text-center py-3 px-3"},df={class:"text-sky-400 font-bold text-lg"},uf={key:1,class:"border-b border-slate-800"},ff={class:"text-center py-3 px-3"},vf={class:"text-emerald-400 font-bold text-lg"},pf={class:"text-center py-3 px-3"},mf={class:"text-sky-400 font-bold text-lg"},hf={key:2},xf={class:"text-center py-3 px-3"},bf={class:"text-emerald-400 font-bold text-lg"},gf={class:"text-center py-3 px-3"},yf={class:"text-sky-400 font-bold text-lg"},_f={key:2,class:"bg-slate-950/50 rounded-xl p-4 border border-slate-700"},kf={class:"space-y-2"},$f={class:"text-2xl font-bold text-slate-100 w-12 text-center"},wf={class:"flex-1 text-slate-300"},Cf={class:"flex gap-3 p-6 border-t border-slate-700"},Sf={__name:"InventoryPanel",props:{character:{type:Object,required:!0}},emits:["update:character","equip-item"],setup(m,{emit:L}){const u=m,S=L,y=[{id:"all",name:"Всё",icon:"📦"},{id:"weapon",name:"Оружие",icon:"⚔️"},{id:"shield",name:"Щиты",icon:"🛡️"},{id:"armor",name:"Броня",icon:"🦺"},{id:"special",name:"Особые",icon:"✨"},{id:"quest",name:"Квестовые",icon:"📜"}],p=J("all"),_=J(!1),E=J(!1),v=J(null),A=J(""),Y=j(()=>{var l,i,r,f;const T=new Set;return(l=u.character.equipment)!=null&&l.armor&&T.add(u.character.equipment.armor),(r=(i=u.character.equipment)==null?void 0:i.weaponSets)==null||r.forEach(x=>{x.weapons.forEach(z=>T.add(z))}),(f=u.character.inventory)==null||f.forEach(x=>{typeof x=="string"?T.add(x):x.id&&T.add(x.id)}),Array.from(T)}),se=j(()=>Y.value.map(T=>{var f,x,z;const l=Re.items.find(U=>U.id===T);if(!l)return null;const i=((f=u.character.equipment)==null?void 0:f.armor)===T,r=(z=(x=u.character.equipment)==null?void 0:x.weaponSets)==null?void 0:z.some(U=>U.weapons.includes(T));return{...l,equipped:i||r,equippedAs:i?"armor":r?"weapon":null}}).filter(Boolean)),V=j(()=>{let T=se.value;if(p.value!=="all"&&(T=T.filter(l=>l.category===p.value)),A.value){const l=A.value.toLowerCase();T=T.filter(i=>{var r;return i.name.toLowerCase().includes(l)||((r=i.desc)==null?void 0:r.toLowerCase().includes(l))})}return T}),W=j(()=>{var i,r;const T=((i=u.character.equipment)==null?void 0:i.wealth)||0,l=((r=u.character.equipment)==null?void 0:r.epoch)||0;return Re.items.filter(f=>{if(Y.value.includes(f.id))return!1;const x=(f.wealth||f.price||0)<=T,z=(f.epoch||0)<=l;return x&&z})}),O=T=>{const l=u.character.inventory||[],i={...u.character,inventory:[...l,T]};S("update:character",i),_.value=!1},ae=T=>{const l=se.value.find(i=>i.id===T);if(l!=null&&l.equipped){alert("Нельзя удалить экипированный предмет. Сначала снимите его.");return}if(confirm(`Удалить "${l.name}" из инвентаря?`)){const i=u.character.inventory.filter(f=>typeof f=="string"?f!==T:f.id!==T),r={...u.character,inventory:i};S("update:character",r)}},B=T=>{S("equip-item",T)},R=T=>{v.value=T,E.value=!0},D=()=>{v.value=null,E.value=!1},X=J("all"),d=J(""),b=j(()=>{let T=W.value;if(X.value!=="all"&&(T=T.filter(l=>l.category===X.value)),d.value){const l=d.value.toLowerCase();T=T.filter(i=>{var r;return i.name.toLowerCase().includes(l)||((r=i.desc)==null?void 0:r.toLowerCase().includes(l))})}return T});return(T,l)=>(t(),s("div",dd,[e("div",ud,[l[10]||(l[10]=e("h2",{class:"text-xl font-bold text-slate-300"},"Инвентарь",-1)),e("button",{onClick:l[0]||(l[0]=i=>_.value=!0),class:"px-3 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/60 text-emerald-100 hover:bg-emerald-500/30 transition flex items-center gap-2"},[...l[9]||(l[9]=[e("span",null,"+",-1),e("span",null,"Добавить предмет",-1)])])]),e("div",fd,[e("div",vd,[(t(),s(N,null,K(y,i=>e("button",{key:i.id,onClick:r=>p.value=i.id,class:G(["px-3 py-2 rounded-lg text-sm font-medium transition",p.value===i.id?"bg-sky-500/20 border border-sky-400 text-sky-100":"bg-slate-800/40 border border-slate-700 text-slate-400 hover:bg-slate-800/60"])},[e("span",md,n(i.icon),1),oe(" "+n(i.name),1)],10,pd)),64))]),je(e("input",{"onUpdate:modelValue":l[1]||(l[1]=i=>A.value=i),type:"text",placeholder:"Поиск по названию или описанию...",class:"w-full px-4 py-2 rounded-lg bg-slate-900/60 border border-slate-700 text-white placeholder-slate-500 focus:border-sky-400 focus:outline-none"},null,512),[[Je,A.value]])]),e("div",hd,[e("div",xd,[l[11]||(l[11]=e("span",{class:"text-slate-400"},"Всего предметов:",-1)),e("span",bd,n(se.value.length),1)]),e("div",gd,[l[12]||(l[12]=e("span",{class:"text-slate-400"},"Экипировано:",-1)),e("span",yd,n(se.value.filter(i=>i.equipped).length),1)]),e("div",_d,[l[13]||(l[13]=e("span",{class:"text-slate-400"},"В инвентаре:",-1)),e("span",kd,n(se.value.filter(i=>!i.equipped).length),1)])]),V.value.length?(t(),s("div",$d,[(t(!0),s(N,null,K(V.value,i=>(t(),s("div",{key:i.id,onClick:r=>R(i),class:G(["p-4 rounded-lg border transition cursor-pointer hover:bg-slate-800/60",i.equipped?"bg-emerald-900/20 border-emerald-700":"bg-slate-950/40 border-slate-700"])},[e("div",Cd,[e("div",Sd,[e("div",Td,[e("h3",Md,n(i.name),1),i.equipped?(t(),s("span",Dd," Надето ")):g("",!0)]),e("p",Ad,n(i.desc),1)]),e("div",Ed,[!i.equipped&&(i.category==="weapon"||i.category==="shield"||i.category==="armor")?(t(),s("button",{key:0,onClick:ye(r=>B(i),["stop"]),class:"px-3 py-1 text-xs rounded-lg bg-sky-500/20 border border-sky-400/60 text-sky-100 hover:bg-sky-500/30 transition",title:"Экипировать"}," Надеть ",8,qd)):g("",!0),i.equipped?g("",!0):(t(),s("button",{key:1,onClick:ye(r=>ae(i.id),["stop"]),class:"px-3 py-1 text-xs rounded-lg bg-red-500/20 border border-red-400/40 text-red-300 hover:bg-red-500/30 transition",title:"Удалить"}," 🗑️ ",8,jd))])]),e("div",Pd,[i.attack!==void 0&&typeof i.defence!="object"?(t(),s("div",Od,[l[14]||(l[14]=e("div",{class:"text-slate-500"},"Атака",-1)),e("div",Bd,n(i.attack),1)])):g("",!0),i.defence!==void 0&&typeof i.defence!="object"?(t(),s("div",Wd,[l[15]||(l[15]=e("div",{class:"text-slate-500"},"Защита",-1)),e("div",Vd,n(i.defence),1)])):g("",!0),typeof i.defence=="object"?(t(),s("div",Xd,[l[20]||(l[20]=e("div",{class:"text-slate-500 text-center mb-2 font-semibold"},"Защита щита",-1)),e("div",Rd,[l[19]||(l[19]=Wt('<div class="text-center" data-v-4ce688b4><div class="text-slate-500" data-v-4ce688b4>Направление</div></div><div class="text-center" data-v-4ce688b4><div class="text-slate-500" data-v-4ce688b4>Удары</div></div><div class="text-center" data-v-4ce688b4><div class="text-slate-500" data-v-4ce688b4>Снаряды</div></div>',3)),i.defence.front?(t(),s(N,{key:0},[l[16]||(l[16]=e("div",{class:"text-slate-400"},"Спереди",-1)),e("div",Id,n(i.defence.front.melee||0),1),e("div",Hd,n(i.defence.front.ranged||0),1)],64)):g("",!0),i.defence.side?(t(),s(N,{key:1},[l[17]||(l[17]=e("div",{class:"text-slate-400"},"С фланга",-1)),e("div",Yd,n(i.defence.side.melee||0),1),e("div",zd,n(i.defence.side.ranged||0),1)],64)):g("",!0),i.defence.back?(t(),s(N,{key:2},[l[18]||(l[18]=e("div",{class:"text-slate-400"},"Сзади",-1)),e("div",Fd,n(i.defence.back.melee||0),1),e("div",Ld,n(i.defence.back.ranged||0),1)],64)):g("",!0)])])):g("",!0),i.attack!==void 0&&typeof i.defence=="object"?(t(),s("div",Nd,[l[21]||(l[21]=e("div",{class:"text-slate-500"},"Атака",-1)),e("div",Ud,n(i.attack),1)])):g("",!0),i.resist!==void 0?(t(),s("div",Gd,[l[22]||(l[22]=e("div",{class:"text-slate-500"},"Резист",-1)),e("div",Jd,n(i.resist),1)])):g("",!0),i.length!==void 0?(t(),s("div",Zd,[l[23]||(l[23]=e("div",{class:"text-slate-500"},"Длина",-1)),e("div",Kd,n(i.length),1)])):g("",!0),i.hands!==void 0?(t(),s("div",Qd,[l[24]||(l[24]=e("div",{class:"text-slate-500"},"Руки",-1)),e("div",eu,n(i.hands),1)])):g("",!0),i.movement!==void 0?(t(),s("div",tu,[l[25]||(l[25]=e("div",{class:"text-slate-500"},"Движение",-1)),e("div",{class:G([i.movement>=0?"text-green-400":"text-red-400","font-bold"])},n(i.movement>=0?"+":"")+n(i.movement),3)])):g("",!0),i.bursts!==void 0?(t(),s("div",su,[l[26]||(l[26]=e("div",{class:"text-slate-500"},"Порывы",-1)),e("div",{class:G([i.bursts>=0?"text-green-400":"text-red-400","font-bold"])},n(i.bursts>=0?"+":"")+n(i.bursts),3)])):g("",!0)])],10,wd))),128))])):(t(),s("div",lu,[...l[27]||(l[27]=[e("div",{class:"text-4xl mb-3"},"📦",-1),e("p",null,"Ничего не найдено",-1)])])),(t(),Me(Ge,{to:"body"},[_.value?(t(),s("div",{key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:l[4]||(l[4]=ye(i=>_.value=!1,["self"]))},[e("div",nu,[e("div",ou,[l[28]||(l[28]=e("h2",{class:"text-xl font-bold"},"Добавить предмет",-1)),e("button",{onClick:l[2]||(l[2]=i=>_.value=!1),class:"w-8 h-8 rounded-lg hover:bg-white/10 transition"}," ✕ ")]),e("div",au,[e("div",iu,[(t(),s(N,null,K(y,i=>e("button",{key:i.id,onClick:r=>X.value=i.id,class:G(["px-3 py-2 rounded-lg text-sm font-medium transition",X.value===i.id?"bg-sky-500/20 border border-sky-400 text-sky-100":"bg-slate-800/40 border border-slate-700 text-slate-400 hover:bg-slate-800/60"])},[e("span",ru,n(i.icon),1),oe(" "+n(i.name),1)],10,cu)),64))]),je(e("input",{"onUpdate:modelValue":l[3]||(l[3]=i=>d.value=i),type:"text",placeholder:"Поиск...",class:"w-full px-4 py-2 rounded-lg bg-slate-950/60 border border-slate-700 text-white placeholder-slate-500 focus:border-sky-400 focus:outline-none"},null,512),[[Je,d.value]])]),e("div",du,[e("p",uu,[l[29]||(l[29]=oe(" Доступно предметов: ",-1)),e("span",fu,n(b.value.length),1)]),b.value.length?(t(),s("div",vu,[(t(!0),s(N,null,K(b.value,i=>(t(),s("button",{key:i.id,onClick:r=>O(i.id),class:"p-4 rounded-lg border bg-slate-950/40 border-slate-700 hover:bg-slate-800/40 transition text-left"},[e("h3",mu,n(i.name),1),e("p",hu,n(i.desc),1),e("div",xu,[i.attack!==void 0&&typeof i.defence!="object"?(t(),s("div",bu,[l[30]||(l[30]=e("div",{class:"text-slate-500 text-[10px]"},"Атака",-1)),e("div",gu,n(i.attack),1)])):g("",!0),i.defence!==void 0&&typeof i.defence!="object"?(t(),s("div",yu,[l[31]||(l[31]=e("div",{class:"text-slate-500 text-[10px]"},"Защита",-1)),e("div",_u,n(i.defence),1)])):g("",!0),typeof i.defence=="object"?(t(),s("div",ku,[l[36]||(l[36]=e("div",{class:"text-emerald-400 font-bold text-center mb-1"},"🛡️ Защита",-1)),i.defence.front?(t(),s("div",$u,[l[33]||(l[33]=e("span",{class:"text-slate-500"},"Спереди:",-1)),e("span",null,[e("span",wu,n(i.defence.front.melee||0),1),l[32]||(l[32]=oe(" / ",-1)),e("span",Cu,n(i.defence.front.ranged||0),1)])])):g("",!0),i.defence.side?(t(),s("div",Su,[l[35]||(l[35]=e("span",{class:"text-slate-500"},"Фланг:",-1)),e("span",null,[e("span",Tu,n(i.defence.side.melee||0),1),l[34]||(l[34]=oe(" / ",-1)),e("span",Mu,n(i.defence.side.ranged||0),1)])])):g("",!0)])):g("",!0),i.resist!==void 0?(t(),s("div",Du,[l[37]||(l[37]=e("div",{class:"text-slate-500 text-[10px]"},"Резист",-1)),e("div",Au,n(i.resist),1)])):g("",!0),i.hands!==void 0?(t(),s("div",Eu,[l[38]||(l[38]=e("div",{class:"text-slate-500 text-[10px]"},"Руки",-1)),e("div",qu,n(i.hands),1)])):g("",!0)])],8,pu))),128))])):(t(),s("div",ju," Нет доступных предметов "))])])])):g("",!0)])),(t(),Me(Ge,{to:"body"},[E.value&&v.value?(t(),s("div",{key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4 backdrop-blur-sm",onClick:D},[e("div",{class:"bg-slate-900 rounded-2xl border border-slate-700 max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:l[8]||(l[8]=ye(()=>{},["stop"]))},[e("div",Pu,[e("h2",Ou,n(v.value.name),1),e("button",{onClick:D,class:"w-10 h-10 rounded-lg hover:bg-slate-800 transition flex items-center justify-center text-slate-400 hover:text-slate-100"},[...l[39]||(l[39]=[e("span",{class:"text-2xl"},"✕",-1)])])]),e("div",Bu,[e("div",Wu,[e("img",{src:c(rt)(v.value.id),alt:v.value.name,class:"w-full h-full object-contain",onError:l[5]||(l[5]=i=>i.target.style.display="none")},null,40,Vu)]),v.value.desc?(t(),s("div",Xu,[e("p",Ru,n(v.value.desc),1)])):g("",!0),e("div",Iu,[v.value.attack!==void 0&&typeof v.value.defence!="object"?(t(),s("div",Hu,[l[40]||(l[40]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"⚔️"),oe(" Атака ")],-1)),e("div",Yu,n(v.value.attack),1)])):g("",!0),v.value.defence!==void 0&&typeof v.value.defence!="object"?(t(),s("div",zu,[l[41]||(l[41]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"🛡️"),oe(" Защита ")],-1)),e("div",Fu,n(v.value.defence),1)])):g("",!0),v.value.resist!==void 0?(t(),s("div",Lu,[l[42]||(l[42]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"💎"),oe(" Резист ")],-1)),e("div",Nu,n(v.value.resist),1)])):g("",!0),v.value.length!==void 0?(t(),s("div",Uu,[l[43]||(l[43]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"↔️"),oe(" Дальность ")],-1)),e("div",Gu,n(v.value.length),1)])):g("",!0),v.value.hands!==void 0?(t(),s("div",Ju,[l[44]||(l[44]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"🤲"),oe(" Руки ")],-1)),e("div",Zu,n(v.value.hands),1)])):g("",!0),v.value.movement!==void 0?(t(),s("div",Ku,[l[45]||(l[45]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"👟"),oe(" Движение ")],-1)),e("div",{class:G(["stat-value",v.value.movement>=0?"text-green-400":"text-red-400"])},n(v.value.movement>=0?"+":"")+n(v.value.movement),3)])):g("",!0),v.value.bursts!==void 0?(t(),s("div",Qu,[l[46]||(l[46]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"💨"),oe(" Порывы ")],-1)),e("div",{class:G(["stat-value",v.value.bursts>=0?"text-green-400":"text-red-400"])},n(v.value.bursts>=0?"+":"")+n(v.value.bursts),3)])):g("",!0),v.value.price!==void 0?(t(),s("div",ef,[l[47]||(l[47]=e("div",{class:"stat-label"},[e("span",{class:"text-lg"},"💰"),oe(" Цена ")],-1)),e("div",tf,n(v.value.price),1)])):g("",!0)]),typeof v.value.defence=="object"?(t(),s("div",sf,[l[52]||(l[52]=e("h3",{class:"text-lg font-bold text-emerald-400 mb-4 flex items-center gap-2"},[e("span",null,"🛡️"),oe(" Защита щита ")],-1)),e("div",lf,[e("table",nf,[l[51]||(l[51]=e("thead",null,[e("tr",{class:"border-b border-slate-700"},[e("th",{class:"text-left text-slate-400 pb-2 pr-4"},"Направление"),e("th",{class:"text-center text-slate-400 pb-2 px-3"},"Ближний бой"),e("th",{class:"text-center text-slate-400 pb-2 px-3"},"Дальний бой")])],-1)),e("tbody",null,[v.value.defence.front?(t(),s("tr",of,[l[48]||(l[48]=e("td",{class:"py-3 pr-4 text-slate-300 font-medium"},"Спереди",-1)),e("td",af,[e("span",cf,n(v.value.defence.front.melee||0),1)]),e("td",rf,[e("span",df,n(v.value.defence.front.ranged||0),1)])])):g("",!0),v.value.defence.side?(t(),s("tr",uf,[l[49]||(l[49]=e("td",{class:"py-3 pr-4 text-slate-300 font-medium"},"С фланга",-1)),e("td",ff,[e("span",vf,n(v.value.defence.side.melee||0),1)]),e("td",pf,[e("span",mf,n(v.value.defence.side.ranged||0),1)])])):g("",!0),v.value.defence.back?(t(),s("tr",hf,[l[50]||(l[50]=e("td",{class:"py-3 pr-4 text-slate-300 font-medium"},"Сзади",-1)),e("td",xf,[e("span",bf,n(v.value.defence.back.melee||0),1)]),e("td",gf,[e("span",yf,n(v.value.defence.back.ranged||0),1)])])):g("",!0)])])])])):g("",!0),v.value.damage?(t(),s("div",_f,[l[53]||(l[53]=e("h3",{class:"text-lg font-bold text-red-400 mb-4 flex items-center gap-2"},[e("span",null,"⚔️"),oe(" Превышение защиты ")],-1)),e("div",kf,[(t(!0),s(N,null,K(v.value.damage,(i,r)=>(t(),s("div",{key:r,class:"flex items-center gap-4 p-3 bg-slate-900/50 rounded-lg"},[e("div",$f,n(r),1),e("div",wf,n(i),1)]))),128))])])):g("",!0)]),e("div",Cf,[!v.value.equipped&&(v.value.category==="weapon"||v.value.category==="shield"||v.value.category==="armor")?(t(),s("button",{key:0,onClick:l[6]||(l[6]=i=>{B(v.value),D()}),class:"flex-1 px-4 py-3 rounded-lg bg-sky-500/20 border border-sky-400/60 text-sky-100 hover:bg-sky-500/30 transition font-semibold"}," Надеть ")):g("",!0),v.value.equipped?g("",!0):(t(),s("button",{key:1,onClick:l[7]||(l[7]=i=>{ae(v.value.id),D()}),class:"flex-1 px-4 py-3 rounded-lg bg-red-500/20 border border-red-400/40 text-red-300 hover:bg-red-500/30 transition font-semibold"}," Удалить ")),e("button",{onClick:D,class:"flex-1 px-4 py-3 rounded-lg bg-slate-700/50 border border-slate-600 text-slate-300 hover:bg-slate-700 transition font-semibold"}," Закрыть ")])])])):g("",!0)]))]))}},Lt=Oe(Sf,[["__scopeId","data-v-4ce688b4"]]),Tf={class:"character-sheet-detailed bg-slate-950 text-slate-50 min-h-full"},Mf={class:"max-w-7xl mx-auto p-4 sm:p-6 space-y-6"},Df={class:"header-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 sm:p-6"},Af={class:"flex items-start gap-4 sm:gap-6"},Ef={class:"flex-1 min-w-0 w-full sm:w-auto"},qf={class:"text-2xl sm:text-3xl font-bold mb-2 break-words"},jf={class:"text-slate-400 text-base sm:text-lg mb-4 break-words"},Pf={class:"grid grid-cols-2 gap-2 sm:gap-3"},Of={class:"stat-badge bg-blue-900/40 border border-blue-700/50 px-2 py-2 sm:px-3 rounded-lg flex items-center gap-1 sm:gap-2 min-w-0"},Bf={class:"min-w-0 flex-1"},Wf={class:"text-base sm:text-lg font-bold"},Vf={class:"stat-badge bg-cyan-900/40 border border-cyan-700/50 px-2 py-2 sm:px-3 rounded-lg flex items-center gap-1 sm:gap-2 min-w-0"},Xf={class:"min-w-0 flex-1"},Rf={class:"text-base sm:text-lg font-bold"},If={class:"stat-badge bg-amber-900/40 border border-amber-700/50 px-2 py-2 sm:px-3 rounded-lg flex items-center gap-1 sm:gap-2 min-w-0"},Hf={class:"min-w-0 flex-1"},Yf={class:"text-base sm:text-lg font-bold"},zf={class:"stat-badge bg-purple-900/40 border border-purple-700/50 px-2 py-2 sm:px-3 rounded-lg flex items-center gap-1 sm:gap-2 min-w-0"},Ff={class:"min-w-0 flex-1"},Lf={class:"text-base sm:text-lg font-bold"},Nf={class:"health-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 sm:p-6"},Uf={class:"checks-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 sm:p-6"},Gf={class:"overflow-x-auto -mx-4 sm:mx-0"},Jf={class:"inline-block min-w-full align-middle px-4 sm:px-0"},Zf={class:"w-full border-collapse min-w-[800px]"},Kf={class:"flex items-center gap-2"},Qf={class:"text-base"},ev={class:"defence-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 sm:p-6"},tv={class:"overflow-x-auto"},sv={class:"w-full border-collapse"},lv={class:"equipment-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 sm:p-6"},nv={class:"inventory-section bg-slate-900/60 border border-white/10 rounded-2xl p-4 sm:p-6"},ov={__name:"CharacterSheetDetailed",props:{character:{type:Object,required:!0}},emits:["close"],setup(m,{emit:L}){const u=Ke(),S=ot(),y=m,p=L,_=r=>{u.updateCharacter(r.id,r)},E=r=>{var f;if(r.category==="armor"){const x={...y.character,equipment:{...y.character.equipment,armor:r.id}};_(x)}else if(r.category==="weapon"||r.category==="shield"){const x=[...((f=y.character.equipment)==null?void 0:f.weaponSets)||[]],z={...x[0]},U=z.weapons.map(ie=>Re.items.find(o=>o.id===ie)).filter(Boolean);U.push(r);const le=U.reduce((ie,o)=>ie+(o.hands||0),0),me=U.filter(ie=>ie.length===2).length;if(le<=2&&me<=1){z.weapons=[...z.weapons,r.id],x[0]=z;const ie={...y.character,equipment:{...y.character.equipment,weaponSets:x}};_(ie)}else alert("Невозможно экипировать: превышено ограничение по рукам или длинному оружию в Наборе 1")}},v=()=>{if(confirm(`Вы уверены, что хотите удалить персонажа "${y.character.name}"? Это действие нельзя отменить.`)){const r=y.character.id;u.deleteCharacter(r),S.sendCharacterDelete(r),p("close")}},A=j(()=>{const r={};return Pe.aspects.forEach(f=>{r[f.id]=f}),r}),Y=j(()=>{var r;return(r=y.character.equipment)!=null&&r.armor?Re.items.find(f=>f.id===y.character.equipment.armor):null});j(()=>{var x,z,U,le;const r=((x=y.character.equipment)==null?void 0:x.activeSetIndex)||0,f=(U=(z=y.character.equipment)==null?void 0:z.weaponSets)==null?void 0:U[r];return(le=f==null?void 0:f.weapons)!=null&&le.length?f.weapons.map(me=>Re.items.find(ie=>ie.id===me)).filter(Boolean):[]}),j(()=>pt(y.character,"shadow"));const se=r=>{const f=Object.entries(Fe.default||Fe).map(([z,U])=>({value:parseInt(z),...U})).filter(z=>z.value>=0).sort((z,U)=>z.value-U.value);let x=f[0];for(const z of f)if(z.value<=r)x=z;else break;return x},V=r=>{const f=se(r);return(f==null?void 0:f.color)||"#FFFFFF"},W=(r,f)=>{const x=ms(y.character,r,f);return{name:se(x).name,value:x,color:V(x)}},O=j(()=>{var x;return 4+(((x=Y.value)==null?void 0:x.movement)||0)}),ae=j(()=>{var r;return((r=Y.value)==null?void 0:r.resist)||0}),B=j(()=>{var x;return 2+(((x=Y.value)==null?void 0:x.bursts)||0)}),R=j(()=>y.character.level||0),D=j(()=>Ze(y.character,"melee")),X=j(()=>Ze(y.character,"ranged")),d=j(()=>Object.entries(Fe.default||Fe).map(([r,f])=>({value:parseInt(r),...f})).filter(r=>r.value>=0).sort((r,f)=>r.value-f.value)),b=j(()=>Pe.metadata.circularOrder.map(r=>{const f=A.value[r];return{id:r,name:f.check.name,icon:f.checkIcon||"game-icons:dice-twenty-faces-twenty",color:f.color}})),T=r=>pt(y.character,r),l=(r,f)=>{const x=T(r),z=f.value;if(x>=z)return{type:"success",value:"✓"};const U=z-x;return U<=1?{type:"success",value:"✓"}:U<=12?{type:"roll",value:U}:{type:"fail",value:"✗"}},i=r=>{const f=r.linetype||"single",x=r.color||"#FFFFFF",z={backgroundSize:"4px 100%",backgroundRepeat:"no-repeat",backgroundPosition:"left center",paddingLeft:"8px"},U=`repeating-linear-gradient(to bottom, ${x} 0px, ${x} 4px, transparent 4px, transparent 8px)`,le=`linear-gradient(to bottom, ${x}, ${x})`,me="linear-gradient(to bottom, transparent, transparent)";return f==="dashed"?{...z,backgroundImage:`${me}, ${U}`,backgroundSize:"2px 100%, 2px 100%",backgroundPosition:"left center, 2px center"}:f==="double"?{...z,backgroundImage:`${U}, ${le}`,backgroundSize:"2px 100%, 2px 100%",backgroundPosition:"left center, 2px center"}:{...z,backgroundImage:`${me}, ${le}`,backgroundSize:"2px 100%, 2px 100%",backgroundPosition:"left center, 2px center"}};return(r,f)=>(t(),s("div",Tf,[e("div",Mf,[e("div",{class:"flex items-center justify-end gap-4 mb-4"},[e("button",{onClick:v,class:"px-4 py-2 rounded-lg bg-red-900/40 border border-red-700/50 text-red-300 hover:bg-red-900/60 transition flex items-center gap-2"},[...f[0]||(f[0]=[e("span",null,"🗑️",-1),e("span",null,"Удалить персонажа",-1)])])]),e("div",Df,[e("div",Af,[k(It,{portrait:m.character.portrait,name:m.character.name,combat:m.character.combat,stats:m.character.stats,meleeDefence:D.value,rangedDefence:X.value,showDefence:!0,defenceLayout:"left",size:"xl"},null,8,["portrait","name","combat","stats","meleeDefence","rangedDefence"]),e("div",Ef,[e("h1",qf,n(m.character.name),1),e("p",jf,n(m.character.class||"Класс не указан"),1),e("div",Pf,[e("div",Of,[f[2]||(f[2]=e("span",{class:"text-lg sm:text-xl flex-shrink-0"},"🛡️",-1)),e("div",Bf,[f[1]||(f[1]=e("div",{class:"text-[10px] sm:text-xs text-blue-300 uppercase truncate"},"Броня",-1)),e("div",Wf,n(ae.value),1)])]),e("div",Vf,[f[4]||(f[4]=e("span",{class:"text-lg sm:text-xl flex-shrink-0"},"⬡",-1)),e("div",Xf,[f[3]||(f[3]=e("div",{class:"text-[10px] sm:text-xs text-cyan-300 uppercase truncate"},"Скорость",-1)),e("div",Rf,n(O.value),1)])]),e("div",If,[f[6]||(f[6]=e("span",{class:"text-lg sm:text-xl flex-shrink-0"},"⚡",-1)),e("div",Hf,[f[5]||(f[5]=e("div",{class:"text-[10px] sm:text-xs text-amber-300 uppercase truncate"},"Порывы",-1)),e("div",Yf,n(B.value),1)])]),e("div",zf,[f[8]||(f[8]=e("span",{class:"text-lg sm:text-xl flex-shrink-0"},"⭐",-1)),e("div",Ff,[f[7]||(f[7]=e("div",{class:"text-[10px] sm:text-xs text-purple-300 uppercase truncate"},"Уровень",-1)),e("div",Lf,n(R.value),1)])])])])])]),e("div",Nf,[f[9]||(f[9]=e("h2",{class:"text-lg sm:text-xl font-bold mb-4 text-slate-300 uppercase tracking-wide"},"Здоровье:",-1)),k(Ht,{combat:m.character.combat||{healthType:"simple",hp:0,maxHp:8,wounds:{scratch:0,light:0,heavy:0,deadly:0}},stats:m.character.stats||{},readonly:!0},null,8,["combat","stats"])]),e("div",Uf,[f[11]||(f[11]=e("h2",{class:"text-lg sm:text-xl font-bold mb-4 text-slate-300 uppercase tracking-wide"},"Навыки:",-1)),e("div",Gf,[e("div",Jf,[e("table",Zf,[e("thead",null,[e("tr",null,[f[10]||(f[10]=e("td",{class:"bg-slate-950/60 border border-slate-700 p-2 text-left text-sm text-slate-500 uppercase w-40"}," Навыки: ",-1)),(t(!0),s(N,null,K(d.value,(x,z)=>(t(),s("td",{key:x.value,class:G(["border border-slate-700 p-2 text-center text-xs font-bold uppercase tracking-wide",x.level===7?"bg-black":"bg-slate-950/80"]),style:ue({color:x.level===7?"#FFFFFF":x.color})},n(x.short),7))),128))])]),e("tbody",null,[(t(!0),s(N,null,K(b.value,x=>(t(),s("tr",{key:x.id,class:"hover:bg-slate-800/20 transition"},[e("td",{class:"bg-slate-950/40 border border-slate-700 p-2 font-bold text-sm",style:ue({color:x.color})},[e("div",Kf,[k(c(q),{icon:x.icon,class:"text-lg"},null,8,["icon"]),oe(" "+n(x.name),1)])],4),(t(!0),s(N,null,K(d.value,z=>(t(),s("td",{key:`${x.id}-${z.value}`,class:G(["border border-slate-700 p-2 text-center font-bold",z.level===7?"bg-black text-white":"bg-slate-950/20",z.level!==7&&l(x.id,z).type==="success"?"text-emerald-300":"",z.level!==7&&l(x.id,z).type==="fail"?"text-red-400":"",z.level!==7&&l(x.id,z).type==="number"?"text-slate-100":""]),style:ue(i(z))},[e("span",Qf,n(l(x.id,z).value),1)],6))),128))]))),128))])])])])]),e("div",ev,[f[16]||(f[16]=e("h2",{class:"text-lg sm:text-xl font-bold mb-4 text-slate-300 uppercase tracking-wide"},"Защита",-1)),e("div",tv,[e("table",sv,[f[15]||(f[15]=e("thead",null,[e("tr",null,[e("th",{class:"bg-slate-950/60 border border-slate-700 p-3 text-left text-sm text-slate-500 uppercase"}),e("th",{class:"bg-slate-950/60 border border-slate-700 p-3 text-center text-sm font-bold text-slate-300"},"Удары"),e("th",{class:"bg-slate-950/60 border border-slate-700 p-3 text-center text-sm font-bold text-slate-300"},"Снаряды")])],-1)),e("tbody",null,[e("tr",null,[f[12]||(f[12]=e("td",{class:"bg-slate-950/40 border border-slate-700 p-3 font-bold text-sm text-slate-300"},"Фронт",-1)),e("td",{class:"border border-slate-700 p-3 text-center bg-slate-950/20 font-semibold",style:ue({color:W("front","melee").color})},n(W("front","melee").name),5),e("td",{class:"border border-slate-700 p-3 text-center bg-slate-950/20 font-semibold",style:ue({color:W("front","ranged").color})},n(W("front","ranged").name),5)]),e("tr",null,[f[13]||(f[13]=e("td",{class:"bg-slate-950/40 border border-slate-700 p-3 font-bold text-sm text-slate-300"},"Фланг",-1)),e("td",{class:"border border-slate-700 p-3 text-center bg-slate-950/20 font-semibold",style:ue({color:W("flank","melee").color})},n(W("flank","melee").name),5),e("td",{class:"border border-slate-700 p-3 text-center bg-slate-950/20 font-semibold",style:ue({color:W("flank","ranged").color})},n(W("flank","ranged").name),5)]),e("tr",null,[f[14]||(f[14]=e("td",{class:"bg-slate-950/40 border border-slate-700 p-3 font-bold text-sm text-slate-300"},"Тыл",-1)),e("td",{class:"border border-slate-700 p-3 text-center bg-slate-950/20 font-semibold",style:ue({color:W("back","melee").color})},n(W("back","melee").name),5),e("td",{class:"border border-slate-700 p-3 text-center bg-slate-950/20 font-semibold",style:ue({color:W("back","ranged").color})},n(W("back","ranged").name),5)])])])])]),e("div",lv,[f[17]||(f[17]=e("h2",{class:"text-lg sm:text-xl font-bold mb-4 text-slate-300 uppercase tracking-wide"},"Экипировка",-1)),k(Ft,{character:m.character,"onUpdate:character":_},null,8,["character"])]),e("div",nv,[k(Lt,{character:m.character,"onUpdate:character":_,onEquipItem:E},null,8,["character"])])])]))}},av=Oe(ov,[["__scopeId","data-v-5dedbf12"]]),iv={class:"character-cards-container"},cv={class:"flex items-center justify-between mb-6"},rv={class:"flex items-center gap-3"},dv={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},uv=["onClick"],fv={key:0,class:"active-badge"},vv={class:"flex items-start gap-4 mb-4"},pv={class:"relative"},mv={class:"level-badge"},hv={class:"flex-1 min-w-0"},xv={class:"text-xl font-bold text-slate-100 mb-1 truncate"},bv={class:"flex items-center gap-2 mb-2"},gv={key:0,class:"text-xs text-slate-400 flex items-center gap-1"},yv={class:"mb-4"},_v={class:"stats-mini-grid"},kv={class:"stat-mini"},$v={class:"text-sm font-bold text-slate-200"},wv={class:"stat-mini"},Cv={class:"text-sm font-bold text-slate-200"},Sv={class:"stat-mini"},Tv={class:"text-sm font-bold text-slate-200"},Mv={class:"card-hover-overlay"},Dv={key:0,class:"empty-state"},Av={class:"empty-icon"},Ev={__name:"CharacterCards",props:{characters:{type:Array,required:!0},activeCharacterId:{type:String,default:null}},emits:["select-character","create-character"],setup(m,{emit:L}){const u=L,S=j(()=>{const V={};return at.classes.forEach(W=>{V[W.id]=W}),V}),y=j(()=>{const V={};return Pe.aspects.forEach(W=>{V[W.id]=W}),V}),p=V=>V.level||0,_=V=>S.value[V.classId],E=V=>{if(!V.stats)return null;let W=-1/0,O=null;return Object.entries(V.stats).forEach(([ae,B])=>{B>W&&(W=B,O=ae)}),O?y.value[O]:null},v=V=>{var B,R;const W=((B=V.equipment)==null?void 0:B.activeSetIndex)??0,ae=(((R=V.equipment)==null?void 0:R.weaponSets)||[])[W];return!ae||!ae.weapons||ae.weapons.length===0?"Невооружен":`${ae.weapons.length} предм.`},A=V=>{var W;return(W=V.equipment)!=null&&W.armor?"🦺":"—"},Y=V=>{u("select-character",V)},se=()=>{u("create-character")};return(V,W)=>(t(),s("div",iv,[e("div",cv,[W[1]||(W[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-slate-100"},"Персонажи"),e("p",{class:"text-slate-400 mt-1"},"Выберите персонажа для управления")],-1)),e("div",rv,[e("button",{onClick:se,class:"px-4 py-2 rounded-lg bg-sky-500/20 border border-sky-400/60 text-sky-100 hover:bg-sky-500/30 transition flex items-center gap-2 font-semibold"},[k(c(q),{icon:"mdi:plus",class:"w-5 h-5"}),W[0]||(W[0]=oe(" Создать ",-1))])])]),e("div",dv,[(t(!0),s(N,null,K(m.characters,O=>{var ae,B,R,D,X;return t(),s("div",{key:O.id,onClick:d=>Y(O.id),class:G(["character-card",{"character-card-active":O.id===m.activeCharacterId}])},[O.id===m.activeCharacterId?(t(),s("div",fv,[k(c(q),{icon:"mdi:check-circle",class:"w-4 h-4"}),W[2]||(W[2]=oe(" Активен ",-1))])):g("",!0),e("div",vv,[e("div",pv,[k(It,{portrait:O.portrait,name:O.name,combat:O.combat,stats:O.stats,meleeDefence:c(Ze)(O,"melee"),rangedDefence:c(Ze)(O,"ranged"),showDefence:!0,defenceLayout:"left",size:"lg"},null,8,["portrait","name","combat","stats","meleeDefence","rangedDefence"]),e("div",mv,n(p(O)),1)]),e("div",hv,[e("h3",xv,n(O.name||"Без имени"),1),e("div",bv,[e("span",{class:"px-2 py-0.5 rounded text-xs font-semibold",style:ue({backgroundColor:`${(ae=_(O))==null?void 0:ae.color}20`,color:(B=_(O))==null?void 0:B.color,borderColor:`${(R=_(O))==null?void 0:R.color}40`,borderWidth:"1px"})},n(((D=_(O))==null?void 0:D.name)||"Класс"),5),E(O)?(t(),s("span",gv,[k(c(q),{icon:E(O).checkIcon,class:"w-3 h-3"},null,8,["icon"]),oe(" "+n(E(O).name),1)])):g("",!0)])])]),e("div",yv,[k(Ht,{combat:O.combat||{healthType:"simple",hp:0,maxHp:8,wounds:{scratch:0,light:0,heavy:0,deadly:0}},stats:O.stats||{},readonly:!0},null,8,["combat","stats"])]),e("div",_v,[e("div",kv,[k(c(q),{icon:"mdi:sword",class:"w-4 h-4 text-red-400"}),W[3]||(W[3]=e("span",{class:"text-xs text-slate-400"},"Оружие",-1)),e("span",$v,n(v(O)),1)]),e("div",wv,[k(c(q),{icon:"mdi:shield",class:"w-4 h-4 text-blue-400"}),W[4]||(W[4]=e("span",{class:"text-xs text-slate-400"},"Броня",-1)),e("span",Cv,n(A(O)),1)]),e("div",Sv,[k(c(q),{icon:"mdi:bag-personal",class:"w-4 h-4 text-amber-400"}),W[5]||(W[5]=e("span",{class:"text-xs text-slate-400"},"Предметы",-1)),e("span",Tv,n(((X=O.inventory)==null?void 0:X.length)||0),1)])]),e("div",Mv,[k(c(q),{icon:"mdi:arrow-right-circle",class:"w-8 h-8"}),W[6]||(W[6]=e("span",{class:"text-sm font-semibold"},"Открыть",-1))])],10,uv)}),128))]),m.characters.length===0?(t(),s("div",Dv,[e("div",Av,[k(c(q),{icon:"mdi:account-group",class:"w-16 h-16"})]),W[7]||(W[7]=e("h3",{class:"text-xl font-bold text-slate-300 mb-2"},"Нет персонажей",-1)),W[8]||(W[8]=e("p",{class:"text-slate-500 mb-4"},"Создайте первого персонажа для начала",-1)),e("button",{onClick:se,class:"px-6 py-3 rounded-lg bg-sky-500/20 border border-sky-400/60 text-sky-100 hover:bg-sky-500/30 transition font-semibold"}," Создать персонажа ")])):g("",!0)]))}},qv=Oe(Ev,[["__scopeId","data-v-483c3ab0"]]),jv={class:"h-full bg-slate-950 text-slate-50 overflow-y-auto"},Pv={key:1,class:"h-full flex flex-col"},Ov={__name:"CharacterSheet",setup(m){const L=nt(),u=Ke(),{showCharacterWizard:S,currentView:y}=He(L),{myCharacters:p,activeCharacter:_,activeCharacterId:E}=He(u),v=J(_.value?"detailed":"cards");Xe(E,B=>{B&&(v.value="detailed")});const A=j(()=>!!_.value);j(()=>p.value.length>0);const Y=()=>{L.openCharacterWizard(),y.value!=="character-sheet"&&L.setCurrentView("character-sheet")},se=()=>{L.closeCharacterWizard()},V=()=>{L.closeCharacterWizard(),v.value="cards"},W=B=>{u.setActiveCharacter(B),v.value="detailed"},O=()=>{v.value="cards"},ae=()=>{v.value="cards"};return(B,R)=>(t(),s("div",jv,[v.value==="cards"?(t(),Me(qv,{key:0,characters:c(p),"active-character-id":c(E),onSelectCharacter:W,onCreateCharacter:Y},null,8,["characters","active-character-id"])):v.value==="detailed"&&A.value?(t(),s("div",Pv,[e("div",{class:"sticky top-0 z-10 bg-slate-950/95 backdrop-blur-sm border-b border-slate-800 px-6 py-3"},[e("button",{onClick:O,class:"flex items-center gap-2 px-3 py-2 rounded-lg text-slate-300 hover:text-slate-100 hover:bg-slate-800/50 transition"},[...R[0]||(R[0]=[e("span",{class:"text-xl"},"←",-1),e("span",{class:"font-medium"},"Назад к списку",-1)])])]),k(av,{character:c(_),onClose:ae},null,8,["character"])])):g("",!0),c(S)?(t(),Me(Hc,{key:2,onClose:se,onCreated:V})):g("",!0)]))}},Bv={key:0,class:"splash-damage-content"},Wv={class:"damage-icon"},Vv={class:"damage-amount"},Xv={key:0,class:"damage-source"},Rv={key:1,class:"splash-heal-content"},Iv={class:"heal-icon"},Hv={class:"heal-amount"},Yv={key:2,class:"splash-effect-content"},zv={class:"effect-text"},Fv={key:3,class:"splash-notification-content"},Lv={class:"notification-text"},Nv={key:4,class:"splash-image-content"},Uv={key:1,class:"image-title"},Gv={class:"image-container"},Jv=["src","alt"],Zv={key:2,class:"image-caption"},Kv={key:0,class:"note-title"},Qv={class:"note-text"},e0={__name:"SplashOverlay",setup(m){const L=ot(),{currentSplash:u}=He(L),S=()=>{var A;((A=u.value)==null?void 0:A.dismissible)!==!1&&L.dismissSplash()},y=j(()=>{if(!u.value)return"";const A=u.value.splashType,Y="splash-overlay";switch(A){case"damage":return`${Y} splash-damage`;case"heal":return`${Y} splash-heal`;case"effect":return`${Y} splash-effect`;case"notification":return`${Y} splash-notification`;case"image":return`${Y} splash-image`;case"note":return`${Y} splash-note`;default:return Y}}),p=["💥","⚔️","🔥","⚡","💀"],_=["✨","💚","🌿","💫"],E=j(()=>p[Math.floor(Math.random()*p.length)]),v=j(()=>_[Math.floor(Math.random()*_.length)]);return(A,Y)=>(t(),Me(Ge,{to:"body"},[k(Xt,{name:"splash"},{default:Vt(()=>{var se,V,W,O,ae,B,R,D,X,d;return[c(u)?(t(),s("div",{key:0,class:G(y.value),onClick:S},[c(u).splashType==="damage"?(t(),s("div",Bv,[e("div",Wv,n(E.value),1),e("div",Vv,"-"+n(((se=c(u).content)==null?void 0:se.amount)||"?"),1),(V=c(u).content)!=null&&V.source?(t(),s("div",Xv,n(c(u).content.source),1)):g("",!0)])):c(u).splashType==="heal"?(t(),s("div",Rv,[e("div",Iv,n(v.value),1),e("div",Hv,"+"+n(((W=c(u).content)==null?void 0:W.amount)||"?"),1)])):c(u).splashType==="effect"?(t(),s("div",Yv,[e("div",zv,n(c(u).content),1)])):c(u).splashType==="notification"?(t(),s("div",Fv,[e("div",Lv,n(c(u).content),1)])):c(u).splashType==="image"?(t(),s("div",Nv,[c(u).dismissible!==!1?(t(),s("button",{key:0,class:"image-close-btn",onClick:ye(S,["stop"])}," ✕ ")):g("",!0),(O=c(u).content)!=null&&O.title?(t(),s("h2",Uv,n(c(u).content.title),1)):g("",!0),e("div",Gv,[e("img",{src:(ae=c(u).content)==null?void 0:ae.url,alt:((B=c(u).content)==null?void 0:B.caption)||"",class:"splash-img"},null,8,Jv)]),(R=c(u).content)!=null&&R.caption?(t(),s("p",Zv,n(c(u).content.caption),1)):g("",!0)])):c(u).splashType==="note"?(t(),s("div",{key:5,class:G(["splash-note-content",`note-style-${((D=c(u).content)==null?void 0:D.style)||"parchment"}`])},[e("button",{class:"note-close-btn",onClick:ye(S,["stop"])}," ✕ "),(X=c(u).content)!=null&&X.title?(t(),s("h2",Kv,n(c(u).content.title),1)):g("",!0),e("div",Qv,n((d=c(u).content)==null?void 0:d.text),1)],2)):g("",!0)],2)):g("",!0)]}),_:1})]))}},t0=Oe(e0,[["__scopeId","data-v-b1027c6f"]]),s0={key:0,class:"collapsed-preview"},l0={class:"collapsed-avatar"},n0=["src","alt"],o0={key:1,class:"avatar-fallback"},a0={class:"collapsed-info"},i0={class:"collapsed-name"},c0={key:0,class:"collapsed-hint"},r0={key:1,class:"expanded-content"},d0={class:"card-header"},u0={class:"character-name"},f0={key:0,class:"other-token-badge"},v0={class:"card-body"},p0={class:"portrait-section"},m0={class:"info-section"},h0={key:0,class:"wounds-display"},x0={class:"wounds-row"},b0={class:"wound-slots"},g0={class:"wounds-row"},y0={class:"wound-slots"},_0={class:"wounds-row"},k0={class:"wound-slots"},$0={class:"wounds-row"},w0={class:"wound-slots"},C0={key:1,class:"other-info"},S0={class:"info-row"},T0={class:"info-row"},M0={key:2,class:"terrain-info"},D0={class:"info-row"},A0={key:0,class:"info-row"},E0={key:1,class:"terrain-stats"},q0={key:2,class:"info-row distance-row"},ft=140,j0={__name:"MobileInfoCard",props:{selectedToken:{type:Object,default:null},selectedHex:{type:Object,default:null},playerCharacter:{type:Object,default:null},playerFacing:{type:Number,default:0},collapsed:{type:Boolean,default:!1},isPlayerTurn:{type:Boolean,default:!1},playerTokenPosition:{type:Object,default:null},alwaysShowPlayer:{type:Boolean,default:!1}},emits:["toggle-collapse","open-character-sheet","switch-equipment","move-to-hex"],setup(m,{emit:L}){const u=m,S=L,y=J(null),p=(o,h,I,H)=>(Math.abs(o-I)+Math.abs(o+h-I-H)+Math.abs(h-H))/2,_=j(()=>!u.selectedHex||!u.playerTokenPosition?null:p(u.playerTokenPosition.q,u.playerTokenPosition.r,u.selectedHex.q,u.selectedHex.r)),E=j(()=>{var o;return(o=u.selectedHex)!=null&&o.terrain?u.selectedHex.terrain.movementCost??1:1}),v=j(()=>{const o=E.value;return o>=5?"stat-blocked":o>=3?"stat-hard":o>=2?"stat-medium":"stat-easy"}),A=j(()=>{var o;return(o=u.selectedHex)!=null&&o.terrain?u.selectedHex.terrain.meleeAdvantage??0:0}),Y=j(()=>{const o=A.value;return o>0?`+${o}`:o<0?`${o}`:"0"}),se=j(()=>{const o=A.value;return o>0?"stat-bonus":o<0?"stat-penalty":"stat-neutral"}),V=j(()=>{var o;return(o=u.selectedHex)!=null&&o.terrain?u.selectedHex.terrain.visibility??"open":"open"}),W=j(()=>({open:"Откр.",partial:"Част.",blocking:"Блок."})[V.value]||V.value),O=j(()=>({open:"mdi:eye-outline",partial:"mdi:eye-off-outline",blocking:"mdi:eye-off"})[V.value]||"mdi:eye-outline"),ae=j(()=>({open:"stat-neutral",partial:"stat-medium",blocking:"stat-hard"})[V.value]||"stat-neutral"),B=j(()=>!(!u.selectedHex||u.selectedToken||!u.isPlayerTurn||!u.playerTokenPosition||u.selectedHex.q===u.playerTokenPosition.q&&u.selectedHex.r===u.playerTokenPosition.r||E.value>=5)),R=()=>{B.value&&S("move-to-hex",u.selectedHex)},D=j(()=>u.alwaysShowPlayer?!0:u.selectedHex&&!u.selectedToken?!1:u.selectedToken?u.playerCharacter?u.selectedToken.characterId===u.playerCharacter.id:!1:!0),X=j(()=>u.alwaysShowPlayer?!1:u.selectedHex&&!u.selectedToken),d=j(()=>{var o;return(o=u.selectedToken)!=null&&o.character?u.selectedToken.character:u.playerCharacter}),b=j(()=>{var o,h;return((h=(o=d.value)==null?void 0:o.combat)==null?void 0:h.wounds)||{scratch:0,light:0,heavy:0,deadly:0}}),T=j(()=>{var I;if(!d.value)return null;const o=d.value.stats||{},h=((I=d.value.combat)==null?void 0:I.bonusDeadlySlots)||0;return ps(o,h)}),l=j(()=>{var o;return(o=T.value)!=null&&o.scratch?T.value.scratch.base+T.value.scratch.bonus:0}),i=j(()=>{var o;return(o=T.value)!=null&&o.light?T.value.light.base+T.value.light.bonus:0}),r=j(()=>{var o;return(o=T.value)!=null&&o.heavy?T.value.heavy.base+T.value.heavy.bonus:0}),f=j(()=>{var o;return(o=T.value)!=null&&o.deadly?T.value.deadly.base+T.value.deadly.bonus:0}),x=o=>{if(o==null)return null;const h=Object.entries(Fe).map(([H,ne])=>({value:parseInt(H),...ne})).filter(H=>H.value>=0).sort((H,ne)=>H.value-ne.value);let I=h[0];for(const H of h)if(H.value<=o)I=H;else break;return I},z=(o,h,I,H)=>{const ne=(H-90)*Math.PI/180;return{x:o+I*Math.cos(ne),y:h+I*Math.sin(ne)}},U=(o,h,I,H,ne,ce,de=0,$e="left")=>{if(!ce)return;const he=ce.color||"#FFFFFF",ge=ce.linetype||"single";let ve;$e==="left"?ve={top:0,upper:300,lower:240,bottom:180}:ve={top:0,upper:60,lower:120,bottom:180};const F=z(h,I,H,ve.top+de),P=z(h,I,H,ve.upper+de),Q=z(h,I,H,ve.lower+de),$=z(h,I,H,ve.bottom+de);let w,ee;if(ne==="front")w=F,ee=P;else if(ne==="flank")w=P,ee=Q;else if(ne==="back")w=Q,ee=$;else return;if(o.lineCap="butt",o.strokeStyle=he,ge==="dashed")o.setLineDash([4,5]),o.lineWidth=2,o.beginPath(),o.moveTo(w.x,w.y),o.lineTo(ee.x,ee.y),o.stroke(),o.setLineDash([]);else if(ge==="double"){o.lineWidth=2,o.beginPath(),o.moveTo(w.x,w.y),o.lineTo(ee.x,ee.y),o.stroke();const be=H+3,_e=z(h,I,be,(ne==="front"?ve.top:ne==="flank"?ve.upper:ve.lower)+de),Se=z(h,I,be,(ne==="front"?ve.upper:ne==="flank"?ve.lower:ve.bottom)+de);o.setLineDash([4,5]),o.lineWidth=2,o.beginPath(),o.moveTo(_e.x,_e.y),o.lineTo(Se.x,Se.y),o.stroke(),o.setLineDash([])}else o.lineWidth=2,o.beginPath(),o.moveTo(w.x,w.y),o.lineTo(ee.x,ee.y),o.stroke()},le=(o,h,I,H,ne,ce,de=0,$e="left")=>{if(!ce)return;const he=ce.color||"#FFFFFF",ge=ce.linetype||"single";let ve,F;if($e==="left")if(ne==="front")ve=300,F=360;else if(ne==="flank")ve=240,F=300;else if(ne==="back")ve=180,F=240;else return;else if(ne==="front")ve=0,F=60;else if(ne==="flank")ve=60,F=120;else if(ne==="back")ve=120,F=180;else return;ve+=de,F+=de;const P=(ve-90)*Math.PI/180,Q=(F-90)*Math.PI/180;if(o.lineCap="butt",o.strokeStyle=he,ge==="dashed")o.setLineDash([4,5]),o.lineWidth=2,o.beginPath(),o.arc(h,I,H,P,Q),o.stroke(),o.setLineDash([]);else if(ge==="double"){o.lineWidth=2,o.beginPath(),o.arc(h,I,H,P,Q),o.stroke();const $=H+3;o.setLineDash([4,5]),o.lineWidth=2,o.beginPath(),o.arc(h,I,$,P,Q),o.stroke(),o.setLineDash([])}else o.lineWidth=2,o.beginPath(),o.arc(h,I,H,P,Q),o.stroke()},me=async()=>{var be,_e;const o=y.value;if(!o)return;const h=o.getContext("2d"),I=ft,H=I/2,ne=I/2,ce=I/2-30;h.clearRect(0,0,I,I);const de=d.value;if(!de){h.fillStyle="#1e293b",h.beginPath(),h.arc(H,ne,ce,0,Math.PI*2),h.fill(),h.strokeStyle="rgba(255, 255, 255, 0.3)",h.lineWidth=2,h.stroke(),h.fillStyle="#64748b",h.font=`bold ${ce}px sans-serif`,h.textAlign="center",h.textBaseline="middle",h.fillText("?",H,ne);return}const $e=qt(de.portrait);$e&&await hs($e);const he=b.value,ge=T.value;xs(h,H,ne,ce,de.portrait,de.name,he,ge),he&&ge&&(bs(h,H,ne,ce,he,ge),gs(h,H,ne,ce,he,ge));let ve=(be=u.selectedToken)==null?void 0:be.meleeDefence,F=(_e=u.selectedToken)==null?void 0:_e.rangedDefence;if(!ve&&de&&(ve=Ze(de,"melee")),!F&&de&&(F=Ze(de,"ranged")),!ve&&!F)return;const P=(u.playerFacing||0)*60,Q=ce+14,$=Q+6,w=["front","flank","back"],ee=["left","right"];if(ve)for(const Se of ee)for(const Ee of w){const qe=ve[Ee];if(qe!=null){const Qe=x(qe);U(h,H,ne,Q,Ee,Qe,P,Se)}}if(F)for(const Se of ee)for(const Ee of w){const qe=F[Ee];if(qe!=null){const Qe=x(qe);le(h,H,ne,$,Ee,Qe,P,Se)}}},ie=()=>{u.collapsed&&S("toggle-collapse")};return Xe(()=>[u.selectedToken,u.playerCharacter,u.playerFacing,u.collapsed],async()=>{await Mt(),u.collapsed||me()},{immediate:!0,deep:!0}),ht(async()=>{await Mt(),u.collapsed||me()}),(o,h)=>{var I,H,ne,ce,de,$e;return t(),s("div",{class:G(["mobile-info-card",{collapsed:m.collapsed,"own-token":D.value}]),onClick:ie},[m.collapsed?(t(),s("div",s0,[e("div",l0,[(I=d.value)!=null&&I.portrait?(t(),s("img",{key:0,src:c(qt)(d.value.portrait),alt:d.value.name},null,8,n0)):(t(),s("div",o0,n(((ce=(ne=(H=d.value)==null?void 0:H.name)==null?void 0:ne.charAt(0))==null?void 0:ce.toUpperCase())||"?"),1))]),e("div",a0,[e("span",i0,n(((de=d.value)==null?void 0:de.name)||"Неизвестно"),1),D.value?g("",!0):(t(),s("span",c0,"нажмите для подробностей"))]),k(c(q),{icon:"mdi:chevron-up",class:"collapse-icon"})])):(t(),s("div",r0,[e("div",d0,[e("button",{class:"collapse-btn",onClick:h[0]||(h[0]=ye(he=>o.$emit("toggle-collapse"),["stop"]))},[k(c(q),{icon:"mdi:chevron-down",class:"w-5 h-5"})]),e("span",u0,n((($e=d.value)==null?void 0:$e.name)||"Неизвестно"),1),!D.value&&m.selectedToken?(t(),s("span",f0,"Чужой")):g("",!0),D.value?(t(),s("button",{key:1,class:"header-action-btn",onClick:h[1]||(h[1]=ye(he=>{var ge;return o.$emit("open-character-sheet",(ge=d.value)==null?void 0:ge.id)},["stop"]))},[k(c(q),{icon:"mdi:file-document-outline",class:"w-4 h-4"})])):g("",!0)]),e("div",v0,[e("div",p0,[e("canvas",{ref_key:"defenceCanvas",ref:y,width:ft,height:ft,class:"defence-canvas"},null,512)]),e("div",m0,[D.value&&d.value?(t(),s("div",h0,[e("div",x0,[h[2]||(h[2]=e("span",{class:"wound-label"},"Царапины:",-1)),e("div",b0,[(t(!0),s(N,null,K(l.value,he=>(t(),s("div",{key:"scratch-"+he,class:G(["wound-slot scratch",{filled:he<=b.value.scratch}])},null,2))),128))])]),e("div",g0,[h[3]||(h[3]=e("span",{class:"wound-label"},"Лёгкие:",-1)),e("div",y0,[(t(!0),s(N,null,K(i.value,he=>(t(),s("div",{key:"light-"+he,class:G(["wound-slot light",{filled:he<=b.value.light}])},null,2))),128))])]),e("div",_0,[h[4]||(h[4]=e("span",{class:"wound-label"},"Тяжёлые:",-1)),e("div",k0,[(t(!0),s(N,null,K(r.value,he=>(t(),s("div",{key:"heavy-"+he,class:G(["wound-slot heavy",{filled:he<=b.value.heavy}])},null,2))),128))])]),e("div",$0,[h[5]||(h[5]=e("span",{class:"wound-label"},"Смерт.:",-1)),e("div",w0,[(t(!0),s(N,null,K(f.value,he=>(t(),s("div",{key:"deadly-"+he,class:G(["wound-slot deadly",{filled:he<=b.value.deadly}])},null,2))),128))])])])):!D.value&&!X.value&&d.value?(t(),s("div",C0,[e("div",S0,[k(c(q),{icon:"mdi:account",class:"w-4 h-4 text-slate-400"}),e("span",null,n(d.value.race||"Неизвестная раса"),1)]),e("div",T0,[k(c(q),{icon:"mdi:sword",class:"w-4 h-4 text-slate-400"}),e("span",null,n(d.value.class||"Неизвестный класс"),1)])])):X.value?(t(),s("div",M0,[e("div",D0,[k(c(q),{icon:"mdi:map-marker",class:"w-4 h-4 text-slate-400"}),e("span",null,"Гекс "+n(m.selectedHex.q)+", "+n(m.selectedHex.r),1)]),m.selectedHex.terrain?(t(),s("div",A0,[k(c(q),{icon:"mdi:terrain",class:"w-4 h-4 text-slate-400"}),e("span",null,n(m.selectedHex.terrain.name||"Неизвестная местность"),1)])):g("",!0),m.selectedHex.terrain?(t(),s("div",E0,[e("div",{class:G(["stat-item",v.value])},[k(c(q),{icon:"mdi:walk",class:"w-3.5 h-3.5"}),e("span",null,n(E.value),1)],2),e("div",{class:G(["stat-item",se.value])},[k(c(q),{icon:"mdi:sword-cross",class:"w-3.5 h-3.5"}),e("span",null,n(Y.value),1)],2),e("div",{class:G(["stat-item",ae.value])},[k(c(q),{icon:O.value,class:"w-3.5 h-3.5"},null,8,["icon"]),e("span",null,n(W.value),1)],2)])):g("",!0),_.value!==null?(t(),s("div",q0,[k(c(q),{icon:"mdi:map-marker-distance",class:"w-4 h-4 text-sky-400"}),e("span",null,n(_.value)+" гекс"+n(_.value===1?"":_.value<5?"а":"ов"),1)])):g("",!0),B.value?(t(),s("button",{key:3,class:"move-btn",onClick:ye(R,["stop"])},[k(c(q),{icon:"mdi:run",class:"w-4 h-4"}),h[6]||(h[6]=e("span",null,"Переместиться",-1))])):g("",!0)])):g("",!0)])])]))],2)}}},Ot=Oe(j0,[["__scopeId","data-v-ff7daa7f"]]);function P0(m){var L;for(const u of at.classes){const S=(L=u.traits)==null?void 0:L.find(y=>y.id===m);if(S)return{sourceType:"class",sourceId:u.id,trait:S}}return null}function O0(m){var L;for(const u of Pe.aspects){const S=(L=u.traits)==null?void 0:L.find(y=>y.id===m);if(S)return{sourceType:"aspect",sourceId:u.id,trait:S}}return null}function B0(m){var L;for(const u of bt.races){const S=(L=u.traits)==null?void 0:L.find(y=>y.id===m);if(S)return{sourceType:"race",sourceId:u.id,trait:S}}return null}function mt(m){return P0(m)||O0(m)||B0(m)||null}function W0(m){if(typeof m=="object"&&m!==null){if(m.id&&m.sourceType&&m.sourceId){const L={id:m.id,sourceType:m.sourceType,sourceId:m.sourceId,level:m.level||1,customDescriptions:m.customDescriptions||{},customTags:m.customTags||{}};return m.customColor&&(L.customColor=m.customColor),L}if(m.id){const L=mt(m.id);if(L)return{id:m.id,sourceType:L.sourceType,sourceId:L.sourceId,level:m.level||1,customDescriptions:m.customDescriptions||m.customDescription?{[m.level||1]:m.customDescription}:{},customTags:m.customTags||{}}}return null}if(typeof m=="string"){const L=mt(m);return L?{id:m,sourceType:L.sourceType,sourceId:L.sourceId,level:1,customDescriptions:{},customTags:{}}:(console.warn(`[SkillsMigration] Навык "${m}" не найден ни в одном источнике`),null)}return null}function V0(m){if(!Array.isArray(m))return{migrated:[],needsSave:!1};let L=!1;const u=[];for(const S of m){(typeof S=="string"||typeof S=="object"&&S&&!S.sourceType)&&(L=!0);const p=W0(S);p&&u.push(p)}return{migrated:u,needsSave:L}}function X0(m){var R,D,X,d,b,T,l,i,r,f;const L=mt(m.id);if(!L)return{...m,name:m.id,maxLevel:1,levels:[],sourceName:"Неизвестно",sourceIcon:"mdi:help-circle",sourceColor:"#94a3b8",aspectColor:"#94a3b8",currentDescription:""};const u=L.trait,S=((R=u.levels)==null?void 0:R.length)||1;let y="",p="mdi:help-circle",_="#94a3b8",E=null,v="#94a3b8",A=null,Y=null;if(L.sourceType==="class"){const x=at.classes.find(U=>U.id===L.sourceId);if(p="mdi:school",y=x?x.name.m||x.name:L.sourceId,E=`/TriP/images/classes/${L.sourceId}.png`,(D=x==null?void 0:x.aspects)!=null&&D[0]){A=x.aspects[0];const U=Pe.aspects.find(le=>le.id===A);U&&(v=U.color||"#94a3b8",Y=U.icon)}}else if(L.sourceType==="aspect"){const x=Pe.aspects.find(z=>z.id===L.sourceId);p=(x==null?void 0:x.icon)||"mdi:hexagon",_=(x==null?void 0:x.color)||"#94a3b8",v=_,Y=x==null?void 0:x.icon,y=(x==null?void 0:x.name)||L.sourceId,A=L.sourceId}else if(L.sourceType==="race"){const x=bt.races.find(z=>z.id===L.sourceId);p="mdi:account",y=(x==null?void 0:x.name)||L.sourceId}const se=[];for(let x=0;x<m.level;x++){const z=(X=u.levels)==null?void 0:X[x];z&&se.push({level:x+1,description:z.text||z.description||"",customDescription:((d=m.customDescriptions)==null?void 0:d[x+1])||"",customTags:((b=m.customTags)==null?void 0:b[x+1])||[]})}const V=(T=u.levels)==null?void 0:T[m.level-1],W=(V==null?void 0:V.text)||(V==null?void 0:V.description)||"",O=((l=m.customDescriptions)==null?void 0:l[0])||((i=m.customDescriptions)==null?void 0:i[m.level])||"",ae=((r=m.customTags)==null?void 0:r[0])||((f=m.customTags)==null?void 0:f[m.level])||[],B=m.customColor||null;return{id:m.id,name:u.name,sourceType:m.sourceType,sourceId:m.sourceId,level:m.level,maxLevel:S,levels:u.levels||[],unlockedLevels:se,sourceName:y,sourceIcon:p,sourceColor:_,sourceImage:E,aspectId:A,aspectColor:v,aspectIcon:Y,currentDescription:W,customDescription:O,customTags:ae,customColor:B,customDescriptions:m.customDescriptions||{},allCustomTags:m.customTags||{}}}const R0={key:0,class:"character-tabs"},I0=["onClick"],H0=["src","alt"],Y0={key:1,class:"char-tab-avatar-fallback"},z0={class:"char-tab-name"},F0={key:1,class:"sheet-tabs-row"},L0=["onClick"],N0={class:"tab-label"},U0={key:2,class:"sheet-content"},G0={class:"tab-content tab-content-bottom"},J0={class:"skills-section"},Z0={class:"skills-header"},K0={class:"skills-controls"},Q0=["title"],ep={key:0,class:"skills-list"},tp=["onClick"],sp={class:"skill-info"},lp={class:"skill-name"},np={class:"skill-level"},op={class:"skill-source"},ap={class:"skill-source-name"},ip={key:0,class:"skill-description"},cp={class:"skill-levels-list"},rp={class:"skill-level-badge"},dp={key:1,class:"skill-custom-note"},up={key:2,class:"skill-hidden-hint"},fp=["onClick"],vp={key:1,class:"skills-empty"},pp={key:2,class:"skills-filter"},mp={class:"skill-details-title"},hp={class:"skill-details-name"},xp={class:"skill-details-level"},bp={class:"skill-details-body"},gp={class:"skill-details-levels"},yp={class:"skill-details-level-badge"},_p={class:"skill-details-desc-text"},kp={class:"skill-details-section"},$p=["value"],wp={class:"skill-details-section"},Cp=["value"],Sp={class:"skill-details-section"},Tp={class:"skill-color-picker"},Mp=["title","onClick"],Dp={class:"action-mode-section"},Ap={class:"mode-header"},Ep={class:"mode-header-center"},qp={class:"mode-active-name"},jp={class:"mode-buttons"},Pp=["onClick","title"],Op=["onClick"],Bp={key:1,class:"mode-info-panel"},Wp={class:"mode-details-name"},Vp={class:"mode-details-desc"},Xp={class:"checks-section"},Rp={class:"checks-table-container"},Ip={class:"aspects-column"},Hp={class:"aspect-name"},Yp={class:"checks-scroll-area"},zp={class:"checks-grid"},Fp={class:"diff-headers-row"},Lp=["title"],Np={class:"tab-content"},Up={class:"section-card"},Gp={class:"section-card"},Jp={class:"tab-content"},Zp={class:"section-card placeholder"},Kp={class:"tab-content"},Qp={class:"section-card placeholder"},em={key:3,class:"empty-state"},tm={__name:"MobileCharacterSheet",props:{character:{type:Object,default:null},embedded:{type:Boolean,default:!1},activeTab:{type:String,default:"main"}},emits:["close","switch-tab","update:activeTab"],setup(m,{emit:L}){const u=m,S=L,y=Ke();ot();const p=nt(),{myCharacters:_,activeCharacter:E,activeCharacterId:v}=He(y),A=j(()=>u.character||E.value),Y=[{id:"main",label:"Основное",icon:"mdi:account"},{id:"items",label:"Вещи",icon:"mdi:bag-personal"},{id:"social",label:"Социум",icon:"mdi:account-group"},{id:"magic",label:"Магия",icon:"mdi:auto-fix"}],se=J("main"),V=j({get:()=>u.embedded?u.activeTab:se.value,set:F=>{u.embedded?S("update:activeTab",F):se.value=F}}),W=F=>{y.setActiveCharacter(F)},O=j(()=>{var P;return(((P=Pe.metadata)==null?void 0:P.circularOrder)||Pe.aspects.map(Q=>Q.id)).map(Q=>Pe.aspects.find($=>$.id===Q)).filter(Boolean)}),ae=j(()=>O.value.filter(F=>F.mode)),B=J(null),R=J(!1),D=J(null),X=j(()=>{if(!B.value)return"не выбран";const F=ae.value.find(P=>P.id===B.value);return F?F.mode.name:"не выбран"}),d=F=>{B.value=B.value===F?null:F},b=F=>{D.value=F},T=J(!1),l=J(!0),i=J(""),r=J(null),f=j(()=>{var F;return(F=A.value)!=null&&F.id?p.getSkillPreferences(A.value.id):{expandedSkills:[],allExpanded:!0}}),x=F=>f.value.allExpanded?!f.value.expandedSkills.includes(F):f.value.expandedSkills.includes(F),z=F=>{var $;if(!(($=A.value)!=null&&$.id))return;const P=A.value.id,Q=x(F);f.value.allExpanded?p.setSkillExpanded(P,F,Q):p.setSkillExpanded(P,F,!Q)},U=()=>{var F;(F=A.value)!=null&&F.id&&p.setAllSkillsExpanded(A.value.id,!f.value.allExpanded)},le=j(()=>{var Q;if(!((Q=A.value)!=null&&Q.skills))return[];const{migrated:F,needsSave:P}=V0(A.value.skills);return P&&A.value.id&&(console.log("[Skills] Миграция навыков персонажа",A.value.name),y.updateCharacter(A.value.id,{skills:F})),F.map($=>X0($)).filter(Boolean)}),me=j(()=>{const F=i.value.toLowerCase().trim();if(!F)return le.value;const P=Q=>{var Ee,qe;let $=0;const w=Q.name.toLowerCase(),ee=Q.sourceName.toLowerCase(),be=((Ee=Q.currentDescription)==null?void 0:Ee.toLowerCase())||"",_e=((qe=Q.customDescription)==null?void 0:qe.toLowerCase())||"",Se=(Q.customTags||[]).join(" ").toLowerCase();return w===F?$+=100:w.startsWith(F)?$+=50:w.includes(F)&&($+=30),ee.includes(F)&&($+=15),Se.includes(F)&&($+=20),_e.includes(F)&&($+=10),be.includes(F)&&($+=5),$};return le.value.map(Q=>({skill:Q,relevance:P(Q)})).filter(Q=>Q.relevance>0).sort((Q,$)=>$.relevance-Q.relevance).map(Q=>Q.skill)}),ie=F=>{r.value=F.id},o=()=>{r.value=null},h=j(()=>r.value&&le.value.find(F=>F.id===r.value)||null),I=(F,P,Q)=>{if(!A.value)return;const $=[...A.value.skills||[]],w=$.findIndex(ee=>ee.id===F);if(w>=0){const ee={...$[w]};ee.customDescriptions={...ee.customDescriptions,[P]:Q},$[w]=ee,y.updateCharacter(A.value.id,{skills:$})}},H=(F,P,Q)=>{if(!A.value)return;const $=[...A.value.skills||[]],w=$.findIndex(ee=>ee.id===F);if(w>=0){const ee={...$[w]};ee.customTags={...ee.customTags,[P]:Q},$[w]=ee,y.updateCharacter(A.value.id,{skills:$})}},ne=[{name:"Красный",value:"#ef4444"},{name:"Оранжевый",value:"#f97316"},{name:"Жёлтый",value:"#eab308"},{name:"Зелёный",value:"#22c55e"},{name:"Бирюзовый",value:"#14b8a6"},{name:"Голубой",value:"#06b6d4"},{name:"Синий",value:"#3b82f6"},{name:"Фиолетовый",value:"#8b5cf6"},{name:"Розовый",value:"#ec4899"},{name:"Серый",value:"#64748b"}],ce=(F,P)=>{if(!A.value)return;const Q=[...A.value.skills||[]],$=Q.findIndex(w=>w.id===F);if($>=0){const w={...Q[$]};P?w.customColor=P:delete w.customColor,Q[$]=w,y.updateCharacter(A.value.id,{skills:Q})}},de=j(()=>{const F=Fe.default||Fe;return Object.entries(F).map(([P,Q])=>({value:parseInt(P),...Q})).sort((P,Q)=>P.value-Q.value)}),$e=F=>pt(A.value,F),he=(F,P)=>{const Q=$e(F),$=P-Q;return $<=2?{type:"auto",value:"✓"}:$<=12?{type:"roll",value:$}:{type:"fail",value:"✗"}},ge=F=>{y.updateCharacter(F.id,F)},ve=F=>{var P;if(A.value){if(F.category==="armor"){const Q={...A.value,equipment:{...A.value.equipment,armor:F.id}};ge(Q)}else if(F.category==="weapon"||F.category==="shield"){const Q=[...((P=A.value.equipment)==null?void 0:P.weaponSets)||[]],$={...Q[0]},w=$.weapons.map(_e=>Re.items.find(Se=>Se.id===_e)).filter(Boolean);w.push(F);const ee=w.reduce((_e,Se)=>_e+(Se.hands||0),0),be=w.filter(_e=>_e.length===2).length;if(ee<=2&&be<=1){$.weapons=[...$.weapons,F.id],Q[0]=$;const _e={...A.value,equipment:{...A.value.equipment,weaponSets:Q}};ge(_e)}}}};return(F,P)=>{var Q;return t(),s("div",{class:G(["mobile-character-sheet",{embedded:m.embedded}])},[!m.embedded&&c(_).length>1?(t(),s("div",R0,[(t(!0),s(N,null,K(c(_),$=>{var w,ee;return t(),s("button",{key:$.id,class:G(["char-tab",{active:c(v)===$.id}]),onClick:be=>W($.id)},[$.portrait?(t(),s("img",{key:0,src:$.portrait,alt:$.name,class:"char-tab-avatar"},null,8,H0)):(t(),s("span",Y0,n(((ee=(w=$.name)==null?void 0:w.charAt(0))==null?void 0:ee.toUpperCase())||"?"),1)),e("span",z0,n($.name),1)],10,I0)}),128))])):g("",!0),m.embedded?g("",!0):(t(),s("div",F0,[(t(),s(N,null,K(Y,$=>e("button",{key:$.id,class:G(["sheet-tab-btn",{active:V.value===$.id}]),onClick:w=>V.value=$.id},[k(c(q),{icon:$.icon,class:"tab-icon"},null,8,["icon"]),e("span",N0,n($.label),1)],10,L0)),64))])),A.value?(t(),s("div",U0,[je(e("div",G0,[e("div",J0,[e("div",Z0,[P[12]||(P[12]=e("span",{class:"skills-title"},"НАВЫКИ И ОСОБЕННОСТИ",-1)),e("div",K0,[e("button",{class:G(["skills-toggle-desc",{active:!l.value}]),onClick:P[0]||(P[0]=$=>l.value=!l.value),title:"Скрыть/показать оригинальные описания"},[k(c(q),{icon:"mdi:text-box-remove"})],2),e("button",{class:G(["skills-toggle-desc",{active:T.value}]),onClick:P[1]||(P[1]=$=>T.value=!T.value),title:"Показать свои заметки"},[k(c(q),{icon:"mdi:note-edit"})],2),e("button",{class:"skills-toggle-expand",onClick:U,title:f.value.allExpanded?"Свернуть все":"Развернуть все"},[k(c(q),{icon:f.value.allExpanded?"mdi:unfold-less-horizontal":"mdi:unfold-more-horizontal"},null,8,["icon"])],8,Q0)])]),le.value.length>0?(t(),s("div",ep,[(t(!0),s(N,null,K(me.value,$=>(t(),s("div",{key:$.id,class:G(["skill-item",{expanded:x($.id)}]),style:ue({"--skill-color":$.customColor||$.aspectColor})},[e("div",{class:"skill-main",onClick:w=>z($.id)},[e("div",sp,[e("span",lp,n($.name),1),e("span",np,n($.level)+"/"+n($.maxLevel),1)]),e("div",op,[e("span",ap,n($.sourceName),1),k(c(q),{icon:x($.id)?"mdi:chevron-up":"mdi:chevron-down",class:"skill-expand-icon"},null,8,["icon"])])],8,tp),x($.id)?(t(),s("div",ip,[$.sourceType==="class"&&$.sourceImage?(t(),s("div",{key:0,class:"skill-bg-image",style:ue({backgroundImage:`url(${$.sourceImage})`})},null,4)):g("",!0),e("div",cp,[l.value?(t(!0),s(N,{key:0},K($.unlockedLevels,w=>(t(),s("div",{key:w.level,class:"skill-level-item"},[e("span",rp,n(w.level),1),e("p",null,n(w.description),1)]))),128)):g("",!0),T.value&&$.customDescription?(t(),s("div",dp,[P[13]||(P[13]=e("span",{class:"skill-note-badge"},"📝",-1)),e("p",null,n($.customDescription),1)])):g("",!0),!l.value&&!(T.value&&$.customDescription)?(t(),s("div",up,[k(c(q),{icon:"mdi:eye-off"}),P[14]||(P[14]=e("span",null,"Описания скрыты",-1))])):g("",!0)]),e("button",{class:"skill-details-btn",onClick:ye(w=>ie($),["stop"])},[k(c(q),{icon:"mdi:dots-horizontal"})],8,fp)])):g("",!0)],6))),128))])):(t(),s("div",vp,[k(c(q),{icon:"mdi:book-open-variant",class:"skills-empty-icon"}),P[15]||(P[15]=e("span",null,"Навыки появятся по мере развития персонажа",-1))])),le.value.length>0?(t(),s("div",pp,[k(c(q),{icon:"mdi:magnify",class:"skills-filter-icon"}),je(e("input",{type:"text","onUpdate:modelValue":P[2]||(P[2]=$=>i.value=$),placeholder:"Поиск навыков...",class:"skills-filter-input"},null,512),[[Je,i.value]]),i.value?(t(),s("button",{key:0,class:"skills-filter-clear",onClick:P[3]||(P[3]=$=>i.value="")},[k(c(q),{icon:"mdi:close"})])):g("",!0)])):g("",!0)]),h.value?(t(),s("div",{key:0,class:"skill-details-overlay",onClick:o},[e("div",{class:"skill-details-card",onClick:P[7]||(P[7]=ye(()=>{},["stop"]))},[e("div",{class:"skill-details-header",style:ue({borderColor:h.value.customColor||h.value.aspectColor})},[k(c(q),{icon:h.value.sourceIcon,class:"skill-details-source-icon"},null,8,["icon"]),e("div",mp,[e("span",hp,n(h.value.name),1),e("span",xp,"Уровень "+n(h.value.level)+" / "+n(h.value.maxLevel),1)]),e("button",{class:"skill-details-close-btn",onClick:o},[k(c(q),{icon:"mdi:close"})])],4),e("div",bp,[e("div",gp,[(t(!0),s(N,null,K(h.value.unlockedLevels,$=>(t(),s("div",{key:$.level,class:"skill-details-level"},[e("span",yp,n($.level),1),e("p",_p,n($.description),1)]))),128))]),e("div",kp,[P[16]||(P[16]=e("h4",null,"Заметка",-1)),e("textarea",{class:"skill-custom-desc-input",value:h.value.customDescription,onInput:P[4]||(P[4]=$=>I(h.value.id,0,$.target.value)),placeholder:"Добавьте заметку к навыку..."},null,40,$p)]),e("div",wp,[P[17]||(P[17]=e("h4",null,"Теги для поиска",-1)),e("input",{type:"text",class:"skill-tags-input",value:(Q=h.value.customTags)==null?void 0:Q.join(", "),onInput:P[5]||(P[5]=$=>H(h.value.id,0,$.target.value.split(",").map(w=>w.trim()).filter(Boolean))),placeholder:"тег1, тег2, тег3..."},null,40,Cp)]),e("div",Sp,[P[18]||(P[18]=e("h4",null,"Цвет метки",-1)),e("div",Tp,[(t(),s(N,null,K(ne,$=>e("button",{key:$.value,class:G(["skill-color-option",{active:(h.value.customColor||h.value.aspectColor)===$.value}]),style:ue({backgroundColor:$.value}),title:$.name,onClick:w=>ce(h.value.id,$.value)},null,14,Mp)),64)),e("button",{class:G(["skill-color-option reset",{active:!h.value.customColor}]),title:"Сбросить (цвет аспекта)",onClick:P[6]||(P[6]=$=>ce(h.value.id,null))},[k(c(q),{icon:"mdi:refresh"})],2)])])])])])):g("",!0),e("div",Dp,[e("div",Ap,[e("div",Ep,[P[19]||(P[19]=e("span",{class:"mode-title"},"РЕЖИМ ДЕЙСТВИЙ:",-1)),e("span",qp,n(X.value),1)]),e("button",{class:"mode-info-btn",onClick:P[8]||(P[8]=$=>R.value=!R.value)},[k(c(q),{icon:"mdi:information-outline"})])]),e("div",jp,[(t(!0),s(N,null,K(ae.value,$=>(t(),s("button",{key:$.id,class:G(["mode-btn",{active:B.value===$.id}]),style:ue({"--mode-color":$.color}),onClick:w=>d($.id),title:$.mode.name},[k(c(q),{icon:$.mode.icon,class:"mode-icon"},null,8,["icon"]),e("button",{class:"mode-detail-btn",onClick:ye(w=>b($),["stop"])},[k(c(q),{icon:"mdi:help-circle-outline"})],8,Op)],14,Pp))),128))])]),R.value?(t(),s("div",Bp,[...P[20]||(P[20]=[e("p",null,"Выбранный режим виден мастеру и влияет на контекст сцены.",-1),e("p",null,"При высоких показателях соответствующего Атрибута режимы становятся эффективнее и дают особые бонусы.",-1),e("p",null,"По умолчанию можно выбрать только один режим. Особые умения увеличивают лимит.",-1),e("p",{class:"mode-info-warning"},"В бою режимы менять нельзя.",-1)])])):g("",!0),D.value?(t(),s("div",{key:2,class:"mode-details-overlay",onClick:P[11]||(P[11]=$=>D.value=null)},[e("div",{class:"mode-details-card",onClick:P[10]||(P[10]=ye(()=>{},["stop"]))},[e("div",{class:"mode-details-header",style:ue({color:D.value.color})},[k(c(q),{icon:D.value.mode.icon,class:"mode-details-icon"},null,8,["icon"]),e("span",Wp,n(D.value.mode.name),1)],4),e("p",Vp,n(D.value.mode.description),1),P[21]||(P[21]=e("div",{class:"mode-details-info"},[e("p",null,"Мастер видит ваш выбранный режим. Контекст сцены может меняться в зависимости от вашего подхода.")],-1)),e("button",{class:"mode-details-close",onClick:P[9]||(P[9]=$=>D.value=null)},"Закрыть")])])):g("",!0),e("div",Xp,[e("div",Rp,[e("div",Ip,[P[22]||(P[22]=e("div",{class:"aspect-header-cell"},[e("span",{class:"checks-title"},"ПРОВЕРКИ")],-1)),(t(!0),s(N,null,K(O.value,$=>{var w;return t(),s("div",{key:$.id,class:"aspect-row-cell",style:ue({color:$.color})},[k(c(q),{icon:$.checkIcon||$.icon||"mdi:circle",class:"aspect-icon"},null,8,["icon"]),e("span",Hp,n(((w=$.check)==null?void 0:w.name)||$.name),1)],4)}),128))]),e("div",Yp,[e("div",zp,[e("div",Fp,[(t(!0),s(N,null,K(de.value,$=>(t(),s("div",{key:$.value,class:G(["diff-header-cell","linetype-"+$.linetype]),style:ue({"--diff-color":$.color}),title:$.name},n($.short),15,Lp))),128))]),(t(!0),s(N,null,K(O.value,$=>(t(),s("div",{key:$.id,class:"checks-row"},[(t(!0),s(N,null,K(de.value,w=>(t(),s("div",{key:w.value,class:G(["check-cell",["linetype-"+w.linetype,he($.id,w.value).type]]),style:ue({"--diff-color":w.color})},n(he($.id,w.value).value),7))),128))]))),128))])])])])],512),[[ze,V.value==="main"]]),je(e("div",Np,[e("div",Up,[P[23]||(P[23]=e("h2",{class:"section-title"},"Снаряжение",-1)),k(Ft,{character:A.value,onUpdate:ge},null,8,["character"])]),e("div",Gp,[P[24]||(P[24]=e("h2",{class:"section-title"},"Инвентарь",-1)),k(Lt,{character:A.value,onEquip:ve},null,8,["character"])])],512),[[ze,V.value==="items"]]),je(e("div",Jp,[e("div",Zp,[k(c(q),{icon:"mdi:account-group",class:"placeholder-icon"}),P[25]||(P[25]=e("p",null,"Социальные связи",-1)),P[26]||(P[26]=e("span",{class:"placeholder-hint"},"В разработке",-1))])],512),[[ze,V.value==="social"]]),je(e("div",Kp,[e("div",Qp,[k(c(q),{icon:"mdi:auto-fix",class:"placeholder-icon"}),P[27]||(P[27]=e("p",null,"Магические способности",-1)),P[28]||(P[28]=e("span",{class:"placeholder-hint"},"В разработке",-1))])],512),[[ze,V.value==="magic"]])])):(t(),s("div",em,[k(c(q),{icon:"mdi:account-off",class:"empty-icon"}),P[29]||(P[29]=e("p",null,"Персонаж не выбран",-1))]))],2)}}},sm=Oe(tm,[["__scopeId","data-v-61e205d0"]]),lm={key:0,class:"collapsed-header"},nm={class:"panel-header"},om={class:"workspace"},am={class:"screen screen-map"},im={class:"screen screen-character"},cm={class:"screen screen-chat"},rm={key:0,class:"pending-action"},dm={class:"action-info"},um={class:"action-controls"},fm=["disabled"],vm={key:1,class:"action-buttons"},pm=["onClick"],mm={class:"btn-label"},hm={key:1,class:"sheet-tabs"},xm=["onClick"],bm={class:"tab-label"},gm={key:2,class:"chat-actions"},ym={class:"nav-bar"},_m={class:"nav-tabs"},km=["onClick"],$m={class:"status-text"},wm={__name:"MobileGameLayout",props:{character:{type:Object,default:null},characters:{type:Array,default:()=>[]},selectedToken:{type:Object,default:null},selectedHex:{type:Object,default:null},playerFacing:{type:Number,default:0},playerTokenPosition:{type:Object,default:null},connectionStatus:{type:String,default:"disconnected"},currentTurn:{type:Object,default:null},isPlayerTurn:{type:Boolean,default:!1},pendingAction:{type:Object,default:null},reactionPrompt:{type:Object,default:null}},emits:["leave-room","set-view","select-action","confirm-action","cancel-action","switch-equipment","reaction-accept","reaction-decline","open-character-sheet","move-to-hex","token-selected","hex-selected","hex-double-tap","action-target-selected"],setup(m,{emit:L}){const u=m,S=L,y=Ke();Rt(),nt();const{myCharacters:p,activeCharacter:_,activeCharacterId:E}=He(y),v=["battle-map","character-sheet","chat"],A=J("battle-map"),Y=j(()=>v.indexOf(A.value)),se=[{id:"main",label:"Основное",icon:"mdi:account"},{id:"items",label:"Вещи",icon:"mdi:bag-personal"},{id:"social",label:"Социум",icon:"mdi:account-group"},{id:"magic",label:"Магия",icon:"mdi:auto-fix"}],V=J("main"),W=[{id:"battle-map",label:"Карта",icon:"mdi:map"},{id:"character-sheet",label:"Персонаж",icon:"mdi:account"},{id:"chat",label:"Чат",icon:"mdi:chat"}],O=J(!1),ae=J(!1),B=J({startX:0,startY:0,currentX:0,isDragging:!1,threshold:80}),R=j(()=>{if(B.value.isDragging){const o=B.value.currentX-B.value.startX,h=100;return Math.max(-h,Math.min(h,o))}return 0}),D=o=>{B.value.startX=o.touches[0].clientX,B.value.startY=o.touches[0].clientY,B.value.currentX=o.touches[0].clientX,B.value.isDragging=!1},X=o=>{const h=o.touches[0].clientX-B.value.startX,I=o.touches[0].clientY-B.value.startY;Math.abs(h)>Math.abs(I)&&Math.abs(h)>15&&(o.preventDefault(),B.value.isDragging=!0,B.value.currentX=o.touches[0].clientX)},d=()=>{if(!B.value.isDragging)return;const o=B.value.currentX-B.value.startX;if(Math.abs(o)>50){const h=Y.value;o>0&&h>0?(A.value=v[h-1],S("set-view",v[h-1])):o<0&&h<v.length-1&&(A.value=v[h+1],S("set-view",v[h+1]))}B.value.isDragging=!1},b=o=>{A.value=o,S("set-view",o)},T=()=>{ae.value=!ae.value},l=()=>{O.value=!O.value},i=j(()=>u.connectionStatus==="in-room"?"connected":u.connectionStatus==="connecting"?"connecting":"disconnected"),r=j(()=>u.connectionStatus==="in-room"?"онлайн":u.connectionStatus==="connecting"?"подкл...":"офлайн"),f=j(()=>A.value==="battle-map"?"map":A.value==="character-sheet"?"character":"chat"),x=[{id:"move",label:"Движение",icon:"mdi:walk"},{id:"attack",label:"Атака",icon:"mdi:sword"},{id:"defend",label:"Защита",icon:"mdi:shield"},{id:"skill",label:"Навык",icon:"mdi:auto-fix"}],z=o=>{S("select-action",o)},U=o=>{S("token-selected",o)},le=o=>{S("hex-selected",o)},me=o=>{S("hex-double-tap",o)},ie=o=>{S("action-target-selected",o)};return(o,h)=>(t(),s("div",{class:G(["mobile-game-layout",{"player-turn":m.isPlayerTurn}])},[e("div",{class:G(["info-panel-overlay",{collapsed:O.value}])},[f.value==="map"?(t(),Me(Ot,{key:0,"selected-token":m.selectedToken,"selected-hex":m.selectedHex,"player-character":m.character,"player-facing":m.playerFacing,collapsed:O.value,"is-player-turn":m.isPlayerTurn,"player-token-position":m.playerTokenPosition,onToggleCollapse:h[0]||(h[0]=I=>O.value=!O.value),onOpenCharacterSheet:h[1]||(h[1]=I=>{S("open-character-sheet",I),A.value="character-sheet"}),onSwitchEquipment:h[2]||(h[2]=I=>o.$emit("switch-equipment")),onMoveToHex:h[3]||(h[3]=I=>o.$emit("move-to-hex",I))},null,8,["selected-token","selected-hex","player-character","player-facing","collapsed","is-player-turn","player-token-position"])):f.value==="character"?(t(),Me(Ot,{key:1,"selected-token":null,"selected-hex":null,"player-character":c(_),"player-facing":0,collapsed:O.value,"is-player-turn":m.isPlayerTurn,"player-token-position":null,"always-show-player":!0,onToggleCollapse:h[4]||(h[4]=I=>O.value=!O.value),onOpenCharacterSheet:h[5]||(h[5]=I=>S("open-character-sheet",I)),onSwitchEquipment:h[6]||(h[6]=I=>o.$emit("switch-equipment"))},null,8,["player-character","collapsed","is-player-turn"])):(t(),s("div",{key:2,class:"info-panel-content",onClick:l},[O.value?(t(),s("div",lm,[k(c(q),{icon:"mdi:chat",class:"collapsed-chat-icon"}),h[14]||(h[14]=e("span",{class:"collapsed-name"},"Игровой чат",-1)),k(c(q),{icon:"mdi:chevron-down",class:"collapse-icon"})])):(t(),s(N,{key:1},[e("div",nm,[e("button",{class:"collapse-btn",onClick:ye(l,["stop"])},[k(c(q),{icon:"mdi:chevron-up"})]),h[15]||(h[15]=e("span",{class:"panel-title"},"Игровой чат",-1))]),e("div",{class:"chat-info-expanded",onClick:h[7]||(h[7]=ye(()=>{},["stop"]))},[...h[16]||(h[16]=[e("p",{class:"chat-hint"},"Общайтесь с другими игроками и мастером",-1)])])],64))]))],2),e("div",om,[e("div",{class:"screens-container",style:ue({transform:`translateX(calc(-${Y.value*(100/3)}% + ${R.value}px))`,transition:B.value.isDragging?"none":"transform 300ms ease-out"})},[e("div",am,[k(Yt,{readonly:!m.isPlayerTurn,"mobile-mode":!0,"pending-action":m.pendingAction,onActionTargetSelected:ie,onTokenSelected:U,onHexSelected:le,onHexDoubleTap:me},null,8,["readonly","pending-action"])]),e("div",im,[k(sm,{embedded:!0,"active-tab":V.value,"onUpdate:activeTab":h[8]||(h[8]=I=>V.value=I)},null,8,["active-tab"])]),e("div",cm,[k(zt)])],4)]),e("div",{class:"action-panel",onTouchstart:D,onTouchmove:X,onTouchend:d},[A.value==="battle-map"?(t(),s(N,{key:0},[m.pendingAction?(t(),s("div",rm,[e("div",dm,[k(c(q),{icon:m.pendingAction.icon,class:"action-icon"},null,8,["icon"]),e("span",null,n(m.pendingAction.title),1)]),e("div",um,[e("button",{class:"btn-cancel",onClick:h[9]||(h[9]=I=>S("cancel-action"))},"Отмена"),e("button",{class:"btn-confirm",disabled:!m.pendingAction.canConfirm,onClick:h[10]||(h[10]=I=>S("confirm-action"))},"OK",8,fm)])])):(t(),s("div",vm,[(t(),s(N,null,K(x,I=>e("button",{key:I.id,class:"action-btn",onClick:H=>z(I)},[k(c(q),{icon:I.icon,class:"btn-icon"},null,8,["icon"]),e("span",mm,n(I.label),1)],8,pm)),64))]))],64)):A.value==="character-sheet"?(t(),s("div",hm,[(t(),s(N,null,K(se,I=>e("button",{key:I.id,class:G(["sheet-tab",{active:V.value===I.id}]),onClick:H=>V.value=I.id},[k(c(q),{icon:I.icon,class:"tab-icon"},null,8,["icon"]),e("span",bm,n(I.label),1)],10,xm)),64))])):(t(),s("div",gm,[...h[17]||(h[17]=[e("span",{class:"chat-hint-text"},"Используйте поле ввода внизу чата",-1)])]))],32),e("div",ym,[e("button",{class:"menu-btn",onClick:T},[k(c(q),{icon:"mdi:menu"})]),e("div",_m,[(t(),s(N,null,K(W,I=>e("button",{key:I.id,class:G(["nav-tab",{active:A.value===I.id}]),onClick:H=>b(I.id)},[k(c(q),{icon:I.icon,class:"nav-icon"},null,8,["icon"])],10,km)),64))]),e("div",{class:G(["connection-status",i.value])},[e("span",$m,n(r.value),1),h[18]||(h[18]=e("div",{class:"status-dot"},null,-1))],2)]),k(Xt,{name:"menu-fade"},{default:Vt(()=>[ae.value?(t(),s("div",{key:0,class:"menu-overlay",onClick:h[13]||(h[13]=I=>ae.value=!1)},[e("div",{class:"menu-content",onClick:h[12]||(h[12]=ye(()=>{},["stop"]))},[e("button",{class:"menu-item exit",onClick:h[11]||(h[11]=I=>{S("leave-room"),ae.value=!1})},[k(c(q),{icon:"mdi:exit-to-app"}),h[19]||(h[19]=e("span",null,"Выйти из комнаты",-1))])])])):g("",!0)]),_:1})],2))}},Cm=Oe(wm,[["__scopeId","data-v-3963cf16"]]),Bt=()=>window.innerWidth<768,Sm=()=>{let m=document.querySelector('meta[name="viewport"]');m||(m=document.createElement("meta"),m.name="viewport",document.head.appendChild(m)),m.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"},Tm={class:"h-screen bg-slate-950 text-slate-50 flex flex-col overflow-hidden"},Mm={key:0,class:"flex-1 flex items-center justify-center"},Dm={key:1,class:"flex-1 flex items-center justify-center"},Am={class:"text-center"},Em={class:"text-rose-400 mb-4"},qm={class:"bg-slate-900/90 backdrop-blur border-b border-white/10 px-4 py-3 flex items-center justify-between flex-shrink-0"},jm={class:"flex items-center gap-4"},Pm={class:"text-sm px-3 py-1 rounded-full bg-slate-800 border border-white/10 font-mono tracking-wider"},Om={class:"flex gap-1"},Bm=["onClick"],Wm={class:"hidden sm:inline"},Vm={class:"flex items-center gap-3"},Xm={class:"text-sm hidden sm:inline"},Rm={class:"flex-1 overflow-hidden"},Um={__name:"PlayerRoom",setup(m){const L=us(),u=fs(),S=ot(),y=nt(),p=Ke(),_=Rt(),{roomId:E,status:v,connections:A}=He(S),{nickname:Y,avatar:se,currentView:V}=He(y),{characters:W}=He(p);j(()=>v.value==="in-room"||v.value==="ready");const O=j(()=>v.value==="connecting"?"Подключение...":v.value==="in-room"?"● Подключено":v.value==="error"?"○ Ошибка":"○ Отключено"),ae=j(()=>v.value==="in-room"?"bg-emerald-500/20 text-emerald-400":v.value==="connecting"?"bg-amber-500/20 text-amber-400":"bg-rose-500/20 text-rose-400"),B=J("battle-map"),R=J(!0),D=J(""),X=J(Bt()),d=J(null),b=J(null),T=J(null),l=J(null),i=j(()=>{var ee;if(!x.value)return 0;const w=(ee=_.getTokenByCharacterId)==null?void 0:ee.call(_,x.value.id);return(w==null?void 0:w.facing)||0}),r=j(()=>{if(!x.value)return null;const w=_.activeMapId;return w?_.findTokenPosition(w,x.value.id):null});console.log("PlayerRoom: isMobile =",X.value,"screen width =",window.innerWidth);const f=[{id:"chat",label:"Чат",icon:"💬"},{id:"character-sheet",label:"Персонаж",icon:"👤"},{id:"battle-map",label:"Карта",icon:"🗺️"}],x=j(()=>{const w=y.userId;console.log("Поиск персонажа игрока:",{userId:w,characters:W.value.length});const ee=W.value.find(be=>be.ownerId===w);return console.log("Найденный персонаж:",ee),ee}),z=J(null),U=j(()=>!0);ht(async()=>{const w=L.params.roomId;if(!w){u.push("/");return}X.value&&Sm();try{S.joinRoom(w),R.value=!1,$()}catch{D.value="Не удалось подключиться к комнате",R.value=!1}const ee=()=>{X.value=Bt()};window.addEventListener("resize",ee),Dt(()=>{window.removeEventListener("resize",ee)})}),Dt(()=>{S.leaveRoom()});const le=w=>{B.value=w},me=()=>{S.leaveRoom(),u.push("/")},ie=w=>{d.value={id:w.id,title:w.label,description:ce(w.id),icon:w.icon,canConfirm:!1}},o=()=>{d.value&&d.value.target&&(console.log("Выполняем действие:",d.value.id,"цель:",d.value.target),d.value.id==="move"&&d.value.target.type==="hex"?h(d.value.target.hex):d.value.id==="attack"&&d.value.target.characterId&&I(d.value.target),d.value=null)},h=w=>{var Ee;const ee=x.value;if(!ee){console.warn("Персонаж игрока не найден");return}console.log(`Перемещаем персонажа ${ee.name} на гекс q:${w.q}, r:${w.r}`);const be=_.activeMapId;if(!be){console.warn("Нет активной карты для перемещения");return}console.log("Активная карта:",be),_.moveTokenByCharacterId(be,ee.id,w.q,w.r)?console.log("Токен перемещен на существующей карте"):(console.log("Токен не найден на карте, размещаем впервые"),_.placeToken(be,ee.id,w.q,w.r)?console.log("Токен успешно размещен на карте"):console.warn("Не удалось разместить токен на карте. Возможно гекс занят.")),(Ee=ee.combat)!=null&&Ee.position?p.moveOnMap(ee.id,w.q,w.r):p.placeOnMap(ee.id,be,w.q,w.r);const Se=S.role==="player"&&S.status==="in-room";console.log("Проверка сессии для отправки:",{role:S.role,status:S.status,isConnectedToMaster:Se}),Se&&(console.log("Отправляем перемещение мастеру..."),S.broadcastCharacterMove(ee.id,w.q,w.r))},I=w=>{console.log("Атакуем цель:",w.characterId)},H=w=>{var ee;d.value&&(d.value.target=w,d.value.canConfirm=!0,w.type==="hex"?d.value.description=`Переместиться на гекс (${w.hex.q}, ${w.hex.r})`:w.characterId&&(d.value.description=`Цель: ${((ee=w.character)==null?void 0:ee.name)||"Неизвестный"}`))},ne=()=>{d.value=null},ce=w=>({move:"Выберите место для перемещения",attack:"Выберите цель для атаки",defend:"Выберите сектор защиты",skill:"Выберите навык и цель",ready:"Сигнализировать о готовности",help:"Показать справку"})[w]||"Выберите действие",de=w=>{b.value=w,w&&(T.value=null)},$e=w=>{T.value=w},he=w=>{w&&(console.log("Перемещение на гекс из инфокарточки:",w),h(w),T.value=null)},ge=w=>{w&&U.value&&(console.log("Двойной тап по гексу - перемещение:",w),h(w),T.value=null)},ve=()=>{console.log("Смена снаряжения")},F=w=>{w&&p.setActiveCharacter(w),le("character-sheet")},P=w=>{console.log("Игрок принял реакцию:",w),S.status==="in-room"&&S.sendReactionResponse(w,!0),l.value=null},Q=w=>{console.log("Игрок отклонил реакцию:",w),S.status==="in-room"&&S.sendReactionResponse(w,!1),l.value=null},$=()=>{S.onMessage("reaction-prompt",w=>{console.log("Получено предложение реакции:",w),l.value={id:w.id,title:w.title||"Реакция!",description:w.description||"Можете использовать реакцию",timeoutSeconds:w.timeoutSeconds||5,startedAt:Date.now()}})};return(w,ee)=>(t(),s("div",Tm,[R.value?(t(),s("div",Mm,[...ee[1]||(ee[1]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin text-4xl mb-4"},"⏳"),e("p",{class:"text-slate-400"},"Подключение к комнате...")],-1)])])):D.value?(t(),s("div",Dm,[e("div",Am,[ee[2]||(ee[2]=e("div",{class:"text-4xl mb-4"},"😔",-1)),e("p",Em,n(D.value),1),e("button",{type:"button",class:"px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition",onClick:ee[0]||(ee[0]=be=>c(u).push("/"))}," Вернуться ")])])):X.value?(t(),Me(Cm,{key:2,character:x.value,characters:c(W),"selected-token":b.value,"selected-hex":T.value,"player-facing":i.value,"player-token-position":r.value,"connection-status":c(v),"current-turn":z.value,"is-player-turn":U.value,"pending-action":d.value,"reaction-prompt":l.value,onSetView:le,onLeaveRoom:me,onSelectAction:ie,onConfirmAction:o,onCancelAction:ne,onSwitchEquipment:ve,onReactionAccept:P,onReactionDecline:Q,onOpenCharacterSheet:F,onMoveToHex:he,onTokenSelected:de,onHexSelected:$e,onHexDoubleTap:ge,onActionTargetSelected:H},null,8,["character","characters","selected-token","selected-hex","player-facing","player-token-position","connection-status","current-turn","is-player-turn","pending-action","reaction-prompt"])):(t(),s(N,{key:3},[e("header",qm,[e("div",jm,[e("button",{type:"button",class:"text-slate-400 hover:text-white transition",onClick:me,title:"Выйти из комнаты"}," ← Выход "),ee[3]||(ee[3]=e("div",{class:"h-6 w-px bg-white/10"},null,-1)),e("span",Pm,n(c(L).params.roomId),1),e("span",{class:G(["px-2 py-0.5 rounded text-xs",ae.value])},n(O.value),3)]),e("nav",Om,[(t(),s(N,null,K(f,be=>e("button",{key:be.id,type:"button",class:G(["px-4 py-2 rounded-lg text-sm transition flex items-center gap-2",B.value===be.id?"bg-sky-500/20 text-sky-400 border border-sky-400/40":"text-slate-400 hover:text-white hover:bg-white/5"]),onClick:_e=>le(be.id)},[e("span",null,n(be.icon),1),e("span",Wm,n(be.label),1)],10,Bm)),64))]),e("div",Vm,[k(ys,{avatar:c(se),size:32},null,8,["avatar"]),e("span",Xm,n(c(Y)),1)])]),e("main",Rm,[je(k(zt,null,null,512),[[ze,B.value==="chat"]]),je(k(Ov,null,null,512),[[ze,B.value==="character-sheet"]]),je(k(Yt,{readonly:!0},null,512),[[ze,B.value==="battle-map"]])])],64)),k(t0)]))}};export{Um as default};
