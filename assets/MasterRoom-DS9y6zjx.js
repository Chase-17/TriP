import{D as S,u as g,a as R,s as u,n as k,o as I,E as x,r as l,c as M,y as B,g as m}from"./index-CduOqXut.js";import{a as L,b as _,d as E,u as T}from"./fillProfile-dB6AUmU-.js";import{G as w}from"./GameLayout-DxnqB2Sj.js";import"./UserAvatar-CwDA-9dA.js";const A={__name:"MasterRoom",setup(D){const i=S(),r=g(),t=L();R(),_();const n=E(),d=T(),{roomId:G,status:p,connections:v}=u(t),{characters:f}=u(d);k(()=>v.value||[]),I(async()=>{const o=i.params.roomId;if(!o){r.push("/master");return}t.setRole("master"),t.roomId=o;try{await t.createRoom(),t.onMessage("scene-event",e=>{console.log("Получено событие сцены от игрока:",e),e.event&&n.handleIncomingEvent(e.event)}),t.onMessage("skill-check-result",e=>{console.log("Получен результат проверки от игрока:",e),e.eventId&&e.result&&n.updateEvent(e.eventId,{completed:!0,result:e.result,completedBy:e.senderId,completedAt:Date.now(),characterName:e.characterName})})}catch(e){console.error("Ошибка создания комнаты:",e)}}),x(()=>{t.leaveRoom()});const h=()=>{t.leaveRoom(),r.push("/master")},a=l(null),c=l(null);return(o,e)=>(M(),B(w,{"is-master":!0,character:null,characters:m(f),"selected-token":a.value,"selected-hex":c.value,"player-facing":0,"player-token-position":null,"connection-status":m(p),"current-turn":null,"is-player-turn":!0,"pending-action":null,"reaction-prompt":null,onLeaveRoom:h,onTokenSelected:e[0]||(e[0]=s=>a.value=s),onHexSelected:e[1]||(e[1]=s=>c.value=s)},null,8,["characters","selected-token","selected-hex","connection-status"]))}};export{A as default};
