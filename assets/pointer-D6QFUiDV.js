import{q as c}from"./index-gQaYO5ct.js";import{u as i}from"./fillProfile-BtIfjwhZ.js";const n={NONE:"none",POINTER:"pointer",PING:"ping",DRAW:"draw",ARROW:"arrow",CIRCLE:"circle",CONE:"cone",LINE:"line",MEASURE:"measure",RANGE:"range"},l={RED:"#ef4444",ORANGE:"#f97316",YELLOW:"#eab308",GREEN:"#22c55e",BLUE:"#3b82f6",PURPLE:"#a855f7",WHITE:"#ffffff"},h=3e3,p=c("pointer",{state:()=>({activeTool:n.NONE,activeColor:l.YELLOW,masterPointer:null,pings:[],drawings:[],currentDrawing:null,shapes:[],currentShape:null,measurement:null,rangeDisplay:null,movementRange:null,hoveredPath:null,autoCleanupSeconds:0,lineWidth:3,showPointerToPlayers:!0}),getters:{isToolActive:e=>e.activeTool!==n.NONE,activePings:e=>{const t=Date.now();return e.pings.filter(s=>t-s.time<s.lifetime)},activeDrawings:e=>{if(e.autoCleanupSeconds===0)return e.drawings;const t=Date.now(),s=e.autoCleanupSeconds*1e3;return e.drawings.filter(r=>t-r.time<s)}},actions:{setTool(e){this.activeTool===n.MEASURE&&e!==n.MEASURE&&this.finishMeasurement(),this.activeTool===n.RANGE&&e!==n.RANGE&&this.hideRange(),this.activeTool=e},setColor(e){this.activeColor=e},setLineWidth(e){this.lineWidth=Math.max(1,Math.min(20,e))},updatePointer(e,t){this.masterPointer={x:e,y:t,time:Date.now()},this._broadcastPointerUpdate()},clearPointer(){this.masterPointer=null,this._broadcastPointerClear()},receivePointerUpdate(e){e.pointer?this.masterPointer=e.pointer:this.masterPointer=null},addPing(e,t,s=null){const r={id:crypto.randomUUID(),x:e,y:t,color:s||this.activeColor,time:Date.now(),lifetime:h};return this.pings.push(r),this._broadcastPing(r),setTimeout(()=>{this.removePing(r.id)},h),r},removePing(e){const t=this.pings.findIndex(s=>s.id===e);t!==-1&&this.pings.splice(t,1)},receivePing(e){this.pings.push(e),setTimeout(()=>{this.removePing(e.id)},e.lifetime)},startDrawing(e,t){this.currentDrawing={points:[{x:e,y:t}],color:this.activeColor,width:this.lineWidth}},continueDrawing(e,t){if(!this.currentDrawing)return;const s=this.currentDrawing.points[this.currentDrawing.points.length-1],r=e-s.x,a=t-s.y;Math.sqrt(r*r+a*a)>2&&this.currentDrawing.points.push({x:e,y:t})},finishDrawing(){if(!this.currentDrawing||this.currentDrawing.points.length<2)return this.currentDrawing=null,null;const e={id:crypto.randomUUID(),...this.currentDrawing,time:Date.now()};return this.drawings.push(e),this._broadcastDrawing(e),this.currentDrawing=null,e},cancelDrawing(){this.currentDrawing=null},receiveDrawing(e){this.drawings.push(e)},startShape(e,t){this.currentShape={type:this.activeTool,start:{x:e,y:t},end:{x:e,y:t},color:this.activeColor}},updateShape(e,t){this.currentShape&&(this.currentShape.end={x:e,y:t})},finishShape(){if(!this.currentShape)return null;const e={id:crypto.randomUUID(),...this.currentShape,time:Date.now()};return this.shapes.push(e),this._broadcastShape(e),this.currentShape=null,e},cancelShape(){this.currentShape=null},receiveShape(e){this.shapes.push(e)},startMeasurement(e,t,s,r){this.measurement={start:{x:e,y:t,q:s,r},end:{x:e,y:t,q:s,r},distance:0,path:[{q:s,r}]}},updateMeasurement(e,t,s,r,a,o){this.measurement&&(this.measurement.end={x:e,y:t,q:s,r},this.measurement.distance=a,this.measurement.path=o||[],this._broadcastMeasurement())},finishMeasurement(){this.measurement=null,this._broadcastMeasurementClear()},receiveMeasurement(e){this.measurement=e.measurement},showRange(e,t,s,r){this.rangeDisplay={center:{q:e,r:t},radius:s,hexes:r||[]},this._broadcastRange()},hideRange(){this.rangeDisplay=null,this._broadcastRangeClear()},receiveRange(e){this.rangeDisplay=e.range},showMovementRange(e,t,s,r){this.movementRange={characterId:e,center:t,hexes:s||[],maxCost:r}},hideMovementRange(){this.movementRange=null,this.hoveredPath=null},showHoveredPath(e,t,s,r={},a=null){this.hoveredPath={segments:e||[],totalCost:t,targetHex:s,resources:r,suggestedFacing:a,selectedFacing:null}},setPathFacing(e){this.hoveredPath&&(this.hoveredPath.selectedFacing=e)},getPathFacing(){return this.hoveredPath?this.hoveredPath.selectedFacing??this.hoveredPath.suggestedFacing??0:0},hideHoveredPath(){this.hoveredPath=null},clearAll(){this.pings=[],this.drawings=[],this.shapes=[],this.currentDrawing=null,this.currentShape=null,this._broadcastClear()},clearDrawings(){this.drawings=[],this.currentDrawing=null,this._broadcastClearDrawings()},clearShapes(){this.shapes=[],this.currentShape=null,this._broadcastClearShapes()},receiveClear(e){switch(e){case"all":this.pings=[],this.drawings=[],this.shapes=[];break;case"drawings":this.drawings=[];break;case"shapes":this.shapes=[];break}},getFullState(){return{pointer:this.masterPointer,pings:this.activePings,drawings:this.activeDrawings,shapes:this.shapes}},applyFullState(e){e.pointer&&(this.masterPointer=e.pointer),e.pings&&(this.pings=e.pings),e.drawings&&(this.drawings=e.drawings),e.shapes&&(this.shapes=e.shapes)},_broadcastPointerUpdate(){if(!this.showPointerToPlayers)return;const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-update",pointer:this.masterPointer})},_broadcastPointerClear(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-update",pointer:null})},_broadcastPing(e){const t=i();t.isMaster&&t.broadcastPayload({type:"pointer-ping",ping:e})},_broadcastDrawing(e){const t=i();t.isMaster&&t.broadcastPayload({type:"pointer-drawing",drawing:e})},_broadcastShape(e){const t=i();t.isMaster&&t.broadcastPayload({type:"pointer-shape",shape:e})},_broadcastClear(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-clear",clearType:"all"})},_broadcastClearDrawings(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-clear",clearType:"drawings"})},_broadcastClearShapes(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-clear",clearType:"shapes"})},_broadcastMeasurement(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-measurement",measurement:this.measurement})},_broadcastMeasurementClear(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-measurement",measurement:null})},_broadcastRange(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-range",range:this.rangeDisplay})},_broadcastRangeClear(){const e=i();e.isMaster&&e.broadcastPayload({type:"pointer-range",range:null})}}});export{l as POINTER_COLORS,n as POINTER_TOOLS,p as usePointerStore};
